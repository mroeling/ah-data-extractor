{"version":3,"file":"index-DHp6-Usn.js","sources":["../../node_modules/@aurelia/metadata/dist/esm/index.dev.mjs","../../node_modules/@aurelia/kernel/dist/esm/index.dev.mjs","../../node_modules/@aurelia/vite-plugin/node_modules/@aurelia/expression-parser/dist/esm/index.dev.mjs","../../node_modules/@aurelia/template-compiler/dist/esm/index.dev.mjs","../../node_modules/@aurelia/vite-plugin/node_modules/@aurelia/runtime/dist/esm/index.dev.mjs","../../node_modules/@aurelia/platform/dist/esm/index.dev.mjs","../../node_modules/@aurelia/platform-browser/dist/esm/index.dev.mjs","../../node_modules/@aurelia/runtime-html/dist/esm/index.dev.mjs","../../node_modules/aurelia/dist/esm/index.dev.mjs","../../src/components/data-extractor-view.html?raw","../../src/nest-analysis/shapefile.ts","../../src/nest-analysis/dbf.ts","../../src/nest-analysis/geojson.ts","../../src/components/crc-table.ts","../../src/components/data-extractor-view.ts","../../src/main.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/**\n * TODO: add description.\n * References:\n * - https://github.com/tc39/proposal-decorator-metadata\n * - https://github.com/microsoft/TypeScript/issues/55788\n */\nfunction initializeTC39Metadata() {\n    // We need the any-coercion here because the metadata in Symbol is marked as unique symbol.\n    // And the symbol we are creating here is not assignable to the unique symbol.\n    // More info: https://github.com/Microsoft/TypeScript/issues/23388\n    Symbol.metadata ??= Symbol.for(\"Symbol.metadata\");\n}\nconst Metadata = {\n    get(key, type) {\n        return type[Symbol.metadata]?.[key];\n    },\n    define(value, type, ...keys) {\n        // Define metadata on the type, when absent.\n        // Note that TS also does exactly that when decorators are used.\n        // This avoids the problem of children inheriting and overwriting metadata from their parents.\n        let metadata = Object.getOwnPropertyDescriptor(type, Symbol.metadata)?.value;\n        if (metadata == null) {\n            Object.defineProperty(type, Symbol.metadata, { value: metadata = Object.create(null), enumerable: true, configurable: true, writable: true });\n        }\n        const length = keys.length;\n        switch (length) {\n            case 0: throw new Error('At least one key must be provided');\n            case 1:\n                metadata[keys[0]] = value;\n                return;\n            case 2:\n                metadata[keys[0]] = metadata[keys[1]] = value;\n                return;\n            default: {\n                for (let i = 0; i < length; ++i) {\n                    metadata[keys[i]] = value;\n                }\n                return;\n            }\n        }\n    },\n    has(key, type) {\n        const metadata = type[Symbol.metadata];\n        return metadata == null\n            ? false\n            : key in metadata;\n    },\n    delete(key, type) {\n        const metadata = type[Symbol.metadata];\n        if (metadata == null)\n            return;\n        Reflect.deleteProperty(metadata, key);\n        return;\n    },\n};\n\nexport { Metadata, initializeTC39Metadata };\n//# sourceMappingURL=index.dev.mjs.map\n","import { Metadata, initializeTC39Metadata } from '@aurelia/metadata';\n\n/** @internal */ const objectFreeze = Object.freeze;\n/** @internal */ const objectAssign = Object.assign;\n/** @internal */ const safeString = String;\n/** @internal */ const getMetadata = Metadata.get;\n/** @internal */ Metadata.has;\n/** @internal */ const defineMetadata = Metadata.define;\n/**\n * Returns true if the value is a Promise via checking if it's an instance of Promise.\n * This does not work for objects across different realms (e.g., iframes).\n * An utility to be shared among core packages for better size optimization\n */\nconst isPromise = (v) => v instanceof Promise;\n/**\n * Returns true if the value is an Array via checking if it's an instance of Array.\n * This does not work for objects across different realms (e.g., iframes).\n * An utility to be shared among core packages for better size optimization\n */\nconst isArray = (v) => v instanceof Array;\n/**\n * Returns true if the value is a Set via checking if it's an instance of Set.\n * This does not work for objects across different realms (e.g., iframes).\n * An utility to be shared among core packages for better size optimization\n */\nconst isSet = (v) => v instanceof Set;\n/**\n * Returns true if the value is a Map via checking if it's an instance of Map.\n * This does not work for objects across different realms (e.g., iframes).\n * An utility to be shared among core packages for better size optimization\n */\nconst isMap = (v) => v instanceof Map;\n/**\n * Returns true if the value is an object via checking if it's an instance of Object.\n * This does not work for objects across different realms (e.g., iframes).\n * An utility to be shared among core packages only for better size optimization\n *\n * This is semi private to core packages and applications should not depend on this.\n */\nconst isObject = (v) => v instanceof Object;\n/**\n * IMPORTANT: This is semi private to core packages and applications should not depend on this.\n *\n * Determine whether a value is an object.\n *\n * Uses `typeof` to guarantee this works cross-realm, which is where `instanceof Object` might fail.\n *\n * Some environments where these issues are known to arise:\n * - same-origin iframes (accessing the other realm via `window.top`)\n * - `jest`.\n *\n * The exact test is:\n * ```ts\n * typeof value === 'object' && value !== null || typeof value === 'function'\n * ```\n *\n * @param value - The value to test.\n * @returns `true` if the value is an object, otherwise `false`.\n * Also performs a type assertion that defaults to `value is Object | Function` which, if the input type is a union with an object type, will infer the correct type.\n * This can be overridden with the generic type argument.\n *\n * @example\n *\n * ```ts\n * class Foo {\n *   bar = 42;\n * }\n *\n * function doStuff(input?: Foo | null) {\n *   input.bar; // Object is possibly 'null' or 'undefined'\n *\n *   // input has an object type in its union (Foo) so that type will be extracted for the 'true' condition\n *   if (isObject(input)) {\n *     input.bar; // OK (input is now typed as Foo)\n *   }\n * }\n *\n * function doOtherStuff(input: unknown) {\n *   input.bar; // Object is of type 'unknown'\n *\n *   // input is 'unknown' so there is no union type to match and it will default to 'Object | Function'\n *   if (isObject(input)) {\n *     input.bar; // Property 'bar' does not exist on type 'Object | Function'\n *   }\n *\n *   // if we know for sure that, if input is an object, it must be a specific type, we can explicitly tell the function to assert that for us\n *   if (isObject<Foo>(input)) {\n *    input.bar; // OK (input is now typed as Foo)\n *   }\n * }\n * ```\n *\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\nfunction isObjectOrFunction(value) {\n    return typeof value === 'object' && value !== null || typeof value === 'function';\n}\n/**\n * Returns true if the value is a function\n * An utility to be shared among core packages for better size optimization\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\nconst isFunction = (v) => typeof v === 'function';\n/**\n * Returns true if the value is a string\n * An utility to be shared among core packages for better size optimization\n */\nconst isString = (v) => typeof v === 'string';\n/**\n * Returns true if the value is a symbol\n * An utility to be shared among core packages for better size optimization\n */\nconst isSymbol = (v) => typeof v === 'symbol';\n/**\n * Returns true if the value is a number\n * An utility to be shared among core packages for better size optimization\n */\nconst isNumber = (v) => typeof v === 'number';\n/**\n * Create an object with no prototype to be used as a record\n * An utility to be shared among core packages for better size optimization\n */\nconst createLookup = () => Object.create(null);\n/**\n * Compare the 2 values without pitfall of JS ===, including NaN and +0/-0\n * An utility to be shared among core packages for better size optimization\n */\nconst areEqual = Object.is;\n\n/* eslint-disable prefer-template */\n/** @internal */\nconst createMappedError = (code, ...details) => {\n        const paddedCode = safeString(code).padStart(4, '0');\n        const message = getMessageByCode(code, ...details);\n        const link = `https://docs.aurelia.io/developer-guides/error-messages/0001-to-0023/aur${paddedCode}`;\n        return new Error(`AUR${paddedCode}: ${message}\\\\n\\\\nFor more information, see: ${link}`);\n    }\n    ;\n\nconst errorsMap = {\n    [1 /* ErrorNames.no_registration_for_interface */]: `No registration for interface: '{{0}}'`,\n    [2 /* ErrorNames.none_resolver_found */]: `'{{0}}' was registered with \"none\" resolver, are you injecting the right key?`,\n    [3 /* ErrorNames.cyclic_dependency */]: `Cyclic dependency found: {{0}}`,\n    [4 /* ErrorNames.no_factory */]: `Resolver for {{0}} returned a null factory`,\n    [5 /* ErrorNames.invalid_resolver_strategy */]: `Invalid resolver strategy specified: {{0}}. Did you assign an invalid strategy value?`,\n    [6 /* ErrorNames.unable_auto_register */]: `Unable to autoregister dependency: {{0}}`,\n    [7 /* ErrorNames.resource_already_exists */]: `Resource key \"{{0}}\" already registered`,\n    [8 /* ErrorNames.unable_resolve_key */]: `Unable to resolve key: {{0}}`,\n    [9 /* ErrorNames.unable_jit_non_constructor */]: `Attempted to jitRegister something that is not a constructor: '{{0}}'. Did you forget to register this resource?`,\n    [10 /* ErrorNames.no_jit_intrinsic_type */]: `Attempted to jitRegister an intrinsic type: \"{{0}}\". Did you forget to add @inject(Key)`,\n    [11 /* ErrorNames.null_resolver_from_register */]: `Invalid resolver, null/undefined returned from the static register method.`,\n    [12 /* ErrorNames.no_jit_interface */]: `Attempted to jitRegister an interface: {{0}}`,\n    [13 /* ErrorNames.no_instance_provided */]: `Cannot call resolve '{{0}}' before calling prepare or after calling dispose.`,\n    [14 /* ErrorNames.null_undefined_key */]: `Key cannot be null or undefined. Are you trying to inject/register something that doesn't exist with DI?` +\n        `A common cause is circular dependency with bundler, did you accidentally introduce circular dependency into your module graph?`,\n    [15 /* ErrorNames.no_construct_native_fn */]: `'{{0}}' is a native function and cannot be safely constructed by DI. If this is intentional, please use a callback or cachedCallback resolver.`,\n    [16 /* ErrorNames.no_active_container_for_resolve */]: `There is not a currently active container to resolve \"{{0}}\". Are you trying to \"new Class(...)\" that has a resolve(...) call?`,\n    [17 /* ErrorNames.invalid_new_instance_on_interface */]: `Failed to instantiate '{{0}}' via @newInstanceOf/@newInstanceForScope, there's no registration and no default implementation,`\n        + ` or the default implementation does not result in factory for constructing the instances.`,\n    [18 /* ErrorNames.event_aggregator_publish_invalid_event_name */]: `Invalid channel name or instance: '{{0}}'.`,\n    [19 /* ErrorNames.event_aggregator_subscribe_invalid_event_name */]: `Invalid channel name or type: {{0}}.`,\n    [20 /* ErrorNames.first_defined_no_value */]: `No defined value found when calling firstDefined()`,\n    [21 /* ErrorNames.invalid_module_transform_input */]: `Invalid module transform input: {{0}}. Expected Promise or Object.`,\n    [22 /* ErrorNames.invalid_inject_decorator_usage */]: `The @inject decorator on the target ('{{0}}') type '{{1}}' is not supported.`,\n    [23 /* ErrorNames.resource_key_already_registered */]: `Resource key '{{0}}' has already been registered.`,\n};\nconst getMessageByCode = (name, ...details) => {\n    let cooked = errorsMap[name];\n    for (let i = 0; i < details.length; ++i) {\n        cooked = cooked.replace(`{{${i}}}`, String(details[i]));\n    }\n    return cooked;\n};\n/** @internal */\n// eslint-disable-next-line\nconst logError = (...args) => globalThis.console.error(...args);\n\n/**\n * Efficiently determine whether the provided property key is numeric\n * (and thus could be an array indexer) or not.\n *\n * Always returns true for values of type `'number'`.\n *\n * Otherwise, only returns true for strings that consist only of positive integers.\n *\n * Results are cached.\n */\nconst isArrayIndex = (() => {\n    const isNumericLookup = {};\n    let result = false;\n    let length = 0;\n    let ch = 0;\n    let i = 0;\n    return (value) => {\n        switch (typeof value) {\n            case 'number':\n                return value >= 0 && (value | 0) === value;\n            case 'string':\n                result = isNumericLookup[value];\n                if (result !== void 0) {\n                    return result;\n                }\n                length = value.length;\n                if (length === 0) {\n                    return isNumericLookup[value] = false;\n                }\n                ch = 0;\n                i = 0;\n                for (; i < length; ++i) {\n                    ch = value.charCodeAt(i);\n                    if (i === 0 && ch === 0x30 && length > 1 /* must not start with 0 */ || ch < 0x30 /* 0 */ || ch > 0x39 /* 9 */) {\n                        return isNumericLookup[value] = false;\n                    }\n                }\n                return isNumericLookup[value] = true;\n            default:\n                return false;\n        }\n    };\n})();\n/**\n * Base implementation of camel and kebab cases\n */\nconst baseCase = /*@__PURE__*/ (function () {\n    \n    // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n    const isDigit = objectAssign(createLookup(), {\n        '0': true,\n        '1': true,\n        '2': true,\n        '3': true,\n        '4': true,\n        '5': true,\n        '6': true,\n        '7': true,\n        '8': true,\n        '9': true,\n    });\n    const charToKind = (char) => {\n        if (char === '') {\n            // We get this if we do charAt() with an index out of range\n            return 0 /* CharKind.none */;\n        }\n        if (char !== char.toUpperCase()) {\n            return 3 /* CharKind.lower */;\n        }\n        if (char !== char.toLowerCase()) {\n            return 2 /* CharKind.upper */;\n        }\n        if (isDigit[char] === true) {\n            return 1 /* CharKind.digit */;\n        }\n        return 0 /* CharKind.none */;\n    };\n    return (input, cb) => {\n        const len = input.length;\n        if (len === 0) {\n            return input;\n        }\n        let sep = false;\n        let output = '';\n        let prevKind;\n        let curChar = '';\n        let curKind = 0 /* CharKind.none */;\n        let nextChar = input.charAt(0);\n        let nextKind = charToKind(nextChar);\n        let i = 0;\n        for (; i < len; ++i) {\n            prevKind = curKind;\n            curChar = nextChar;\n            curKind = nextKind;\n            nextChar = input.charAt(i + 1);\n            nextKind = charToKind(nextChar);\n            if (curKind === 0 /* CharKind.none */) {\n                if (output.length > 0) {\n                    // Only set sep to true if it's not at the beginning of output.\n                    sep = true;\n                }\n            }\n            else {\n                if (!sep && output.length > 0 && curKind === 2 /* CharKind.upper */) {\n                    // Separate UAFoo into UA Foo.\n                    // Separate uaFOO into ua FOO.\n                    sep = prevKind === 3 /* CharKind.lower */ || nextKind === 3 /* CharKind.lower */;\n                }\n                output += cb(curChar, sep);\n                sep = false;\n            }\n        }\n        return output;\n    };\n})();\n/**\n * Efficiently convert a string to camelCase.\n *\n * Non-alphanumeric characters are treated as separators.\n *\n * Primarily used by Aurelia to convert DOM attribute names to ViewModel property names.\n *\n * Results are cached.\n */\nconst camelCase = /*@__PURE__*/ (function () {\n    const cache = createLookup();\n    const callback = (char, sep) => {\n        return sep ? char.toUpperCase() : char.toLowerCase();\n    };\n    return (input) => {\n        let output = cache[input];\n        if (output === void 0) {\n            output = cache[input] = baseCase(input, callback);\n        }\n        return output;\n    };\n})();\n/**\n * Efficiently convert a string to PascalCase.\n *\n * Non-alphanumeric characters are treated as separators.\n *\n * Primarily used by Aurelia to convert element names to class names for synthetic types.\n *\n * Results are cached.\n */\nconst pascalCase = /*@__PURE__*/ (function () {\n    const cache = createLookup();\n    return (input) => {\n        let output = cache[input];\n        if (output === void 0) {\n            output = camelCase(input);\n            if (output.length > 0) {\n                output = output[0].toUpperCase() + output.slice(1);\n            }\n            cache[input] = output;\n        }\n        return output;\n    };\n})();\n/**\n * Efficiently convert a string to kebab-case.\n *\n * Non-alphanumeric characters are treated as separators.\n *\n * Primarily used by Aurelia to convert ViewModel property names to DOM attribute names.\n *\n * Results are cached.\n */\nconst kebabCase = /*@__PURE__*/ (function () {\n    const cache = createLookup();\n    const callback = (char, sep) => {\n        return sep ? `-${char.toLowerCase()}` : char.toLowerCase();\n    };\n    return (input) => {\n        let output = cache[input];\n        if (output === void 0) {\n            output = cache[input] = baseCase(input, callback);\n        }\n        return output;\n    };\n})();\n/**\n * Efficiently (up to 10x faster than `Array.from`) convert an `ArrayLike` to a real array.\n *\n * Primarily used by Aurelia to convert DOM node lists to arrays.\n */\nconst toArray = (input) => {\n    // benchmark: http://jsben.ch/xjsyF\n    const length = input.length;\n    const arr = Array(length);\n    let i = 0;\n    for (; i < length; ++i) {\n        arr[i] = input[i];\n    }\n    return arr;\n};\n/**\n * Decorator. Bind the method to the class instance.\n */\nconst bound = (originalMethod, context) => {\n    const methodName = context.name;\n    context.addInitializer(function () {\n        Reflect.defineProperty(this, methodName, {\n            value: originalMethod.bind(this),\n            writable: true,\n            configurable: true,\n            enumerable: false,\n        });\n    });\n};\nconst mergeArrays = (...arrays) => {\n    const result = [];\n    let k = 0;\n    const arraysLen = arrays.length;\n    let arrayLen = 0;\n    let array;\n    let i = 0;\n    for (; i < arraysLen; ++i) {\n        array = arrays[i];\n        if (array !== void 0) {\n            arrayLen = array.length;\n            let j = 0;\n            for (; j < arrayLen; ++j) {\n                result[k++] = array[j];\n            }\n        }\n    }\n    return result;\n};\nconst firstDefined = (...values) => {\n    const len = values.length;\n    let value;\n    let i = 0;\n    for (; len > i; ++i) {\n        value = values[i];\n        if (value !== void 0) {\n            return value;\n        }\n    }\n    throw createMappedError(20 /* ErrorNames.first_defined_no_value */);\n};\n/**\n * Get the prototypes of a class hierarchy. Es6 classes have their parent class as prototype\n * so this will return a list of constructors\n *\n * @example\n * ```ts\n * class A {}\n * class B extends A {}\n *\n * assert.deepStrictEqual(getPrototypeChain(A), [A])\n * assert.deepStrictEqual(getPrototypeChain(B), [B, A])\n * ```\n */\nconst getPrototypeChain = /*@__PURE__*/ (function () {\n    const functionPrototype = Function.prototype;\n    const getPrototypeOf = Object.getPrototypeOf;\n    const cache = new WeakMap();\n    let proto = functionPrototype;\n    let i = 0;\n    let chain = void 0;\n    return function (Type) {\n        chain = cache.get(Type);\n        if (chain === void 0) {\n            cache.set(Type, chain = [proto = Type]);\n            i = 0;\n            while ((proto = getPrototypeOf(proto)) !== functionPrototype) {\n                chain[++i] = proto;\n            }\n        }\n        return chain;\n    };\n})();\n/** @internal */\nfunction toLookup(...objs) {\n    return objectAssign(createLookup(), ...objs);\n}\n/**\n * Determine whether the value is a native function.\n *\n * @param fn - The function to check.\n * @returns `true` is the function is a native function, otherwise `false`\n */\nconst isNativeFunction = /*@__PURE__*/ (() => {\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    const lookup = new WeakMap();\n    let isNative = false;\n    let sourceText = '';\n    let i = 0;\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    return (fn) => {\n        isNative = lookup.get(fn);\n        if (isNative == null) {\n            i = (sourceText = fn.toString()).length;\n            isNative = i > 28 && sourceText.indexOf('[native code] }') === i - 15;\n            lookup.set(fn, isNative);\n        }\n        return isNative;\n    };\n})();\n/**\n * Normalize a potential promise via a callback, to ensure things stay synchronous when they can.\n *\n * If the value is a promise, it is `then`ed before the callback is invoked. Otherwise the callback is invoked synchronously.\n */\nconst onResolve \n// implementation\n= (maybePromise, resolveCallback) => {\n    if (isPromise(maybePromise)) {\n        return maybePromise.then(resolveCallback);\n    }\n    return resolveCallback(maybePromise);\n};\n/**\n * Normalize an array of potential promises, to ensure things stay synchronous when they can.\n *\n * If exactly one value is a promise, then that promise is returned.\n *\n * If more than one value is a promise, a new `Promise.all` is returned.\n *\n * If none of the values is a promise, nothing is returned, to indicate that things can stay synchronous.\n */\nconst onResolveAll = (...maybePromises) => {\n    let maybePromise = void 0;\n    let firstPromise = void 0;\n    let promises = void 0;\n    let i = 0;\n    // eslint-disable-next-line\n    let ii = maybePromises.length;\n    for (; i < ii; ++i) {\n        maybePromise = maybePromises[i];\n        if (isPromise(maybePromise = maybePromises[i])) {\n            if (firstPromise === void 0) {\n                firstPromise = maybePromise;\n            }\n            else if (promises === void 0) {\n                promises = [firstPromise, maybePromise];\n            }\n            else {\n                promises.push(maybePromise);\n            }\n        }\n    }\n    if (promises === void 0) {\n        return firstPromise;\n    }\n    return Promise.all(promises);\n};\n\n/** @internal */\nconst instanceRegistration = (key, value) => new Resolver(key, 0 /* ResolverStrategy.instance */, value);\n/** @internal */\nconst singletonRegistration = (key, value) => new Resolver(key, 1 /* ResolverStrategy.singleton */, value);\n/** @internal */\nconst transientRegistation = (key, value) => new Resolver(key, 2 /* ResolverStrategy.transient */, value);\n/** @internal */\nconst callbackRegistration = (key, callback) => new Resolver(key, 3 /* ResolverStrategy.callback */, callback);\n/** @internal */\nconst cachedCallbackRegistration = (key, callback) => new Resolver(key, 3 /* ResolverStrategy.callback */, cacheCallbackResult(callback));\n/** @internal */\nconst aliasToRegistration = (originalKey, aliasKey) => new Resolver(aliasKey, 5 /* ResolverStrategy.alias */, originalKey);\n/** @internal */\nconst deferRegistration = (key, ...params) => new ParameterizedRegistry(key, params);\nconst containerLookup = new WeakMap();\n/** @internal */\nconst cacheCallbackResult = (fun) => {\n    return (handler, requestor, resolver) => {\n        let resolverLookup = containerLookup.get(handler);\n        if (resolverLookup === void 0) {\n            containerLookup.set(handler, resolverLookup = new WeakMap());\n        }\n        if (resolverLookup.has(resolver)) {\n            return resolverLookup.get(resolver);\n        }\n        const t = fun(handler, requestor, resolver);\n        resolverLookup.set(resolver, t);\n        return t;\n    };\n};\n/**\n * you can use the resulting {@linkcode IRegistration} of any of the factory methods\n * to register with the container, e.g.\n * ```\n * class Foo {}\n * const container = DI.createContainer();\n * container.register(Registration.instance(Foo, new Foo()));\n * container.get(Foo);\n * ```\n */\nconst Registration = {\n    /**\n     * allows you to pass an instance.\n     * Every time you request this {@linkcode Key} you will get this instance back.\n     * ```\n     * Registration.instance(Foo, new Foo()));\n     * ```\n     *\n     * @param key - key to register the instance with\n     * @param value - the instance associated with the key\n     */\n    instance: instanceRegistration,\n    /**\n     * Creates an instance from the class.\n     * Every time you request this {@linkcode Key} you will get the same one back.\n     * ```\n     * Registration.singleton(Foo, Foo);\n     * ```\n     *\n     * @param key - key to register the singleton class with\n     * @param value - the singleton class to instantiate when a container resolves the associated key\n     */\n    singleton: singletonRegistration,\n    /**\n     * Creates an instance from a class.\n     * Every time you request this {@linkcode Key} you will get a new instance.\n     * ```\n     * Registration.instance(Foo, Foo);\n     * ```\n     *\n     * @param key - key to register the transient class with\n     * @param value - the class to instantiate when a container resolves the associated key\n     */\n    transient: transientRegistation,\n    /**\n     * Creates an instance from the method passed.\n     * Every time you request this {@linkcode Key} you will get a new instance.\n     * ```\n     * Registration.callback(Foo, () => new Foo());\n     * Registration.callback(Bar, (c: IContainer) => new Bar(c.get(Foo)));\n     * ```\n     *\n     * @param key - key to register the callback with\n     * @param callback - the callback to invoke when a container resolves the associated key\n     */\n    callback: callbackRegistration,\n    /**\n     * Creates an instance from the method passed.\n     * On the first request for the {@linkcode Key} your callback is called and returns an instance.\n     * subsequent requests for the {@linkcode Key}, the initial instance returned will be returned.\n     * If you pass the same {@linkcode Registration} to another container the same cached value will be used.\n     * Should all references to the resolver returned be removed, the cache will expire.\n     * ```\n     * Registration.cachedCallback(Foo, () => new Foo());\n     * Registration.cachedCallback(Bar, (c: IContainer) => new Bar(c.get(Foo)));\n     * ```\n     *\n     * @param key - key to register the cached callback with\n     * @param callback - the cache callback to invoke when a container resolves the associated key\n     */\n    cachedCallback: cachedCallbackRegistration,\n    /**\n     * creates an alternate {@linkcode Key} to retrieve an instance by.\n     * Returns the same scope as the original {@linkcode Key}.\n     * ```\n     * Register.singleton(Foo, Foo)\n     * Register.aliasTo(Foo, MyFoos);\n     *\n     * container.getAll(MyFoos) // contains an instance of Foo\n     * ```\n     *\n     * @param originalKey - the real key to resolve the get call from a container\n     * @param aliasKey - the key that a container allows to resolve the real key associated\n     */\n    aliasTo: aliasToRegistration,\n    /**\n     * @internal\n     * @param key - the key to register a defer registration\n     * @param params - the parameters that should be passed to the resolution of the key\n     */\n    defer: deferRegistration,\n};\nconst createImplementationRegister = function (key) {\n    return function register(container) {\n        container.register(singletonRegistration(this, this), aliasToRegistration(this, key));\n    };\n};\n\nconst annoBaseName = 'au:annotation';\n/** @internal */\nconst getAnnotationKeyFor = (name, context) => {\n    if (context === void 0) {\n        return `${annoBaseName}:${name}`;\n    }\n    return `${annoBaseName}:${name}:${context}`;\n};\n/** @internal */\nconst appendAnnotation = (target, key) => {\n    const keys = getMetadata(annoBaseName, target);\n    if (keys === void 0) {\n        defineMetadata([key], target, annoBaseName);\n    }\n    else {\n        keys.push(key);\n    }\n};\nconst annotation = /*@__PURE__*/ objectFreeze({\n    name: 'au:annotation',\n    appendTo: appendAnnotation,\n    set(target, prop, value) {\n        defineMetadata(value, target, getAnnotationKeyFor(prop));\n    },\n    get: (target, prop) => getMetadata(getAnnotationKeyFor(prop), target),\n    getKeys(target) {\n        let keys = getMetadata(annoBaseName, target);\n        if (keys === void 0) {\n            defineMetadata(keys = [], target, annoBaseName);\n        }\n        return keys;\n    },\n    isKey: (key) => key.startsWith(annoBaseName),\n    keyFor: getAnnotationKeyFor,\n});\nconst resourceBaseName = 'au:resource';\n/**\n * Builds a resource key from the provided parts.\n */\nconst getResourceKeyFor = (type, name, context) => {\n    if (name == null) {\n        return `${resourceBaseName}:${type}`;\n    }\n    if (context == null) {\n        return `${resourceBaseName}:${type}:${name}`;\n    }\n    return `${resourceBaseName}:${type}:${name}:${context}`;\n};\nconst Protocol = {\n    annotation,\n};\nconst hasOwn = Object.prototype.hasOwnProperty;\n/**\n * The order in which the values are checked:\n * 1. Annotations (usually set by decorators) have the highest priority; they override the definition as well as static properties on the type.\n * 2. Definition properties (usually set by the customElement decorator object literal) come next. They override static properties on the type.\n * 3. Static properties on the type come last. Note that this does not look up the prototype chain (bindables are an exception here, but we do that differently anyway)\n * 4. The default property that is provided last. The function is only called if the default property is needed\n */\nfunction fromAnnotationOrDefinitionOrTypeOrDefault(name, def, Type, getDefault) {\n    let value = getMetadata(getAnnotationKeyFor(name), Type);\n    if (value === void 0) {\n        value = def[name];\n        if (value === void 0) {\n            value = Type[name];\n            if (value === void 0 || !hasOwn.call(Type, name)) { // First just check the value (common case is faster), but do make sure it doesn't come from the proto chain\n                return getDefault();\n            }\n            return value;\n        }\n        return value;\n    }\n    return value;\n}\n/**\n * The order in which the values are checked:\n * 1. Annotations (usually set by decorators) have the highest priority; they override static properties on the type.\n * 2. Static properties on the typ. Note that this does not look up the prototype chain (bindables are an exception here, but we do that differently anyway)\n * 3. The default property that is provided last. The function is only called if the default property is needed\n */\nfunction fromAnnotationOrTypeOrDefault(name, Type, getDefault) {\n    let value = getMetadata(getAnnotationKeyFor(name), Type);\n    if (value === void 0) {\n        value = Type[name];\n        if (value === void 0 || !hasOwn.call(Type, name)) { // First just check the value (common case is faster), but do make sure it doesn't come from the proto chain\n            return getDefault();\n        }\n        return value;\n    }\n    return value;\n}\n/**\n * The order in which the values are checked:\n * 1. Definition properties.\n * 2. The default property that is provided last. The function is only called if the default property is needed\n */\nfunction fromDefinitionOrDefault(name, def, getDefault) {\n    const value = def[name];\n    if (value === void 0) {\n        return getDefault();\n    }\n    return value;\n}\n\n/* eslint-disable @typescript-eslint/no-this-alias */\n/* eslint-disable @typescript-eslint/strict-boolean-expressions, @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-explicit-any */\nconst registrableMetadataKey = Symbol.for('au:registrable');\nconst DefaultResolver = {\n    none(key) {\n        throw createMappedError(2 /* ErrorNames.none_resolver_found */, key);\n    },\n    singleton: (key) => new Resolver(key, 1 /* ResolverStrategy.singleton */, key),\n    transient: (key) => new Resolver(key, 2 /* ResolverStrategy.transient */, key),\n};\nclass ContainerConfiguration {\n    constructor(inheritParentResources, defaultResolver) {\n        this.inheritParentResources = inheritParentResources;\n        this.defaultResolver = defaultResolver;\n    }\n    static from(config) {\n        if (config === void 0 ||\n            config === ContainerConfiguration.DEFAULT) {\n            return ContainerConfiguration.DEFAULT;\n        }\n        return new ContainerConfiguration(config.inheritParentResources ?? false, config.defaultResolver ?? DefaultResolver.singleton);\n    }\n}\nContainerConfiguration.DEFAULT = ContainerConfiguration.from({});\n/** @internal */\nconst createContainer = (config) => new Container(null, ContainerConfiguration.from(config));\nconst InstrinsicTypeNames = new Set('Array ArrayBuffer Boolean DataView Date Error EvalError Float32Array Float64Array Function Int8Array Int16Array Int32Array Map Number Object Promise RangeError ReferenceError RegExp Set SharedArrayBuffer String SyntaxError TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array URIError WeakMap WeakSet'.split(' '));\n// const factoryKey = 'di:factory';\n// const factoryAnnotationKey = Protocol.annotation.keyFor(factoryKey);\nlet containerId = 0;\nlet currentContainer = null;\n/** @internal */\nclass Container {\n    get depth() {\n        return this._parent === null ? 0 : this._parent.depth + 1;\n    }\n    get parent() {\n        return this._parent;\n    }\n    constructor(parent, config) {\n        this.id = ++containerId;\n        /** @internal */\n        this._registerDepth = 0;\n        /** @internal */\n        this._disposableResolvers = new Map();\n        this._parent = parent;\n        this.config = config;\n        this._resolvers = new Map();\n        this.res = {};\n        if (parent === null) {\n            this.root = this;\n            this._factories = new Map();\n        }\n        else {\n            this.root = parent.root;\n            this._factories = parent._factories;\n            if (config.inheritParentResources) {\n                // todo: when the simplify resource system work is commenced\n                //       this resource inheritance can just be a Object.create() call\n                //       with parent resources as the prototype of the child resources\n                for (const key in parent.res) {\n                    this.registerResolver(key, parent.res[key]);\n                }\n            }\n        }\n        this._resolvers.set(IContainer, containerResolver);\n    }\n    register(...params) {\n        if (++this._registerDepth === 100) {\n            throw createMappedError(6 /* ErrorNames.unable_auto_register */, ...params);\n        }\n        let current;\n        let keys;\n        let value;\n        let j;\n        let jj;\n        let i = 0;\n        // eslint-disable-next-line\n        let ii = params.length;\n        let def;\n        for (; i < ii; ++i) {\n            current = params[i];\n            if (!isObjectOrFunction(current)) {\n                continue;\n            }\n            if (isRegistry(current)) {\n                current.register(this);\n            }\n            else if ((def = getMetadata(resourceBaseName, current)) != null) {\n                def.register(this);\n            }\n            else if (isClass(current)) {\n                const registrable = current[Symbol.metadata]?.[registrableMetadataKey];\n                if (isRegistry(registrable)) {\n                    registrable.register(this);\n                }\n                else if (isString((current).$au?.type)) {\n                    const $au = current.$au;\n                    const aliases = (current.aliases ?? emptyArray).concat($au.aliases ?? emptyArray);\n                    let key = `${resourceBaseName}:${$au.type}:${$au.name}`;\n                    if (this.has(key, false)) {\n                        {\n                            // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n                            globalThis.console?.warn(createMappedError(7 /* ErrorNames.resource_already_exists */, key));\n                        }\n                        continue;\n                    }\n                    aliasToRegistration(current, key).register(this);\n                    if (!this.has(current, false)) {\n                        singletonRegistration(current, current).register(this);\n                    }\n                    j = 0;\n                    jj = aliases.length;\n                    for (; j < jj; ++j) {\n                        key = `${resourceBaseName}:${$au.type}:${aliases[j]}`;\n                        if (this.has(key, false)) {\n                            {\n                                // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n                                globalThis.console?.warn(createMappedError(7 /* ErrorNames.resource_already_exists */, key));\n                            }\n                            continue;\n                        }\n                        aliasToRegistration(current, key).register(this);\n                    }\n                }\n                else {\n                    singletonRegistration(current, current).register(this);\n                }\n            }\n            else {\n                keys = Object.keys(current);\n                j = 0;\n                jj = keys.length;\n                for (; j < jj; ++j) {\n                    value = current[keys[j]];\n                    if (!isObjectOrFunction(value)) {\n                        continue;\n                    }\n                    // note: we could remove this if-branch and call this.register directly\n                    // - the extra check is just a perf tweak to create fewer unnecessary arrays by the spread operator\n                    if (isRegistry(value)) {\n                        value.register(this);\n                    }\n                    else {\n                        this.register(value);\n                    }\n                }\n            }\n        }\n        --this._registerDepth;\n        return this;\n    }\n    registerResolver(key, resolver, isDisposable = false) {\n        validateKey(key);\n        const resolvers = this._resolvers;\n        const result = resolvers.get(key);\n        if (result == null) {\n            resolvers.set(key, resolver);\n            if (isResourceKey(key)) {\n                if (this.res[key] !== void 0) {\n                    throw createMappedError(7 /* ErrorNames.resource_already_exists */, key);\n                }\n                this.res[key] = resolver;\n            }\n        }\n        else if (result instanceof Resolver && result._strategy === 4 /* ResolverStrategy.array */) {\n            result._state.push(resolver);\n        }\n        else {\n            resolvers.set(key, new Resolver(key, 4 /* ResolverStrategy.array */, [result, resolver]));\n        }\n        if (isDisposable) {\n            this._disposableResolvers.set(key, resolver);\n        }\n        return resolver;\n    }\n    deregister(key) {\n        validateKey(key);\n        const resolver = this._resolvers.get(key);\n        if (resolver != null) {\n            this._resolvers.delete(key);\n            if (isResourceKey(key)) {\n                // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n                delete this.res[key];\n            }\n            if (this._disposableResolvers.has(key)) {\n                resolver.dispose();\n                this._disposableResolvers.delete(key);\n            }\n        }\n    }\n    // public deregisterResolverFor<K extends Key>(key: K, searchAncestors: boolean): void {\n    //   validateKey(key);\n    //   // eslint-disable-next-line @typescript-eslint/no-this-alias\n    //   let current: Container | null = this;\n    //   let resolver: IResolver | undefined;\n    //   while (current != null) {\n    //     resolver = current._resolvers.get(key);\n    //     if (resolver != null) {\n    //       current._resolvers.delete(key);\n    //       break;\n    //     }\n    //     if (current.parent == null) { return; }\n    //     current = searchAncestors ? current.parent : null;\n    //   }\n    //   if (resolver == null) { return; }\n    //   if (resolver instanceof Resolver && resolver.strategy === ResolverStrategy.array) {\n    //     throw createError('Cannot deregister a resolver with array strategy');\n    //   }\n    //   if (this._disposableResolvers.has(resolver as IDisposableResolver<K>)) {\n    //     (resolver as IDisposableResolver<K>).dispose();\n    //   }\n    //   if (isResourceKey(key)) {\n    //     // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n    //     delete this.res[key];\n    //   }\n    // }\n    registerTransformer(key, transformer) {\n        const resolver = this.getResolver(key);\n        if (resolver == null) {\n            return false;\n        }\n        if (resolver.getFactory) {\n            const factory = resolver.getFactory(this);\n            if (factory == null) {\n                return false;\n            }\n            // This type cast is a bit of a hacky one, necessary due to the duplicity of IResolverLike.\n            // Problem is that that interface's type arg can be of type Key, but the getFactory method only works on\n            // type Constructable. So the return type of that optional method has this additional constraint, which\n            // seems to confuse the type checker.\n            factory.registerTransformer(transformer);\n            return true;\n        }\n        return false;\n    }\n    getResolver(key, autoRegister = true) {\n        validateKey(key);\n        if (key.resolve !== void 0) {\n            return key;\n        }\n        const previousContainer = currentContainer;\n        let current = currentContainer = this;\n        let resolver;\n        let handler;\n        try {\n            while (current != null) {\n                resolver = current._resolvers.get(key);\n                if (resolver == null) {\n                    if (current._parent == null) {\n                        handler = (isRegisterInRequester(key)) ? this : current;\n                        if (autoRegister) {\n                            return this._jitRegister(key, handler);\n                        }\n                        return null;\n                    }\n                    current = current._parent;\n                }\n                else {\n                    return resolver;\n                }\n            }\n        }\n        finally {\n            currentContainer = previousContainer;\n        }\n        return null;\n    }\n    has(key, searchAncestors = false) {\n        return this._resolvers.has(key)\n            || isResourceKey(key) && key in this.res\n            || ((searchAncestors && this._parent?.has(key, true)) ?? false);\n    }\n    get(key) {\n        validateKey(key);\n        if (key.$isResolver) {\n            return key.resolve(this, this);\n        }\n        const previousContainer = currentContainer;\n        let current = currentContainer = this;\n        let resolver;\n        let handler;\n        try {\n            while (current != null) {\n                resolver = current._resolvers.get(key);\n                if (resolver == null) {\n                    if (current._parent == null) {\n                        handler = (isRegisterInRequester(key)) ? this : current;\n                        resolver = this._jitRegister(key, handler);\n                        return resolver.resolve(current, this);\n                    }\n                    current = current._parent;\n                }\n                else {\n                    return resolver.resolve(current, this);\n                }\n            }\n        }\n        finally {\n            currentContainer = previousContainer;\n        }\n        throw createMappedError(8 /* ErrorNames.unable_resolve_key */, key);\n    }\n    getAll(key, searchAncestors = false) {\n        validateKey(key);\n        const previousContainer = currentContainer;\n        const requestor = currentContainer = this;\n        let current = requestor;\n        let resolver;\n        let resolutions = emptyArray;\n        try {\n            if (searchAncestors) {\n                while (current != null) {\n                    resolver = current._resolvers.get(key);\n                    if (resolver != null) {\n                        resolutions = resolutions.concat(buildAllResponse(resolver, current, requestor));\n                    }\n                    current = current._parent;\n                }\n                return resolutions;\n            }\n            while (current != null) {\n                resolver = current._resolvers.get(key);\n                if (resolver == null) {\n                    current = current._parent;\n                    if (current == null) {\n                        return emptyArray;\n                    }\n                }\n                else {\n                    return buildAllResponse(resolver, current, requestor);\n                }\n            }\n        }\n        finally {\n            currentContainer = previousContainer;\n        }\n        return emptyArray;\n    }\n    invoke(Type, dynamicDependencies) {\n        if (isNativeFunction(Type)) {\n            throw createMappedError(15 /* ErrorNames.no_construct_native_fn */, Type);\n        }\n        const previousContainer = currentContainer;\n        currentContainer = this;\n        {\n            let resolvedDeps;\n            let dep;\n            try {\n                resolvedDeps = getDependencies(Type).map(_ => this.get(dep = _));\n            }\n            catch (ex) {\n                logError(`[DEV:aurelia] Error during construction of ${!Type.name ? `(Anonymous) ${String(Type)}` : Type.name}, caused by dependency: ${String(dep)}`);\n                currentContainer = previousContainer;\n                throw ex;\n            }\n            try {\n                return dynamicDependencies === void 0\n                    ? new Type(...resolvedDeps)\n                    : new Type(...resolvedDeps, ...dynamicDependencies);\n            }\n            catch (ex) {\n                logError(`[DEV:aurelia] Error during construction of ${!Type.name ? `(Anonymous) ${String(Type)}` : Type.name}`);\n                throw ex;\n            }\n            finally {\n                currentContainer = previousContainer;\n            }\n        }\n        try {\n            return dynamicDependencies === void 0\n                ? new Type(...getDependencies(Type).map(containerGetKey, this))\n                : new Type(...getDependencies(Type).map(containerGetKey, this), ...dynamicDependencies);\n        }\n        finally {\n            currentContainer = previousContainer;\n        }\n    }\n    hasFactory(key) {\n        return this._factories.has(key);\n    }\n    getFactory(Type) {\n        let factory = this._factories.get(Type);\n        if (factory === void 0) {\n            if (isNativeFunction(Type)) {\n                throw createMappedError(15 /* ErrorNames.no_construct_native_fn */, Type);\n            }\n            this._factories.set(Type, factory = new Factory(Type, getDependencies(Type)));\n        }\n        return factory;\n    }\n    registerFactory(key, factory) {\n        this._factories.set(key, factory);\n    }\n    createChild(config) {\n        if (config === void 0 && this.config.inheritParentResources) {\n            if (this.config === ContainerConfiguration.DEFAULT) {\n                return new Container(this, this.config);\n            }\n            return new Container(this, ContainerConfiguration.from({\n                ...this.config,\n                inheritParentResources: false,\n            }));\n        }\n        return new Container(this, ContainerConfiguration.from(config ?? this.config));\n    }\n    disposeResolvers() {\n        const resolvers = this._resolvers;\n        const disposableResolvers = this._disposableResolvers;\n        let disposable;\n        let key;\n        for ([key, disposable] of disposableResolvers.entries()) {\n            disposable.dispose?.();\n            resolvers.delete(key);\n        }\n        disposableResolvers.clear();\n    }\n    useResources(container) {\n        const res = container.res;\n        for (const key in res) {\n            this.registerResolver(key, res[key]);\n        }\n    }\n    find(keyOrKind, name) {\n        const key = isString(name) ? `${resourceBaseName}:${keyOrKind}:${name}` : keyOrKind;\n        let container = this;\n        let resolver = container.res[key];\n        if (resolver == null) {\n            container = container.root;\n            resolver = container.res[key];\n        }\n        if (resolver == null) {\n            return null;\n        }\n        return resolver.getFactory?.(container)?.Type ?? null;\n    }\n    dispose() {\n        if (this._disposableResolvers.size > 0) {\n            this.disposeResolvers();\n        }\n        this._resolvers.clear();\n        if (this.root === this) {\n            this._factories.clear();\n            this.res = {};\n        }\n    }\n    /** @internal */\n    _jitRegister(keyAsValue, handler) {\n        const $isRegistry = isRegistry(keyAsValue);\n        if (!isFunction(keyAsValue) && !$isRegistry) {\n            throw createMappedError(9 /* ErrorNames.unable_jit_non_constructor */, keyAsValue);\n        }\n        if (InstrinsicTypeNames.has(keyAsValue.name)) {\n            throw createMappedError(10 /* ErrorNames.no_jit_intrinsic_type */, keyAsValue);\n        }\n        if ($isRegistry) {\n            const registrationResolver = keyAsValue.register(handler, keyAsValue);\n            if (!(registrationResolver instanceof Object) || registrationResolver.resolve == null) {\n                const newResolver = handler._resolvers.get(keyAsValue);\n                if (newResolver != null) {\n                    return newResolver;\n                }\n                throw createMappedError(11 /* ErrorNames.null_resolver_from_register */, keyAsValue);\n            }\n            return registrationResolver;\n        }\n        // TODO(sayan): remove potential dead code\n        if (keyAsValue.$isInterface) {\n            throw createMappedError(12 /* ErrorNames.no_jit_interface */, keyAsValue.friendlyName);\n        }\n        const resolver = this.config.defaultResolver(keyAsValue, handler);\n        handler._resolvers.set(keyAsValue, resolver);\n        return resolver;\n    }\n}\n/** @internal */\nclass Factory {\n    constructor(Type, dependencies) {\n        this.Type = Type;\n        this.dependencies = dependencies;\n        this.transformers = null;\n    }\n    construct(container, dynamicDependencies) {\n        const previousContainer = currentContainer;\n        currentContainer = container;\n        let instance;\n        /* istanbul ignore next */\n        {\n            let resolvedDeps;\n            let dep;\n            try {\n                resolvedDeps = this.dependencies.map(_ => container.get(dep = _));\n            }\n            catch (ex) {\n                logError(`[DEV:aurelia] Error during construction of ${!this.Type.name ? `(Anonymous) ${String(this.Type)}` : this.Type.name}, caused by dependency: ${String(dep)}`);\n                currentContainer = previousContainer;\n                throw ex;\n            }\n            try {\n                if (dynamicDependencies === void 0) {\n                    instance = new this.Type(...resolvedDeps);\n                }\n                else {\n                    instance = new this.Type(...resolvedDeps, ...dynamicDependencies);\n                }\n                if (this.transformers == null) {\n                    return instance;\n                }\n                return this.transformers.reduce(transformInstance, instance);\n            }\n            catch (ex) {\n                logError(`[DEV:aurelia] Error during construction of ${!this.Type.name ? `(Anonymous) ${String(this.Type)}` : this.Type.name}`);\n                throw ex;\n            }\n            finally {\n                currentContainer = previousContainer;\n            }\n        }\n        try {\n            if (dynamicDependencies === void 0) {\n                instance = new this.Type(...this.dependencies.map(containerGetKey, container));\n            }\n            else {\n                instance = new this.Type(...this.dependencies.map(containerGetKey, container), ...dynamicDependencies);\n            }\n            if (this.transformers == null) {\n                return instance;\n            }\n            return this.transformers.reduce(transformInstance, instance);\n        }\n        finally {\n            currentContainer = previousContainer;\n        }\n    }\n    registerTransformer(transformer) {\n        (this.transformers ??= []).push(transformer);\n    }\n}\nfunction transformInstance(inst, transform) {\n    return transform(inst);\n}\nfunction validateKey(key) {\n    if (key === null || key === void 0) {\n        throw createMappedError(14 /* ErrorNames.null_undefined_key */);\n    }\n}\nfunction containerGetKey(d) {\n    return this.get(d);\n}\nfunction resolve(...keys) {\n    if (currentContainer == null) {\n        throw createMappedError(16 /* ErrorNames.no_active_container_for_resolve */, ...keys);\n    }\n    /* istanbul ignore next */\n    {\n        if (keys.length === 1) {\n            try {\n                return currentContainer.get(keys[0]);\n            }\n            catch (ex) {\n                logError(`[DEV:aurelia] resolve() call error for: ${String(keys[0])}`);\n                throw ex;\n            }\n        }\n        else {\n            let key;\n            try {\n                return keys.map(_ => currentContainer.get(key = _));\n            }\n            catch (ex) {\n                logError(`[DEV:aurelia] resolve() call error for: ${String(key)}`);\n                throw ex;\n            }\n        }\n    }\n    return keys.length === 1\n        ? currentContainer.get(keys[0])\n        : keys.map(containerGetKey, currentContainer);\n}\nconst buildAllResponse = (resolver, handler, requestor) => {\n    if (resolver instanceof Resolver && resolver._strategy === 4 /* ResolverStrategy.array */) {\n        const state = resolver._state;\n        const ii = state.length;\n        const results = Array(ii);\n        let i = 0;\n        for (; i < ii; ++i) {\n            results[i] = state[i].resolve(handler, requestor);\n        }\n        return results;\n    }\n    return [resolver.resolve(handler, requestor)];\n};\nconst containerResolver = {\n    $isResolver: true,\n    resolve(handler, requestor) {\n        return requestor;\n    }\n};\nconst isRegistry = (obj) => isFunction(obj?.register);\nconst isSelfRegistry = (obj) => isRegistry(obj) && typeof obj.registerInRequestor === 'boolean';\nconst isRegisterInRequester = (obj) => isSelfRegistry(obj) && obj.registerInRequestor;\nconst isClass = (obj) => obj.prototype !== void 0;\nconst isResourceKey = (key) => isString(key) && key.indexOf(':') > 0;\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/prefer-nullish-coalescing */\n/* eslint-disable @typescript-eslint/strict-boolean-expressions */\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\nclass ResolverBuilder {\n    constructor(\n    /** @internal */ _container, \n    /** @internal */ _key) {\n        this._container = _container;\n        this._key = _key;\n    }\n    instance(value) {\n        return this._registerResolver(0 /* ResolverStrategy.instance */, value);\n    }\n    singleton(value) {\n        return this._registerResolver(1 /* ResolverStrategy.singleton */, value);\n    }\n    transient(value) {\n        return this._registerResolver(2 /* ResolverStrategy.transient */, value);\n    }\n    callback(value) {\n        return this._registerResolver(3 /* ResolverStrategy.callback */, value);\n    }\n    cachedCallback(value) {\n        return this._registerResolver(3 /* ResolverStrategy.callback */, cacheCallbackResult(value));\n    }\n    aliasTo(destinationKey) {\n        return this._registerResolver(5 /* ResolverStrategy.alias */, destinationKey);\n    }\n    /** @internal */\n    _registerResolver(strategy, state) {\n        const { _container: container, _key: key } = this;\n        this._container = this._key = (void 0);\n        return container.registerResolver(key, new Resolver(key, strategy, state));\n    }\n}\nconst cloneArrayWithPossibleProps = (source) => {\n    const clone = source.slice();\n    const keys = Object.keys(source);\n    const len = keys.length;\n    let key;\n    for (let i = 0; i < len; ++i) {\n        key = keys[i];\n        if (!isArrayIndex(key)) {\n            clone[key] = source[key];\n        }\n    }\n    return clone;\n};\nconst diParamTypesKeys = getAnnotationKeyFor('di:paramtypes');\nconst getAnnotationParamtypes = (Type) => {\n    return getMetadata(diParamTypesKeys, Type);\n};\nconst getDesignParamtypes = (Type) => getMetadata('design:paramtypes', Type);\nconst getOrCreateAnnotationParamTypes = (context) => {\n    return (context.metadata[diParamTypesKeys] ??= []);\n};\n/** @internal */\nconst getDependencies = (Type) => {\n    // Note: Every detail of this getDependencies method is pretty deliberate at the moment, and probably not yet 100% tested from every possible angle,\n    // so be careful with making changes here as it can have a huge impact on complex end user apps.\n    // Preferably, only make changes to the dependency resolution process via a RFC.\n    const key = getAnnotationKeyFor('di:dependencies');\n    let dependencies = getMetadata(key, Type);\n    if (dependencies === void 0) {\n        // Type.length is the number of constructor parameters. If this is 0, it could mean the class has an empty constructor\n        // but it could also mean the class has no constructor at all (in which case it inherits the constructor from the prototype).\n        // Non-zero constructor length + no paramtypes means emitDecoratorMetadata is off, or the class has no decorator.\n        // We're not doing anything with the above right now, but it's good to keep in mind for any future issues.\n        const inject = Type.inject;\n        if (inject === void 0) {\n            // design:paramtypes is set by tsc when emitDecoratorMetadata is enabled.\n            const designParamtypes = getDesignParamtypes(Type);\n            // au:annotation:di:paramtypes is set by the parameter decorator from DI.createInterface or by @inject\n            const annotationParamtypes = getAnnotationParamtypes(Type);\n            if (designParamtypes === void 0) {\n                if (annotationParamtypes === void 0) {\n                    // Only go up the prototype if neither static inject nor any of the paramtypes is defined, as\n                    // there is no sound way to merge a type's deps with its prototype's deps\n                    const Proto = Object.getPrototypeOf(Type);\n                    if (isFunction(Proto) && Proto !== Function.prototype) {\n                        dependencies = cloneArrayWithPossibleProps(getDependencies(Proto));\n                    }\n                    else {\n                        dependencies = [];\n                    }\n                }\n                else {\n                    // No design:paramtypes so just use the au:annotation:di:paramtypes\n                    dependencies = cloneArrayWithPossibleProps(annotationParamtypes);\n                }\n            }\n            else if (annotationParamtypes === void 0) {\n                // No au:annotation:di:paramtypes so just use the design:paramtypes\n                dependencies = cloneArrayWithPossibleProps(designParamtypes);\n            }\n            else {\n                // We've got both, so merge them (in case of conflict on same index, au:annotation:di:paramtypes take precedence)\n                dependencies = cloneArrayWithPossibleProps(designParamtypes);\n                let len = annotationParamtypes.length;\n                let auAnnotationParamtype;\n                let i = 0;\n                for (; i < len; ++i) {\n                    auAnnotationParamtype = annotationParamtypes[i];\n                    if (auAnnotationParamtype !== void 0) {\n                        dependencies[i] = auAnnotationParamtype;\n                    }\n                }\n                const keys = Object.keys(annotationParamtypes);\n                let key;\n                i = 0;\n                len = keys.length;\n                for (i = 0; i < len; ++i) {\n                    key = keys[i];\n                    if (!isArrayIndex(key)) {\n                        dependencies[key] = annotationParamtypes[key];\n                    }\n                }\n            }\n        }\n        else {\n            // Ignore paramtypes if we have static inject\n            dependencies = cloneArrayWithPossibleProps(inject);\n        }\n        defineMetadata(dependencies, Type, key);\n    }\n    return dependencies;\n};\n/**\n * @internal\n *\n * @param configureOrName - Use for improving error messaging\n */\nconst createInterface = (configureOrName, configuror) => {\n    const configure = isFunction(configureOrName) ? configureOrName : configuror;\n    const friendlyName = (isString(configureOrName) ? configureOrName : undefined) ?? '(anonymous)';\n    const Interface = {\n        // Old code kept with the hope that the argument decorator proposal will be standardized by TC39 (https://github.com/tc39/proposal-class-method-parameter-decorators)\n        // function(_target: Injectable | AbstractInjectable, _property: string | symbol | undefined, _index: number | undefined): void {\n        //    if (target == null || new.target !== undefined) {\n        //     throw createMappedError(ErrorNames.no_registration_for_interface, friendlyName);\n        //    }\n        //    const annotationParamtypes = getOrCreateAnnotationParamTypes(target as Injectable);\n        //    annotationParamtypes[index!] = Interface;\n        // },\n        $isInterface: true,\n        friendlyName: friendlyName,\n        toString: () => `InterfaceSymbol<${friendlyName}>`,\n        register: configure != null\n            ? (container, key) => configure(new ResolverBuilder(container, key ?? Interface))\n            : void 0,\n    };\n    return Interface;\n};\nconst inject = (...dependencies) => {\n    return (decorated, context) => {\n        switch (context.kind) {\n            case 'class': {\n                const annotationParamtypes = getOrCreateAnnotationParamTypes(context);\n                let dep;\n                let i = 0;\n                for (; i < dependencies.length; ++i) {\n                    dep = dependencies[i];\n                    if (dep !== void 0) {\n                        annotationParamtypes[i] = dep;\n                    }\n                }\n                break;\n            }\n            case 'field': {\n                const annotationParamtypes = getOrCreateAnnotationParamTypes(context);\n                const dep = dependencies[0];\n                if (dep !== void 0) {\n                    annotationParamtypes[context.name] = dep;\n                }\n                break;\n            }\n            // TODO(sayan): support getter injection - new feature\n            // TODO:\n            //    support method parameter injection when the class-method-parameter-decorators proposal (https://github.com/tc39/proposal-class-method-parameter-decorators)\n            //    reaches stage 4 and/or implemented by TS.\n            default:\n                throw createMappedError(22 /* ErrorNames.invalid_inject_decorator_usage */, String(context.name), context.kind);\n        }\n    };\n};\nconst DI = /*@__PURE__*/ (() => {\n    // putting this function inside this IIFE as we wants to call it without triggering side effect\n    initializeTC39Metadata();\n    return {\n        createContainer,\n        getDesignParamtypes,\n        // getAnnotationParamtypes,\n        // getOrCreateAnnotationParamTypes,\n        getDependencies: getDependencies,\n        /**\n         * creates a decorator that also matches an interface and can be used as a {@linkcode Key}.\n         * ```ts\n         * const ILogger = DI.createInterface<Logger>('Logger');\n         * container.register(Registration.singleton(ILogger, getSomeLogger()));\n         * const log = container.get(ILogger);\n         * log.info('hello world');\n         * class Foo {\n         *   constructor( @ILogger log: ILogger ) {\n         *     log.info('hello world');\n         *   }\n         * }\n         * ```\n         * you can also build default registrations into your interface.\n         * ```ts\n         * export const ILogger = DI.createInterface<Logger>('Logger', builder => builder.cachedCallback(LoggerDefault));\n         * const log = container.get(ILogger);\n         * log.info('hello world');\n         * class Foo {\n         *   constructor( @ILogger log: ILogger ) {\n         *     log.info('hello world');\n         *   }\n         * }\n         * ```\n         * but these default registrations won't work the same with other decorators that take keys, for example\n         * ```ts\n         * export const MyStr = DI.createInterface<string>('MyStr', builder => builder.instance('somestring'));\n         * class Foo {\n         *   constructor( @optional(MyStr) public readonly str: string ) {\n         *   }\n         * }\n         * container.get(Foo).str; // returns undefined\n         * ```\n         * to fix this add this line somewhere before you do a `get`\n         * ```ts\n         * container.register(MyStr);\n         * container.get(Foo).str; // returns 'somestring'\n         * ```\n         *\n         * - @param configureOrName - supply a string to improve error messaging\n         */\n        createInterface,\n        inject,\n        /**\n         * Registers the `target` class as a transient dependency; each time the dependency is resolved\n         * a new instance will be created.\n         *\n         * @param target - The class / constructor function to register as transient.\n         * @returns The same class, with a static `register` method that takes a container and returns the appropriate resolver.\n         *\n         * @example ```ts\n         * // On an existing class\n         * class Foo { }\n         * DI.transient(Foo);\n         *\n         * // Inline declaration\n         * const Foo = DI.transient(class { });\n         * // Foo is now strongly typed with register\n         * Foo.register(container);\n         * ```\n         */\n        transient(target) {\n            target.register = function (container) {\n                const registration = transientRegistation(target, target);\n                return registration.register(container, target);\n            };\n            target.registerInRequestor = false;\n            return target;\n        },\n        /**\n         * Registers the `target` class as a singleton dependency; the class will only be created once. Each\n         * consecutive time the dependency is resolved, the same instance will be returned.\n         *\n         * @param target - The class / constructor function to register as a singleton.\n         * @returns The same class, with a static `register` method that takes a container and returns the appropriate resolver.\n         * @example ```ts\n         * // On an existing class\n         * class Foo { }\n         * DI.singleton(Foo);\n         *\n         * // Inline declaration\n         * const Foo = DI.singleton(class { });\n         * // Foo is now strongly typed with register\n         * Foo.register(container);\n         * ```\n         */\n        singleton(target, options = defaultSingletonOptions) {\n            target.register = function (container) {\n                const registration = singletonRegistration(target, target);\n                return registration.register(container, target);\n            };\n            target.registerInRequestor = options.scoped;\n            return target;\n        },\n    };\n})();\nconst IContainer = /*@__PURE__*/ createInterface('IContainer');\nconst IServiceLocator = IContainer;\nfunction transientDecorator(target, context) {\n    return DI.transient(target);\n}\nfunction transient(target, context) {\n    return target == null ? transientDecorator : transientDecorator(target);\n}\nconst defaultSingletonOptions = { scoped: false };\nconst decorateSingleton = DI.singleton;\nfunction singleton(targetOrOptions, _context) {\n    return isFunction(targetOrOptions)\n        // The decorator is applied without options. Example: `@singleton()` or `@singleton`\n        ? decorateSingleton(targetOrOptions)\n        : function ($target, _ctx) {\n            return decorateSingleton($target, targetOrOptions);\n        };\n}\n\n/** @internal */\nclass Resolver {\n    get $isResolver() { return true; }\n    constructor(key, strategy, state) {\n        /** @internal */\n        this._resolving = false;\n        /**\n         * When resolving a singleton, the internal state is changed,\n         * so cache the original constructable factory for future requests\n         * @internal\n         */\n        this._cachedFactory = null;\n        this._key = key;\n        this._strategy = strategy;\n        this._state = state;\n    }\n    register(container, key) {\n        return container.registerResolver(key || this._key, this);\n    }\n    resolve(handler, requestor) {\n        switch (this._strategy) {\n            case 0 /* ResolverStrategy.instance */:\n                return this._state;\n            case 1 /* ResolverStrategy.singleton */: {\n                if (this._resolving) {\n                    throw createMappedError(3 /* ErrorNames.cyclic_dependency */, this._state.name);\n                }\n                this._resolving = true;\n                this._state = (this._cachedFactory = handler.getFactory(this._state)).construct(requestor);\n                this._strategy = 0 /* ResolverStrategy.instance */;\n                this._resolving = false;\n                return this._state;\n            }\n            case 2 /* ResolverStrategy.transient */: {\n                // Always create transients from the requesting container\n                const factory = handler.getFactory(this._state);\n                if (factory === null) {\n                    throw createMappedError(4 /* ErrorNames.no_factory */, this._key);\n                }\n                return factory.construct(requestor);\n            }\n            case 3 /* ResolverStrategy.callback */:\n                return this._state(handler, requestor, this);\n            case 4 /* ResolverStrategy.array */:\n                return this._state[0].resolve(handler, requestor);\n            case 5 /* ResolverStrategy.alias */:\n                return requestor.get(this._state);\n            default:\n                throw createMappedError(5 /* ErrorNames.invalid_resolver_strategy */, this._strategy);\n        }\n    }\n    getFactory(container) {\n        switch (this._strategy) {\n            case 1 /* ResolverStrategy.singleton */:\n            case 2 /* ResolverStrategy.transient */:\n                return container.getFactory(this._state);\n            case 5 /* ResolverStrategy.alias */:\n                return container.getResolver(this._state)?.getFactory?.(container) ?? null;\n            case 0 /* ResolverStrategy.instance */:\n                return this._cachedFactory;\n            default:\n                return null;\n        }\n    }\n}\nclass InstanceProvider {\n    get friendlyName() {\n        return this._name;\n    }\n    constructor(name, \n    /**\n     * if not undefined, then this is the value this provider will resolve to\n     * until overridden by explicit prepare call\n     */\n    instance = null, Type = null) {\n        this._name = name;\n        this._instance = instance;\n        this._Type = Type;\n    }\n    prepare(instance) {\n        this._instance = instance;\n    }\n    get $isResolver() { return true; }\n    resolve() {\n        if (this._instance == null) {\n            throw createMappedError(13 /* ErrorNames.no_instance_provided */, this._name);\n        }\n        return this._instance;\n    }\n    getFactory(container) {\n        return this._Type == null ? null : container.getFactory(this._Type);\n    }\n    dispose() {\n        this._instance = null;\n    }\n}\n/**\n * An implementation of IRegistry that delegates registration to a\n * separately registered class. The ParameterizedRegistry facilitates the\n * passing of parameters to the final registry.\n */\nclass ParameterizedRegistry {\n    constructor(key, params) {\n        this.key = key;\n        this.params = params;\n    }\n    register(container) {\n        if (container.has(this.key, true)) {\n            const registry = container.get(this.key);\n            registry.register(container, ...this.params);\n        }\n        else {\n            container.register(...this.params.filter(x => typeof x === 'object'));\n        }\n    }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst emptyArray = objectFreeze([]);\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst emptyObject = objectFreeze({});\n// eslint-disable-next-line @typescript-eslint/no-empty-function\nfunction noop() { }\nconst IPlatform = /*@__PURE__*/ createInterface('IPlatform');\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/**\n * ! Semi private API to avoid repetitive work creating resolvers.\n *\n * Naming isn't entirely correct, but it's good enough for internal usage.\n */\nfunction createResolver(getter) {\n    return function (key) {\n        function Resolver(target, context) {\n            inject(Resolver)(target, context);\n        }\n        Resolver.$isResolver = true;\n        Resolver.resolve = function (handler, requestor) {\n            return getter(key, handler, requestor);\n        };\n        return Resolver;\n    };\n}\n/**\n * Create a resolver that will resolve all values of a key from resolving container\n */\nconst all = (key, searchAncestors = false) => {\n    function resolver(decorated, context) {\n        inject(resolver)(decorated, context);\n    }\n    resolver.$isResolver = true;\n    resolver.resolve = (handler, requestor) => requestor.getAll(key, searchAncestors);\n    return resolver;\n};\n/**\n * Create a resolver that will resolve the last instance of a key from the resolving container\n *\n * - @param key [[`Key`]]\n */\nconst last = (key) => ({\n    $isResolver: true,\n    resolve: handler => {\n        const allInstances = handler.getAll(key);\n        return allInstances.length > 0 ? allInstances[allInstances.length - 1] : undefined;\n    }\n});\n/**\n * Lazily inject a dependency depending on whether the [[`Key`]] is present at the time of function call.\n *\n * You need to make your argument a function that returns the type, for example\n * ```ts\n * class Foo {\n *   constructor( @lazy('random') public random: () => number )\n * }\n * const foo = container.get(Foo); // instanceof Foo\n * foo.random(); // throws\n * ```\n * would throw an exception because you haven't registered `'random'` before calling the method. This, would give you a\n * new [['Math.random()']] number each time.\n * ```ts\n * class Foo {\n *   constructor( @lazy('random') public random: () => random )\n * }\n * container.register(Registration.callback('random', Math.random ));\n * container.get(Foo).random(); // some random number\n * container.get(Foo).random(); // another random number\n * ```\n * `@lazy` does not manage the lifecycle of the underlying key. If you want a singleton, you have to register as a\n * `singleton`, `transient` would also behave as you would expect, providing you a new instance each time.\n *\n * - @param key [[`Key`]]\n * see { @link DI.createInterface } on interactions with interfaces\n */\nconst lazy = /*@__PURE__*/ createResolver((key, handler, requestor) => {\n    return () => requestor.get(key);\n});\n/**\n * Allows you to optionally inject a dependency depending on whether the [[`Key`]] is present, for example\n * ```ts\n * class Foo {\n *   constructor( @inject('mystring') public str: string = 'somestring' )\n * }\n * container.get(Foo); // throws\n * ```\n * would fail\n * ```ts\n * class Foo {\n *   constructor( @optional('mystring') public str: string = 'somestring' )\n * }\n * container.get(Foo).str // somestring\n * ```\n * if you use it without a default it will inject `undefined`, so rember to mark your input type as\n * possibly `undefined`!\n *\n * - @param key: [[`Key`]]\n *\n * see { @link DI.createInterface } on interactions with interfaces\n */\nconst optional = /*@__PURE__*/ createResolver((key, handler, requestor) => {\n    if (requestor.has(key, true)) {\n        return requestor.get(key);\n    }\n    else {\n        return undefined;\n    }\n});\n/**\n * ignore tells the container not to try to inject a dependency\n */\nconst ignore = /*@__PURE__*/ objectAssign((decorated, context) => {\n    inject(ignore)(decorated, context);\n}, { $isResolver: true, resolve: () => void 0 });\n/**\n * Inject a function that will return a resolved instance of the [[key]] given.\n * Also supports passing extra parameters to the invocation of the resolved constructor of [[key]]\n *\n * For typings, it's a function that take 0 or more arguments and return an instance. Example:\n * ```ts\n * class Foo {\n *   constructor( @factory(MyService) public createService: (...args: unknown[]) => MyService)\n * }\n * const foo = container.get(Foo); // instanceof Foo\n * const myService_1 = foo.createService('user service')\n * const myService_2 = foo.createService('content service')\n * ```\n *\n * ```ts\n * class Foo {\n *   constructor( @factory('random') public createRandomizer: () => Randomizer)\n * }\n * container.get(Foo).createRandomizer(); // create a randomizer\n * ```\n * would throw an exception because you haven't registered `'random'` before calling the method. This, would give you a\n * new instance of Randomizer each time.\n *\n * `@factory` does not manage the lifecycle of the underlying key. If you want a singleton, you have to register as a\n * `singleton`, `transient` would also behave as you would expect, providing you a new instance each time.\n *\n * - @param key [[`Key`]]\n * see { @link DI.createInterface } on interactions with interfaces\n */\nconst factory = /*@__PURE__*/ createResolver((key, handler, requestor) => {\n    return (...args) => handler.getFactory(key).construct(requestor, args);\n});\n/**\n * Create a resolver that will only resolve if the requesting container has the key pre-registered\n */\nconst own = /*@__PURE__*/ createResolver((key, handler, requestor) => {\n    return requestor.has(key, false) ? requestor.get(key) : void 0;\n});\n/**\n * Create a resolver that will resolve a key based on resource semantic (leaf + root + ignore middle layer container)\n * Will resolve at the root level if the key is not registered in the requestor container\n */\nconst resource = /*@__PURE__*/ createResolver((key, handler, requestor) => requestor.has(key, false)\n    ? requestor.get(key)\n    : requestor.root.get(key));\n/**\n * Create a resolver that will resolve a key based on resource semantic (leaf + root + ignore middle layer container)\n * only if the key is registered either in the requestor container or in the root container\n *\n * Returns `undefined` if the key is not registered in either container\n */\nconst optionalResource = /*@__PURE__*/ createResolver((key, handler, requestor) => requestor.has(key, false)\n    ? requestor.get(key)\n    : requestor.root.has(key, false)\n        ? requestor.root.get(key)\n        : void 0);\n/**\n * Create a resolver for resolving all registrations of a key with resource semantic (leaf + root + ignore middle layer container)\n */\nconst allResources = /*@__PURE__*/ createResolver((key, handler, requestor) => \n// prevent duplicate retrieval\nrequestor === requestor.root\n    ? requestor.getAll(key, false)\n    : requestor.has(key, false)\n        ? requestor.getAll(key, false).concat(requestor.root.getAll(key, false))\n        : requestor.root.getAll(key, false));\n/**\n * Create a resolver that will resolve a new instance of a key, and register the newly created instance with the requestor container\n */\nconst newInstanceForScope = /*@__PURE__*/ createResolver((key, handler, requestor) => {\n    const instance = createNewInstance(key, handler, requestor);\n    const instanceProvider = new InstanceProvider(safeString(key), instance);\n    /**\n     * By default the new instances for scope are disposable.\n     * If need be, we can always enhance the `createNewInstance` to support a 'injection' context, to make a non/disposable registration here.\n     */\n    requestor.registerResolver(key, instanceProvider, true);\n    return instance;\n});\n/**\n * Create a resolver that will resolve a new instance of a key\n */\nconst newInstanceOf = /*@__PURE__*/ createResolver((key, handler, requestor) => createNewInstance(key, handler, requestor));\nconst createNewInstance = (key, handler, requestor) => {\n    // 1. if there's a factory registration for the key\n    if (handler.hasFactory(key)) {\n        return handler.getFactory(key).construct(requestor);\n    }\n    // 2. if key is an interface\n    if (isInterface(key)) {\n        const hasDefault = isFunction(key.register);\n        const resolver = handler.getResolver(key, false);\n        let factory;\n        if (resolver == null) {\n            if (hasDefault) {\n                // creating a new container as we do not want to pollute the resolver registry\n                factory = (newInstanceContainer ??= createContainer()).getResolver(key, true)?.getFactory?.(handler);\n            }\n            newInstanceContainer.dispose();\n        }\n        else {\n            factory = resolver.getFactory?.(handler);\n        }\n        // 2.1 and has resolvable factory\n        if (factory != null) {\n            return factory.construct(requestor);\n        }\n        // 2.2 cannot instantiate a dummy interface\n        throw createMappedError(17 /* ErrorNames.invalid_new_instance_on_interface */, key);\n    }\n    // 3. jit factory, in case of newInstanceOf(SomeClass)\n    return handler.getFactory(key).construct(requestor);\n};\nconst isInterface = (key) => key?.$isInterface === true;\nlet newInstanceContainer;\n\n/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\n\nfunction __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n    var _, done = false;\n    for (var i = decorators.length - 1; i >= 0; i--) {\n        var context = {};\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n        if (kind === \"accessor\") {\n            if (result === void 0) continue;\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n            if (_ = accept(result.get)) descriptor.get = _;\n            if (_ = accept(result.set)) descriptor.set = _;\n            if (_ = accept(result.init)) initializers.unshift(_);\n        }\n        else if (_ = accept(result)) {\n            if (kind === \"field\") initializers.unshift(_);\n            else descriptor[key] = _;\n        }\n    }\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\n    done = true;\n}\nfunction __runInitializers(thisArg, initializers, value) {\n    var useValue = arguments.length > 2;\n    for (var i = 0; i < initializers.length; i++) {\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n    }\n    return useValue ? value : void 0;\n}\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n    var e = new Error(message);\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\n/** @internal */ const trace = 0;\n/** @internal */ const debug = 1;\n/** @internal */ const info = 2;\n/** @internal */ const warn = 3;\n/** @internal */ const error = 4;\n/** @internal */ const fatal = 5;\n/** @internal */ const none = 6;\nconst LogLevel = objectFreeze({\n    /**\n     * The most detailed information about internal app state.\n     *\n     * Disabled by default and should never be enabled in a production environment.\n     */\n    trace,\n    /**\n     * Information that is useful for debugging during development and has no long-term value.\n     */\n    debug,\n    /**\n     * Information about the general flow of the application that has long-term value.\n     */\n    info,\n    /**\n     * Unexpected circumstances that require attention but do not otherwise cause the current flow of execution to stop.\n     */\n    warn,\n    /**\n     * Unexpected circumstances that cause the flow of execution in the current activity to stop but do not cause an app-wide failure.\n     */\n    error,\n    /**\n     * Unexpected circumstances that cause an app-wide failure or otherwise require immediate attention.\n     */\n    fatal,\n    /**\n     * No messages should be written.\n     */\n    none,\n});\nconst ILogConfig = /*@__PURE__*/ createInterface('ILogConfig', x => x.instance(new LogConfig('no-colors', warn)));\nconst ISink = /*@__PURE__*/ createInterface('ISink');\nconst ILogEventFactory = /*@__PURE__*/ createInterface('ILogEventFactory', x => x.singleton(DefaultLogEventFactory));\nconst ILogger = /*@__PURE__*/ createInterface('ILogger', x => x.singleton(DefaultLogger));\nconst ILogScopes = /*@__PURE__*/ createInterface('ILogScope');\nconst LoggerSink = /*@__PURE__*/ objectFreeze({\n    key: getAnnotationKeyFor('logger-sink-handles'),\n    define(target, definition) {\n        defineMetadata(definition.handles, target, this.key);\n    },\n    getHandles(target) {\n        return getMetadata(this.key, target.constructor);\n    },\n});\nconst sink = (definition) => {\n    return (_target, context) => context.addInitializer(function () {\n        LoggerSink.define(this, definition);\n    });\n};\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\nconst format = toLookup({\n    red(str) {\n        return `\\u001b[31m${str}\\u001b[39m`;\n    },\n    green(str) {\n        return `\\u001b[32m${str}\\u001b[39m`;\n    },\n    yellow(str) {\n        return `\\u001b[33m${str}\\u001b[39m`;\n    },\n    blue(str) {\n        return `\\u001b[34m${str}\\u001b[39m`;\n    },\n    magenta(str) {\n        return `\\u001b[35m${str}\\u001b[39m`;\n    },\n    cyan(str) {\n        return `\\u001b[36m${str}\\u001b[39m`;\n    },\n    white(str) {\n        return `\\u001b[37m${str}\\u001b[39m`;\n    },\n    grey(str) {\n        return `\\u001b[90m${str}\\u001b[39m`;\n    },\n});\nclass LogConfig {\n    constructor(colorOptions, level) {\n        this.colorOptions = colorOptions;\n        this.level = level;\n    }\n}\nconst getLogLevelString = (function () {\n    const logLevelString = {\n        'no-colors': toLookup({\n            TRC: 'TRC',\n            DBG: 'DBG',\n            INF: 'INF',\n            WRN: 'WRN',\n            ERR: 'ERR',\n            FTL: 'FTL',\n            QQQ: '???',\n        }),\n        'colors': toLookup({\n            TRC: format.grey('TRC'),\n            DBG: format.grey('DBG'),\n            INF: format.white('INF'),\n            WRN: format.yellow('WRN'),\n            ERR: format.red('ERR'),\n            FTL: format.red('FTL'),\n            QQQ: format.grey('???'),\n        }),\n    };\n    return (level, colorOptions) => {\n        if (level <= trace) {\n            return logLevelString[colorOptions].TRC;\n        }\n        if (level <= debug) {\n            return logLevelString[colorOptions].DBG;\n        }\n        if (level <= info) {\n            return logLevelString[colorOptions].INF;\n        }\n        if (level <= warn) {\n            return logLevelString[colorOptions].WRN;\n        }\n        if (level <= error) {\n            return logLevelString[colorOptions].ERR;\n        }\n        if (level <= fatal) {\n            return logLevelString[colorOptions].FTL;\n        }\n        return logLevelString[colorOptions].QQQ;\n    };\n})();\nconst getScopeString = (scope, colorOptions) => {\n    if (colorOptions === 'no-colors') {\n        return scope.join('.');\n    }\n    return scope.map(format.cyan).join('.');\n};\nconst getIsoString = (timestamp, colorOptions) => {\n    if (colorOptions === 'no-colors') {\n        return new Date(timestamp).toISOString();\n    }\n    return format.grey(new Date(timestamp).toISOString());\n};\nclass DefaultLogEvent {\n    constructor(severity, message, optionalParams, scope, colorOptions, timestamp) {\n        this.severity = severity;\n        this.message = message;\n        this.optionalParams = optionalParams;\n        this.scope = scope;\n        this.colorOptions = colorOptions;\n        this.timestamp = timestamp;\n    }\n    toString() {\n        const { severity, message, scope, colorOptions, timestamp } = this;\n        if (scope.length === 0) {\n            return `${getIsoString(timestamp, colorOptions)} [${getLogLevelString(severity, colorOptions)}] ${message}`;\n        }\n        return `${getIsoString(timestamp, colorOptions)} [${getLogLevelString(severity, colorOptions)} ${getScopeString(scope, colorOptions)}] ${message}`;\n    }\n    getFormattedLogInfo(forConsole = false) {\n        const { severity, message: messageOrError, scope, colorOptions, timestamp, optionalParams } = this;\n        let error = null;\n        let message = '';\n        if (forConsole && messageOrError instanceof Error) {\n            error = messageOrError;\n        }\n        else {\n            message = messageOrError;\n        }\n        const scopeInfo = scope.length === 0 ? '' : ` ${getScopeString(scope, colorOptions)}`;\n        let msg = `${getIsoString(timestamp, colorOptions)} [${getLogLevelString(severity, colorOptions)}${scopeInfo}] ${message}`;\n        if (optionalParams === void 0 || optionalParams.length === 0) {\n            return error === null ? [msg] : [msg, error];\n        }\n        let offset = 0;\n        while (msg.includes('%s')) {\n            msg = msg.replace('%s', String(optionalParams[offset++]));\n        }\n        return error !== null ? [msg, error, ...optionalParams.slice(offset)] : [msg, ...optionalParams.slice(offset)];\n    }\n}\nclass DefaultLogEventFactory {\n    constructor() {\n        this.config = resolve(ILogConfig);\n    }\n    createLogEvent(logger, level, message, optionalParams) {\n        return new DefaultLogEvent(level, message, optionalParams, logger.scope, this.config.colorOptions, Date.now());\n    }\n}\nclass ConsoleSink {\n    static register(container) {\n        singletonRegistration(ISink, ConsoleSink).register(container);\n    }\n    constructor(p = resolve(IPlatform)) {\n        const $console = p.console;\n        this.handleEvent = function emit(event) {\n            const _info = event.getFormattedLogInfo(true);\n            switch (event.severity) {\n                case trace:\n                case debug:\n                    return $console.debug(..._info);\n                case info:\n                    return $console.info(..._info);\n                case warn:\n                    return $console.warn(..._info);\n                case error:\n                case fatal:\n                    return $console.error(..._info);\n            }\n        };\n    }\n}\nlet DefaultLogger = (() => {\n    var _a;\n    let _instanceExtraInitializers = [];\n    let _trace_decorators;\n    let _debug_decorators;\n    let _info_decorators;\n    let _warn_decorators;\n    let _error_decorators;\n    let _fatal_decorators;\n    return _a = class DefaultLogger {\n            /* eslint-disable default-param-last */\n            constructor(\n            /**\n             * The global logger configuration.\n             */\n            config = resolve(ILogConfig), factory = resolve(ILogEventFactory), sinks = resolve(all(ISink)), \n            /**\n             * The scopes that this logger was created for, if any.\n             */\n            scope = resolve(optional(ILogScopes)) ?? [], parent = null) {\n                this.scope = (__runInitializers(this, _instanceExtraInitializers), scope);\n                /** @internal */\n                this._scopedLoggers = createLookup();\n                /* eslint-enable default-param-last */\n                let traceSinks;\n                let debugSinks;\n                let infoSinks;\n                let warnSinks;\n                let errorSinks;\n                let fatalSinks;\n                this.config = config;\n                this._factory = factory;\n                this.sinks = sinks;\n                if (parent === null) {\n                    this.root = this;\n                    this.parent = this;\n                    traceSinks = this._traceSinks = [];\n                    debugSinks = this._debugSinks = [];\n                    infoSinks = this._infoSinks = [];\n                    warnSinks = this._warnSinks = [];\n                    errorSinks = this._errorSinks = [];\n                    fatalSinks = this._fatalSinks = [];\n                    for (const $sink of sinks) {\n                        const handles = LoggerSink.getHandles($sink);\n                        if (handles?.includes(trace) ?? true) {\n                            traceSinks.push($sink);\n                        }\n                        if (handles?.includes(debug) ?? true) {\n                            debugSinks.push($sink);\n                        }\n                        if (handles?.includes(info) ?? true) {\n                            infoSinks.push($sink);\n                        }\n                        if (handles?.includes(warn) ?? true) {\n                            warnSinks.push($sink);\n                        }\n                        if (handles?.includes(error) ?? true) {\n                            errorSinks.push($sink);\n                        }\n                        if (handles?.includes(fatal) ?? true) {\n                            fatalSinks.push($sink);\n                        }\n                    }\n                }\n                else {\n                    this.root = parent.root;\n                    this.parent = parent;\n                    traceSinks = this._traceSinks = parent._traceSinks;\n                    debugSinks = this._debugSinks = parent._debugSinks;\n                    infoSinks = this._infoSinks = parent._infoSinks;\n                    warnSinks = this._warnSinks = parent._warnSinks;\n                    errorSinks = this._errorSinks = parent._errorSinks;\n                    fatalSinks = this._fatalSinks = parent._fatalSinks;\n                }\n            }\n            trace(messageOrGetMessage, ...optionalParams) {\n                if (this.config.level <= trace) {\n                    this._emit(this._traceSinks, trace, messageOrGetMessage, optionalParams);\n                }\n            }\n            debug(messageOrGetMessage, ...optionalParams) {\n                if (this.config.level <= debug) {\n                    this._emit(this._debugSinks, debug, messageOrGetMessage, optionalParams);\n                }\n            }\n            info(messageOrGetMessage, ...optionalParams) {\n                if (this.config.level <= info) {\n                    this._emit(this._infoSinks, info, messageOrGetMessage, optionalParams);\n                }\n            }\n            warn(messageOrGetMessage, ...optionalParams) {\n                if (this.config.level <= warn) {\n                    this._emit(this._warnSinks, warn, messageOrGetMessage, optionalParams);\n                }\n            }\n            error(messageOrGetMessage, ...optionalParams) {\n                if (this.config.level <= error) {\n                    this._emit(this._errorSinks, error, messageOrGetMessage, optionalParams);\n                }\n            }\n            fatal(messageOrGetMessage, ...optionalParams) {\n                if (this.config.level <= fatal) {\n                    this._emit(this._fatalSinks, fatal, messageOrGetMessage, optionalParams);\n                }\n            }\n            /**\n             * Create a new logger with an additional permanent prefix added to the logging outputs.\n             * When chained, multiple scopes are separated by a dot.\n             *\n             * This is preliminary API and subject to change before alpha release.\n             *\n             * @example\n             *\n             * ```ts\n             * export class MyComponent {\n             *   constructor(@ILogger private logger: ILogger) {\n             *     this.logger.debug('before scoping');\n             *     // console output: '[DBG] before scoping'\n             *     this.logger = logger.scopeTo('MyComponent');\n             *     this.logger.debug('after scoping');\n             *     // console output: '[DBG MyComponent] after scoping'\n             *   }\n             *\n             *   public doStuff(): void {\n             *     const logger = this.logger.scopeTo('doStuff()');\n             *     logger.debug('doing stuff');\n             *     // console output: '[DBG MyComponent.doStuff()] doing stuff'\n             *   }\n             * }\n             * ```\n             */\n            scopeTo(name) {\n                const scopedLoggers = this._scopedLoggers;\n                let scopedLogger = scopedLoggers[name];\n                if (scopedLogger === void 0) {\n                    scopedLogger = scopedLoggers[name] = new _a(this.config, this._factory, null, this.scope.concat(name), this);\n                }\n                return scopedLogger;\n            }\n            /** @internal */\n            _emit(sinks, level, msgOrGetMsg, optionalParams) {\n                const message = (isFunction(msgOrGetMsg) ? msgOrGetMsg() : msgOrGetMsg);\n                const event = this._factory.createLogEvent(this, level, message, optionalParams);\n                for (let i = 0, ii = sinks.length; i < ii; ++i) {\n                    sinks[i].handleEvent(event);\n                }\n            }\n        },\n        (() => {\n            const _metadata = typeof Symbol === \"function\" && Symbol.metadata ? Object.create(null) : void 0;\n            _trace_decorators = [bound];\n            _debug_decorators = [bound];\n            _info_decorators = [bound];\n            _warn_decorators = [bound];\n            _error_decorators = [bound];\n            _fatal_decorators = [bound];\n            __esDecorate(_a, null, _trace_decorators, { kind: \"method\", name: \"trace\", static: false, private: false, access: { has: obj => \"trace\" in obj, get: obj => obj.trace }, metadata: _metadata }, null, _instanceExtraInitializers);\n            __esDecorate(_a, null, _debug_decorators, { kind: \"method\", name: \"debug\", static: false, private: false, access: { has: obj => \"debug\" in obj, get: obj => obj.debug }, metadata: _metadata }, null, _instanceExtraInitializers);\n            __esDecorate(_a, null, _info_decorators, { kind: \"method\", name: \"info\", static: false, private: false, access: { has: obj => \"info\" in obj, get: obj => obj.info }, metadata: _metadata }, null, _instanceExtraInitializers);\n            __esDecorate(_a, null, _warn_decorators, { kind: \"method\", name: \"warn\", static: false, private: false, access: { has: obj => \"warn\" in obj, get: obj => obj.warn }, metadata: _metadata }, null, _instanceExtraInitializers);\n            __esDecorate(_a, null, _error_decorators, { kind: \"method\", name: \"error\", static: false, private: false, access: { has: obj => \"error\" in obj, get: obj => obj.error }, metadata: _metadata }, null, _instanceExtraInitializers);\n            __esDecorate(_a, null, _fatal_decorators, { kind: \"method\", name: \"fatal\", static: false, private: false, access: { has: obj => \"fatal\" in obj, get: obj => obj.fatal }, metadata: _metadata }, null, _instanceExtraInitializers);\n            if (_metadata) Object.defineProperty(_a, Symbol.metadata, { enumerable: true, configurable: true, writable: true, value: _metadata });\n        })(),\n        _a;\n})();\n/**\n * A basic `ILogger` configuration that configures a single `console` sink based on provided options.\n *\n * NOTE: You *must* register the return value of `.create` with the container / au instance, not this `LoggerConfiguration` object itself.\n *\n * @example\n * ```ts\n * container.register(LoggerConfiguration.create());\n *\n * container.register(LoggerConfiguration.create({sinks: [ConsoleSink]}))\n *\n * container.register(LoggerConfiguration.create({sinks: [ConsoleSink], level: LogLevel.debug}))\n *\n * ```\n */\nconst LoggerConfiguration = /*@__PURE__*/ toLookup({\n    /**\n     * @param $console - The `console` object to use. Can be the native `window.console` / `global.console`, but can also be a wrapper or mock that implements the same interface.\n     * @param level - The global `LogLevel` to configure. Defaults to `warn` or higher.\n     * @param colorOptions - Whether to use colors or not. Defaults to `noColors`. Colors are especially nice in nodejs environments but don't necessarily work (well) in all environments, such as browsers.\n     */\n    create({ level = warn, colorOptions = 'no-colors', sinks = [], } = {}) {\n        return toLookup({\n            register(container) {\n                container.register(instanceRegistration(ILogConfig, new LogConfig(colorOptions, level)));\n                for (const $sink of sinks) {\n                    if (isFunction($sink)) {\n                        container.register(singletonRegistration(ISink, $sink));\n                    }\n                    else {\n                        container.register($sink);\n                    }\n                }\n                return container;\n            },\n        });\n    },\n});\n\nconst IModuleLoader = /*@__PURE__*/ createInterface(x => x.singleton(ModuleLoader));\nconst noTransform = (m) => m;\nclass ModuleTransformer {\n    constructor(transform) {\n        this._promiseCache = new Map();\n        this._objectCache = new Map();\n        this._transform = transform;\n    }\n    transform(objOrPromise) {\n        if (objOrPromise instanceof Promise) {\n            return this._transformPromise(objOrPromise);\n        }\n        else if (typeof objOrPromise === 'object' && objOrPromise !== null) {\n            return this._transformObject(objOrPromise);\n        }\n        else {\n            throw createMappedError(21 /* ErrorNames.invalid_module_transform_input */, objOrPromise);\n        }\n    }\n    /** @internal */\n    _transformPromise(promise) {\n        if (this._promiseCache.has(promise)) {\n            return this._promiseCache.get(promise);\n        }\n        const ret = promise.then(obj => {\n            return this._transformObject(obj);\n        });\n        this._promiseCache.set(promise, ret);\n        void ret.then(value => {\n            // make it synchronous for future requests\n            this._promiseCache.set(promise, value);\n        });\n        return ret;\n    }\n    /** @internal */\n    _transformObject(obj) {\n        if (this._objectCache.has(obj)) {\n            return this._objectCache.get(obj);\n        }\n        const ret = this._transform(this._analyze(obj));\n        this._objectCache.set(obj, ret);\n        if (ret instanceof Promise) {\n            void ret.then(value => {\n                // make it synchronous for future requests\n                this._objectCache.set(obj, value);\n            });\n        }\n        return ret;\n    }\n    /** @internal */\n    _analyze(m) {\n        if (m == null)\n            throw createMappedError(21 /* ErrorNames.invalid_module_transform_input */, m);\n        if (typeof m !== 'object')\n            return new AnalyzedModule(m, []);\n        let value;\n        let isRegistry;\n        let isConstructable;\n        let definition;\n        const items = [];\n        for (const key in m) {\n            switch (typeof (value = m[key])) {\n                case 'object':\n                    if (value === null) {\n                        continue;\n                    }\n                    isRegistry = isFunction(value.register);\n                    isConstructable = false;\n                    definition = null;\n                    break;\n                case 'function':\n                    isRegistry = isFunction(value.register);\n                    isConstructable = value.prototype !== void 0;\n                    definition = getMetadata(resourceBaseName, value) ?? null;\n                    break;\n                default:\n                    continue;\n            }\n            items.push(new ModuleItem(key, value, isRegistry, isConstructable, definition));\n        }\n        return new AnalyzedModule(m, items);\n    }\n}\nclass ModuleLoader {\n    constructor() {\n        this.transformers = new Map();\n    }\n    load(objOrPromise, transform = noTransform) {\n        const transformers = this.transformers;\n        let transformer = transformers.get(transform);\n        if (transformer === void 0) {\n            transformers.set(transform, transformer = new ModuleTransformer(transform));\n        }\n        return transformer.transform(objOrPromise);\n    }\n    dispose() {\n        this.transformers.clear();\n    }\n}\nclass AnalyzedModule {\n    constructor(raw, items) {\n        this.raw = raw;\n        this.items = items;\n    }\n}\nclass ModuleItem {\n    constructor(key, value, isRegistry, isConstructable, definition) {\n        this.key = key;\n        this.value = value;\n        this.isRegistry = isRegistry;\n        this.isConstructable = isConstructable;\n        this.definition = definition;\n    }\n}\n/**\n * Iterate through the exports of a module and register aliases for resources respectively\n */\nconst aliasedResourcesRegistry = (mod, mainKeyAlias, aliases = {}) => {\n    return {\n        register(container) {\n            const analyzedModule = container.get(IModuleLoader).load(mod);\n            let mainAliasRegistered = false;\n            analyzedModule.items.forEach((item) => {\n                const definition = item.definition;\n                if (definition == null) {\n                    container.register(item.value);\n                    return;\n                }\n                if (!mainAliasRegistered && mainKeyAlias != null) {\n                    mainAliasRegistered = true;\n                    definition.register(container, mainKeyAlias);\n                    return;\n                }\n                // cannot use item.key, since it could contain an uppercase letter\n                // while if import as is used in html, then it'll be lowercase letters only\n                // using definition name, however, comes with an issue, which is that it's not guaranteed to be unique\n                //\n                // for example: a module can export both an element and an attribute with the name \"foo\"\n                // but if that's the case, devs can always split the exports into two modules\n                const alias = aliases[definition.name];\n                definition.register(container, alias);\n            });\n        },\n    };\n};\n// or extract the registry part into a class?\n//\n// class AliasModuleKeysRegistry implements IRegistry {\n//   /** @internal */ private readonly _mod: IModule;\n//   /** @internal */ private readonly _mainKeyAlias: string | null;\n//   /** @internal */ private readonly _otherAliases: Record<string, string>;\n//   public constructor(\n//     mod: IModule,\n//     mainKeyAlias: string | null,\n//     aliases: Record<string, string>,\n//   ) {\n//     this._mod = mod;\n//     this._mainKeyAlias = mainKeyAlias;\n//     this._otherAliases = aliases;\n//   }\n//   /** @internal */\n//   private _getAliasedKeyForName(key: string, name: string): string {\n//     // replace the part after the last : with the name\n//     const parts = key.split(':');\n//     parts[parts.length - 1] = name;\n//     return parts.join(':');\n//   }\n//   public register(container: IContainer) {\n//     const analyzedModule = container.get(IModuleLoader).load(this._mod);\n//     let mainAliasRegistered = false;\n//     analyzedModule.items.forEach((item) => {\n//       const definition = item.definition;\n//       if (definition == null) {\n//         container.register(item.value);\n//         return;\n//       }\n//       if (!mainAliasRegistered && this._mainKeyAlias != null) {\n//         mainAliasRegistered = true;\n//         aliasToRegistration(definition.key, this._mainKeyAlias).register(container);\n//         return;\n//       }\n//       for (const aliasedExport in this._otherAliases) {\n//         const aliasName = this._otherAliases[aliasedExport];\n//         const aliasKey = this._getAliasedKeyForName(definition.key, aliasName);\n//         if (item.key === aliasedExport) {\n//           aliasToRegistration(definition.key, aliasKey).register(container);\n//         }\n//       }\n//     });\n//   }\n// }\n\n/**\n * Represents a handler for an EventAggregator event.\n */\nclass Handler {\n    constructor(type, cb) {\n        this.type = type;\n        this.cb = cb;\n    }\n    handle(message) {\n        if (message instanceof this.type) {\n            this.cb.call(null, message);\n        }\n    }\n}\nconst IEventAggregator = /*@__PURE__*/ createInterface('IEventAggregator', x => x.singleton(EventAggregator));\n/**\n * Enables loosely coupled publish/subscribe messaging.\n */\nclass EventAggregator {\n    constructor() {\n        /** @internal */\n        this.eventLookup = {};\n        /** @internal */\n        this.messageHandlers = [];\n    }\n    publish(channelOrInstance, message) {\n        // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n        if (!channelOrInstance) {\n            throw createMappedError(18 /* ErrorNames.event_aggregator_publish_invalid_event_name */, channelOrInstance);\n        }\n        if (isString(channelOrInstance)) {\n            let subscribers = this.eventLookup[channelOrInstance];\n            if (subscribers !== void 0) {\n                subscribers = subscribers.slice();\n                const numSubscribers = subscribers.length;\n                for (let i = 0; i < numSubscribers; i++) {\n                    subscribers[i](message, channelOrInstance);\n                }\n            }\n        }\n        else {\n            const subscribers = this.messageHandlers.slice();\n            const numSubscribers = subscribers.length;\n            for (let i = 0; i < numSubscribers; i++) {\n                subscribers[i].handle(channelOrInstance);\n            }\n        }\n    }\n    subscribe(channelOrType, callback) {\n        // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n        if (!channelOrType) {\n            throw createMappedError(19 /* ErrorNames.event_aggregator_subscribe_invalid_event_name */, channelOrType);\n        }\n        let handler;\n        let subscribers;\n        if (isString(channelOrType)) {\n            if (this.eventLookup[channelOrType] === void 0) {\n                this.eventLookup[channelOrType] = [];\n            }\n            handler = callback;\n            subscribers = this.eventLookup[channelOrType];\n        }\n        else {\n            handler = new Handler(channelOrType, callback);\n            subscribers = this.messageHandlers;\n        }\n        subscribers.push(handler);\n        return {\n            dispose() {\n                const idx = subscribers.indexOf(handler);\n                if (idx !== -1) {\n                    subscribers.splice(idx, 1);\n                }\n            }\n        };\n    }\n    subscribeOnce(channelOrType, callback) {\n        const sub = this.subscribe(channelOrType, (message, event) => {\n            sub.dispose();\n            callback(message, event);\n        });\n        return sub;\n    }\n}\n\nexport { AnalyzedModule, ConsoleSink, ContainerConfiguration, DI, DefaultLogEvent, DefaultLogEventFactory, DefaultLogger, DefaultResolver, EventAggregator, IContainer, IEventAggregator, ILogConfig, ILogEventFactory, ILogger, IModuleLoader, IPlatform, IServiceLocator, ISink, InstanceProvider, LogConfig, LogLevel, LoggerConfiguration, ModuleItem, Protocol, Registration, aliasedResourcesRegistry, all, allResources, areEqual, bound, camelCase, createImplementationRegister, createLookup, createResolver, emptyArray, emptyObject, factory, firstDefined, format, fromAnnotationOrDefinitionOrTypeOrDefault, fromAnnotationOrTypeOrDefault, fromDefinitionOrDefault, getPrototypeChain, getResourceKeyFor, ignore, inject, isArray, isArrayIndex, isFunction, isMap, isNativeFunction, isNumber, isObject, isObjectOrFunction, isPromise, isSet, isString, isSymbol, kebabCase, last, lazy, mergeArrays, newInstanceForScope, newInstanceOf, noop, onResolve, onResolveAll, optional, optionalResource, own, pascalCase, registrableMetadataKey, resolve, resource, resourceBaseName, singleton, sink, toArray, transient };\n//# sourceMappingURL=index.dev.mjs.map\n","import { emptyArray, createImplementationRegister, DI } from '@aurelia/kernel';\n\n/* eslint-disable @typescript-eslint/no-unused-vars */\n/** @internal */ const ekAccessThis = 'AccessThis';\n/** @internal */ const ekAccessBoundary = 'AccessBoundary';\n/** @internal */ const ekAccessGlobal = 'AccessGlobal';\n/** @internal */ const ekAccessScope = 'AccessScope';\n/** @internal */ const ekArrayLiteral = 'ArrayLiteral';\n/** @internal */ const ekObjectLiteral = 'ObjectLiteral';\n/** @internal */ const ekPrimitiveLiteral = 'PrimitiveLiteral';\n/** @internal */ const ekNew = 'New';\n/** @internal */ const ekTemplate = 'Template';\n/** @internal */ const ekUnary = 'Unary';\n/** @internal */ const ekCallScope = 'CallScope';\n/** @internal */ const ekCallMember = 'CallMember';\n/** @internal */ const ekCallFunction = 'CallFunction';\n/** @internal */ const ekCallGlobal = 'CallGlobal';\n/** @internal */ const ekAccessMember = 'AccessMember';\n/** @internal */ const ekAccessKeyed = 'AccessKeyed';\n/** @internal */ const ekTaggedTemplate = 'TaggedTemplate';\n/** @internal */ const ekBinary = 'Binary';\n/** @internal */ const ekConditional = 'Conditional';\n/** @internal */ const ekAssign = 'Assign';\n/** @internal */ const ekArrowFunction = 'ArrowFunction';\n/** @internal */ const ekValueConverter = 'ValueConverter';\n/** @internal */ const ekBindingBehavior = 'BindingBehavior';\n/** @internal */ const ekArrayBindingPattern = 'ArrayBindingPattern';\n/** @internal */ const ekObjectBindingPattern = 'ObjectBindingPattern';\n/** @internal */ const ekBindingIdentifier = 'BindingIdentifier';\n/** @internal */ const ekForOfStatement = 'ForOfStatement';\n/** @internal */ const ekInterpolation = 'Interpolation';\n/** @internal */ const ekArrayDestructuring = 'ArrayDestructuring';\n/** @internal */ const ekObjectDestructuring = 'ObjectDestructuring';\n/** @internal */ const ekDestructuringAssignmentLeaf = 'DestructuringAssignmentLeaf';\n/** @internal */ const ekCustom = 'Custom';\nclass CustomExpression {\n    constructor(value) {\n        this.value = value;\n        this.$kind = ekCustom;\n    }\n    evaluate(...params) {\n        return this.value;\n    }\n    assign(...params) {\n        return params;\n    }\n    bind(...params) {\n        // empty\n    }\n    unbind(...params) {\n        // empty\n    }\n    accept(_visitor) {\n        return (void 0);\n    }\n}\nclass BindingBehaviorExpression {\n    constructor(expression, name, args) {\n        this.expression = expression;\n        this.name = name;\n        this.args = args;\n        this.$kind = ekBindingBehavior;\n        this.key = `_bb_${name}`;\n    }\n}\nclass ValueConverterExpression {\n    constructor(expression, name, args) {\n        this.expression = expression;\n        this.name = name;\n        this.args = args;\n        this.$kind = ekValueConverter;\n    }\n}\nclass AssignExpression {\n    constructor(target, value, op = '=') {\n        this.target = target;\n        this.value = value;\n        this.op = op;\n        this.$kind = ekAssign;\n    }\n}\nclass ConditionalExpression {\n    constructor(condition, yes, no) {\n        this.condition = condition;\n        this.yes = yes;\n        this.no = no;\n        this.$kind = ekConditional;\n    }\n}\nclass AccessGlobalExpression {\n    constructor(name) {\n        this.name = name;\n        this.$kind = ekAccessGlobal;\n    }\n}\nclass AccessThisExpression {\n    constructor(ancestor = 0) {\n        this.ancestor = ancestor;\n        this.$kind = ekAccessThis;\n    }\n}\nclass AccessBoundaryExpression {\n    constructor() {\n        this.$kind = ekAccessBoundary;\n    }\n}\nclass AccessScopeExpression {\n    constructor(name, ancestor = 0) {\n        this.name = name;\n        this.ancestor = ancestor;\n        this.$kind = ekAccessScope;\n    }\n}\nconst isAccessGlobal = (ast) => (ast.$kind === ekAccessGlobal ||\n    (ast.$kind === ekAccessMember ||\n        ast.$kind === ekAccessKeyed) && ast.accessGlobal);\nclass AccessMemberExpression {\n    constructor(object, name, optional = false) {\n        this.object = object;\n        this.name = name;\n        this.optional = optional;\n        this.$kind = ekAccessMember;\n        this.accessGlobal = isAccessGlobal(object);\n    }\n}\nclass AccessKeyedExpression {\n    constructor(object, key, optional = false) {\n        this.object = object;\n        this.key = key;\n        this.optional = optional;\n        this.$kind = ekAccessKeyed;\n        this.accessGlobal = isAccessGlobal(object);\n    }\n}\nclass NewExpression {\n    constructor(func, args) {\n        this.func = func;\n        this.args = args;\n        this.$kind = ekNew;\n    }\n}\nclass CallScopeExpression {\n    constructor(name, args, ancestor = 0, optional = false) {\n        this.name = name;\n        this.args = args;\n        this.ancestor = ancestor;\n        this.optional = optional;\n        this.$kind = ekCallScope;\n    }\n}\nclass CallMemberExpression {\n    constructor(object, name, args, optionalMember = false, optionalCall = false) {\n        this.object = object;\n        this.name = name;\n        this.args = args;\n        this.optionalMember = optionalMember;\n        this.optionalCall = optionalCall;\n        this.$kind = ekCallMember;\n    }\n}\nclass CallFunctionExpression {\n    constructor(func, args, optional = false) {\n        this.func = func;\n        this.args = args;\n        this.optional = optional;\n        this.$kind = ekCallFunction;\n    }\n}\nclass CallGlobalExpression {\n    constructor(name, args) {\n        this.name = name;\n        this.args = args;\n        this.$kind = ekCallGlobal;\n    }\n}\nclass BinaryExpression {\n    constructor(operation, left, right) {\n        this.operation = operation;\n        this.left = left;\n        this.right = right;\n        this.$kind = ekBinary;\n    }\n}\nclass UnaryExpression {\n    constructor(operation, expression, pos = 0) {\n        this.operation = operation;\n        this.expression = expression;\n        this.pos = pos;\n        this.$kind = ekUnary;\n    }\n}\nclass PrimitiveLiteralExpression {\n    constructor(value) {\n        this.value = value;\n        this.$kind = ekPrimitiveLiteral;\n    }\n}\nPrimitiveLiteralExpression.$undefined = new PrimitiveLiteralExpression(void 0);\nPrimitiveLiteralExpression.$null = new PrimitiveLiteralExpression(null);\nPrimitiveLiteralExpression.$true = new PrimitiveLiteralExpression(true);\nPrimitiveLiteralExpression.$false = new PrimitiveLiteralExpression(false);\nPrimitiveLiteralExpression.$empty = new PrimitiveLiteralExpression('');\nclass ArrayLiteralExpression {\n    constructor(elements) {\n        this.elements = elements;\n        this.$kind = ekArrayLiteral;\n    }\n}\nArrayLiteralExpression.$empty = new ArrayLiteralExpression(emptyArray);\nclass ObjectLiteralExpression {\n    constructor(keys, values) {\n        this.keys = keys;\n        this.values = values;\n        this.$kind = ekObjectLiteral;\n    }\n}\nObjectLiteralExpression.$empty = new ObjectLiteralExpression(emptyArray, emptyArray);\nclass TemplateExpression {\n    constructor(cooked, expressions = emptyArray) {\n        this.cooked = cooked;\n        this.expressions = expressions;\n        this.$kind = ekTemplate;\n    }\n}\nTemplateExpression.$empty = new TemplateExpression(['']);\nclass TaggedTemplateExpression {\n    constructor(cooked, raw, func, expressions = emptyArray) {\n        this.cooked = cooked;\n        this.func = func;\n        this.expressions = expressions;\n        this.$kind = ekTaggedTemplate;\n        cooked.raw = raw;\n    }\n}\nclass ArrayBindingPattern {\n    // We'll either have elements, or keys+values, but never all 3\n    constructor(elements) {\n        this.elements = elements;\n        this.$kind = ekArrayBindingPattern;\n    }\n}\nclass ObjectBindingPattern {\n    // We'll either have elements, or keys+values, but never all 3\n    constructor(keys, values) {\n        this.keys = keys;\n        this.values = values;\n        this.$kind = ekObjectBindingPattern;\n    }\n}\nclass BindingIdentifier {\n    constructor(name) {\n        this.name = name;\n        this.$kind = ekBindingIdentifier;\n    }\n}\n// https://tc39.github.io/ecma262/#sec-iteration-statements\n// https://tc39.github.io/ecma262/#sec-for-in-and-for-of-statements\nclass ForOfStatement {\n    constructor(declaration, iterable, semiIdx) {\n        this.declaration = declaration;\n        this.iterable = iterable;\n        this.semiIdx = semiIdx;\n        this.$kind = ekForOfStatement;\n    }\n}\n/*\n* Note: this implementation is far simpler than the one in vCurrent and might be missing important stuff (not sure yet)\n* so while this implementation is identical to Template and we could reuse that one, we don't want to lock outselves in to potentially the wrong abstraction\n* but this class might be a candidate for removal if it turns out it does provide all we need\n*/\nclass Interpolation {\n    constructor(parts, expressions = emptyArray) {\n        this.parts = parts;\n        this.expressions = expressions;\n        this.$kind = ekInterpolation;\n        this.isMulti = expressions.length > 1;\n        this.firstExpression = expressions[0];\n    }\n}\n// spec: https://tc39.es/ecma262/#sec-destructuring-assignment\n/** This is an internal API */\nclass DestructuringAssignmentExpression {\n    constructor($kind, list, source, initializer) {\n        this.$kind = $kind;\n        this.list = list;\n        this.source = source;\n        this.initializer = initializer;\n    }\n}\n/** This is an internal API */\nclass DestructuringAssignmentSingleExpression {\n    constructor(target, source, initializer) {\n        this.target = target;\n        this.source = source;\n        this.initializer = initializer;\n        this.$kind = ekDestructuringAssignmentLeaf;\n    }\n}\n/** This is an internal API */\nclass DestructuringAssignmentRestExpression {\n    constructor(target, indexOrProperties) {\n        this.target = target;\n        this.indexOrProperties = indexOrProperties;\n        this.$kind = ekDestructuringAssignmentLeaf;\n    }\n}\nclass ArrowFunction {\n    constructor(args, body, rest = false) {\n        this.args = args;\n        this.body = body;\n        this.rest = rest;\n        this.$kind = ekArrowFunction;\n    }\n}\n\n/** @internal */\nconst createError = (message) => new Error(message);\n/** @internal */\nconst isString = (v) => typeof v === 'string';\n// this is used inside template literal, since TS errs without String(...value)\n/** @internal */ const safeString = String;\n/** @internal */ const createLookup = () => Object.create(null);\n\nconst astVisit = (ast, visitor) => {\n    switch (ast.$kind) {\n        case ekAccessKeyed: return visitor.visitAccessKeyed(ast);\n        case ekAccessMember: return visitor.visitAccessMember(ast);\n        case ekAccessScope: return visitor.visitAccessScope(ast);\n        case ekAccessThis: return visitor.visitAccessThis(ast);\n        case ekAccessBoundary: return visitor.visitAccessBoundary(ast);\n        case ekArrayBindingPattern: return visitor.visitArrayBindingPattern(ast);\n        case ekArrayDestructuring: return visitor.visitDestructuringAssignmentExpression(ast);\n        case ekArrayLiteral: return visitor.visitArrayLiteral(ast);\n        case ekArrowFunction: return visitor.visitArrowFunction(ast);\n        case ekAssign: return visitor.visitAssign(ast);\n        case ekBinary: return visitor.visitBinary(ast);\n        case ekBindingBehavior: return visitor.visitBindingBehavior(ast);\n        case ekBindingIdentifier: return visitor.visitBindingIdentifier(ast);\n        case ekCallFunction: return visitor.visitCallFunction(ast);\n        case ekCallMember: return visitor.visitCallMember(ast);\n        case ekCallScope: return visitor.visitCallScope(ast);\n        case ekConditional: return visitor.visitConditional(ast);\n        case ekDestructuringAssignmentLeaf: return visitor.visitDestructuringAssignmentSingleExpression(ast);\n        case ekForOfStatement: return visitor.visitForOfStatement(ast);\n        case ekInterpolation: return visitor.visitInterpolation(ast);\n        case ekObjectBindingPattern: return visitor.visitObjectBindingPattern(ast);\n        case ekObjectDestructuring: return visitor.visitDestructuringAssignmentExpression(ast);\n        case ekObjectLiteral: return visitor.visitObjectLiteral(ast);\n        case ekPrimitiveLiteral: return visitor.visitPrimitiveLiteral(ast);\n        case ekTaggedTemplate: return visitor.visitTaggedTemplate(ast);\n        case ekTemplate: return visitor.visitTemplate(ast);\n        case ekUnary: return visitor.visitUnary(ast);\n        case ekValueConverter: return visitor.visitValueConverter(ast);\n        case ekCustom: return visitor.visitCustom(ast);\n        default: {\n            throw createError(`Trying to visit unknown ast node ${JSON.stringify(ast)}`);\n        }\n    }\n};\nclass Unparser {\n    constructor() {\n        this.text = '';\n    }\n    static unparse(expr) {\n        const visitor = new Unparser();\n        astVisit(expr, visitor);\n        return visitor.text;\n    }\n    visitAccessMember(expr) {\n        astVisit(expr.object, this);\n        this.text += `${expr.optional ? '?' : ''}.${expr.name}`;\n    }\n    visitAccessKeyed(expr) {\n        astVisit(expr.object, this);\n        this.text += `${expr.optional ? '?.' : ''}[`;\n        astVisit(expr.key, this);\n        this.text += ']';\n    }\n    visitAccessThis(expr) {\n        if (expr.ancestor === 0) {\n            this.text += '$this';\n            return;\n        }\n        this.text += '$parent';\n        let i = expr.ancestor - 1;\n        while (i--) {\n            this.text += '.$parent';\n        }\n    }\n    visitAccessBoundary(_expr) {\n        this.text += 'this';\n    }\n    visitAccessScope(expr) {\n        let i = expr.ancestor;\n        while (i--) {\n            this.text += '$parent.';\n        }\n        this.text += expr.name;\n    }\n    visitArrayLiteral(expr) {\n        const elements = expr.elements;\n        this.text += '[';\n        for (let i = 0, length = elements.length; i < length; ++i) {\n            if (i !== 0) {\n                this.text += ',';\n            }\n            astVisit(elements[i], this);\n        }\n        this.text += ']';\n    }\n    visitArrowFunction(expr) {\n        const args = expr.args;\n        const ii = args.length;\n        let i = 0;\n        let text = '(';\n        let name;\n        for (; i < ii; ++i) {\n            name = args[i].name;\n            if (i > 0) {\n                text += ', ';\n            }\n            if (i < ii - 1) {\n                text += name;\n            }\n            else {\n                text += expr.rest ? `...${name}` : name;\n            }\n        }\n        this.text += `${text}) => `;\n        astVisit(expr.body, this);\n    }\n    visitObjectLiteral(expr) {\n        const keys = expr.keys;\n        const values = expr.values;\n        this.text += '{';\n        for (let i = 0, length = keys.length; i < length; ++i) {\n            if (i !== 0) {\n                this.text += ',';\n            }\n            this.text += `'${keys[i]}':`;\n            astVisit(values[i], this);\n        }\n        this.text += '}';\n    }\n    visitPrimitiveLiteral(expr) {\n        this.text += '(';\n        if (isString(expr.value)) {\n            const escaped = expr.value.replace(/'/g, '\\\\\\'');\n            this.text += `'${escaped}'`;\n        }\n        else {\n            this.text += `${expr.value}`;\n        }\n        this.text += ')';\n    }\n    visitCallFunction(expr) {\n        this.text += '(';\n        astVisit(expr.func, this);\n        this.text += expr.optional ? '?.' : '';\n        this.writeArgs(expr.args);\n        this.text += ')';\n    }\n    visitCallMember(expr) {\n        astVisit(expr.object, this);\n        this.text += `${expr.optionalMember ? '?.' : ''}.${expr.name}${expr.optionalCall ? '?.' : ''}`;\n        this.writeArgs(expr.args);\n    }\n    visitCallScope(expr) {\n        let i = expr.ancestor;\n        while (i--) {\n            this.text += '$parent.';\n        }\n        this.text += `${expr.name}${expr.optional ? '?.' : ''}`;\n        this.writeArgs(expr.args);\n    }\n    visitTemplate(expr) {\n        const { cooked, expressions } = expr;\n        const length = expressions.length;\n        this.text += '`';\n        this.text += cooked[0];\n        for (let i = 0; i < length; i++) {\n            astVisit(expressions[i], this);\n            this.text += cooked[i + 1];\n        }\n        this.text += '`';\n    }\n    visitTaggedTemplate(expr) {\n        const { cooked, expressions } = expr;\n        const length = expressions.length;\n        astVisit(expr.func, this);\n        this.text += '`';\n        this.text += cooked[0];\n        for (let i = 0; i < length; i++) {\n            astVisit(expressions[i], this);\n            this.text += cooked[i + 1];\n        }\n        this.text += '`';\n    }\n    visitUnary(expr) {\n        this.text += `(${expr.operation}`;\n        if (expr.operation.charCodeAt(0) >= /* a */ 97) {\n            this.text += ' ';\n        }\n        astVisit(expr.expression, this);\n        this.text += ')';\n    }\n    visitBinary(expr) {\n        this.text += '(';\n        astVisit(expr.left, this);\n        if (expr.operation.charCodeAt(0) === /* i */ 105) {\n            this.text += ` ${expr.operation} `;\n        }\n        else {\n            this.text += expr.operation;\n        }\n        astVisit(expr.right, this);\n        this.text += ')';\n    }\n    visitConditional(expr) {\n        this.text += '(';\n        astVisit(expr.condition, this);\n        this.text += '?';\n        astVisit(expr.yes, this);\n        this.text += ':';\n        astVisit(expr.no, this);\n        this.text += ')';\n    }\n    visitAssign(expr) {\n        this.text += '(';\n        astVisit(expr.target, this);\n        this.text += '=';\n        astVisit(expr.value, this);\n        this.text += ')';\n    }\n    visitValueConverter(expr) {\n        const args = expr.args;\n        astVisit(expr.expression, this);\n        this.text += `|${expr.name}`;\n        for (let i = 0, length = args.length; i < length; ++i) {\n            this.text += ':';\n            astVisit(args[i], this);\n        }\n    }\n    visitBindingBehavior(expr) {\n        const args = expr.args;\n        astVisit(expr.expression, this);\n        this.text += `&${expr.name}`;\n        for (let i = 0, length = args.length; i < length; ++i) {\n            this.text += ':';\n            astVisit(args[i], this);\n        }\n    }\n    visitArrayBindingPattern(expr) {\n        const elements = expr.elements;\n        this.text += '[';\n        for (let i = 0, length = elements.length; i < length; ++i) {\n            if (i !== 0) {\n                this.text += ',';\n            }\n            astVisit(elements[i], this);\n        }\n        this.text += ']';\n    }\n    visitObjectBindingPattern(expr) {\n        const keys = expr.keys;\n        const values = expr.values;\n        this.text += '{';\n        for (let i = 0, length = keys.length; i < length; ++i) {\n            if (i !== 0) {\n                this.text += ',';\n            }\n            this.text += `'${keys[i]}':`;\n            astVisit(values[i], this);\n        }\n        this.text += '}';\n    }\n    visitBindingIdentifier(expr) {\n        this.text += expr.name;\n    }\n    visitForOfStatement(expr) {\n        astVisit(expr.declaration, this);\n        this.text += ' of ';\n        astVisit(expr.iterable, this);\n    }\n    visitInterpolation(expr) {\n        const { parts, expressions } = expr;\n        const length = expressions.length;\n        this.text += '${';\n        this.text += parts[0];\n        for (let i = 0; i < length; i++) {\n            astVisit(expressions[i], this);\n            this.text += parts[i + 1];\n        }\n        this.text += '}';\n    }\n    visitDestructuringAssignmentExpression(expr) {\n        const $kind = expr.$kind;\n        const isObjDes = $kind === ekObjectDestructuring;\n        this.text += isObjDes ? '{' : '[';\n        const list = expr.list;\n        const len = list.length;\n        let i;\n        let item;\n        for (i = 0; i < len; i++) {\n            item = list[i];\n            switch (item.$kind) {\n                case ekDestructuringAssignmentLeaf:\n                    astVisit(item, this);\n                    break;\n                case ekArrayDestructuring:\n                case ekObjectDestructuring: {\n                    const source = item.source;\n                    if (source) {\n                        astVisit(source, this);\n                        this.text += ':';\n                    }\n                    astVisit(item, this);\n                    break;\n                }\n            }\n        }\n        this.text += isObjDes ? '}' : ']';\n    }\n    visitDestructuringAssignmentSingleExpression(expr) {\n        astVisit(expr.source, this);\n        this.text += ':';\n        astVisit(expr.target, this);\n        const initializer = expr.initializer;\n        if (initializer !== void 0) {\n            this.text += '=';\n            astVisit(initializer, this);\n        }\n    }\n    visitDestructuringAssignmentRestExpression(expr) {\n        this.text += '...';\n        astVisit(expr.target, this);\n    }\n    visitCustom(expr) {\n        this.text += safeString(expr.value);\n    }\n    writeArgs(args) {\n        this.text += '(';\n        for (let i = 0, length = args.length; i < length; ++i) {\n            if (i !== 0) {\n                this.text += ',';\n            }\n            astVisit(args[i], this);\n        }\n        this.text += ')';\n    }\n}\n\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/* eslint-disable prefer-template */\n/** @internal */\nconst createMappedError = (code, ...details) => new Error(`AUR${safeString(code).padStart(4, '0')}: ${getMessageByCode(code, ...details)}`)\n    ;\n\nconst errorsMap = {\n    [99 /* ErrorNames.method_not_implemented */]: 'Method {{0}} not implemented',\n    [101 /* ErrorNames.ast_behavior_not_found */]: `Ast eval error: binding behavior \"{{0}}\" could not be found. Did you forget to register it as a dependency?`,\n    [102 /* ErrorNames.ast_behavior_duplicated */]: `Ast eval error: binding behavior \"{{0}}\" already applied.`,\n    [103 /* ErrorNames.ast_converter_not_found */]: `Ast eval error: value converter \"{{0}}\" could not be found. Did you forget to register it as a dependency?`,\n    [105 /* ErrorNames.ast_$host_not_found */]: `Ast eval error: unable to find $host context. Did you forget [au-slot] attribute?`,\n    [106 /* ErrorNames.ast_no_assign_$host */]: `Ast eval error: invalid assignment. \"$host\" is a reserved keyword.`,\n    [107 /* ErrorNames.ast_not_a_function */]: `Ast eval error: expression is not a function.`,\n    [109 /* ErrorNames.ast_unknown_unary_operator */]: `Ast eval error: unknown unary operator: \"{{0}}\"`,\n    [108 /* ErrorNames.ast_unknown_binary_operator */]: `Ast eval error: unknown binary operator: \"{{0}}\"`,\n    [110 /* ErrorNames.ast_tagged_not_a_function */]: `Ast eval error: left-hand side of tagged template expression is not a function.`,\n    [111 /* ErrorNames.ast_name_is_not_a_function */]: `Ast eval error: expected \"{{0}}\" to be a function`,\n    [112 /* ErrorNames.ast_destruct_null */]: `Ast eval error: cannot use non-object value for destructuring assignment.`,\n    [151 /* ErrorNames.parse_invalid_start */]: `Expression error: invalid start: \"{{0}}\"`,\n    [152 /* ErrorNames.parse_no_spread */]: `Expression error: spread operator is not supported: \"{{0}}\"`,\n    [153 /* ErrorNames.parse_expected_identifier */]: `Expression error: expected identifier: \"{{0}}\"`,\n    [154 /* ErrorNames.parse_invalid_member_expr */]: `Expression error: invalid member expression: \"{{0}}\"`,\n    [155 /* ErrorNames.parse_unexpected_end */]: `Expression error: unexpected end of expression: \"{{0}}\"`,\n    [156 /* ErrorNames.parse_unconsumed_token */]: `Expression error: unconsumed token: \"{{0}}\" at position {{1}} of \"{{2}}\"`,\n    [157 /* ErrorNames.parse_invalid_empty */]: `Expression error: invalid empty expression. Empty expression is only valid in event bindings (trigger, delegate, capture etc...)`,\n    [158 /* ErrorNames.parse_left_hand_side_not_assignable */]: `Expression error: left hand side of expression is not assignable: \"{{0}}\"`,\n    [159 /* ErrorNames.parse_expected_converter_identifier */]: `Expression error: expected identifier to come after value converter operator: \"{{0}}\"`,\n    [160 /* ErrorNames.parse_expected_behavior_identifier */]: `Expression error: expected identifier to come after binding behavior operator: {{0}}`,\n    [161 /* ErrorNames.parse_unexpected_keyword_of */]: `Expression error: unexpected keyword \"of\": \"{{0}}\"`,\n    [162 /* ErrorNames.parse_unexpected_keyword_import */]: `Expression error: unexpected keyword \"import\": \"{{0}}\"`,\n    [163 /* ErrorNames.parse_invalid_identifier_in_forof */]: `Expression error: invalid BindingIdentifier at left hand side of \"of\": \"{{0}}\" | kind: {{1}}`,\n    [164 /* ErrorNames.parse_invalid_identifier_object_literal_key */]: `Expression error: invalid or unsupported property definition in object literal: \"{{0}}\"`,\n    [165 /* ErrorNames.parse_unterminated_string */]: `Expression error: unterminated quote in string literal: \"{{0}}\"`,\n    [166 /* ErrorNames.parse_unterminated_template_string */]: `Expression error: unterminated template string: \"{{0}}\"`,\n    [167 /* ErrorNames.parse_missing_expected_token */]: `Expression error: missing expected token \"{{0}}\" in \"{{1}}\"`,\n    [168 /* ErrorNames.parse_unexpected_character */]: `Expression error: unexpected character: \"{{0}}\"`,\n    [170 /* ErrorNames.parse_unexpected_token_destructuring */]: `Expression error: unexpected \"{{0}}\" at position \"{{1}}\" for destructuring assignment in \"{{2}}\"`,\n    [171 /* ErrorNames.parse_unexpected_token_optional_chain */]: `Expression error: unexpected {{0}} at position \"{{1}}\" for optional chain in \"{{2}}\"`,\n    [172 /* ErrorNames.parse_invalid_tag_in_optional_chain */]: `Expression error: invalid tagged template on optional chain in \"{{1}}\"`,\n    [173 /* ErrorNames.parse_invalid_arrow_params */]: `Expression error: invalid arrow parameter list in \"{{0}}\"`,\n    [174 /* ErrorNames.parse_no_arrow_param_default_value */]: `Expression error: arrow function with default parameters is not supported: \"{{0}}\"`,\n    [175 /* ErrorNames.parse_no_arrow_param_destructuring */]: `Expression error: arrow function with destructuring parameters is not supported: \"{{0}}\"`,\n    [176 /* ErrorNames.parse_rest_must_be_last */]: `Expression error: rest parameter must be last formal parameter in arrow function: \"{{0}}\"`,\n    [178 /* ErrorNames.parse_no_arrow_fn_body */]: `Expression error: arrow function with function body is not supported: \"{{0}}\"`,\n    [179 /* ErrorNames.parse_unexpected_double_dot */]: `Expression error: unexpected token '.' at position \"{{1}}\" in \"{{0}}\"`,\n};\nconst getMessageByCode = (name, ...details) => {\n    let cooked = errorsMap[name];\n    for (let i = 0; i < details.length; ++i) {\n        const regex = new RegExp(`{{${i}(:.*)?}}`, 'g');\n        let matches = regex.exec(cooked);\n        while (matches != null) {\n            const method = matches[1]?.slice(1);\n            let value = details[i];\n            if (value != null) {\n                switch (method) {\n                    case 'toString':\n                        value = Object.prototype.toString.call(value);\n                        break;\n                    case 'join(!=)':\n                        value = value.join('!=');\n                        break;\n                    case 'element':\n                        value = value === '*' ? 'all elements' : `<${value} />`;\n                        break;\n                    default: {\n                        // property access\n                        if (method?.startsWith('.')) {\n                            value = safeString(value[method.slice(1)]);\n                        }\n                        else {\n                            value = safeString(value);\n                        }\n                    }\n                }\n            }\n            cooked = cooked.slice(0, matches.index) + value + cooked.slice(regex.lastIndex);\n            matches = regex.exec(cooked);\n        }\n    }\n    return cooked;\n};\n\n/* eslint-disable @typescript-eslint/no-unnecessary-type-assertion */\nconst IExpressionParser = /*@__PURE__*/ DI.createInterface('IExpressionParser');\n/**\n * A default implementation of the IExpressionParser interface\n */\nclass ExpressionParser {\n    constructor() {\n        /** @internal */ this._expressionLookup = createLookup();\n        /** @internal */ this._forOfLookup = createLookup();\n        /** @internal */ this._interpolationLookup = createLookup();\n    }\n    parse(expression, expressionType) {\n        let found;\n        switch (expressionType) {\n            case etIsCustom:\n                return new CustomExpression(expression);\n            case etInterpolation:\n                found = this._interpolationLookup[expression];\n                if (found === void 0) {\n                    found = this._interpolationLookup[expression] = this.$parse(expression, expressionType);\n                }\n                return found;\n            case etIsIterator:\n                found = this._forOfLookup[expression];\n                if (found === void 0) {\n                    found = this._forOfLookup[expression] = this.$parse(expression, expressionType);\n                }\n                return found;\n            default: {\n                if (expression.length === 0) {\n                    if (expressionType === etIsFunction || expressionType === etIsProperty) {\n                        return PrimitiveLiteralExpression.$empty;\n                    }\n                    throw invalidEmptyExpression();\n                }\n                found = this._expressionLookup[expression];\n                if (found === void 0) {\n                    found = this._expressionLookup[expression] = this.$parse(expression, expressionType);\n                }\n                return found;\n            }\n        }\n    }\n    /** @internal */\n    $parse(expression, expressionType) {\n        $input = expression;\n        $index = 0;\n        $length = expression.length;\n        $scopeDepth = 0;\n        $startIndex = 0;\n        $currentToken = 6291456 /* Token.EOF */;\n        $tokenValue = '';\n        $currentChar = $charCodeAt(0);\n        $assignable = true;\n        $optional = false;\n        $accessGlobal = true;\n        $semicolonIndex = -1;\n        return parse(61 /* Precedence.Variadic */, expressionType === void 0 ? etIsProperty : expressionType);\n    }\n}\nExpressionParser.register = createImplementationRegister(IExpressionParser);\n\nfunction unescapeCode(code) {\n    switch (code) {\n        case 98 /* Char.LowerB */: return 8 /* Char.Backspace */;\n        case 116 /* Char.LowerT */: return 9 /* Char.Tab */;\n        case 110 /* Char.LowerN */: return 10 /* Char.LineFeed */;\n        case 118 /* Char.LowerV */: return 11 /* Char.VerticalTab */;\n        case 102 /* Char.LowerF */: return 12 /* Char.FormFeed */;\n        case 114 /* Char.LowerR */: return 13 /* Char.CarriageReturn */;\n        case 34 /* Char.DoubleQuote */: return 34 /* Char.DoubleQuote */;\n        case 39 /* Char.SingleQuote */: return 39 /* Char.SingleQuote */;\n        case 92 /* Char.Backslash */: return 92 /* Char.Backslash */;\n        default: return code;\n    }\n}\n\n\nconst $false = PrimitiveLiteralExpression.$false;\nconst $true = PrimitiveLiteralExpression.$true;\nconst $null = PrimitiveLiteralExpression.$null;\nconst $undefined = PrimitiveLiteralExpression.$undefined;\nconst $this = new AccessThisExpression(0);\nconst $parent = new AccessThisExpression(1);\nconst boundary = new AccessBoundaryExpression();\nconst etNone = 'None';\nconst etInterpolation = 'Interpolation';\nconst etIsIterator = 'IsIterator';\nconst etIsChainable = 'IsChainable';\nconst etIsFunction = 'IsFunction';\nconst etIsProperty = 'IsProperty';\nconst etIsCustom = 'IsCustom';\nlet $input = '';\nlet $index = 0;\nlet $length = 0;\nlet $scopeDepth = 0;\nlet $startIndex = 0;\nlet $currentToken = 6291456 /* Token.EOF */;\nlet $tokenValue = '';\nlet $currentChar;\nlet $assignable = true;\nlet $optional = false;\nlet $accessGlobal = true;\nlet $semicolonIndex = -1;\nconst stringFromCharCode = String.fromCharCode;\nconst $charCodeAt = (index) => $input.charCodeAt(index);\nconst $tokenRaw = () => $input.slice($startIndex, $index);\nconst globalNames = ('Infinity NaN isFinite isNaN parseFloat parseInt decodeURI decodeURIComponent encodeURI encodeURIComponent' +\n    ' Array BigInt Boolean Date Map Number Object RegExp Set String JSON Math Intl').split(' ');\nfunction parseExpression(input, expressionType) {\n    $input = input;\n    $index = 0;\n    $length = input.length;\n    $scopeDepth = 0;\n    $startIndex = 0;\n    $currentToken = 6291456 /* Token.EOF */;\n    $tokenValue = '';\n    $currentChar = $charCodeAt(0);\n    $assignable = true;\n    $optional = false;\n    $accessGlobal = true;\n    $semicolonIndex = -1;\n    return parse(61 /* Precedence.Variadic */, expressionType === void 0 ? etIsProperty : expressionType);\n}\n// This is performance-critical code which follows a subset of the well-known ES spec.\n// Knowing the spec, or parsers in general, will help with understanding this code and it is therefore not the\n// single source of information for being able to figure it out.\n// It generally does not need to change unless the spec changes or spec violations are found, or optimization\n// opportunities are found (which would likely not fix these warnings in any case).\n// It's therefore not considered to have any tangible impact on the maintainability of the code base.\n// For reference, most of the parsing logic is based on: https://tc39.github.io/ecma262/#sec-ecmascript-language-expressions\n// eslint-disable-next-line max-lines-per-function\nfunction parse(minPrecedence, expressionType) {\n    if (expressionType === etIsCustom) {\n        return new CustomExpression($input);\n    }\n    if ($index === 0) {\n        if (expressionType === etInterpolation) {\n            return parseInterpolation();\n        }\n        nextToken();\n        if ($currentToken & 4194304 /* Token.ExpressionTerminal */) {\n            throw invalidStartOfExpression();\n        }\n    }\n    $assignable = 577 /* Precedence.Binary */ > minPrecedence;\n    $optional = false;\n    $accessGlobal = 579 /* Precedence.LeftHandSide */ > minPrecedence;\n    let optionalThisTail = false;\n    let result = void 0;\n    let ancestor = 0;\n    if ($currentToken & 131072 /* Token.UnaryOp */) {\n        /**\n         * parseUnaryExpression\n         *\n         * https://tc39.github.io/ecma262/#sec-unary-operators\n         *\n         * UnaryExpression :\n         * 1. LeftHandSideExpression\n         * 2. void UnaryExpression\n         * 3. typeof UnaryExpression\n         * 4. + UnaryExpression\n         * 5. - UnaryExpression\n         * 6. ! UnaryExpression\n         * 7. ++ UnaryExpression\n         * 8. -- UnaryExpression\n         *\n         * IsValidAssignmentTarget\n         * 2,3,4,5,6,7,8 = false\n         * 1 = see parseLeftHandSideExpression\n         *\n         * Note: technically we should throw on +++ / ---, but there's nothing to gain from that\n         */\n        const op = TokenValues[$currentToken & 63 /* Token.Type */];\n        nextToken();\n        result = new UnaryExpression(op, parse(579 /* Precedence.LeftHandSide */, expressionType));\n        $assignable = false;\n    }\n    else {\n        /**\n         * parsePrimaryExpression\n         *\n         * https://tc39.github.io/ecma262/#sec-primary-expression\n         *\n         * PrimaryExpression :\n         * 1. this\n         * 2. IdentifierName\n         * 3. Literal\n         * 4. ArrayLiteralExpression\n         * 5. ObjectLiteralExpression\n         * 6. TemplateLiteral\n         * 7. ParenthesizedExpression\n         *\n         * Literal :\n         * NullLiteral\n         * BooleanLiteral\n         * NumericLiteral\n         * StringLiteral\n         *\n         * ParenthesizedExpression :\n         * ( AssignmentExpression )\n         *\n         * IsValidAssignmentTarget\n         * 1,3,4,5,6,7 = false\n         * 2 = true\n         */\n        primary: switch ($currentToken) {\n            case 12296 /* Token.ParentScope */: // $parent\n                ancestor = $scopeDepth;\n                $assignable = false;\n                $accessGlobal = false;\n                do {\n                    nextToken();\n                    ++ancestor;\n                    switch ($currentToken) {\n                        case 65547 /* Token.Dot */:\n                            nextToken();\n                            if (($currentToken & 12288 /* Token.IdentifierName */) === 0) {\n                                throw expectedIdentifier();\n                            }\n                            break;\n                        case 12 /* Token.DotDot */:\n                        case 13 /* Token.DotDotDot */:\n                            throw expectedIdentifier();\n                        case 2162702 /* Token.QuestionDot */:\n                            $optional = true;\n                            nextToken();\n                            if (($currentToken & 12288 /* Token.IdentifierName */) === 0) {\n                                result = ancestor === 0 ? $this : ancestor === 1 ? $parent : new AccessThisExpression(ancestor);\n                                optionalThisTail = true;\n                                break primary;\n                            }\n                            break;\n                        default:\n                            if ($currentToken & 2097152 /* Token.AccessScopeTerminal */) {\n                                result = ancestor === 0 ? $this : ancestor === 1 ? $parent : new AccessThisExpression(ancestor);\n                                break primary;\n                            }\n                            throw invalidMemberExpression();\n                    }\n                } while ($currentToken === 12296 /* Token.ParentScope */);\n            // falls through\n            case 4096 /* Token.Identifier */: { // identifier\n                const id = $tokenValue;\n                if (expressionType === etIsIterator) {\n                    result = new BindingIdentifier(id);\n                }\n                else if ($accessGlobal && globalNames.includes(id)) {\n                    result = new AccessGlobalExpression(id);\n                }\n                else if ($accessGlobal && id === 'import') {\n                    throw unexpectedImportKeyword();\n                }\n                else {\n                    result = new AccessScopeExpression(id, ancestor);\n                }\n                $assignable = !$optional;\n                nextToken();\n                if (consumeOpt(53 /* Token.Arrow */)) {\n                    if ($currentToken === 524298 /* Token.OpenBrace */) {\n                        throw functionBodyInArrowFn();\n                    }\n                    const _optional = $optional;\n                    const _scopeDepth = $scopeDepth;\n                    ++$scopeDepth;\n                    const body = parse(62 /* Precedence.Assign */, etNone);\n                    $optional = _optional;\n                    $scopeDepth = _scopeDepth;\n                    $assignable = false;\n                    result = new ArrowFunction([new BindingIdentifier(id)], body);\n                }\n                break;\n            }\n            case 12 /* Token.DotDot */:\n                throw unexpectedDoubleDot();\n            case 13 /* Token.DotDotDot */:\n                throw invalidSpreadOp();\n            case 12293 /* Token.ThisScope */: // $this\n                $assignable = false;\n                nextToken();\n                switch ($scopeDepth) {\n                    case 0:\n                        result = $this;\n                        break;\n                    case 1:\n                        result = $parent;\n                        break;\n                    default:\n                        result = new AccessThisExpression($scopeDepth);\n                        break;\n                }\n                break;\n            case 12294 /* Token.AccessBoundary */: // this\n                $assignable = false;\n                nextToken();\n                result = boundary;\n                break;\n            case 2688009 /* Token.OpenParen */:\n                result = parseCoverParenthesizedExpressionAndArrowParameterList(expressionType);\n                break;\n            case 2688020 /* Token.OpenBracket */:\n                result = $input.search(/\\s+of\\s+/) > $index ? parseArrayDestructuring() : parseArrayLiteralExpression(expressionType);\n                break;\n            case 524298 /* Token.OpenBrace */:\n                result = parseObjectLiteralExpression(expressionType);\n                break;\n            case 2163762 /* Token.TemplateTail */:\n                result = new TemplateExpression([$tokenValue]);\n                $assignable = false;\n                nextToken();\n                break;\n            case 2163763 /* Token.TemplateContinuation */:\n                result = parseTemplate(expressionType, result, false);\n                break;\n            case 16384 /* Token.StringLiteral */:\n            case 32768 /* Token.NumericLiteral */:\n                result = new PrimitiveLiteralExpression($tokenValue);\n                $assignable = false;\n                nextToken();\n                break;\n            case 8194 /* Token.NullKeyword */:\n            case 8195 /* Token.UndefinedKeyword */:\n            case 8193 /* Token.TrueKeyword */:\n            case 8192 /* Token.FalseKeyword */:\n                result = TokenValues[$currentToken & 63 /* Token.Type */];\n                $assignable = false;\n                nextToken();\n                break;\n            case 8196 /* Token.NewKeyword */: {\n                nextToken();\n                const callee = parse(578 /* Precedence.Member */, expressionType);\n                let args;\n                if ($currentToken === 2688009 /* Token.OpenParen */) {\n                    args = parseArguments();\n                }\n                else {\n                    args = [];\n                    nextToken();\n                }\n                result = new NewExpression(callee, args);\n                $assignable = false;\n                break;\n            }\n            default:\n                if ($index >= $length) {\n                    throw unexpectedEndOfExpression();\n                }\n                else {\n                    throw unconsumedToken();\n                }\n        }\n        if (expressionType === etIsIterator) {\n            return parseForOfStatement(result);\n        }\n        switch ($currentToken) {\n            case 2228282 /* Token.PlusPlus */:\n            case 2228283 /* Token.MinusMinus */:\n                result = new UnaryExpression(TokenValues[$currentToken & 63 /* Token.Type */], result, 1);\n                nextToken();\n                $assignable = false;\n                break;\n        }\n        if (579 /* Precedence.LeftHandSide */ < minPrecedence) {\n            return result;\n        }\n        if ($currentToken === 12 /* Token.DotDot */ || $currentToken === 13 /* Token.DotDotDot */) {\n            throw expectedIdentifier();\n        }\n        if (result.$kind === ekAccessThis) {\n            switch ($currentToken) {\n                case 2162702 /* Token.QuestionDot */:\n                    $optional = true;\n                    $assignable = false;\n                    nextToken();\n                    if (($currentToken & 13312 /* Token.OptionalSuffix */) === 0) {\n                        throw unexpectedTokenInOptionalChain();\n                    }\n                    if ($currentToken & 12288 /* Token.IdentifierName */) {\n                        result = new AccessScopeExpression($tokenValue, result.ancestor);\n                        nextToken();\n                    }\n                    else if ($currentToken === 2688009 /* Token.OpenParen */) {\n                        result = new CallFunctionExpression(result, parseArguments(), true);\n                    }\n                    else if ($currentToken === 2688020 /* Token.OpenBracket */) {\n                        result = parseKeyedExpression(result, true);\n                    }\n                    else {\n                        throw invalidTaggedTemplateOnOptionalChain();\n                    }\n                    break;\n                case 65547 /* Token.Dot */:\n                    $assignable = !$optional;\n                    nextToken();\n                    if (($currentToken & 12288 /* Token.IdentifierName */) === 0) {\n                        throw expectedIdentifier();\n                    }\n                    result = new AccessScopeExpression($tokenValue, result.ancestor);\n                    nextToken();\n                    break;\n                case 12 /* Token.DotDot */:\n                case 13 /* Token.DotDotDot */:\n                    throw expectedIdentifier();\n                case 2688009 /* Token.OpenParen */:\n                    result = new CallFunctionExpression(result, parseArguments(), optionalThisTail);\n                    break;\n                case 2688020 /* Token.OpenBracket */:\n                    result = parseKeyedExpression(result, optionalThisTail);\n                    break;\n                case 2163762 /* Token.TemplateTail */:\n                    result = createTemplateTail(result);\n                    break;\n                case 2163763 /* Token.TemplateContinuation */:\n                    result = parseTemplate(expressionType, result, true);\n                    break;\n            }\n        }\n        /**\n         * parseMemberExpression (Token.Dot, Token.OpenBracket, Token.TemplateContinuation)\n         *\n         * MemberExpression :\n         * 1. PrimaryExpression\n         * 2. MemberExpression [ AssignmentExpression ]\n         * 3. MemberExpression . IdentifierName\n         * 4. MemberExpression TemplateLiteral\n         *\n         * IsValidAssignmentTarget\n         * 1,4 = false\n         * 2,3 = true\n         *\n         *\n         * parseCallExpression (Token.OpenParen)\n         * CallExpression :\n         * 1. MemberExpression Arguments\n         * 2. CallExpression Arguments\n         * 3. CallExpression [ AssignmentExpression ]\n         * 4. CallExpression . IdentifierName\n         * 5. CallExpression TemplateLiteral\n         *\n         * IsValidAssignmentTarget\n         * 1,2,5 = false\n         * 3,4 = true\n         */\n        while (($currentToken & 65536 /* Token.LeftHandSide */) > 0) {\n            switch ($currentToken) {\n                case 2162702 /* Token.QuestionDot */:\n                    result = parseOptionalChainLHS(result);\n                    break;\n                case 65547 /* Token.Dot */:\n                    nextToken();\n                    if (($currentToken & 12288 /* Token.IdentifierName */) === 0) {\n                        throw expectedIdentifier();\n                    }\n                    result = parseMemberExpressionLHS(result, false);\n                    break;\n                case 12 /* Token.DotDot */:\n                case 13 /* Token.DotDotDot */:\n                    throw expectedIdentifier();\n                case 2688009 /* Token.OpenParen */:\n                    if (578 /* Precedence.Member */ === minPrecedence) {\n                        return result;\n                    }\n                    if (result.$kind === ekAccessScope) {\n                        result = new CallScopeExpression(result.name, parseArguments(), result.ancestor, false);\n                    }\n                    else if (result.$kind === ekAccessMember) {\n                        result = new CallMemberExpression(result.object, result.name, parseArguments(), result.optional, false);\n                    }\n                    else if (result.$kind === ekAccessGlobal) {\n                        result = new CallGlobalExpression(result.name, parseArguments());\n                    }\n                    else {\n                        result = new CallFunctionExpression(result, parseArguments(), false);\n                    }\n                    break;\n                case 2688020 /* Token.OpenBracket */:\n                    result = parseKeyedExpression(result, false);\n                    break;\n                case 2163762 /* Token.TemplateTail */:\n                    if ($optional) {\n                        throw invalidTaggedTemplateOnOptionalChain();\n                    }\n                    result = createTemplateTail(result);\n                    break;\n                case 2163763 /* Token.TemplateContinuation */:\n                    if ($optional) {\n                        throw invalidTaggedTemplateOnOptionalChain();\n                    }\n                    result = parseTemplate(expressionType, result, true);\n                    break;\n            }\n        }\n    }\n    if ($currentToken === 12 /* Token.DotDot */ || $currentToken === 13 /* Token.DotDotDot */) {\n        throw expectedIdentifier();\n    }\n    if (577 /* Precedence.Binary */ < minPrecedence) {\n        return result;\n    }\n    /**\n     * parseBinaryExpression\n     *\n     * https://tc39.github.io/ecma262/#sec-multiplicative-operators\n     *\n     * MultiplicativeExpression : (local precedence 6)\n     * UnaryExpression\n     * MultiplicativeExpression * / % UnaryExpression\n     *\n     * AdditiveExpression : (local precedence 5)\n     * MultiplicativeExpression\n     * AdditiveExpression + - MultiplicativeExpression\n     *\n     * RelationalExpression : (local precedence 4)\n     * AdditiveExpression\n     * RelationalExpression < > <= >= instanceof in AdditiveExpression\n     *\n     * EqualityExpression : (local precedence 3)\n     * RelationalExpression\n     * EqualityExpression == != === !== RelationalExpression\n     *\n     * LogicalANDExpression : (local precedence 2)\n     * EqualityExpression\n     * LogicalANDExpression && EqualityExpression\n     *\n     * LogicalORExpression : (local precedence 1)\n     * LogicalANDExpression\n     * LogicalORExpression || LogicalANDExpression\n     *\n     * CoalesceExpression :\n     * CoalesceExpressionHead ?? BitwiseORExpression\n     *\n     * CoalesceExpressionHead :\n     * CoelesceExpression\n     * BitwiseORExpression\n     *\n     * ShortCircuitExpression :\n     * LogicalORExpression\n     * CoalesceExpression\n     */\n    while (($currentToken & 262144 /* Token.BinaryOp */) > 0) {\n        const opToken = $currentToken;\n        if ((opToken & 960 /* Token.Precedence */) <= minPrecedence) {\n            break;\n        }\n        nextToken();\n        result = new BinaryExpression(TokenValues[opToken & 63 /* Token.Type */], result, parse(opToken & 960 /* Token.Precedence */, expressionType));\n        $assignable = false;\n    }\n    if (63 /* Precedence.Conditional */ < minPrecedence) {\n        return result;\n    }\n    /**\n     * parseConditionalExpression\n     * https://tc39.github.io/ecma262/#prod-ConditionalExpression\n     *\n     * ConditionalExpression :\n     * 1. ShortCircuitExpression\n     * 2. ShortCircuitExpression ? AssignmentExpression : AssignmentExpression\n     *\n     * IsValidAssignmentTarget\n     * 1,2 = false\n     */\n    if (consumeOpt(6291480 /* Token.Question */)) {\n        const yes = parse(62 /* Precedence.Assign */, expressionType);\n        consume(6291478 /* Token.Colon */);\n        result = new ConditionalExpression(result, yes, parse(62 /* Precedence.Assign */, expressionType));\n        $assignable = false;\n    }\n    if (62 /* Precedence.Assign */ < minPrecedence) {\n        return result;\n    }\n    /**\n     * parseAssignmentExpression\n     *\n     * https://tc39.github.io/ecma262/#prod-AssignmentExpression\n     * Note: AssignmentExpression here is equivalent to ES Expression because we don't parse the comma operator\n     *\n     * AssignmentExpression :\n     * 1. ConditionalExpression\n     * 2. LeftHandSideExpression = AssignmentExpression\n     * 3. LeftHandSideExpression AssignmentOperator AssignmentExpression\n     *\n     * IsValidAssignmentTarget\n     * 1,2 = false\n     */\n    switch ($currentToken) {\n        case 4194352 /* Token.Equals */:\n        case 4194358 /* Token.PlusEquals */:\n        case 4194359 /* Token.MinusEquals */:\n        case 4194360 /* Token.AsteriskEquals */:\n        case 4194361 /* Token.SlashEquals */: {\n            if (!$assignable) {\n                throw lhsNotAssignable();\n            }\n            const op = TokenValues[$currentToken & 63 /* Token.Type */];\n            nextToken();\n            result = new AssignExpression(result, parse(62 /* Precedence.Assign */, expressionType), op);\n            break;\n        }\n    }\n    if (61 /* Precedence.Variadic */ < minPrecedence) {\n        return result;\n    }\n    /**\n     * parseValueConverter\n     */\n    while (consumeOpt(6291482 /* Token.Bar */)) {\n        if ($currentToken === 6291456 /* Token.EOF */) {\n            throw expectedValueConverterIdentifier();\n        }\n        const name = $tokenValue;\n        nextToken();\n        const args = new Array();\n        while (consumeOpt(6291478 /* Token.Colon */)) {\n            args.push(parse(62 /* Precedence.Assign */, expressionType));\n        }\n        result = new ValueConverterExpression(result, name, args);\n    }\n    /**\n     * parseBindingBehavior\n     */\n    while (consumeOpt(6291481 /* Token.Ampersand */)) {\n        if ($currentToken === 6291456 /* Token.EOF */) {\n            throw expectedBindingBehaviorIdentifier();\n        }\n        const name = $tokenValue;\n        nextToken();\n        const args = new Array();\n        while (consumeOpt(6291478 /* Token.Colon */)) {\n            args.push(parse(62 /* Precedence.Assign */, expressionType));\n        }\n        result = new BindingBehaviorExpression(result, name, args);\n    }\n    if ($currentToken !== 6291456 /* Token.EOF */) {\n        if (expressionType === etInterpolation && $currentToken === 7340047 /* Token.CloseBrace */) {\n            return result;\n        }\n        if (expressionType === etIsChainable && $currentToken === 6291479 /* Token.Semicolon */) {\n            if ($index === $length) {\n                throw unconsumedToken();\n            }\n            $semicolonIndex = $index - 1;\n            return result;\n        }\n        if ($tokenRaw() === 'of') {\n            throw unexpectedOfKeyword();\n        }\n        throw unconsumedToken();\n    }\n    return result;\n}\n/**\n * [key,]\n * [key]\n * [,value]\n * [key,value]\n */\nfunction parseArrayDestructuring() {\n    const items = [];\n    const dae = new DestructuringAssignmentExpression(ekArrayDestructuring, items, void 0, void 0);\n    let target = '';\n    let $continue = true;\n    let index = 0;\n    while ($continue) {\n        nextToken();\n        switch ($currentToken) {\n            case 7340053 /* Token.CloseBracket */:\n                $continue = false;\n                addItem();\n                break;\n            case 6291475 /* Token.Comma */:\n                addItem();\n                break;\n            case 4096 /* Token.Identifier */:\n                target = $tokenRaw();\n                break;\n            default:\n                throw unexpectedTokenInDestructuring();\n        }\n    }\n    consume(7340053 /* Token.CloseBracket */);\n    return dae;\n    function addItem() {\n        if (target !== '') {\n            items.push(new DestructuringAssignmentSingleExpression(new AccessMemberExpression($this, target), new AccessKeyedExpression($this, new PrimitiveLiteralExpression(index++)), void 0));\n            target = '';\n        }\n        else {\n            index++;\n        }\n    }\n}\nfunction parseArguments() {\n    const _optional = $optional;\n    nextToken();\n    const args = [];\n    while ($currentToken !== 7340048 /* Token.CloseParen */) {\n        args.push(parse(62 /* Precedence.Assign */, etNone));\n        if (!consumeOpt(6291475 /* Token.Comma */)) {\n            break;\n        }\n    }\n    consume(7340048 /* Token.CloseParen */);\n    $assignable = false;\n    $optional = _optional;\n    return args;\n}\nfunction parseKeyedExpression(result, optional) {\n    const _optional = $optional;\n    nextToken();\n    result = new AccessKeyedExpression(result, parse(62 /* Precedence.Assign */, etNone), optional);\n    consume(7340053 /* Token.CloseBracket */);\n    $assignable = !_optional;\n    $optional = _optional;\n    return result;\n}\nfunction parseOptionalChainLHS(lhs) {\n    $optional = true;\n    $assignable = false;\n    nextToken();\n    if (($currentToken & 13312 /* Token.OptionalSuffix */) === 0) {\n        throw unexpectedTokenInOptionalChain();\n    }\n    if ($currentToken & 12288 /* Token.IdentifierName */) {\n        return parseMemberExpressionLHS(lhs, true);\n    }\n    if ($currentToken === 2688009 /* Token.OpenParen */) {\n        if (lhs.$kind === ekAccessScope) {\n            return new CallScopeExpression(lhs.name, parseArguments(), lhs.ancestor, true);\n        }\n        else if (lhs.$kind === ekAccessMember) {\n            return new CallMemberExpression(lhs.object, lhs.name, parseArguments(), lhs.optional, true);\n        }\n        else {\n            return new CallFunctionExpression(lhs, parseArguments(), true);\n        }\n    }\n    if ($currentToken === 2688020 /* Token.OpenBracket */) {\n        return parseKeyedExpression(lhs, true);\n    }\n    throw invalidTaggedTemplateOnOptionalChain();\n}\nfunction parseMemberExpressionLHS(lhs, optional) {\n    const rhs = $tokenValue;\n    switch ($currentToken) {\n        case 2162702 /* Token.QuestionDot */: {\n            $optional = true;\n            $assignable = false;\n            const indexSave = $index;\n            const startIndexSave = $startIndex;\n            const currentTokenSave = $currentToken;\n            const currentCharSave = $currentChar;\n            const tokenValueSave = $tokenValue;\n            const assignableSave = $assignable;\n            const optionalSave = $optional;\n            nextToken();\n            if (($currentToken & 13312 /* Token.OptionalSuffix */) === 0) {\n                throw unexpectedTokenInOptionalChain();\n            }\n            if ($currentToken === 2688009 /* Token.OpenParen */) {\n                return new CallMemberExpression(lhs, rhs, parseArguments(), optional, true);\n            }\n            $index = indexSave;\n            $startIndex = startIndexSave;\n            $currentToken = currentTokenSave;\n            $currentChar = currentCharSave;\n            $tokenValue = tokenValueSave;\n            $assignable = assignableSave;\n            $optional = optionalSave;\n            return new AccessMemberExpression(lhs, rhs, optional);\n        }\n        case 2688009 /* Token.OpenParen */: {\n            $assignable = false;\n            return new CallMemberExpression(lhs, rhs, parseArguments(), optional, false);\n        }\n        default: {\n            $assignable = !$optional;\n            nextToken();\n            return new AccessMemberExpression(lhs, rhs, optional);\n        }\n    }\n}\n\n/**\n * https://tc39.es/ecma262/#prod-CoverParenthesizedExpressionAndArrowParameterList\n * CoverParenthesizedExpressionAndArrowParameterList :\n * ( Expression )\n * ( )\n * ( BindingIdentifier )\n * ( Expression , BindingIdentifier )\n */\nfunction parseCoverParenthesizedExpressionAndArrowParameterList(expressionType) {\n    nextToken();\n    const indexSave = $index;\n    const startIndexSave = $startIndex;\n    const currentTokenSave = $currentToken;\n    const currentCharSave = $currentChar;\n    const tokenValueSave = $tokenValue;\n    const optionalSave = $optional;\n    const arrowParams = [];\n    let paramsState = 1 /* ArrowFnParams.Valid */;\n    let isParamList = false;\n    // eslint-disable-next-line no-constant-condition\n    loop: while (true) {\n        if ($currentToken === 13 /* Token.DotDotDot */) {\n            nextToken();\n            if ($currentToken !== 4096 /* Token.Identifier */) {\n                throw expectedIdentifier();\n            }\n            arrowParams.push(new BindingIdentifier($tokenValue));\n            nextToken();\n            if ($currentToken === 6291475 /* Token.Comma */) {\n                throw restParamsMustBeLastParam();\n            }\n            if ($currentToken !== 7340048 /* Token.CloseParen */) {\n                throw invalidSpreadOp();\n            }\n            nextToken();\n            if ($currentToken !== 53 /* Token.Arrow */) {\n                throw invalidSpreadOp();\n            }\n            nextToken();\n            const _optional = $optional;\n            const _scopeDepth = $scopeDepth;\n            ++$scopeDepth;\n            const body = parse(62 /* Precedence.Assign */, etNone);\n            $optional = _optional;\n            $scopeDepth = _scopeDepth;\n            $assignable = false;\n            return new ArrowFunction(arrowParams, body, true);\n        }\n        switch ($currentToken) {\n            case 4096 /* Token.Identifier */:\n                arrowParams.push(new BindingIdentifier($tokenValue));\n                nextToken();\n                break;\n            case 7340048 /* Token.CloseParen */:\n                // ()     - only valid if followed directly by an arrow\n                nextToken();\n                break loop;\n            /* eslint-disable */\n            case 524298 /* Token.OpenBrace */:\n            // ({     - may be a valid parenthesized expression\n            case 2688020 /* Token.OpenBracket */:\n                // ([     - may be a valid parenthesized expression\n                nextToken();\n                paramsState = 4 /* ArrowFnParams.Destructuring */;\n                break;\n            /* eslint-enable */\n            case 6291475 /* Token.Comma */:\n                // (,     - never valid\n                // (a,,   - never valid\n                paramsState = 2 /* ArrowFnParams.Invalid */;\n                isParamList = true;\n                break loop;\n            case 2688009 /* Token.OpenParen */:\n                // ((     - may be a valid nested parenthesized expression or arrow fn\n                // (a,(   - never valid\n                paramsState = 2 /* ArrowFnParams.Invalid */;\n                break loop;\n            default:\n                nextToken();\n                paramsState = 2 /* ArrowFnParams.Invalid */;\n                break;\n        }\n        switch ($currentToken) {\n            case 6291475 /* Token.Comma */:\n                nextToken();\n                isParamList = true;\n                if (paramsState === 1 /* ArrowFnParams.Valid */) {\n                    break;\n                }\n                // ([something invalid],   - treat as arrow fn / invalid arrow params\n                break loop;\n            case 7340048 /* Token.CloseParen */:\n                nextToken();\n                break loop;\n            case 4194352 /* Token.Equals */:\n                // (a=a     - may be a valid parenthesized expression\n                if (paramsState === 1 /* ArrowFnParams.Valid */) {\n                    paramsState = 3 /* ArrowFnParams.Default */;\n                }\n                break loop;\n            case 53 /* Token.Arrow */:\n                // (a,a=>  - never valid\n                if (isParamList) {\n                    throw invalidArrowParameterList();\n                }\n                // (a=>    - may be a valid parenthesized expression with nested arrow fn\n                nextToken();\n                paramsState = 2 /* ArrowFnParams.Invalid */;\n                break loop;\n            default:\n                if (paramsState === 1 /* ArrowFnParams.Valid */) {\n                    paramsState = 2 /* ArrowFnParams.Invalid */;\n                }\n                break loop;\n        }\n    }\n    if ($currentToken === 53 /* Token.Arrow */) {\n        if (paramsState === 1 /* ArrowFnParams.Valid */) {\n            nextToken();\n            if ($currentToken === 524298 /* Token.OpenBrace */) {\n                throw functionBodyInArrowFn();\n            }\n            const _optional = $optional;\n            const _scopeDepth = $scopeDepth;\n            ++$scopeDepth;\n            const body = parse(62 /* Precedence.Assign */, etNone);\n            $optional = _optional;\n            $scopeDepth = _scopeDepth;\n            $assignable = false;\n            return new ArrowFunction(arrowParams, body);\n        }\n        throw invalidArrowParameterList();\n    }\n    else if (paramsState === 1 /* ArrowFnParams.Valid */ && arrowParams.length === 0) {\n        // ()    - never valid as a standalone expression\n        throw missingExpectedToken(53 /* Token.Arrow */);\n    }\n    if (isParamList) {\n        // ([something invalid],   - treat as arrow fn / invalid arrow params\n        switch (paramsState) {\n            case 2 /* ArrowFnParams.Invalid */:\n                throw invalidArrowParameterList();\n            case 3 /* ArrowFnParams.Default */:\n                throw defaultParamsInArrowFn();\n            case 4 /* ArrowFnParams.Destructuring */:\n                throw destructuringParamsInArrowFn();\n        }\n    }\n    $index = indexSave;\n    $startIndex = startIndexSave;\n    $currentToken = currentTokenSave;\n    $currentChar = currentCharSave;\n    $tokenValue = tokenValueSave;\n    $optional = optionalSave;\n    const _optional = $optional;\n    const expr = parse(62 /* Precedence.Assign */, expressionType);\n    $optional = _optional;\n    consume(7340048 /* Token.CloseParen */);\n    if ($currentToken === 53 /* Token.Arrow */) {\n        // we only get here if there was a valid parenthesized expression which was not valid as arrow fn params\n        switch (paramsState) {\n            case 2 /* ArrowFnParams.Invalid */:\n                throw invalidArrowParameterList();\n            case 3 /* ArrowFnParams.Default */:\n                throw defaultParamsInArrowFn();\n            case 4 /* ArrowFnParams.Destructuring */:\n                throw destructuringParamsInArrowFn();\n        }\n    }\n    return expr;\n}\n/**\n * parseArrayLiteralExpression\n * https://tc39.github.io/ecma262/#prod-ArrayLiteralExpression\n *\n * ArrayLiteralExpression :\n * [ Elision(opt) ]\n * [ ElementList ]\n * [ ElementList, Elision(opt) ]\n *\n * ElementList :\n * Elision(opt) AssignmentExpression\n * ElementList, Elision(opt) AssignmentExpression\n *\n * Elision :\n * ,\n * Elision ,\n */\nfunction parseArrayLiteralExpression(expressionType) {\n    const _optional = $optional;\n    nextToken();\n    const elements = new Array();\n    while ($currentToken !== 7340053 /* Token.CloseBracket */) {\n        if (consumeOpt(6291475 /* Token.Comma */)) {\n            elements.push($undefined);\n            if ($currentToken === 7340053 /* Token.CloseBracket */) {\n                break;\n            }\n        }\n        else {\n            elements.push(parse(62 /* Precedence.Assign */, expressionType === etIsIterator ? etNone : expressionType));\n            if (consumeOpt(6291475 /* Token.Comma */)) {\n                if ($currentToken === 7340053 /* Token.CloseBracket */) {\n                    break;\n                }\n            }\n            else {\n                break;\n            }\n        }\n    }\n    $optional = _optional;\n    consume(7340053 /* Token.CloseBracket */);\n    if (expressionType === etIsIterator) {\n        return new ArrayBindingPattern(elements);\n    }\n    else {\n        $assignable = false;\n        return new ArrayLiteralExpression(elements);\n    }\n}\nconst allowedForExprKinds = [ekArrayBindingPattern, ekObjectBindingPattern, ekBindingIdentifier, ekArrayDestructuring, ekObjectDestructuring];\nfunction parseForOfStatement(result) {\n    if (!allowedForExprKinds.includes(result.$kind)) {\n        throw invalidLHSBindingIdentifierInForOf(result.$kind);\n    }\n    if ($currentToken !== 4204596 /* Token.OfKeyword */) {\n        throw invalidLHSBindingIdentifierInForOf(result.$kind);\n    }\n    nextToken();\n    const declaration = result;\n    const statement = parse(61 /* Precedence.Variadic */, etIsChainable);\n    return new ForOfStatement(declaration, statement, $semicolonIndex);\n}\n/**\n * parseObjectLiteralExpression\n * https://tc39.github.io/ecma262/#prod-Literal\n *\n * ObjectLiteralExpression :\n * { }\n * { PropertyDefinitionList }\n *\n * PropertyDefinitionList :\n * PropertyDefinition\n * PropertyDefinitionList, PropertyDefinition\n *\n * PropertyDefinition :\n * IdentifierName\n * PropertyName : AssignmentExpression\n *\n * PropertyName :\n * IdentifierName\n * StringLiteral\n * NumericLiteral\n */\nfunction parseObjectLiteralExpression(expressionType) {\n    const _optional = $optional;\n    const keys = new Array();\n    const values = new Array();\n    nextToken();\n    while ($currentToken !== 7340047 /* Token.CloseBrace */) {\n        keys.push($tokenValue);\n        // Literal = mandatory colon\n        if ($currentToken & 49152 /* Token.StringOrNumericLiteral */) {\n            nextToken();\n            consume(6291478 /* Token.Colon */);\n            values.push(parse(62 /* Precedence.Assign */, expressionType === etIsIterator ? etNone : expressionType));\n        }\n        else if ($currentToken & 12288 /* Token.IdentifierName */) {\n            // IdentifierName = optional colon\n            const currentChar = $currentChar;\n            const currentToken = $currentToken;\n            const index = $index;\n            nextToken();\n            if (consumeOpt(6291478 /* Token.Colon */)) {\n                values.push(parse(62 /* Precedence.Assign */, expressionType === etIsIterator ? etNone : expressionType));\n            }\n            else {\n                // Shorthand\n                $currentChar = currentChar;\n                $currentToken = currentToken;\n                $index = index;\n                values.push(parse(580 /* Precedence.Primary */, expressionType === etIsIterator ? etNone : expressionType));\n            }\n        }\n        else {\n            throw invalidPropDefInObjLiteral();\n        }\n        if ($currentToken !== 7340047 /* Token.CloseBrace */) {\n            consume(6291475 /* Token.Comma */);\n        }\n    }\n    $optional = _optional;\n    consume(7340047 /* Token.CloseBrace */);\n    if (expressionType === etIsIterator) {\n        return new ObjectBindingPattern(keys, values);\n    }\n    else {\n        $assignable = false;\n        return new ObjectLiteralExpression(keys, values);\n    }\n}\nfunction parseInterpolation() {\n    const parts = [];\n    const expressions = [];\n    const length = $length;\n    let result = '';\n    while ($index < length) {\n        switch ($currentChar) {\n            case 36 /* Char.Dollar */:\n                if ($charCodeAt($index + 1) === 123 /* Char.OpenBrace */) {\n                    parts.push(result);\n                    result = '';\n                    $index += 2;\n                    $currentChar = $charCodeAt($index);\n                    nextToken();\n                    const expression = parse(61 /* Precedence.Variadic */, etInterpolation);\n                    expressions.push(expression);\n                    continue;\n                }\n                else {\n                    result += '$';\n                }\n                break;\n            case 92 /* Char.Backslash */:\n                result += stringFromCharCode(unescapeCode(nextChar()));\n                break;\n            default:\n                result += stringFromCharCode($currentChar);\n        }\n        nextChar();\n    }\n    if (expressions.length) {\n        parts.push(result);\n        return new Interpolation(parts, expressions);\n    }\n    return null;\n}\n/**\n * parseTemplateLiteralExpression\n * https://tc39.github.io/ecma262/#prod-Literal\n *\n * TemplateExpression :\n * NoSubstitutionTemplate\n * TemplateHead\n *\n * NoSubstitutionTemplate :\n * ` TemplateCharacters(opt) `\n *\n * TemplateHead :\n * ` TemplateCharacters(opt) ${\n *\n * TemplateSubstitutionTail :\n * TemplateMiddle\n * TemplateTail\n *\n * TemplateMiddle :\n * } TemplateCharacters(opt) ${\n *\n * TemplateTail :\n * } TemplateCharacters(opt) `\n *\n * TemplateCharacters :\n * TemplateCharacter TemplateCharacters(opt)\n *\n * TemplateCharacter :\n * $ [lookahead  {]\n * \\ EscapeSequence\n * SourceCharacter (but not one of ` or \\ or $)\n */\nfunction parseTemplate(expressionType, result, tagged) {\n    const _optional = $optional;\n    const cooked = [$tokenValue];\n    // TODO: properly implement raw parts / decide whether we want this\n    consume(2163763 /* Token.TemplateContinuation */);\n    const expressions = [parse(62 /* Precedence.Assign */, expressionType)];\n    while (($currentToken = scanTemplateTail()) !== 2163762 /* Token.TemplateTail */) {\n        cooked.push($tokenValue);\n        consume(2163763 /* Token.TemplateContinuation */);\n        expressions.push(parse(62 /* Precedence.Assign */, expressionType));\n    }\n    cooked.push($tokenValue);\n    $assignable = false;\n    $optional = _optional;\n    if (tagged) {\n        nextToken();\n        return new TaggedTemplateExpression(cooked, cooked, result, expressions);\n    }\n    else {\n        nextToken();\n        return new TemplateExpression(cooked, expressions);\n    }\n}\nfunction createTemplateTail(result) {\n    $assignable = false;\n    const strings = [$tokenValue];\n    nextToken();\n    return new TaggedTemplateExpression(strings, strings, result);\n}\nfunction nextToken() {\n    while ($index < $length) {\n        $startIndex = $index;\n        if (($currentToken = (CharScanners[$currentChar]())) != null) { // a null token means the character must be skipped\n            return;\n        }\n    }\n    $currentToken = 6291456 /* Token.EOF */;\n}\nfunction nextChar() {\n    return $currentChar = $charCodeAt(++$index);\n}\nfunction scanIdentifier() {\n    // run to the next non-idPart\n    while (IdParts[nextChar()])\n        ;\n    const token = KeywordLookup[$tokenValue = $tokenRaw()];\n    // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n    return token === undefined ? 4096 /* Token.Identifier */ : token;\n}\nfunction scanNumber(isFloat) {\n    let char = $currentChar;\n    if (isFloat === false) {\n        do {\n            char = nextChar();\n        } while (char <= 57 /* Char.Nine */ && char >= 48 /* Char.Zero */);\n        if (char !== 46 /* Char.Dot */) {\n            $tokenValue = parseInt($tokenRaw(), 10);\n            return 32768 /* Token.NumericLiteral */;\n        }\n        // past this point it's always a float\n        char = nextChar();\n        if ($index >= $length) {\n            // unless the number ends with a dot - that behaves a little different in native ES expressions\n            // but in our AST that behavior has no effect because numbers are always stored in variables\n            $tokenValue = parseInt($tokenRaw().slice(0, -1), 10);\n            return 32768 /* Token.NumericLiteral */;\n        }\n    }\n    if (char <= 57 /* Char.Nine */ && char >= 48 /* Char.Zero */) {\n        do {\n            char = nextChar();\n        } while (char <= 57 /* Char.Nine */ && char >= 48 /* Char.Zero */);\n    }\n    else {\n        $currentChar = $charCodeAt(--$index);\n    }\n    $tokenValue = parseFloat($tokenRaw());\n    return 32768 /* Token.NumericLiteral */;\n}\nfunction scanString() {\n    const quote = $currentChar;\n    nextChar(); // Skip initial quote.\n    let unescaped = 0;\n    const buffer = new Array();\n    let marker = $index;\n    while ($currentChar !== quote) {\n        if ($currentChar === 92 /* Char.Backslash */) {\n            buffer.push($input.slice(marker, $index));\n            nextChar();\n            unescaped = unescapeCode($currentChar);\n            nextChar();\n            buffer.push(stringFromCharCode(unescaped));\n            marker = $index;\n        }\n        else if ($index >= $length) {\n            throw unterminatedStringLiteral();\n        }\n        else {\n            nextChar();\n        }\n    }\n    const last = $input.slice(marker, $index);\n    nextChar(); // Skip terminating quote.\n    // Compute the unescaped string value.\n    buffer.push(last);\n    const unescapedStr = buffer.join('');\n    $tokenValue = unescapedStr;\n    return 16384 /* Token.StringLiteral */;\n}\nfunction scanTemplate() {\n    let tail = true;\n    let result = '';\n    while (nextChar() !== 96 /* Char.Backtick */) {\n        if ($currentChar === 36 /* Char.Dollar */) {\n            if (($index + 1) < $length && $charCodeAt($index + 1) === 123 /* Char.OpenBrace */) {\n                $index++;\n                tail = false;\n                break;\n            }\n            else {\n                result += '$';\n            }\n        }\n        else if ($currentChar === 92 /* Char.Backslash */) {\n            result += stringFromCharCode(unescapeCode(nextChar()));\n        }\n        else {\n            if ($index >= $length) {\n                throw unterminatedTemplateLiteral();\n            }\n            result += stringFromCharCode($currentChar);\n        }\n    }\n    nextChar();\n    $tokenValue = result;\n    if (tail) {\n        return 2163762 /* Token.TemplateTail */;\n    }\n    return 2163763 /* Token.TemplateContinuation */;\n}\nconst scanTemplateTail = () => {\n    if ($index >= $length) {\n        throw unterminatedTemplateLiteral();\n    }\n    $index--;\n    return scanTemplate();\n};\nconst consumeOpt = (token) => {\n    if ($currentToken === token) {\n        nextToken();\n        return true;\n    }\n    return false;\n};\nconst consume = (token) => {\n    if ($currentToken === token) {\n        nextToken();\n    }\n    else {\n        throw missingExpectedToken(token);\n    }\n};\n// #region errors\nconst invalidStartOfExpression = () => createMappedError(151 /* ErrorNames.parse_invalid_start */, $input);\nconst invalidSpreadOp = () => createMappedError(152 /* ErrorNames.parse_no_spread */, $input);\nconst expectedIdentifier = () => createMappedError(153 /* ErrorNames.parse_expected_identifier */, $input);\nconst invalidMemberExpression = () => createMappedError(154 /* ErrorNames.parse_invalid_member_expr */, $input);\nconst unexpectedEndOfExpression = () => createMappedError(155 /* ErrorNames.parse_unexpected_end */, $input);\nconst unconsumedToken = () => createMappedError(156 /* ErrorNames.parse_unconsumed_token */, $tokenRaw(), $index, $input);\nconst invalidEmptyExpression = () => createMappedError(157 /* ErrorNames.parse_invalid_empty */);\nconst lhsNotAssignable = () => createMappedError(158 /* ErrorNames.parse_left_hand_side_not_assignable */, $input);\nconst expectedValueConverterIdentifier = () => createMappedError(159 /* ErrorNames.parse_expected_converter_identifier */, $input);\nconst expectedBindingBehaviorIdentifier = () => createMappedError(160 /* ErrorNames.parse_expected_behavior_identifier */, $input);\nconst unexpectedOfKeyword = () => createMappedError(161 /* ErrorNames.parse_unexpected_keyword_of */, $input);\nconst unexpectedImportKeyword = () => createMappedError(162 /* ErrorNames.parse_unexpected_keyword_import */, $input);\nconst invalidLHSBindingIdentifierInForOf = (kind) => createMappedError(163 /* ErrorNames.parse_invalid_identifier_in_forof */, $input, kind);\nconst invalidPropDefInObjLiteral = () => createMappedError(164 /* ErrorNames.parse_invalid_identifier_object_literal_key */, $input);\nconst unterminatedStringLiteral = () => createMappedError(165 /* ErrorNames.parse_unterminated_string */, $input);\nconst unterminatedTemplateLiteral = () => createMappedError(166 /* ErrorNames.parse_unterminated_template_string */, $input);\nconst missingExpectedToken = (token) => createMappedError(167 /* ErrorNames.parse_missing_expected_token */, TokenValues[token & 63 /* Token.Type */], $input)\n    ;\nconst unexpectedTokenInDestructuring = () => createMappedError(170 /* ErrorNames.parse_unexpected_token_destructuring */, $tokenRaw(), $index, $input)\n    ;\nconst unexpectedTokenInOptionalChain = () => createMappedError(171 /* ErrorNames.parse_unexpected_token_optional_chain */, $tokenRaw(), $index - 1, $input)\n    ;\nconst invalidTaggedTemplateOnOptionalChain = () => createMappedError(172 /* ErrorNames.parse_invalid_tag_in_optional_chain */, $input);\nconst invalidArrowParameterList = () => createMappedError(173 /* ErrorNames.parse_invalid_arrow_params */, $input);\nconst defaultParamsInArrowFn = () => createMappedError(174 /* ErrorNames.parse_no_arrow_param_default_value */, $input);\nconst destructuringParamsInArrowFn = () => createMappedError(175 /* ErrorNames.parse_no_arrow_param_destructuring */, $input);\nconst restParamsMustBeLastParam = () => createMappedError(176 /* ErrorNames.parse_rest_must_be_last */, $input);\nconst functionBodyInArrowFn = () => createMappedError(178 /* ErrorNames.parse_no_arrow_fn_body */, $input);\nconst unexpectedDoubleDot = () => createMappedError(179 /* ErrorNames.parse_unexpected_double_dot */, $index - 1, $input)\n    ;\n// #endregion\n/**\n * Array for mapping tokens to token values. The indices of the values\n * correspond to the token bits 0-38.\n * For this to work properly, the values in the array must be kept in\n * the same order as the token bits.\n * Usage: TokenValues[token & Token.Type]\n */\nconst TokenValues = [\n    $false, $true, $null, $undefined, 'new', 'this', '$this', null /* '$host' */, '$parent',\n    '(', '{', '.', '..', '...', '?.', '}', ')', ',', '[', ']', ':', ';', '?', '\\'', '\"',\n    '&', '|', '??', '||', '&&', '==', '!=', '===', '!==', '<', '>',\n    '<=', '>=', 'in', 'instanceof', '+', '-', 'typeof', 'void', '*', '%', '/', '**', '=', '!',\n    2163762 /* Token.TemplateTail */, 2163763 /* Token.TemplateContinuation */,\n    'of', '=>', '+=', '-=', '*=', '/=', '++', '--'\n];\nconst KeywordLookup = /*@__PURE__*/ Object.assign(createLookup(), {\n    true: 8193 /* Token.TrueKeyword */,\n    null: 8194 /* Token.NullKeyword */,\n    false: 8192 /* Token.FalseKeyword */,\n    undefined: 8195 /* Token.UndefinedKeyword */,\n    new: 8196 /* Token.NewKeyword */,\n    this: 12294 /* Token.AccessBoundary */,\n    $this: 12293 /* Token.ThisScope */,\n    $parent: 12296 /* Token.ParentScope */,\n    in: 6562214 /* Token.InKeyword */,\n    instanceof: 6562215 /* Token.InstanceOfKeyword */,\n    typeof: 139306 /* Token.TypeofKeyword */,\n    void: 139307 /* Token.VoidKeyword */,\n    of: 4204596 /* Token.OfKeyword */,\n});\n// Character scanning function lookup\nconst { CharScanners, IdParts, } = /*@__PURE__*/ (() => {\n    const unexpectedCharacter = () => {\n        throw createMappedError(168 /* ErrorNames.parse_unexpected_character */, $input);\n    };\n    unexpectedCharacter.notMapped = true;\n    /**\n     * Ranges of code points in pairs of 2 (eg 0x41-0x5B, 0x61-0x7B, ...) where the second value is not inclusive (5-7 means 5 and 6)\n     * Single values are denoted by the second value being a 0\n     *\n     * Copied from output generated with \"node build/generate-unicode.js\"\n     *\n     * See also: https://en.wikibooks.org/wiki/Unicode/Character_reference/0000-0FFF\n     */\n    const codes = {\n        /* [$0-9A-Za_a-z] */\n        AsciiIdPart: [0x24, 0, 0x30, 0x3A, 0x41, 0x5B, 0x5F, 0, 0x61, 0x7B],\n        IdStart: /* IdentifierStart */ [0x24, 0, 0x41, 0x5B, 0x5F, 0, 0x61, 0x7B, 0xAA, 0, 0xBA, 0, 0xC0, 0xD7, 0xD8, 0xF7, 0xF8, 0x2B9, 0x2E0, 0x2E5, 0x1D00, 0x1D26, 0x1D2C, 0x1D5D, 0x1D62, 0x1D66, 0x1D6B, 0x1D78, 0x1D79, 0x1DBF, 0x1E00, 0x1F00, 0x2071, 0, 0x207F, 0, 0x2090, 0x209D, 0x212A, 0x212C, 0x2132, 0, 0x214E, 0, 0x2160, 0x2189, 0x2C60, 0x2C80, 0xA722, 0xA788, 0xA78B, 0xA7AF, 0xA7B0, 0xA7B8, 0xA7F7, 0xA800, 0xAB30, 0xAB5B, 0xAB5C, 0xAB65, 0xFB00, 0xFB07, 0xFF21, 0xFF3B, 0xFF41, 0xFF5B],\n        Digit: /* DecimalNumber */ [0x30, 0x3A],\n        Skip: /* Skippable */ [0, 0x21, 0x7F, 0xA1]\n    };\n    /**\n     * Decompress the ranges into an array of numbers so that the char code\n     * can be used as an index to the lookup\n     */\n    const decompress = (lookup, $set, compressed, value) => {\n        const rangeCount = compressed.length;\n        for (let i = 0; i < rangeCount; i += 2) {\n            const start = compressed[i];\n            let end = compressed[i + 1];\n            end = end > 0 ? end : start + 1;\n            if (lookup) {\n                lookup.fill(value, start, end);\n            }\n        }\n    };\n    // // ASCII IdentifierPart lookup\n    // const AsciiIdParts = ((AsciiIdParts) => {\n    //   decompress(null, AsciiIdParts, codes.AsciiIdPart, true);\n    //   return AsciiIdParts;\n    // })(new Set<number>());\n    // IdentifierPart lookup\n    const IdParts = /*@__PURE__*/ ((IdParts) => {\n        decompress(IdParts, null, codes.IdStart, 1);\n        decompress(IdParts, null, codes.Digit, 1);\n        return IdParts;\n    })(new Uint8Array(0xFFFF));\n    // CharFuncLookup functions\n    const returnToken = (token) => () => {\n        nextChar();\n        return token;\n    };\n    const CharScanners = new Array(0xFFFF);\n    CharScanners.fill(unexpectedCharacter, 0, 0xFFFF);\n    decompress(CharScanners, null, codes.Skip, () => {\n        nextChar();\n        return null;\n    });\n    decompress(CharScanners, null, codes.IdStart, scanIdentifier);\n    decompress(CharScanners, null, codes.Digit, () => scanNumber(false));\n    CharScanners[34 /* Char.DoubleQuote */] =\n        CharScanners[39 /* Char.SingleQuote */] = () => {\n            return scanString();\n        };\n    CharScanners[96 /* Char.Backtick */] = () => {\n        return scanTemplate();\n    };\n    // !, !=, !==\n    CharScanners[33 /* Char.Exclamation */] = () => {\n        if (nextChar() !== 61 /* Char.Equals */) {\n            return 131121 /* Token.Exclamation */;\n        }\n        if (nextChar() !== 61 /* Char.Equals */) {\n            return 6553951 /* Token.ExclamationEquals */;\n        }\n        nextChar();\n        return 6553953 /* Token.ExclamationEqualsEquals */;\n    };\n    // =, ==, ===, =>\n    CharScanners[61 /* Char.Equals */] = () => {\n        if (nextChar() === 62 /* Char.GreaterThan */) {\n            nextChar();\n            return 53 /* Token.Arrow */;\n        }\n        if ($currentChar !== 61 /* Char.Equals */) {\n            return 4194352 /* Token.Equals */;\n        }\n        if (nextChar() !== 61 /* Char.Equals */) {\n            return 6553950 /* Token.EqualsEquals */;\n        }\n        nextChar();\n        return 6553952 /* Token.EqualsEqualsEquals */;\n    };\n    // &, &&\n    CharScanners[38 /* Char.Ampersand */] = () => {\n        if (nextChar() !== 38 /* Char.Ampersand */) {\n            return 6291481 /* Token.Ampersand */;\n        }\n        nextChar();\n        return 6553885 /* Token.AmpersandAmpersand */;\n    };\n    // |, ||\n    CharScanners[124 /* Char.Bar */] = () => {\n        if (nextChar() !== 124 /* Char.Bar */) {\n            return 6291482 /* Token.Bar */;\n        }\n        nextChar();\n        return 6553820 /* Token.BarBar */;\n    };\n    // ?, ??, ?.\n    CharScanners[63 /* Char.Question */] = () => {\n        if (nextChar() === 46 /* Char.Dot */) {\n            const peek = $charCodeAt($index + 1);\n            if (peek <= 48 /* Char.Zero */ || peek >= 57 /* Char.Nine */) {\n                nextChar();\n                return 2162702 /* Token.QuestionDot */;\n            }\n            return 6291480 /* Token.Question */;\n        }\n        if ($currentChar !== 63 /* Char.Question */) {\n            return 6291480 /* Token.Question */;\n        }\n        nextChar();\n        return 6553755 /* Token.QuestionQuestion */;\n    };\n    // ., ...\n    CharScanners[46 /* Char.Dot */] = () => {\n        if (nextChar() <= 57 /* Char.Nine */ && $currentChar >= 48 /* Char.Zero */) {\n            return scanNumber(true);\n        }\n        if ($currentChar === 46 /* Char.Dot */) {\n            if (nextChar() !== 46 /* Char.Dot */) {\n                return 12 /* Token.DotDot */;\n            }\n            nextChar();\n            return 13 /* Token.DotDotDot */;\n        }\n        return 65547 /* Token.Dot */;\n    };\n    // <, <=\n    CharScanners[60 /* Char.LessThan */] = () => {\n        if (nextChar() !== 61 /* Char.Equals */) {\n            return 6554018 /* Token.LessThan */;\n        }\n        nextChar();\n        return 6554020 /* Token.LessThanEquals */;\n    };\n    // >, >=\n    CharScanners[62 /* Char.GreaterThan */] = () => {\n        if (nextChar() !== 61 /* Char.Equals */) {\n            return 6554019 /* Token.GreaterThan */;\n        }\n        nextChar();\n        return 6554021 /* Token.GreaterThanEquals */;\n    };\n    CharScanners[37 /* Char.Percent */] = returnToken(6554157 /* Token.Percent */);\n    CharScanners[40 /* Char.OpenParen */] = returnToken(2688009 /* Token.OpenParen */);\n    CharScanners[41 /* Char.CloseParen */] = returnToken(7340048 /* Token.CloseParen */);\n    // *, *=, **\n    CharScanners[42 /* Char.Asterisk */] = () => {\n        if (nextChar() === 61 /* Char.Equals */) {\n            nextChar();\n            return 4194360 /* Token.AsteriskEquals */;\n        }\n        if ($currentChar === 42 /* Char.Asterisk */) {\n            nextChar();\n            return 6554223 /* Token.AsteriskAsterisk */;\n        }\n        return 6554156 /* Token.Asterisk */;\n    };\n    // +, +=, ++\n    CharScanners[43 /* Char.Plus */] = () => {\n        if (nextChar() === 43 /* Char.Plus */) {\n            nextChar();\n            return 2228282 /* Token.PlusPlus */;\n        }\n        if ($currentChar !== 61 /* Char.Equals */) {\n            return 2490856 /* Token.Plus */;\n        }\n        nextChar();\n        return 4194358 /* Token.PlusEquals */;\n    };\n    CharScanners[44 /* Char.Comma */] = returnToken(6291475 /* Token.Comma */);\n    // -, -=, --\n    CharScanners[45 /* Char.Minus */] = () => {\n        if (nextChar() === 45 /* Char.Minus */) {\n            nextChar();\n            return 2228283 /* Token.MinusMinus */;\n        }\n        if ($currentChar !== 61 /* Char.Equals */) {\n            return 2490857 /* Token.Minus */;\n        }\n        nextChar();\n        return 4194359 /* Token.MinusEquals */;\n    };\n    // /, /=\n    CharScanners[47 /* Char.Slash */] = () => {\n        if (nextChar() !== 61 /* Char.Equals */) {\n            return 6554158 /* Token.Slash */;\n        }\n        nextChar();\n        return 4194361 /* Token.SlashEquals */;\n    };\n    CharScanners[58 /* Char.Colon */] = returnToken(6291478 /* Token.Colon */);\n    CharScanners[59 /* Char.Semicolon */] = returnToken(6291479 /* Token.Semicolon */);\n    CharScanners[91 /* Char.OpenBracket */] = returnToken(2688020 /* Token.OpenBracket */);\n    CharScanners[93 /* Char.CloseBracket */] = returnToken(7340053 /* Token.CloseBracket */);\n    CharScanners[123 /* Char.OpenBrace */] = returnToken(524298 /* Token.OpenBrace */);\n    CharScanners[125 /* Char.CloseBrace */] = returnToken(7340047 /* Token.CloseBrace */);\n    return { CharScanners, IdParts };\n})();\n\nexport { AccessBoundaryExpression, AccessGlobalExpression, AccessKeyedExpression, AccessMemberExpression, AccessScopeExpression, AccessThisExpression, ArrayBindingPattern, ArrayLiteralExpression, ArrowFunction, AssignExpression, BinaryExpression, BindingBehaviorExpression, BindingIdentifier, CallFunctionExpression, CallGlobalExpression, CallMemberExpression, CallScopeExpression, ConditionalExpression, CustomExpression, DestructuringAssignmentExpression, DestructuringAssignmentRestExpression, DestructuringAssignmentSingleExpression, ExpressionParser, ForOfStatement, IExpressionParser, Interpolation, NewExpression, ObjectBindingPattern, ObjectLiteralExpression, PrimitiveLiteralExpression, TaggedTemplateExpression, TemplateExpression, UnaryExpression, Unparser, ValueConverterExpression, astVisit, parseExpression };\n//# sourceMappingURL=index.dev.mjs.map\n","import { DI, Registration, getResourceKeyFor, registrableMetadataKey, emptyArray, resolve, IContainer, isString, firstDefined, mergeArrays, Protocol, resourceBaseName, resource, camelCase, IPlatform, createImplementationRegister, noop, toArray, pascalCase, ILogger, allResources } from '@aurelia/kernel';\nimport { Metadata } from '@aurelia/metadata';\nimport { PrimitiveLiteralExpression, IExpressionParser } from '@aurelia/expression-parser';\n\n/** @internal */ const tcCreateInterface = DI.createInterface;\n/** @internal */ const tcObjectFreeze = Object.freeze;\n/** @internal */ const { aliasTo: aliasRegistration, singleton: singletonRegistration } = Registration;\n/** ExpressionType */\n/** @internal */ const etInterpolation = 'Interpolation';\n/** @internal */ const etIsFunction = 'IsFunction';\n/** @internal */ const etIsProperty = 'IsProperty';\n/** @internal */ const definitionTypeElement = 'custom-element';\n\n// Note: the oneTime binding now has a non-zero value for 2 reasons:\n//  - plays nicer with bitwise operations (more consistent code, more explicit settings)\n//  - allows for potentially having something like BindingMode.oneTime | BindingMode.fromView, where an initial value is set once to the view but updates from the view also propagate back to the view model\n//\n// Furthermore, the \"default\" mode would be for simple \".bind\" expressions to make it explicit for our logic that the default is being used.\n// This essentially adds extra information which binding could use to do smarter things and allows bindingBehaviors that add a mode instead of simply overwriting it\n/**\n * Mode of a binding to operate\n * - 1 / one time - bindings should only update the target once\n * - 2 / to view - bindings should update the target and observe the source for changes to update again\n * - 3 / from view - bindings should update the source and observe the target for changes to update again\n * - 6 / two way - bindings should observe both target and source for changes to update the other side\n * - 0 / default - undecided mode, bindings, depends on the circumstance, may decide what to do accordingly\n */\nconst BindingMode = /*@__PURE__*/ tcObjectFreeze({\n    /**\n     * Unspecified mode, bindings may act differently with this mode\n     */\n    default: 0,\n    oneTime: 1,\n    toView: 2,\n    fromView: 4,\n    twoWay: 6,\n});\n\n/**\n * An interface describing the template compiler used by Aurelia applicaitons\n */\nconst ITemplateCompiler = /*@__PURE__*/ tcCreateInterface('ITemplateCompiler');\n\n/**\n * An interface describing the API for mapping attributes to properties\n */\nconst IAttrMapper = /*@__PURE__*/ tcCreateInterface('IAttrMapper');\n\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/* eslint-disable prefer-template */\n/** @internal */\nconst createMappedError = (code, ...details) => {\n        const paddedCode = String(code).padStart(4, '0');\n        const message = getMessageByCode(code, ...details);\n        const link = `https://docs.aurelia.io/developer-guides/error-messages/0088-to-0723/aur${paddedCode}`;\n        return new Error(`AUR${paddedCode}: ${message}\\n\\nFor more information, see: ${link}`);\n    }\n    ;\n\nconst errorsMap = {\n    [88 /* ErrorNames.attribute_pattern_already_initialized */]: 'AttributeParser is already initialized; cannot add patterns after initialization.',\n    [89 /* ErrorNames.attribute_pattern_duplicate */]: 'Attribute pattern \"{{0}}\" has already been registered.',\n    [99 /* ErrorNames.method_not_implemented */]: 'Method {{0}} not implemented',\n    [157 /* ErrorNames.binding_command_existed */]: `Binding command {{0}} has already been registered.`,\n    [701 /* ErrorNames.compiler_root_is_local */]: `Template compilation error in element \"{{0:name}}\": the root <template> cannot be a local element template.`,\n    [702 /* ErrorNames.compiler_invalid_surrogate_attr */]: `Template compilation error: attribute \"{{0}}\" is invalid on element surrogate.`,\n    [703 /* ErrorNames.compiler_no_tc_on_surrogate */]: `Template compilation error: template controller \"{{0}}\" is invalid on element surrogate.`,\n    [704 /* ErrorNames.compiler_invalid_let_command */]: `Template compilation error: Invalid command \"{{0:.command}}\" for <let>. Only to-view/bind supported.`,\n    [706 /* ErrorNames.compiler_au_slot_on_non_element */]: `Template compilation error: detected projection with [au-slot=\"{{0}}\"] attempted on a non custom element {{1}}.`,\n    [707 /* ErrorNames.compiler_binding_to_non_bindable */]: `Template compilation error: creating binding to non-bindable property {{0}} on {{1}}.`,\n    [708 /* ErrorNames.compiler_template_only_local_template */]: `Template compilation error: the custom element \"{{0}}\" does not have any content other than local template(s).`,\n    [709 /* ErrorNames.compiler_local_el_not_under_root */]: `Template compilation error: local element template needs to be defined directly under root of element \"{{0}}\".`,\n    [710 /* ErrorNames.compiler_local_el_bindable_not_under_root */]: `Template compilation error: bindable properties of local element \"{{0}}\" template needs to be defined directly under <template>.`,\n    [711 /* ErrorNames.compiler_local_el_bindable_name_missing */]: `Template compilation error: the attribute 'property' is missing in {{0:outerHTML}} in local element \"{{1}}\"`,\n    [712 /* ErrorNames.compiler_local_el_bindable_duplicate */]: `Template compilation error: Bindable property and attribute needs to be unique; found property: {{0}}, attribute: {{1}}`,\n    [713 /* ErrorNames.compiler_unknown_binding_command */]: `Template compilation error: unknown binding command: \"{{0}}\".{{0:bindingCommandHelp}}`,\n    [714 /* ErrorNames.compiler_primary_already_existed */]: `Template compilation error: primary already exists on element/attribute \"{{0}}\"`,\n    [715 /* ErrorNames.compiler_local_name_empty */]: `Template compilation error: the value of \"as-custom-element\" attribute cannot be empty for local element in element \"{{0}}\"`,\n    [716 /* ErrorNames.compiler_duplicate_local_name */]: `Template compilation error: duplicate definition of the local template named \"{{0}} in element {{1}}\"`,\n    [717 /* ErrorNames.compiler_slot_without_shadowdom */]: `Template compilation error: detected a usage of \"<slot>\" element without specifying shadow DOM options in element: {{0}}`,\n    [718 /* ErrorNames.compiler_no_spread_tc */]: `Spreading template controller \"{{0}}\" is not supported.`,\n    [719 /* ErrorNames.compiler_attr_mapper_duplicate_mapping */]: `Attribute {{0}} has been already registered for {{1:element}}`,\n    [720 /* ErrorNames.compiler_no_reserved_spread_syntax */]: `Spreading syntax \"...xxx\" is reserved. Encountered \"...{{0}}\"`,\n    [721 /* ErrorNames.compiler_no_reserved_$bindable */]: `Usage of $bindables is only allowed on custom element. Encountered: <{{0}} {{1}}=\"{{2}}\">`,\n    [722 /* ErrorNames.compiler_no_dom_api */]: 'Invalid platform object provided to the compilation, no DOM API found.',\n    [723 /* ErrorNames.compiler_invalid_class_binding_syntax */]: `Template compilation error: Invalid comma-separated class binding syntax in {{0}}. It resulted in no valid class names after parsing.`,\n    [9998 /* ErrorNames.no_spread_template_controller */]: 'Spread binding does not support spreading custom attributes/template controllers. Did you build the spread instruction manually?',\n};\nconst getMessageByCode = (name, ...details) => {\n    let cooked = errorsMap[name];\n    for (let i = 0; i < details.length; ++i) {\n        const regex = new RegExp(`{{${i}(:.*)?}}`, 'g');\n        let matches = regex.exec(cooked);\n        while (matches != null) {\n            const method = matches[1]?.slice(1);\n            let value = details[i];\n            if (value != null) {\n                switch (method) {\n                    case 'nodeName':\n                        value = value.nodeName.toLowerCase();\n                        break;\n                    case 'name':\n                        value = value.name;\n                        break;\n                    case 'typeof':\n                        value = typeof value;\n                        break;\n                    case 'ctor':\n                        value = value.constructor.name;\n                        break;\n                    case 'controller':\n                        value = value.controller.name;\n                        break;\n                    case 'target@property':\n                        value = `${value.target}@${value.targetProperty}`;\n                        break;\n                    case 'toString':\n                        value = Object.prototype.toString.call(value);\n                        break;\n                    case 'join(!=)':\n                        value = value.join('!=');\n                        break;\n                    case 'bindingCommandHelp':\n                        value = getBindingCommandHelp(value);\n                        break;\n                    case 'element':\n                        value = value === '*' ? 'all elements' : `<${value} />`;\n                        break;\n                    default: {\n                        // property access\n                        if (method?.startsWith('.')) {\n                            value = String(value[method.slice(1)]);\n                        }\n                        else {\n                            value = String(value);\n                        }\n                    }\n                }\n            }\n            cooked = cooked.slice(0, matches.index) + value + cooked.slice(regex.lastIndex);\n            matches = regex.exec(cooked);\n        }\n    }\n    return cooked;\n};\nfunction getBindingCommandHelp(name) {\n    switch (name) {\n        case 'delegate':\n            return `\\nThe \".delegate\" binding command has been removed in v2.`\n                + ` Binding command \".trigger\" should be used instead.`\n                + ` If you are migrating v1 application, install compat package`\n                + ` to add back the \".delegate\" binding command for ease of migration.`;\n        case 'call':\n            return `\\nThe \".call\" binding command has been removed in v2.`\n                + ` If you want to pass a callback that preserves the context of the function call,`\n                + ` you can use lambda instead. Refer to lambda expression doc for more details.`;\n        default:\n            return '';\n    }\n}\n\nvar _a, _b, _c, _d, _e;\nclass CharSpec {\n    constructor(chars, repeat, isSymbol, isInverted) {\n        this.chars = chars;\n        this.repeat = repeat;\n        this.isSymbol = isSymbol;\n        this.isInverted = isInverted;\n        if (isInverted) {\n            switch (chars.length) {\n                case 0:\n                    this.has = this._hasOfNoneInverse;\n                    break;\n                case 1:\n                    this.has = this._hasOfSingleInverse;\n                    break;\n                default:\n                    this.has = this._hasOfMultipleInverse;\n            }\n        }\n        else {\n            switch (chars.length) {\n                case 0:\n                    this.has = this._hasOfNone;\n                    break;\n                case 1:\n                    this.has = this._hasOfSingle;\n                    break;\n                default:\n                    this.has = this._hasOfMultiple;\n            }\n        }\n    }\n    equals(other) {\n        return this.chars === other.chars\n            && this.repeat === other.repeat\n            && this.isSymbol === other.isSymbol\n            && this.isInverted === other.isInverted;\n    }\n    /** @internal */\n    _hasOfMultiple(char) {\n        return this.chars.includes(char);\n    }\n    /** @internal */\n    _hasOfSingle(char) {\n        return this.chars === char;\n    }\n    /** @internal */\n    _hasOfNone(_char) {\n        return false;\n    }\n    /** @internal */\n    _hasOfMultipleInverse(char) {\n        return !this.chars.includes(char);\n    }\n    /** @internal */\n    _hasOfSingleInverse(char) {\n        return this.chars !== char;\n    }\n    /** @internal */\n    _hasOfNoneInverse(_char) {\n        return true;\n    }\n}\nclass Interpretation {\n    constructor() {\n        this.parts = emptyArray;\n        /** @internal */\n        this._pattern = '';\n        /** @internal */\n        this._currentRecord = {};\n        /** @internal */\n        this._partsRecord = {};\n    }\n    get pattern() {\n        const value = this._pattern;\n        if (value === '') {\n            return null;\n        }\n        else {\n            return value;\n        }\n    }\n    set pattern(value) {\n        if (value == null) {\n            this._pattern = '';\n            this.parts = emptyArray;\n        }\n        else {\n            this._pattern = value;\n            this.parts = this._partsRecord[value];\n        }\n    }\n    append(pattern, ch) {\n        const currentRecord = this._currentRecord;\n        if (currentRecord[pattern] === undefined) {\n            currentRecord[pattern] = ch;\n        }\n        else {\n            currentRecord[pattern] += ch;\n        }\n    }\n    next(pattern) {\n        const currentRecord = this._currentRecord;\n        let partsRecord;\n        if (currentRecord[pattern] !== undefined) {\n            partsRecord = this._partsRecord;\n            if (partsRecord[pattern] === undefined) {\n                partsRecord[pattern] = [currentRecord[pattern]];\n            }\n            else {\n                partsRecord[pattern].push(currentRecord[pattern]);\n            }\n            currentRecord[pattern] = undefined;\n        }\n    }\n}\nclass AttrParsingState {\n    get _pattern() {\n        return this._isEndpoint ? this._patterns[0] : null;\n    }\n    constructor(charSpec, ...patterns) {\n        this.charSpec = charSpec;\n        this._nextStates = [];\n        this._types = null;\n        this._isEndpoint = false;\n        this._patterns = patterns;\n    }\n    findChild(charSpec) {\n        const nextStates = this._nextStates;\n        const len = nextStates.length;\n        let child = null;\n        let i = 0;\n        for (; i < len; ++i) {\n            child = nextStates[i];\n            if (charSpec.equals(child.charSpec)) {\n                return child;\n            }\n        }\n        return null;\n    }\n    append(charSpec, pattern) {\n        const patterns = this._patterns;\n        if (!patterns.includes(pattern)) {\n            patterns.push(pattern);\n        }\n        let state = this.findChild(charSpec);\n        if (state == null) {\n            state = new AttrParsingState(charSpec, pattern);\n            this._nextStates.push(state);\n            if (charSpec.repeat) {\n                state._nextStates.push(state);\n            }\n        }\n        return state;\n    }\n    findMatches(ch, interpretation) {\n        // TODO: reuse preallocated arrays\n        const results = [];\n        const nextStates = this._nextStates;\n        const len = nextStates.length;\n        let childLen = 0;\n        let child = null;\n        let i = 0;\n        let j = 0;\n        for (; i < len; ++i) {\n            child = nextStates[i];\n            if (child.charSpec.has(ch)) {\n                results.push(child);\n                childLen = child._patterns.length;\n                j = 0;\n                if (child.charSpec.isSymbol) {\n                    for (; j < childLen; ++j) {\n                        interpretation.next(child._patterns[j]);\n                    }\n                }\n                else {\n                    for (; j < childLen; ++j) {\n                        interpretation.append(child._patterns[j], ch);\n                    }\n                }\n            }\n        }\n        return results;\n    }\n}\n/** @internal */\nclass StaticSegment {\n    constructor(text) {\n        this.text = text;\n        const len = this._len = text.length;\n        const specs = this._specs = [];\n        let i = 0;\n        for (; len > i; ++i) {\n            specs.push(new CharSpec(text[i], false, false, false));\n        }\n    }\n    eachChar(callback) {\n        const len = this._len;\n        const specs = this._specs;\n        let i = 0;\n        for (; len > i; ++i) {\n            callback(specs[i]);\n        }\n    }\n}\n/** @internal */\nclass DynamicSegment {\n    constructor(symbols) {\n        this.text = 'PART';\n        this._spec = new CharSpec(symbols, true, false, true);\n    }\n    eachChar(callback) {\n        callback(this._spec);\n    }\n}\n/** @internal */\nclass SymbolSegment {\n    constructor(text) {\n        this.text = text;\n        this._spec = new CharSpec(text, false, true, false);\n    }\n    eachChar(callback) {\n        callback(this._spec);\n    }\n}\nclass SegmentTypes {\n    constructor() {\n        this.statics = 0;\n        this.dynamics = 0;\n        this.symbols = 0;\n    }\n}\nconst ISyntaxInterpreter = /*@__PURE__*/ tcCreateInterface('ISyntaxInterpreter', x => x.singleton(SyntaxInterpreter));\n/**\n * The default implementation of @see {ISyntaxInterpreter}.\n */\nclass SyntaxInterpreter {\n    constructor() {\n        /** @internal */\n        this._rootState = new AttrParsingState(null);\n        /** @internal */\n        this._initialStates = [this._rootState];\n    }\n    // todo: this only works if this method is ever called only once\n    add(defs) {\n        defs = defs.slice(0).sort((d1, d2) => d1.pattern > d2.pattern ? 1 : -1);\n        const ii = defs.length;\n        let currentState;\n        let def;\n        let pattern;\n        let types;\n        let segments;\n        let len;\n        let charSpecCb;\n        let i = 0;\n        let j;\n        while (ii > i) {\n            currentState = this._rootState;\n            def = defs[i];\n            pattern = def.pattern;\n            types = new SegmentTypes();\n            segments = this._parse(def, types);\n            len = segments.length;\n            charSpecCb = (ch) => currentState = currentState.append(ch, pattern);\n            for (j = 0; len > j; ++j) {\n                segments[j].eachChar(charSpecCb);\n            }\n            currentState._types = types;\n            currentState._isEndpoint = true;\n            ++i;\n        }\n    }\n    interpret(name) {\n        const interpretation = new Interpretation();\n        const len = name.length;\n        let states = this._initialStates;\n        let i = 0;\n        let state;\n        for (; i < len; ++i) {\n            states = this._getNextStates(states, name.charAt(i), interpretation);\n            if (states.length === 0) {\n                break;\n            }\n        }\n        states = states.filter(isEndpoint);\n        if (states.length > 0) {\n            states.sort(sortEndpoint);\n            state = states[0];\n            if (!state.charSpec.isSymbol) {\n                interpretation.next(state._pattern);\n            }\n            interpretation.pattern = state._pattern;\n        }\n        return interpretation;\n    }\n    /** @internal */\n    _getNextStates(states, ch, interpretation) {\n        // TODO: reuse preallocated arrays\n        const nextStates = [];\n        let state = null;\n        const len = states.length;\n        let i = 0;\n        for (; i < len; ++i) {\n            state = states[i];\n            nextStates.push(...state.findMatches(ch, interpretation));\n        }\n        return nextStates;\n    }\n    /** @internal */\n    _parse(def, types) {\n        const result = [];\n        const pattern = def.pattern;\n        const len = pattern.length;\n        const symbols = def.symbols;\n        let i = 0;\n        let start = 0;\n        let c = '';\n        while (i < len) {\n            c = pattern.charAt(i);\n            if (symbols.length === 0 || !symbols.includes(c)) {\n                if (i === start) {\n                    if (c === 'P' && pattern.slice(i, i + 4) === 'PART') {\n                        start = i = (i + 4);\n                        result.push(new DynamicSegment(symbols));\n                        ++types.dynamics;\n                    }\n                    else {\n                        ++i;\n                    }\n                }\n                else {\n                    ++i;\n                }\n            }\n            else if (i !== start) {\n                result.push(new StaticSegment(pattern.slice(start, i)));\n                ++types.statics;\n                start = i;\n            }\n            else {\n                result.push(new SymbolSegment(pattern.slice(start, i + 1)));\n                ++types.symbols;\n                start = ++i;\n            }\n        }\n        if (start !== i) {\n            result.push(new StaticSegment(pattern.slice(start, i)));\n            ++types.statics;\n        }\n        return result;\n    }\n}\nfunction isEndpoint(a) {\n    return a._isEndpoint;\n}\nfunction sortEndpoint(a, b) {\n    // both a and b are endpoints\n    // compare them based on the number of static, then dynamic & symbol fragments\n    const aTypes = a._types;\n    const bTypes = b._types;\n    if (aTypes.statics !== bTypes.statics) {\n        return bTypes.statics - aTypes.statics;\n    }\n    if (aTypes.dynamics !== bTypes.dynamics) {\n        return bTypes.dynamics - aTypes.dynamics;\n    }\n    if (aTypes.symbols !== bTypes.symbols) {\n        return bTypes.symbols - aTypes.symbols;\n    }\n    return 0;\n}\nclass AttrSyntax {\n    constructor(rawName, rawValue, target, command, parts = null) {\n        this.rawName = rawName;\n        this.rawValue = rawValue;\n        this.target = target;\n        this.command = command;\n        this.parts = parts;\n    }\n}\nconst IAttributePattern = /*@__PURE__*/ tcCreateInterface('IAttributePattern');\nconst IAttributeParser = /*@__PURE__*/ tcCreateInterface('IAttributeParser', x => x.singleton(AttributeParser));\n/**\n * The default implementation of the @see IAttributeParser interface\n */\nclass AttributeParser {\n    constructor() {\n        /** @internal */\n        this._cache = {};\n        /**\n         * A 2 level record with the same key on both levels.\n         * Just a trick to maintain `this` + have simple lookup + support multi patterns per class definition\n         *\n         * @internal\n         */\n        this._patterns = {};\n        /** @internal */\n        this._initialized = false;\n        /** @internal */\n        this._allDefinitions = [];\n        this._interpreter = resolve(ISyntaxInterpreter);\n        this._container = resolve(IContainer);\n    }\n    registerPattern(patterns, Type) {\n        if (this._initialized)\n            throw createMappedError(88 /* ErrorNames.attribute_pattern_already_initialized */);\n        const $patterns = this._patterns;\n        for (const { pattern } of patterns) {\n            if ($patterns[pattern] != null)\n                throw createMappedError(89 /* ErrorNames.attribute_pattern_duplicate */, pattern);\n            $patterns[pattern] = { patternType: Type };\n        }\n        this._allDefinitions.push(...patterns);\n    }\n    /** @internal */\n    _initialize() {\n        this._interpreter.add(this._allDefinitions);\n        const _container = this._container;\n        for (const [, value] of Object.entries(this._patterns)) {\n            value.pattern = _container.get(value.patternType);\n        }\n    }\n    parse(name, value) {\n        // Optimization Idea: move the initialization to an AppTask\n        if (!this._initialized) {\n            this._initialize();\n            this._initialized = true;\n        }\n        let interpretation = this._cache[name];\n        if (interpretation == null) {\n            interpretation = this._cache[name] = this._interpreter.interpret(name);\n        }\n        const pattern = interpretation.pattern;\n        if (pattern == null) {\n            return new AttrSyntax(name, value, name, null, null);\n        }\n        else {\n            return this._patterns[pattern].pattern[pattern](name, value, interpretation.parts);\n        }\n    }\n}\n/**\n * Decorator to be used on attr pattern classes\n */\nfunction attributePattern(...patternDefs) {\n    return function decorator(target, context) {\n        const registrable = AttributePattern.create(patternDefs, target);\n        // Decorators are by nature static, so we need to store the metadata on the class itself, assuming only one set of patterns per class.\n        context.metadata[registrableMetadataKey] = registrable;\n        return target;\n    };\n}\nconst AttributePattern = /*@__PURE__*/ tcObjectFreeze({\n    name: getResourceKeyFor('attribute-pattern'),\n    create(patternDefs, Type) {\n        return {\n            register(container) {\n                container.get(IAttributeParser).registerPattern(patternDefs, Type);\n                singletonRegistration(IAttributePattern, Type).register(container);\n            }\n        };\n    },\n});\nclass DotSeparatedAttributePattern {\n    'PART.PART'(rawName, rawValue, parts) {\n        return new AttrSyntax(rawName, rawValue, parts[0], parts[1]);\n    }\n    'PART.PART.PART'(rawName, rawValue, parts) {\n        return new AttrSyntax(rawName, rawValue, `${parts[0]}.${parts[1]}`, parts[2]);\n    }\n}\n_a = Symbol.metadata;\nDotSeparatedAttributePattern[_a] = {\n    [registrableMetadataKey]: /*@__PURE__*/ AttributePattern.create([\n        { pattern: 'PART.PART', symbols: '.' },\n        { pattern: 'PART.PART.PART', symbols: '.' }\n    ], DotSeparatedAttributePattern)\n};\nclass RefAttributePattern {\n    'ref'(rawName, rawValue, _parts) {\n        return new AttrSyntax(rawName, rawValue, 'element', 'ref');\n    }\n    'PART.ref'(rawName, rawValue, parts) {\n        let target = parts[0];\n        if (target === 'view-model') {\n            target = 'component';\n            {\n                // eslint-disable-next-line no-console\n                console.warn(`[aurelia] Detected view-model.ref usage: \"${rawName}=${rawValue}\".`\n                    + ` This is deprecated and component.ref should be used instead`);\n            }\n        }\n        return new AttrSyntax(rawName, rawValue, target, 'ref');\n    }\n}\n_b = Symbol.metadata;\nRefAttributePattern[_b] = {\n    [registrableMetadataKey]: /*@__PURE__*/ AttributePattern.create([\n        { pattern: 'ref', symbols: '' },\n        { pattern: 'PART.ref', symbols: '.' }\n    ], RefAttributePattern)\n};\nclass EventAttributePattern {\n    'PART.trigger:PART'(rawName, rawValue, parts) {\n        return new AttrSyntax(rawName, rawValue, parts[0], 'trigger', parts);\n    }\n    'PART.capture:PART'(rawName, rawValue, parts) {\n        return new AttrSyntax(rawName, rawValue, parts[0], 'capture', parts);\n    }\n}\n_c = Symbol.metadata;\nEventAttributePattern[_c] = {\n    [registrableMetadataKey]: /*@__PURE__*/ AttributePattern.create([\n        { pattern: 'PART.trigger:PART', symbols: '.:' },\n        { pattern: 'PART.capture:PART', symbols: '.:' },\n    ], EventAttributePattern)\n};\nclass ColonPrefixedBindAttributePattern {\n    ':PART'(rawName, rawValue, parts) {\n        return new AttrSyntax(rawName, rawValue, parts[0], 'bind');\n    }\n}\n_d = Symbol.metadata;\nColonPrefixedBindAttributePattern[_d] = {\n    [registrableMetadataKey]: /*@__PURE__*/ AttributePattern.create([{ pattern: ':PART', symbols: ':' }], ColonPrefixedBindAttributePattern)\n};\nclass AtPrefixedTriggerAttributePattern {\n    '@PART'(rawName, rawValue, parts) {\n        return new AttrSyntax(rawName, rawValue, parts[0], 'trigger');\n    }\n    '@PART:PART'(rawName, rawValue, parts) {\n        return new AttrSyntax(rawName, rawValue, parts[0], 'trigger', [parts[0], 'trigger', ...parts.slice(1)]);\n    }\n}\n_e = Symbol.metadata;\nAtPrefixedTriggerAttributePattern[_e] = {\n    [registrableMetadataKey]: /*@__PURE__*/ AttributePattern.create([\n        { pattern: '@PART', symbols: '@' },\n        { pattern: '@PART:PART', symbols: '@:' },\n    ], AtPrefixedTriggerAttributePattern)\n};\n\n/** @internal */ const getMetadata = Metadata.get;\n/** @internal */ Metadata.has;\n/** @internal */ const defineMetadata = Metadata.define;\n\n/** @internal */ const hydrateElement = 'ra';\n/** @internal */ const hydrateAttribute = 'rb';\n/** @internal */ const hydrateTemplateController = 'rc';\n/** @internal */ const hydrateLetElement = 'rd';\n/** @internal */ const setProperty = 're';\n/** @internal */ const interpolation = 'rf';\n/** @internal */ const propertyBinding = 'rg';\n/** @internal */ const letBinding = 'ri';\n/** @internal */ const refBinding = 'rj';\n/** @internal */ const iteratorBinding = 'rk';\n/** @internal */ const multiAttr = 'rl';\n/** @internal */ const textBinding = 'ha';\n/** @internal */ const listenerBinding = 'hb';\n/** @internal */ const attributeBinding = 'hc';\n/** @internal */ const stylePropertyBinding = 'hd';\n/** @internal */ const setAttribute = 'he';\n/** @internal */ const setClassAttribute = 'hf';\n/** @internal */ const setStyleAttribute = 'hg';\n/** @internal */ const spreadTransferedBinding = 'hs';\n/** @internal */ const spreadElementProp = 'hp';\n/** @internal */ const spreadValueBinding = 'svb';\nconst InstructionType = /*@__PURE__*/ tcObjectFreeze({\n    hydrateElement,\n    hydrateAttribute,\n    hydrateTemplateController,\n    hydrateLetElement,\n    setProperty,\n    interpolation,\n    propertyBinding,\n    letBinding,\n    refBinding,\n    iteratorBinding,\n    multiAttr,\n    textBinding,\n    listenerBinding,\n    attributeBinding,\n    stylePropertyBinding,\n    setAttribute,\n    setClassAttribute,\n    setStyleAttribute,\n    spreadTransferedBinding,\n    spreadElementProp,\n    spreadValueBinding,\n});\nconst IInstruction = /*@__PURE__*/ tcCreateInterface('Instruction');\nclass InterpolationInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = interpolation;\n    }\n}\nclass PropertyBindingInstruction {\n    constructor(from, to, mode) {\n        this.from = from;\n        this.to = to;\n        this.mode = mode;\n        this.type = propertyBinding;\n    }\n}\nclass IteratorBindingInstruction {\n    constructor(forOf, to, props) {\n        this.forOf = forOf;\n        this.to = to;\n        this.props = props;\n        this.type = iteratorBinding;\n    }\n}\nclass RefBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = refBinding;\n    }\n}\nclass SetPropertyInstruction {\n    constructor(value, to) {\n        this.value = value;\n        this.to = to;\n        this.type = setProperty;\n    }\n}\nclass MultiAttrInstruction {\n    constructor(value, to, command) {\n        this.value = value;\n        this.to = to;\n        this.command = command;\n        this.type = multiAttr;\n    }\n}\nclass HydrateElementInstruction {\n    constructor(\n    /**\n     * The name of the custom element this instruction is associated with\n     */\n    // in theory, Constructor of resources should be accepted too\n    // though it would be unnecessary right now\n    res, \n    /**\n     * Bindable instructions for the custom element instance\n     */\n    props, \n    /**\n     * Indicates what projections are associated with the element usage\n     */\n    projections, \n    /**\n     * Indicates whether the usage of the custom element was with a containerless attribute or not\n     */\n    containerless, \n    /**\n     * A list of captured attr syntaxes\n     */\n    captures, \n    /**\n     * Any data associated with this instruction\n     */\n    data) {\n        this.res = res;\n        this.props = props;\n        this.projections = projections;\n        this.containerless = containerless;\n        this.captures = captures;\n        this.data = data;\n        this.type = hydrateElement;\n    }\n}\n// the template type gives an opportunity for implementor of resources resolver to provide a more specific type\nclass HydrateAttributeInstruction {\n    constructor(\n    // in theory, Constructor of resources should be accepted too\n    // though it would be unnecessary right now\n    res, alias, \n    /**\n     * Bindable instructions for the custom attribute instance\n     */\n    props) {\n        this.res = res;\n        this.alias = alias;\n        this.props = props;\n        this.type = hydrateAttribute;\n    }\n}\n// the template type gives an opportunity for implementor of resources resolver to provide a more specific type\nclass HydrateTemplateController {\n    constructor(def, \n    // in theory, Constructor of resources should be accepted too\n    // though it would be unnecessary right now\n    res, alias, \n    /**\n     * Bindable instructions for the template controller instance\n     */\n    props) {\n        this.def = def;\n        this.res = res;\n        this.alias = alias;\n        this.props = props;\n        this.type = hydrateTemplateController;\n    }\n}\nclass HydrateLetElementInstruction {\n    constructor(instructions, toBindingContext) {\n        this.instructions = instructions;\n        this.toBindingContext = toBindingContext;\n        this.type = hydrateLetElement;\n    }\n}\nclass LetBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = letBinding;\n    }\n}\nclass TextBindingInstruction {\n    constructor(from) {\n        this.from = from;\n        this.type = textBinding;\n    }\n}\nclass ListenerBindingInstruction {\n    constructor(from, to, capture, modifier) {\n        this.from = from;\n        this.to = to;\n        this.capture = capture;\n        this.modifier = modifier;\n        this.type = listenerBinding;\n    }\n}\nclass StylePropertyBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = stylePropertyBinding;\n    }\n}\nclass SetAttributeInstruction {\n    constructor(value, to) {\n        this.value = value;\n        this.to = to;\n        this.type = setAttribute;\n    }\n}\nclass SetClassAttributeInstruction {\n    constructor(value) {\n        this.value = value;\n        this.type = setClassAttribute;\n    }\n}\nclass SetStyleAttributeInstruction {\n    constructor(value) {\n        this.value = value;\n        this.type = setStyleAttribute;\n    }\n}\nclass AttributeBindingInstruction {\n    constructor(\n    /**\n     * `attr` and `to` have the same value on a normal attribute\n     * Will be different on `class` and `style`\n     * on `class`: attr = `class` (from binding command), to = attribute name\n     * on `style`: attr = `style` (from binding command), to = attribute name\n     */\n    attr, from, to) {\n        this.attr = attr;\n        this.from = from;\n        this.to = to;\n        this.type = attributeBinding;\n    }\n}\nclass SpreadTransferedBindingInstruction {\n    constructor() {\n        this.type = spreadTransferedBinding;\n    }\n}\n/**\n * When spreading any attribute bindings onto an element,\n * it's possible that some attributes will be targeting the bindable properties of a custom element\n * This instruction is used to express that\n */\nclass SpreadElementPropBindingInstruction {\n    constructor(instruction) {\n        this.instruction = instruction;\n        this.type = spreadElementProp;\n    }\n}\nclass SpreadValueBindingInstruction {\n    constructor(target, from) {\n        this.target = target;\n        this.from = from;\n        this.type = spreadValueBinding;\n    }\n}\n\nfunction bindingCommand(nameOrDefinition) {\n    return function (target, context) {\n        context.addInitializer(function () {\n            BindingCommand.define(nameOrDefinition, target);\n        });\n        return target;\n    };\n}\nclass BindingCommandDefinition {\n    constructor(Type, name, aliases, key) {\n        this.Type = Type;\n        this.name = name;\n        this.aliases = aliases;\n        this.key = key;\n    }\n    static create(nameOrDef, Type) {\n        let name;\n        let def;\n        if (isString(nameOrDef)) {\n            name = nameOrDef;\n            def = { name };\n        }\n        else {\n            name = nameOrDef.name;\n            def = nameOrDef;\n        }\n        return new BindingCommandDefinition(Type, firstDefined(getCommandAnnotation(Type, 'name'), name), mergeArrays(getCommandAnnotation(Type, 'aliases'), def.aliases, Type.aliases), getCommandKeyFrom(name));\n    }\n    register(container, aliasName) {\n        const $Type = this.Type;\n        const key = typeof aliasName === 'string' ? getCommandKeyFrom(aliasName) : this.key;\n        const aliases = this.aliases;\n        if (!container.has(key, false)) {\n            container.register(container.has($Type, false) ? null : singletonRegistration($Type, $Type), aliasRegistration($Type, key), ...aliases.map(alias => aliasRegistration($Type, getCommandKeyFrom(alias))));\n        } /* istanbul ignore next */\n        else {\n            // eslint-disable-next-line no-console\n            console.warn(`[DEV:aurelia] ${createMappedError(157 /* ErrorNames.binding_command_existed */, this.name)}`);\n        }\n    }\n}\nconst bindingCommandTypeName = 'binding-command';\nconst cmdBaseName = /*@__PURE__*/ getResourceKeyFor(bindingCommandTypeName);\nconst getCommandKeyFrom = (name) => `${cmdBaseName}:${name}`;\nconst getCommandAnnotation = (Type, prop) => getMetadata(Protocol.annotation.keyFor(prop), Type);\nconst BindingCommand = /*@__PURE__*/ (() => {\n    const staticResourceDefinitionMetadataKey = '__au_static_resource__';\n    const getDefinitionFromStaticAu = (\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    Type, typeName, createDef) => {\n        let def = getMetadata(staticResourceDefinitionMetadataKey, Type);\n        if (def == null) {\n            if (Type.$au?.type === typeName) {\n                def = createDef(Type.$au, Type);\n                defineMetadata(def, Type, staticResourceDefinitionMetadataKey);\n            }\n        }\n        return def;\n    };\n    return tcObjectFreeze({\n        name: cmdBaseName,\n        keyFrom: getCommandKeyFrom,\n        // isType<T>(value: T): value is (T extends Constructable ? BindingCommandType<T> : never) {\n        //   return isFunction(value) && hasOwnMetadata(cmdBaseName, value);\n        // },\n        define(nameOrDef, Type) {\n            const definition = BindingCommandDefinition.create(nameOrDef, Type);\n            const $Type = definition.Type;\n            // registration of resource name is a requirement for the resource system in kernel (module-loader)\n            defineMetadata(definition, $Type, cmdBaseName, resourceBaseName);\n            return $Type;\n        },\n        getAnnotation: getCommandAnnotation,\n        find(container, name) {\n            const Type = container.find(bindingCommandTypeName, name);\n            return Type == null\n                ? null\n                : getMetadata(cmdBaseName, Type) ?? getDefinitionFromStaticAu(Type, bindingCommandTypeName, BindingCommandDefinition.create) ?? null;\n        },\n        get(container, name) {\n            {\n                try {\n                    return container.get(resource(getCommandKeyFrom(name)));\n                }\n                catch (ex) {\n                    // eslint-disable-next-line no-console\n                    console.log(`\\n\\n\\n[DEV:aurelia] Cannot retrieve binding command with name\\n\\n\\n\\n\\n`, name);\n                    throw ex;\n                }\n            }\n            return container.get(resource(getCommandKeyFrom(name)));\n        },\n    });\n})();\nclass OneTimeBindingCommand {\n    get ignoreAttr() { return false; }\n    build(info, exprParser, attrMapper) {\n        const attr = info.attr;\n        let target = attr.target;\n        let value = info.attr.rawValue;\n        value = value === '' ? camelCase(target) : value;\n        if (info.bindable == null) {\n            target = attrMapper.map(info.node, target)\n                // if the mapper doesn't know how to map it\n                // use the default behavior, which is camel-casing\n                ?? camelCase(target);\n        }\n        else {\n            target = info.bindable.name;\n        }\n        return new PropertyBindingInstruction(exprParser.parse(value, etIsProperty), target, 1 /* InternalBindingMode.oneTime */);\n    }\n}\nOneTimeBindingCommand.$au = {\n    type: bindingCommandTypeName,\n    name: 'one-time',\n};\nclass ToViewBindingCommand {\n    get ignoreAttr() { return false; }\n    build(info, exprParser, attrMapper) {\n        const attr = info.attr;\n        let target = attr.target;\n        let value = info.attr.rawValue;\n        value = value === '' ? camelCase(target) : value;\n        if (info.bindable == null) {\n            target = attrMapper.map(info.node, target)\n                // if the mapper doesn't know how to map it\n                // use the default behavior, which is camel-casing\n                ?? camelCase(target);\n        }\n        else {\n            target = info.bindable.name;\n        }\n        return new PropertyBindingInstruction(exprParser.parse(value, etIsProperty), target, 2 /* InternalBindingMode.toView */);\n    }\n}\nToViewBindingCommand.$au = {\n    type: bindingCommandTypeName,\n    name: 'to-view',\n};\nclass FromViewBindingCommand {\n    get ignoreAttr() { return false; }\n    build(info, exprParser, attrMapper) {\n        const attr = info.attr;\n        let target = attr.target;\n        let value = attr.rawValue;\n        value = value === '' ? camelCase(target) : value;\n        if (info.bindable == null) {\n            target = attrMapper.map(info.node, target)\n                // if the mapper doesn't know how to map it\n                // use the default behavior, which is camel-casing\n                ?? camelCase(target);\n        }\n        else {\n            target = info.bindable.name;\n        }\n        return new PropertyBindingInstruction(exprParser.parse(value, etIsProperty), target, 4 /* InternalBindingMode.fromView */);\n    }\n}\nFromViewBindingCommand.$au = {\n    type: bindingCommandTypeName,\n    name: 'from-view',\n};\nclass TwoWayBindingCommand {\n    get ignoreAttr() { return false; }\n    build(info, exprParser, attrMapper) {\n        const attr = info.attr;\n        let target = attr.target;\n        let value = attr.rawValue;\n        value = value === '' ? camelCase(target) : value;\n        if (info.bindable == null) {\n            target = attrMapper.map(info.node, target)\n                // if the mapper doesn't know how to map it\n                // use the default behavior, which is camel-casing\n                ?? camelCase(target);\n        }\n        else {\n            target = info.bindable.name;\n        }\n        return new PropertyBindingInstruction(exprParser.parse(value, etIsProperty), target, 6 /* InternalBindingMode.twoWay */);\n    }\n}\nTwoWayBindingCommand.$au = {\n    type: bindingCommandTypeName,\n    name: 'two-way',\n};\nclass DefaultBindingCommand {\n    get ignoreAttr() { return false; }\n    build(info, exprParser, attrMapper) {\n        const attr = info.attr;\n        const bindable = info.bindable;\n        let value = attr.rawValue;\n        let target = attr.target;\n        let defDefaultMode;\n        let mode;\n        value = value === '' ? camelCase(target) : value;\n        if (bindable == null) {\n            mode = attrMapper.isTwoWay(info.node, target) ? 6 /* InternalBindingMode.twoWay */ : 2 /* InternalBindingMode.toView */;\n            target = attrMapper.map(info.node, target)\n                // if the mapper doesn't know how to map it\n                // use the default behavior, which is camel-casing\n                ?? camelCase(target);\n        }\n        else {\n            defDefaultMode = info.def.defaultBindingMode ?? 0;\n            mode = bindable.mode === 0 || bindable.mode == null\n                ? defDefaultMode == null || defDefaultMode === 0\n                    ? 2 /* InternalBindingMode.toView */\n                    : defDefaultMode\n                : bindable.mode;\n            target = bindable.name;\n        }\n        return new PropertyBindingInstruction(exprParser.parse(value, etIsProperty), target, isString(mode)\n            ? BindingMode[mode] ?? 0 /* InternalBindingMode.default */\n            : mode);\n    }\n}\nDefaultBindingCommand.$au = {\n    type: bindingCommandTypeName,\n    name: 'bind',\n};\nclass ForBindingCommand {\n    constructor() {\n        /** @internal */\n        this._attrParser = resolve(IAttributeParser);\n    }\n    get ignoreAttr() { return false; }\n    build(info, exprParser) {\n        const target = info.bindable === null\n            ? camelCase(info.attr.target)\n            : info.bindable.name;\n        const forOf = exprParser.parse(info.attr.rawValue, 'IsIterator');\n        let props = emptyArray;\n        if (forOf.semiIdx > -1) {\n            const attr = info.attr.rawValue.slice(forOf.semiIdx + 1);\n            const i = attr.indexOf(':');\n            if (i > -1) {\n                const attrName = attr.slice(0, i).trim();\n                const attrValue = attr.slice(i + 1).trim();\n                const attrSyntax = this._attrParser.parse(attrName, attrValue);\n                props = [new MultiAttrInstruction(attrValue, attrSyntax.target, attrSyntax.command)];\n            }\n        }\n        return new IteratorBindingInstruction(forOf, target, props);\n    }\n}\nForBindingCommand.$au = {\n    type: bindingCommandTypeName,\n    name: 'for',\n};\nclass TriggerBindingCommand {\n    get ignoreAttr() { return true; }\n    build(info, exprParser) {\n        return new ListenerBindingInstruction(exprParser.parse(info.attr.rawValue, etIsFunction), info.attr.target, false, info.attr.parts?.[2] ?? null);\n    }\n}\nTriggerBindingCommand.$au = {\n    type: bindingCommandTypeName,\n    name: 'trigger',\n};\nclass CaptureBindingCommand {\n    get ignoreAttr() { return true; }\n    build(info, exprParser) {\n        return new ListenerBindingInstruction(exprParser.parse(info.attr.rawValue, etIsFunction), info.attr.target, true, info.attr.parts?.[2] ?? null);\n    }\n}\nCaptureBindingCommand.$au = {\n    type: bindingCommandTypeName,\n    name: 'capture',\n};\n/**\n * Attr binding command. Compile attr with binding symbol with command `attr` to `AttributeBindingInstruction`\n */\nclass AttrBindingCommand {\n    get ignoreAttr() { return true; }\n    build(info, exprParser) {\n        const attr = info.attr;\n        const target = attr.target;\n        let value = attr.rawValue;\n        value = value === '' ? camelCase(target) : value;\n        return new AttributeBindingInstruction(target, exprParser.parse(value, etIsProperty), target);\n    }\n}\nAttrBindingCommand.$au = {\n    type: bindingCommandTypeName,\n    name: 'attr',\n};\n/**\n * Style binding command. Compile attr with binding symbol with command `style` to `AttributeBindingInstruction`\n */\nclass StyleBindingCommand {\n    get ignoreAttr() { return true; }\n    build(info, exprParser) {\n        return new AttributeBindingInstruction('style', exprParser.parse(info.attr.rawValue, etIsProperty), info.attr.target);\n    }\n}\nStyleBindingCommand.$au = {\n    type: bindingCommandTypeName,\n    name: 'style',\n};\n/**\n * Class binding command. Compile attr with binding symbol with command `class` to `AttributeBindingInstruction`\n */\nclass ClassBindingCommand {\n    get ignoreAttr() { return true; }\n    build(info, exprParser) {\n        let target = info.attr.target;\n        if (target.includes(\",\")) {\n            const classes = target\n                .split(\",\")\n                .filter(c => c.length > 0);\n            if (classes.length === 0) {\n                throw createMappedError(723 /* ErrorNames.compiler_invalid_class_binding_syntax */);\n            }\n            target = classes.join(' ');\n        }\n        return new AttributeBindingInstruction(\"class\", exprParser.parse(info.attr.rawValue, etIsProperty), target);\n    }\n}\nClassBindingCommand.$au = {\n    type: bindingCommandTypeName,\n    name: 'class',\n};\n/**\n * Binding command to refer different targets (element, custom element/attribute view models, controller) attached to an element\n */\nclass RefBindingCommand {\n    get ignoreAttr() { return true; }\n    build(info, exprParser) {\n        return new RefBindingInstruction(exprParser.parse(info.attr.rawValue, etIsProperty), info.attr.target);\n    }\n}\nRefBindingCommand.$au = {\n    type: bindingCommandTypeName,\n    name: 'ref',\n};\nclass SpreadValueBindingCommand {\n    get ignoreAttr() { return false; }\n    build(info) {\n        return new SpreadValueBindingInstruction(info.attr.target, info.attr.rawValue);\n    }\n}\nSpreadValueBindingCommand.$au = {\n    type: bindingCommandTypeName,\n    name: 'spread',\n};\n\n/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\n\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n    var e = new Error(message);\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nconst ITemplateElementFactory = /*@__PURE__*/ tcCreateInterface('ITemplateElementFactory', x => x.singleton(TemplateElementFactory));\nconst markupCache = {};\nclass TemplateElementFactory {\n    constructor() {\n        /** @internal */\n        this.p = resolve(IPlatform);\n        /** @internal */\n        this._template = this.t();\n    }\n    t() {\n        return this.p.document.createElement('template');\n    }\n    createTemplate(input) {\n        if (isString(input)) {\n            let result = markupCache[input];\n            if (result === void 0) {\n                const template = this._template;\n                template.innerHTML = input;\n                const node = template.content.firstElementChild;\n                // if the input is either not wrapped in a template or there is more than one node,\n                // return the whole template that wraps it/them (and create a new one for the next input)\n                if (needsWrapping(node)) {\n                    this._template = this.t();\n                    result = template;\n                }\n                else {\n                    // the node to return is both a template and the only node, so return just the node\n                    // and clean up the template for the next input\n                    template.content.removeChild(node);\n                    result = node;\n                }\n                markupCache[input] = result;\n            }\n            return result.cloneNode(true);\n        }\n        if (input.nodeName !== 'TEMPLATE') {\n            // if we get one node that is not a template, wrap it in one\n            const template = this.t();\n            template.content.appendChild(input);\n            return template;\n        }\n        // we got a template element, remove it from the DOM if it's present there and don't\n        // do any other processing\n        input.parentNode?.removeChild(input);\n        return input.cloneNode(true);\n        function needsWrapping(node) {\n            if (node == null)\n                return true;\n            if (node.nodeName !== 'TEMPLATE')\n                return true;\n            // At this point the node is a template element.\n            // If the template has meaningful siblings, then it needs wrapping.\n            // low-hanging fruit: check the next element sibling\n            const nextElementSibling = node.nextElementSibling;\n            if (nextElementSibling != null)\n                return true;\n            // check the previous sibling\n            const prevSibling = node.previousSibling;\n            if (prevSibling != null) {\n                switch (prevSibling.nodeType) {\n                    // The previous sibling cannot be an element, because the node is the first element in the template.\n                    case 3: // Text\n                        return prevSibling.textContent.trim().length > 0;\n                }\n            }\n            // the previous sibling was not meaningful, so check the next sibling\n            const nextSibling = node.nextSibling;\n            if (nextSibling != null) {\n                switch (nextSibling.nodeType) {\n                    // element is already checked above\n                    case 3: // Text\n                        return nextSibling.textContent.trim().length > 0;\n                }\n            }\n            // neither the previous nor the next sibling was meaningful, hence the template does not need wrapping\n            return false;\n        }\n    }\n}\n\n/** @internal */\nconst auLocationStart = 'au-start';\n/** @internal */\nconst auLocationEnd = 'au-end';\n/** @internal */\nconst insertBefore = (parent, newChildNode, target) => {\n    return parent.insertBefore(newChildNode, target);\n};\n/** @internal */\nconst insertManyBefore = (parent, target, newChildNodes) => {\n    if (parent === null) {\n        return;\n    }\n    const ii = newChildNodes.length;\n    let i = 0;\n    while (ii > i) {\n        parent.insertBefore(newChildNodes[i], target);\n        ++i;\n    }\n};\n/** @internal */\nconst appendToTemplate = (parent, child) => {\n    return parent.content.appendChild(child);\n};\n/** @internal */\nconst appendManyToTemplate = (parent, children) => {\n    const ii = children.length;\n    let i = 0;\n    while (ii > i) {\n        parent.content.appendChild(children[i]);\n        ++i;\n    }\n};\n/** @internal */\nconst isElement = (node) => node.nodeType === 1;\n/** @internal */\nconst isTextNode = (node) => node.nodeType === 3;\n\nconst auslotAttr = 'au-slot';\nconst defaultSlotName = 'default';\nconst generateElementName = ((id) => () => `anonymous-${++id}`)(0);\nclass TemplateCompiler {\n    constructor() {\n        this.debug = false;\n        this.resolveResources = true;\n    }\n    compile(definition, container) {\n        if (definition.template == null || definition.needsCompile === false) {\n            return definition;\n        }\n        const context = new CompilationContext(definition, container, null, null, void 0);\n        const template = isString(definition.template) || !definition.enhance\n            ? context._templateFactory.createTemplate(definition.template)\n            : definition.template;\n        const isTemplateElement = template.nodeName === TEMPLATE_NODE_NAME && template.content != null;\n        const content = isTemplateElement ? template.content : template;\n        const hooks = TemplateCompilerHooks.findAll(container);\n        const ii = hooks.length;\n        let i = 0;\n        if (ii > 0) {\n            while (ii > i) {\n                hooks[i].compiling?.(template);\n                ++i;\n            }\n        }\n        if (template.hasAttribute(localTemplateIdentifier)) {\n            throw createMappedError(701 /* ErrorNames.compiler_root_is_local */, definition);\n        }\n        this._compileLocalElement(content, context);\n        this._compileNode(content, context);\n        const compiledDef = {\n            ...definition,\n            name: definition.name || generateElementName(),\n            dependencies: (definition.dependencies ?? emptyArray).concat(context.deps ?? emptyArray),\n            instructions: context.rows,\n            surrogates: isTemplateElement\n                ? this._compileSurrogate(template, context)\n                : emptyArray,\n            template,\n            hasSlots: context.hasSlot,\n            needsCompile: false,\n        };\n        return compiledDef;\n    }\n    compileSpread(requestor, attrSyntaxs, container, target, targetDef) {\n        const context = new CompilationContext(requestor, container, null, null, void 0);\n        const instructions = [];\n        const elDef = targetDef ?? context._findElement(target.nodeName.toLowerCase());\n        const isCustomElement = elDef !== null;\n        const exprParser = context._exprParser;\n        const ii = attrSyntaxs.length;\n        let i = 0;\n        let attrSyntax;\n        let attrDef = null;\n        let attrInstructions;\n        let attrBindableInstructions;\n        let bindablesInfo;\n        let bindable;\n        let primaryBindable;\n        let bindingCommand = null;\n        let expr;\n        let isMultiBindings;\n        let attrTarget;\n        let attrValue;\n        for (; ii > i; ++i) {\n            attrSyntax = attrSyntaxs[i];\n            attrTarget = attrSyntax.target;\n            attrValue = attrSyntax.rawValue;\n            if (attrTarget === '...$attrs') {\n                instructions.push(new SpreadTransferedBindingInstruction());\n                continue;\n            }\n            bindingCommand = context._getCommand(attrSyntax);\n            if (bindingCommand !== null && bindingCommand.ignoreAttr) {\n                // when the binding command overrides everything\n                // just pass the target as is to the binding command, and treat it as a normal attribute:\n                // active.class=\"...\"\n                // background.style=\"...\"\n                // my-attr.attr=\"...\"\n                commandBuildInfo.node = target;\n                commandBuildInfo.attr = attrSyntax;\n                commandBuildInfo.bindable = null;\n                commandBuildInfo.def = null;\n                instructions.push(bindingCommand.build(commandBuildInfo, context._exprParser, context._attrMapper));\n                // to next attribute\n                continue;\n            }\n            if (isCustomElement) {\n                // if the element is a custom element\n                // - prioritize bindables on a custom element before plain attributes\n                bindablesInfo = context._getBindables(elDef);\n                bindable = bindablesInfo.attrs[attrTarget];\n                if (bindable !== void 0) {\n                    if (bindingCommand == null) {\n                        expr = exprParser.parse(attrValue, etInterpolation);\n                        instructions.push(new SpreadElementPropBindingInstruction(expr == null\n                            ? new SetPropertyInstruction(attrValue, bindable.name)\n                            : new InterpolationInstruction(expr, bindable.name)));\n                    }\n                    else {\n                        commandBuildInfo.node = target;\n                        commandBuildInfo.attr = attrSyntax;\n                        commandBuildInfo.bindable = bindable;\n                        commandBuildInfo.def = elDef;\n                        instructions.push(new SpreadElementPropBindingInstruction(bindingCommand.build(commandBuildInfo, context._exprParser, context._attrMapper)));\n                    }\n                    continue;\n                }\n            }\n            attrDef = context._findAttr(attrTarget);\n            if (attrDef !== null) {\n                if (attrDef.isTemplateController) {\n                    throw createMappedError(9998 /* ErrorNames.no_spread_template_controller */, attrTarget);\n                }\n                bindablesInfo = context._getBindables(attrDef);\n                // Custom attributes are always in multiple binding mode,\n                // except when they can't be\n                // When they cannot be:\n                //        * has explicit configuration noMultiBindings: false\n                //        * has binding command, ie: <div my-attr.bind=\"...\">.\n                //          In this scenario, the value of the custom attributes is required to be a valid expression\n                //        * has no colon: ie: <div my-attr=\"abcd\">\n                //          In this scenario, it's simply invalid syntax.\n                //          Consider style attribute rule-value pair: <div style=\"rule: ruleValue\">\n                isMultiBindings = attrDef.noMultiBindings === false\n                    && bindingCommand === null\n                    && hasInlineBindings(attrValue);\n                if (isMultiBindings) {\n                    attrBindableInstructions = this._compileMultiBindings(target, attrValue, attrDef, context);\n                }\n                else {\n                    primaryBindable = bindablesInfo.primary;\n                    // custom attribute + single value + WITHOUT binding command:\n                    // my-attr=\"\"\n                    // my-attr=\"${}\"\n                    if (bindingCommand === null) {\n                        expr = exprParser.parse(attrValue, etInterpolation);\n                        attrBindableInstructions = [\n                            expr === null\n                                ? new SetPropertyInstruction(attrValue, primaryBindable.name)\n                                : new InterpolationInstruction(expr, primaryBindable.name)\n                        ];\n                    }\n                    else {\n                        // custom attribute with binding command:\n                        // my-attr.bind=\"...\"\n                        // my-attr.two-way=\"...\"\n                        commandBuildInfo.node = target;\n                        commandBuildInfo.attr = attrSyntax;\n                        commandBuildInfo.bindable = primaryBindable;\n                        commandBuildInfo.def = attrDef;\n                        attrBindableInstructions = [bindingCommand.build(commandBuildInfo, context._exprParser, context._attrMapper)];\n                    }\n                }\n                (attrInstructions ??= []).push(new HydrateAttributeInstruction(\n                // todo: def/ def.Type or def.name should be configurable\n                //       example: AOT/runtime can use def.Type, but there are situation\n                //       where instructions need to be serialized, def.name should be used\n                this.resolveResources ? attrDef : attrDef.name, attrDef.aliases != null && attrDef.aliases.includes(attrTarget) ? attrTarget : void 0, attrBindableInstructions));\n                continue;\n            }\n            if (bindingCommand == null) {\n                expr = exprParser.parse(attrValue, etInterpolation);\n                // reaching here means:\n                // + maybe a plain attribute with interpolation\n                // + maybe a plain attribute\n                if (expr != null) {\n                    instructions.push(new InterpolationInstruction(expr, \n                    // if not a bindable, then ensure plain attribute are mapped correctly:\n                    // e.g: colspan -> colSpan\n                    //      innerhtml -> innerHTML\n                    //      minlength -> minLength etc...\n                    context._attrMapper.map(target, attrTarget) ?? camelCase(attrTarget)));\n                }\n                else {\n                    switch (attrTarget) {\n                        case 'class':\n                            instructions.push(new SetClassAttributeInstruction(attrValue));\n                            break;\n                        case 'style':\n                            instructions.push(new SetStyleAttributeInstruction(attrValue));\n                            break;\n                        default:\n                            // if not a custom attribute + no binding command + not a bindable + not an interpolation\n                            // then it's just a plain attribute\n                            instructions.push(new SetAttributeInstruction(attrValue, attrTarget));\n                    }\n                }\n            }\n            else {\n                // reaching here means:\n                // + a plain attribute with binding command\n                commandBuildInfo.node = target;\n                commandBuildInfo.attr = attrSyntax;\n                commandBuildInfo.bindable = null;\n                commandBuildInfo.def = null;\n                instructions.push(bindingCommand.build(commandBuildInfo, context._exprParser, context._attrMapper));\n            }\n        }\n        resetCommandBuildInfo();\n        if (attrInstructions != null) {\n            return attrInstructions.concat(instructions);\n        }\n        return instructions;\n    }\n    /** @internal */\n    _compileSurrogate(el, context) {\n        const instructions = [];\n        const attrs = el.attributes;\n        const exprParser = context._exprParser;\n        let ii = attrs.length;\n        let i = 0;\n        let attr;\n        let attrName;\n        let attrValue;\n        let attrSyntax;\n        let attrDef = null;\n        let attrInstructions;\n        let attrBindableInstructions;\n        let bindableInfo;\n        let primaryBindable;\n        let bindingCommand = null;\n        let expr;\n        let isMultiBindings;\n        let realAttrTarget;\n        let realAttrValue;\n        for (; ii > i; ++i) {\n            attr = attrs[i];\n            attrName = attr.name;\n            attrValue = attr.value;\n            attrSyntax = context._attrParser.parse(attrName, attrValue);\n            realAttrTarget = attrSyntax.target;\n            realAttrValue = attrSyntax.rawValue;\n            if (invalidSurrogateAttribute[realAttrTarget]) {\n                throw createMappedError(702 /* ErrorNames.compiler_invalid_surrogate_attr */, attrName);\n            }\n            bindingCommand = context._getCommand(attrSyntax);\n            if (bindingCommand !== null && bindingCommand.ignoreAttr) {\n                // when the binding command overrides everything\n                // just pass the target as is to the binding command, and treat it as a normal attribute:\n                // active.class=\"...\"\n                // background.style=\"...\"\n                // my-attr.attr=\"...\"\n                commandBuildInfo.node = el;\n                commandBuildInfo.attr = attrSyntax;\n                commandBuildInfo.bindable = null;\n                commandBuildInfo.def = null;\n                instructions.push(bindingCommand.build(commandBuildInfo, context._exprParser, context._attrMapper));\n                // to next attribute\n                continue;\n            }\n            attrDef = context._findAttr(realAttrTarget);\n            if (attrDef !== null) {\n                if (attrDef.isTemplateController) {\n                    throw createMappedError(703 /* ErrorNames.compiler_no_tc_on_surrogate */, realAttrTarget);\n                }\n                bindableInfo = context._getBindables(attrDef);\n                // Custom attributes are always in multiple binding mode,\n                // except when they can't be\n                // When they cannot be:\n                //        * has explicit configuration noMultiBindings: false\n                //        * has binding command, ie: <div my-attr.bind=\"...\">.\n                //          In this scenario, the value of the custom attributes is required to be a valid expression\n                //        * has no colon: ie: <div my-attr=\"abcd\">\n                //          In this scenario, it's simply invalid syntax.\n                //          Consider style attribute rule-value pair: <div style=\"rule: ruleValue\">\n                isMultiBindings = attrDef.noMultiBindings === false\n                    && bindingCommand === null\n                    && hasInlineBindings(realAttrValue);\n                if (isMultiBindings) {\n                    attrBindableInstructions = this._compileMultiBindings(el, realAttrValue, attrDef, context);\n                }\n                else {\n                    primaryBindable = bindableInfo.primary;\n                    // custom attribute + single value + WITHOUT binding command:\n                    // my-attr=\"\"\n                    // my-attr=\"${}\"\n                    if (bindingCommand === null) {\n                        expr = exprParser.parse(realAttrValue, etInterpolation);\n                        attrBindableInstructions = expr === null\n                            ? realAttrValue === ''\n                                // when the attribute usage is <div attr>\n                                // it's considered as no bindings\n                                ? []\n                                : [new SetPropertyInstruction(realAttrValue, primaryBindable.name)]\n                            : [new InterpolationInstruction(expr, primaryBindable.name)];\n                    }\n                    else {\n                        // custom attribute with binding command:\n                        // my-attr.bind=\"...\"\n                        // my-attr.two-way=\"...\"\n                        commandBuildInfo.node = el;\n                        commandBuildInfo.attr = attrSyntax;\n                        commandBuildInfo.bindable = primaryBindable;\n                        commandBuildInfo.def = attrDef;\n                        attrBindableInstructions = [bindingCommand.build(commandBuildInfo, context._exprParser, context._attrMapper)];\n                    }\n                }\n                el.removeAttribute(attrName);\n                --i;\n                --ii;\n                (attrInstructions ??= []).push(new HydrateAttributeInstruction(\n                // todo: def/ def.Type or def.name should be configurable\n                //       example: AOT/runtime can use def.Type, but there are situation\n                //       where instructions need to be serialized, def.name should be used\n                this.resolveResources ? attrDef : attrDef.name, attrDef.aliases != null && attrDef.aliases.includes(realAttrTarget) ? realAttrTarget : void 0, attrBindableInstructions));\n                continue;\n            }\n            if (bindingCommand === null) {\n                expr = exprParser.parse(realAttrValue, etInterpolation);\n                if (expr != null) {\n                    el.removeAttribute(attrName);\n                    --i;\n                    --ii;\n                    instructions.push(new InterpolationInstruction(expr, \n                    // if not a bindable, then ensure plain attribute are mapped correctly:\n                    // e.g: colspan -> colSpan\n                    //      innerhtml -> innerHTML\n                    //      minlength -> minLength etc...\n                    context._attrMapper.map(el, realAttrTarget) ?? camelCase(realAttrTarget)));\n                }\n                else {\n                    switch (attrName) {\n                        case 'class':\n                            instructions.push(new SetClassAttributeInstruction(realAttrValue));\n                            break;\n                        case 'style':\n                            instructions.push(new SetStyleAttributeInstruction(realAttrValue));\n                            break;\n                        default:\n                            // if not a custom attribute + no binding command + not a bindable + not an interpolation\n                            // then it's just a plain attribute\n                            instructions.push(new SetAttributeInstruction(realAttrValue, attrName));\n                    }\n                }\n            }\n            else {\n                commandBuildInfo.node = el;\n                commandBuildInfo.attr = attrSyntax;\n                commandBuildInfo.bindable = null;\n                commandBuildInfo.def = null;\n                instructions.push(bindingCommand.build(commandBuildInfo, context._exprParser, context._attrMapper));\n            }\n        }\n        resetCommandBuildInfo();\n        if (attrInstructions != null) {\n            return attrInstructions.concat(instructions);\n        }\n        return instructions;\n    }\n    // overall flow:\n    // each of the method will be responsible for compiling its corresponding node type\n    // and it should return the next node to be compiled\n    /** @internal */\n    _compileNode(node, context) {\n        switch (node.nodeType) {\n            case 1:\n                switch (node.nodeName) {\n                    case 'LET':\n                        return this._compileLet(node, context);\n                    // ------------------------------------\n                    // todo: possible optimization:\n                    // when two conditions below are met:\n                    // 1. there's no attribute on au slot,\n                    // 2. there's no projection\n                    //\n                    // -> flatten the au-slot into children as this is just a static template\n                    // ------------------------------------\n                    // case 'AU-SLOT':\n                    //   return this.auSlot(node as Element, container, context);\n                    default:\n                        return this._compileElement(node, context);\n                }\n            case 3:\n                return this._compileText(node, context);\n            case 11: {\n                let current = node.firstChild;\n                while (current !== null) {\n                    current = this._compileNode(current, context);\n                }\n                break;\n            }\n        }\n        return node.nextSibling;\n    }\n    /** @internal */\n    _compileLet(el, context) {\n        const attrs = el.attributes;\n        const ii = attrs.length;\n        const letInstructions = [];\n        const exprParser = context._exprParser;\n        let toBindingContext = false;\n        let i = 0;\n        let attr;\n        let attrSyntax;\n        let attrName;\n        let attrValue;\n        let bindingCommand;\n        let realAttrTarget;\n        let realAttrValue;\n        let expr;\n        for (; ii > i; ++i) {\n            attr = attrs[i];\n            attrName = attr.name;\n            attrValue = attr.value;\n            if (attrName === 'to-binding-context') {\n                toBindingContext = true;\n                continue;\n            }\n            attrSyntax = context._attrParser.parse(attrName, attrValue);\n            realAttrTarget = attrSyntax.target;\n            realAttrValue = attrSyntax.rawValue;\n            bindingCommand = context._getCommand(attrSyntax);\n            if (bindingCommand !== null) {\n                if (attrSyntax.command === 'bind') {\n                    letInstructions.push(new LetBindingInstruction(exprParser.parse(realAttrValue, etIsProperty), camelCase(realAttrTarget)));\n                }\n                else {\n                    throw createMappedError(704 /* ErrorNames.compiler_invalid_let_command */, attrSyntax);\n                }\n                continue;\n            }\n            expr = exprParser.parse(realAttrValue, etInterpolation);\n            if (expr === null) {\n                {\n                    // eslint-disable-next-line no-console\n                    console.warn(`[DEV:aurelia] Property \"${realAttrTarget}\" is declared with literal string ${realAttrValue}. ` +\n                        `Did you mean ${realAttrTarget}.bind=\"${realAttrValue}\"?`);\n                }\n            }\n            letInstructions.push(new LetBindingInstruction(expr === null ? new PrimitiveLiteralExpression(realAttrValue) : expr, camelCase(realAttrTarget)));\n        }\n        context.rows.push([new HydrateLetElementInstruction(letInstructions, toBindingContext)]);\n        // probably no need to replace\n        // as the let itself can be used as is\n        // though still need to mark el as target to ensure the instruction is matched with a target\n        return this._markAsTarget(el, context).nextSibling;\n    }\n    /** @internal */\n    // eslint-disable-next-line\n    _compileElement(el, context) {\n        // overall, the template compiler does it job by compiling one node,\n        // and let that the process of compiling that node point to the next node to be compiled.\n        // ----------------------------------------\n        // a summary of this 650 line long function:\n        // 1. walk through all attributes to put them into their corresponding instruction groups\n        //    template controllers      -> list 1\n        //    custom attributes         -> list 2\n        //    plain attrs with bindings -> list 3\n        //    el bindables              -> list 4\n        // 2. ensure element instruction is present\n        // 3. sort instructions:\n        //    hydrate custom element instruction\n        //    hydrate custom attribute instructions\n        //    rest kept as is (except special cases & to-be-decided)\n        //    3.1\n        //      mark this element as a target for later hydration\n        // 4. Compiling child nodes of this element\n        //    4.1.\n        //      If 1 or more [Template controller]:\n        //      4.1.1.\n        //          Start processing the most inner (most right TC in list 1) similarly to step 4.2:\n        //          4.1.1.0.\n        //          let innerContext = context.createChild();\n        //          4.1.1.1.\n        //              walks through the child nodes, and perform a [au-slot] check\n        //              - if this is a custom element, then extract all [au-slot] annotated elements into corresponding templates by their target slot name\n        //              - else throw an error as [au-slot] is used on non-custom-element\n        //          4.1.1.2.\n        //              recursively compiles the child nodes into the innerContext\n        //      4.1.2.\n        //          Start processing other Template controllers by walking the TC list (list 1) RIGHT -> LEFT\n        //          Explanation:\n        //              If there' are multiple template controllers on an element,\n        //              only the most inner template controller will have access to the template with the current element\n        //              other \"outer\" template controller will only need to see a marker pointing to a definition of the inner one\n        //    4.2.\n        //      NO [Template controller]\n        //      4.2.1.\n        //          walks through the child nodes, and perform a [au-slot] check\n        //          - if this is a custom element, then extract all [au-slot] annotated elements into corresponding templates by their target slot name\n        //          - else throw an error as [au-slot] is used on non-custom-element\n        //      4.2.2\n        //          recursively compiles the child nodes into the current context\n        // 5. Returning the next node for the compilation\n        const nextSibling = el.nextSibling;\n        const elName = (el.getAttribute('as-element') ?? el.nodeName).toLowerCase();\n        const elDef = context._findElement(elName);\n        const isCustomElement = elDef !== null;\n        const isShadowDom = isCustomElement && elDef.shadowOptions != null;\n        const capture = elDef?.capture;\n        const hasCaptureFilter = capture != null && typeof capture !== 'boolean';\n        const captures = capture ? [] : emptyArray;\n        const exprParser = context._exprParser;\n        const removeAttr = this.debug\n            ? noop\n            : () => {\n                el.removeAttribute(attrName);\n                --i;\n                --ii;\n            };\n        let attrs = el.attributes;\n        let instructions;\n        let ii = attrs.length;\n        let i = 0;\n        let attr;\n        let attrName;\n        let attrValue;\n        let attrSyntax;\n        /**\n         * A list of plain attribute bindings/interpolation bindings\n         */\n        let plainAttrInstructions;\n        let elBindableInstructions;\n        let attrDef = null;\n        let isMultiBindings = false;\n        let bindable;\n        let attrInstructions;\n        let attrBindableInstructions;\n        let tcInstructions;\n        let tcInstruction;\n        let expr;\n        let elementInstruction;\n        let bindingCommand = null;\n        let bindablesInfo;\n        let primaryBindable;\n        let realAttrTarget;\n        let realAttrValue;\n        let processContentResult = true;\n        let hasContainerless = false;\n        let canCapture = false;\n        let needsMarker = false;\n        let elementMetadata;\n        let spreadIndex = 0;\n        if (elName === 'slot') {\n            if (context.root.def.shadowOptions == null) {\n                throw createMappedError(717 /* ErrorNames.compiler_slot_without_shadowdom */, context.root.def.name);\n            }\n            context.root.hasSlot = true;\n        }\n        if (isCustomElement) {\n            elementMetadata = {};\n            // todo: this is a bit ... powerful\n            // maybe do not allow it to process its own attributes\n            processContentResult = elDef.processContent?.call(elDef.Type, el, context.p, elementMetadata);\n            // might have changed during the process\n            attrs = el.attributes;\n            ii = attrs.length;\n        }\n        // 1. walk and compile through all attributes\n        //    for each of them, put in appropriate group.\n        //    ex. plain attr with binding -> plain attr instruction list\n        //        template controller     -> tc instruction list\n        //        custom attribute        -> ca instruction list\n        //        el bindable attribute   -> el bindable instruction list\n        for (; ii > i; ++i) {\n            attr = attrs[i];\n            attrName = attr.name;\n            attrValue = attr.value;\n            switch (attrName) {\n                // ignore these 2 attributes\n                case 'as-element':\n                case 'containerless':\n                    removeAttr();\n                    hasContainerless = hasContainerless || attrName === 'containerless';\n                    continue;\n            }\n            attrSyntax = context._attrParser.parse(attrName, attrValue);\n            bindingCommand = context._getCommand(attrSyntax);\n            realAttrTarget = attrSyntax.target;\n            realAttrValue = attrSyntax.rawValue;\n            if (capture && (!hasCaptureFilter || hasCaptureFilter && capture(realAttrTarget))) {\n                if (bindingCommand != null && bindingCommand.ignoreAttr) {\n                    removeAttr();\n                    captures.push(attrSyntax);\n                    continue;\n                }\n                canCapture = realAttrTarget !== auslotAttr\n                    && realAttrTarget !== 'slot'\n                    && ((spreadIndex = realAttrTarget.indexOf('...')) === -1\n                        // the following condition will allow syntaxes:\n                        // ...$bindables\n                        // ...some.expression\n                        || (spreadIndex === 0 && (realAttrTarget === '...$attrs')));\n                if (canCapture) {\n                    bindablesInfo = context._getBindables(elDef);\n                    // if capture is on, capture everything except:\n                    // - as-element\n                    // - containerless\n                    // - bindable properties\n                    // - template controller\n                    if (bindablesInfo.attrs[realAttrTarget] == null && !context._findAttr(realAttrTarget)?.isTemplateController) {\n                        removeAttr();\n                        captures.push(attrSyntax);\n                        continue;\n                    }\n                }\n            }\n            if (realAttrTarget === '...$attrs') {\n                (plainAttrInstructions ??= []).push(new SpreadTransferedBindingInstruction());\n                removeAttr();\n                continue;\n            }\n            if (bindingCommand?.ignoreAttr) {\n                // when the binding command overrides everything\n                // just pass the target as is to the binding command, and treat it as a normal attribute:\n                // active.class=\"...\"\n                // background.style=\"...\"\n                // my-attr.attr=\"...\"\n                commandBuildInfo.node = el;\n                commandBuildInfo.attr = attrSyntax;\n                commandBuildInfo.bindable = null;\n                commandBuildInfo.def = null;\n                (plainAttrInstructions ??= []).push(bindingCommand.build(commandBuildInfo, context._exprParser, context._attrMapper));\n                removeAttr();\n                // to next attribute\n                continue;\n            }\n            if (realAttrTarget.indexOf('...') === 0) {\n                if (isCustomElement && (realAttrTarget = realAttrTarget.slice(3)) !== '$element') {\n                    (elBindableInstructions ??= []).push(new SpreadValueBindingInstruction('$bindables', realAttrTarget === '$bindables' ? realAttrValue : realAttrTarget));\n                    removeAttr();\n                    continue;\n                }\n                {\n                    if (realAttrTarget === '$bindable' || realAttrTarget === 'bindables') {\n                        // eslint-disable-next-line no-console\n                        console.warn(`[DEV:aurelia] Detected usage of ${realAttrTarget} on <${el.nodeName}>, did you mean \"$bindables\"?`);\n                    }\n                }\n                throw createMappedError(720 /* ErrorNames.compiler_no_reserved_spread_syntax */, realAttrTarget);\n            }\n            // reaching here means:\n            // + there may or may not be a binding command, but it won't be an overriding command\n            if (isCustomElement) {\n                // if the element is a custom element\n                // - prioritize bindables on a custom element before plain attributes\n                bindablesInfo = context._getBindables(elDef);\n                bindable = bindablesInfo.attrs[realAttrTarget];\n                if (bindable !== void 0) {\n                    if (bindingCommand === null) {\n                        expr = exprParser.parse(realAttrValue, etInterpolation);\n                        (elBindableInstructions ??= []).push(expr == null\n                            ? new SetPropertyInstruction(realAttrValue, bindable.name)\n                            : new InterpolationInstruction(expr, bindable.name));\n                    }\n                    else {\n                        commandBuildInfo.node = el;\n                        commandBuildInfo.attr = attrSyntax;\n                        commandBuildInfo.bindable = bindable;\n                        commandBuildInfo.def = elDef;\n                        (elBindableInstructions ??= []).push(bindingCommand.build(commandBuildInfo, context._exprParser, context._attrMapper));\n                    }\n                    removeAttr();\n                    {\n                        attrDef = context._findAttr(realAttrTarget);\n                        if (attrDef !== null) {\n                            // eslint-disable-next-line no-console\n                            console.warn(`[DEV:aurelia] Binding with bindable \"${realAttrTarget}\" on custom element \"${elDef.name}\" is ambiguous.` +\n                                `There is a custom attribute with the same name.`);\n                        }\n                    }\n                    continue;\n                }\n                if (realAttrTarget === '$bindables') {\n                    if (bindingCommand != null) {\n                        commandBuildInfo.node = el;\n                        commandBuildInfo.attr = attrSyntax;\n                        commandBuildInfo.bindable = null;\n                        commandBuildInfo.def = elDef;\n                        {\n                            const instruction = bindingCommand.build(commandBuildInfo, context._exprParser, context._attrMapper);\n                            if (!(instruction instanceof SpreadValueBindingInstruction)) {\n                                // eslint-disable-next-line no-console\n                                console.warn(`[DEV:aurelia] Binding with \"$bindables\" on custom element \"${elDef.name}\" with command ${attrSyntax.command} ` +\n                                    ` did not result in a spread binding instruction. This likely won't work as expected.`);\n                            }\n                            (elBindableInstructions ??= []).push(instruction);\n                        }\n                    }\n                    else {\n                        // eslint-disable-next-line no-console\n                        console.warn(`[DEV:aurelia] Usage of \"$bindables\" on custom element \"<${elDef.name}>\" is ignored.`);\n                    }\n                    removeAttr();\n                    continue;\n                }\n            }\n            if (realAttrTarget === '$bindables') {\n                throw createMappedError(721 /* ErrorNames.compiler_no_reserved_$bindable */, el.nodeName, realAttrTarget, realAttrValue);\n            }\n            // reaching here means:\n            // + there may or may not be a binding command, but it won't be an overriding command\n            // + the attribute is not targeting a bindable property of a custom element\n            //\n            // + maybe it's a custom attribute\n            // + maybe it's a plain attribute\n            // check for custom attributes before plain attributes\n            attrDef = context._findAttr(realAttrTarget);\n            if (attrDef !== null) {\n                bindablesInfo = context._getBindables(attrDef);\n                // Custom attributes are always in multiple binding mode,\n                // except when they can't be\n                // When they cannot be:\n                //        * has explicit configuration noMultiBindings: false\n                //        * has binding command, ie: <div my-attr.bind=\"...\">.\n                //          In this scenario, the value of the custom attributes is required to be a valid expression\n                //        * has no colon: ie: <div my-attr=\"abcd\">\n                //          In this scenario, it's simply invalid syntax.\n                //          Consider style attribute rule-value pair: <div style=\"rule: ruleValue\">\n                isMultiBindings = attrDef.noMultiBindings === false\n                    && bindingCommand === null\n                    && hasInlineBindings(realAttrValue);\n                if (isMultiBindings) {\n                    attrBindableInstructions = this._compileMultiBindings(el, realAttrValue, attrDef, context);\n                }\n                else {\n                    primaryBindable = bindablesInfo.primary;\n                    // custom attribute + single value + WITHOUT binding command:\n                    // my-attr=\"\"\n                    // my-attr=\"${}\"\n                    if (bindingCommand === null) {\n                        expr = exprParser.parse(realAttrValue, etInterpolation);\n                        attrBindableInstructions = expr === null\n                            ? realAttrValue === ''\n                                // when the attribute usage is <div attr>\n                                // it's considered as no bindings\n                                ? []\n                                : [new SetPropertyInstruction(realAttrValue, primaryBindable.name)]\n                            : [new InterpolationInstruction(expr, primaryBindable.name)];\n                    }\n                    else {\n                        // custom attribute with binding command:\n                        // my-attr.bind=\"...\"\n                        // my-attr.two-way=\"...\"\n                        commandBuildInfo.node = el;\n                        commandBuildInfo.attr = attrSyntax;\n                        commandBuildInfo.bindable = primaryBindable;\n                        commandBuildInfo.def = attrDef;\n                        attrBindableInstructions = [bindingCommand.build(commandBuildInfo, context._exprParser, context._attrMapper)];\n                    }\n                }\n                removeAttr();\n                if (attrDef.isTemplateController) {\n                    (tcInstructions ??= []).push(new HydrateTemplateController(voidDefinition, \n                    // todo: def/ def.Type or def.name should be configurable\n                    //       example: AOT/runtime can use def.Type, but there are situation\n                    //       where instructions need to be serialized, def.name should be used\n                    this.resolveResources ? attrDef : attrDef.name, void 0, attrBindableInstructions));\n                }\n                else {\n                    (attrInstructions ??= []).push(new HydrateAttributeInstruction(\n                    // todo: def/ def.Type or def.name should be configurable\n                    //       example: AOT/runtime can use def.Type, but there are situation\n                    //       where instructions need to be serialized, def.name should be used\n                    this.resolveResources ? attrDef : attrDef.name, attrDef.aliases != null && attrDef.aliases.includes(realAttrTarget) ? realAttrTarget : void 0, attrBindableInstructions));\n                }\n                continue;\n            }\n            // reaching here means:\n            // + it's a plain attribute\n            // + there may or may not be a binding command, but it won't be an overriding command\n            if (bindingCommand === null) {\n                // reaching here means:\n                // + maybe a plain attribute with interpolation\n                // + maybe a plain attribute\n                expr = exprParser.parse(realAttrValue, etInterpolation);\n                if (expr != null) {\n                    // if it's an interpolation, remove the attribute\n                    removeAttr();\n                    (plainAttrInstructions ??= []).push(new InterpolationInstruction(expr, \n                    // if not a bindable, then ensure plain attribute are mapped correctly:\n                    // e.g: colspan -> colSpan\n                    //      innerhtml -> innerHTML\n                    //      minlength -> minLength etc...\n                    context._attrMapper.map(el, realAttrTarget) ?? camelCase(realAttrTarget)));\n                }\n                continue;\n            }\n            // reaching here means:\n            // + has binding command\n            // + not an overriding binding command\n            // + not a custom attribute\n            // + not a custom element bindable\n            commandBuildInfo.node = el;\n            commandBuildInfo.attr = attrSyntax;\n            commandBuildInfo.bindable = null;\n            commandBuildInfo.def = null;\n            (plainAttrInstructions ??= []).push(bindingCommand.build(commandBuildInfo, context._exprParser, context._attrMapper));\n            removeAttr();\n        }\n        resetCommandBuildInfo();\n        if (this._shouldReorderAttrs(el, plainAttrInstructions) && plainAttrInstructions != null && plainAttrInstructions.length > 1) {\n            this._reorder(el, plainAttrInstructions);\n        }\n        // 2. ensure that element instruction is present if this element is a custom element\n        if (isCustomElement) {\n            elementInstruction = new HydrateElementInstruction(\n            // todo: def/ def.Type or def.name should be configurable\n            //       example: AOT/runtime can use def.Type, but there are situation\n            //       where instructions need to be serialized, def.name should be used\n            this.resolveResources ? elDef : elDef.name, (elBindableInstructions ?? emptyArray), null, hasContainerless, captures, elementMetadata);\n        }\n        // 3. merge and sort all instructions into a single list\n        //    as instruction list for this element\n        if (plainAttrInstructions != null\n            || elementInstruction != null\n            || attrInstructions != null) {\n            instructions = emptyArray.concat(elementInstruction ?? emptyArray, attrInstructions ?? emptyArray, plainAttrInstructions ?? emptyArray);\n            // 3.1 mark as template for later hydration\n            // this._markAsTarget(el, context);\n            needsMarker = true;\n        }\n        // 4. compiling child nodes\n        let shouldCompileContent;\n        if (tcInstructions != null) {\n            // 4.1 if there is 1 or more [Template controller]\n            ii = tcInstructions.length - 1;\n            i = ii;\n            tcInstruction = tcInstructions[i];\n            let template;\n            if (isMarker(el)) {\n                template = context.t();\n                appendManyToTemplate(template, [\n                    // context.h(MARKER_NODE_NAME),\n                    context._marker(),\n                    context._comment(auLocationStart),\n                    context._comment(auLocationEnd),\n                ]);\n            }\n            else {\n                // assumption: el.parentNode is not null\n                // but not always the case: e.g compile/enhance an element without parent with TC on it\n                this._replaceByMarker(el, context);\n                if (el.nodeName === 'TEMPLATE') {\n                    template = el;\n                }\n                else {\n                    template = context.t();\n                    appendToTemplate(template, el);\n                }\n            }\n            const mostInnerTemplate = template;\n            // 4.1.1.0. prepare child context for the inner template compilation\n            const childContext = context._createChild(instructions == null ? [] : [instructions]);\n            let childEl;\n            let targetSlot;\n            let hasAuSlot = false;\n            let projections;\n            let slotTemplateRecord;\n            let slotTemplates;\n            let slotTemplate;\n            let marker;\n            let projectionCompilationContext;\n            let j = 0, jj = 0;\n            // 4.1.1.1.\n            //  walks through the child nodes, and perform [au-slot] check\n            //  note: this is a bit different with the summary above, possibly wrong since it will not throw\n            //        on [au-slot] used on a non-custom-element + with a template controller on it\n            // for each child element of a custom element\n            // scan for [au-slot], if there's one\n            // then extract the element into a projection definition\n            // this allows support for [au-slot] declared on the same element with anther template controller\n            // e.g:\n            //\n            // can do:\n            //  <my-el>\n            //    <div au-slot if.bind=\"...\"></div>\n            //    <div if.bind=\"...\" au-slot></div>\n            //  </my-el>\n            //\n            // instead of:\n            //  <my-el>\n            //    <template au-slot><div if.bind=\"...\"></div>\n            //  </my-el>\n            let child = el.firstChild;\n            let isEmptyTextNode = false;\n            if (processContentResult !== false) {\n                while (child !== null) {\n                    targetSlot = isElement(child) ? child.getAttribute(auslotAttr) : null;\n                    hasAuSlot = targetSlot !== null || isCustomElement && !isShadowDom;\n                    childEl = child.nextSibling;\n                    if (hasAuSlot) {\n                        if (!isCustomElement) {\n                            throw createMappedError(706 /* ErrorNames.compiler_au_slot_on_non_element */, targetSlot, elName);\n                        }\n                        child.removeAttribute?.(auslotAttr);\n                        // ignore all whitespace\n                        isEmptyTextNode = isTextNode(child) && child.textContent.trim() === '';\n                        if (!isEmptyTextNode) {\n                            ((slotTemplateRecord ??= {})[targetSlot || defaultSlotName] ??= []).push(child);\n                        }\n                        el.removeChild(child);\n                    }\n                    child = childEl;\n                }\n            }\n            if (slotTemplateRecord != null) {\n                projections = {};\n                // aggregate all content targeting the same slot\n                // into a single template\n                // with some special rule around <template> element\n                for (targetSlot in slotTemplateRecord) {\n                    template = context.t();\n                    slotTemplates = slotTemplateRecord[targetSlot];\n                    for (j = 0, jj = slotTemplates.length; jj > j; ++j) {\n                        slotTemplate = slotTemplates[j];\n                        if (slotTemplate.nodeName === 'TEMPLATE') {\n                            // this means user has some thing more than [au-slot] on a template\n                            // consider this intentional, and use it as is\n                            // e.g:\n                            // case 1\n                            // <my-element>\n                            //   <template au-slot repeat.for=\"i of items\">\n                            // ----vs----\n                            // case 2\n                            // <my-element>\n                            //   <template au-slot>this is just some static stuff <b>And a b</b></template>\n                            if (slotTemplate.attributes.length > 0) {\n                                // case 1\n                                appendToTemplate(template, slotTemplate);\n                            }\n                            else {\n                                // case 2\n                                appendToTemplate(template, slotTemplate.content);\n                            }\n                        }\n                        else {\n                            appendToTemplate(template, slotTemplate);\n                        }\n                    }\n                    // after aggregating all the [au-slot] templates into a single one\n                    // compile it\n                    // technically, the most inner template controller compilation context\n                    // is the parent of this compilation context\n                    // but for simplicity in compilation, maybe start with a flatter hierarchy\n                    // also, it wouldn't have any real uses\n                    projectionCompilationContext = context._createChild();\n                    this._compileNode(template.content, projectionCompilationContext);\n                    projections[targetSlot] = {\n                        name: generateElementName(),\n                        type: definitionTypeElement,\n                        template,\n                        instructions: projectionCompilationContext.rows,\n                        needsCompile: false,\n                    };\n                }\n                elementInstruction.projections = projections;\n            }\n            if (needsMarker) {\n                if (isCustomElement && (hasContainerless || elDef.containerless)) {\n                    this._replaceByMarker(el, context);\n                }\n                else {\n                    this._markAsTarget(el, context);\n                }\n            }\n            shouldCompileContent = !isCustomElement || !elDef.containerless && !hasContainerless && processContentResult !== false;\n            if (shouldCompileContent) {\n                // 4.1.1.2:\n                //  recursively compiles the child nodes into the inner context\n                // important:\n                // ======================\n                // only goes inside a template, if there is a template controller on it\n                // otherwise, leave it alone\n                if (el.nodeName === TEMPLATE_NODE_NAME) {\n                    this._compileNode(el.content, childContext);\n                }\n                else {\n                    child = el.firstChild;\n                    while (child !== null) {\n                        child = this._compileNode(child, childContext);\n                    }\n                }\n            }\n            tcInstruction.def = {\n                name: generateElementName(),\n                type: definitionTypeElement,\n                template: mostInnerTemplate,\n                instructions: childContext.rows,\n                needsCompile: false,\n            };\n            // 4.1.2.\n            //  Start processing other Template controllers by walking the TC list (list 1) RIGHT -> LEFT\n            while (i-- > 0) {\n                // for each of the template controller from [right] to [left]\n                // do create:\n                // (1) a template\n                // (2) add a marker to the template\n                // (3) an instruction\n                // instruction will be corresponded to the marker\n                // =========================\n                tcInstruction = tcInstructions[i];\n                template = context.t();\n                // appending most inner template is inaccurate, as the most outer one\n                // is not really the parent of the most inner one\n                // but it's only for the purpose of creating a marker,\n                // so it's just an optimization hack\n                // marker = this._markAsTarget(context.h(MARKER_NODE_NAME));\n                // marker = context.h(MARKER_NODE_NAME);\n                marker = context._marker();\n                appendManyToTemplate(template, [\n                    marker,\n                    context._comment(auLocationStart),\n                    context._comment(auLocationEnd),\n                ]);\n                tcInstruction.def = {\n                    name: generateElementName(),\n                    type: definitionTypeElement,\n                    template,\n                    needsCompile: false,\n                    instructions: [[tcInstructions[i + 1]]],\n                };\n            }\n            // the most outer template controller should be\n            // the only instruction for peek instruction of the current context\n            // e.g\n            // <div if.bind=\"yes\" with.bind=\"scope\" repeat.for=\"i of items\" data-id=\"i.id\">\n            // results in:\n            // -----------\n            //\n            //  TC(if-[value=yes])\n            //    | TC(with-[value=scope])\n            //        | TC(repeat-[...])\n            //            | div(data-id-[value=i.id])\n            context.rows.push([tcInstruction]);\n        }\n        else {\n            // 4.2\n            //\n            // if there's no template controller\n            // then the instruction built is appropriate to be assigned as the peek row\n            // and before the children compilation\n            if (instructions != null) {\n                context.rows.push(instructions);\n            }\n            let child = el.firstChild;\n            let childEl;\n            let targetSlot;\n            let hasAuSlot = false;\n            let projections = null;\n            let slotTemplateRecord;\n            let slotTemplates;\n            let slotTemplate;\n            let template;\n            let projectionCompilationContext;\n            let isEmptyTextNode = false;\n            let j = 0, jj = 0;\n            // 4.2.1.\n            //    walks through the child nodes and perform [au-slot] check\n            // --------------------\n            // for each child element of a custom element\n            // scan for [au-slot], if there's one\n            // then extract the element into a projection definition\n            // this allows support for [au-slot] declared on the same element with anther template controller\n            // e.g:\n            //\n            // can do:\n            //  <my-el>\n            //    <div au-slot if.bind=\"...\"></div>\n            //    <div if.bind=\"...\" au-slot></div>\n            //  </my-el>\n            //\n            // instead of:\n            //  <my-el>\n            //    <template au-slot><div if.bind=\"...\"></div>\n            //  </my-el>\n            if (processContentResult !== false) {\n                while (child !== null) {\n                    targetSlot = isElement(child) ? child.getAttribute(auslotAttr) : null;\n                    hasAuSlot = targetSlot !== null || isCustomElement && !isShadowDom;\n                    childEl = child.nextSibling;\n                    if (hasAuSlot) {\n                        if (!isCustomElement) {\n                            throw createMappedError(706 /* ErrorNames.compiler_au_slot_on_non_element */, targetSlot, elName);\n                        }\n                        child.removeAttribute?.(auslotAttr);\n                        // ignore all whitespace\n                        isEmptyTextNode = isTextNode(child) && child.textContent.trim() === '';\n                        if (!isEmptyTextNode) {\n                            ((slotTemplateRecord ??= {})[targetSlot || defaultSlotName] ??= []).push(child);\n                        }\n                        el.removeChild(child);\n                    }\n                    child = childEl;\n                }\n            }\n            if (slotTemplateRecord != null) {\n                projections = {};\n                // aggregate all content targeting the same slot\n                // into a single template\n                // with some special rule around <template> element\n                for (targetSlot in slotTemplateRecord) {\n                    template = context.t();\n                    slotTemplates = slotTemplateRecord[targetSlot];\n                    for (j = 0, jj = slotTemplates.length; jj > j; ++j) {\n                        slotTemplate = slotTemplates[j];\n                        if (slotTemplate.nodeName === TEMPLATE_NODE_NAME) {\n                            // this means user has some thing more than [au-slot] on a template\n                            // consider this intentional, and use it as is\n                            // e.g:\n                            // case 1\n                            // <my-element>\n                            //   <template au-slot repeat.for=\"i of items\">\n                            // ----vs----\n                            // case 2\n                            // <my-element>\n                            //   <template au-slot>this is just some static stuff <b>And a b</b></template>\n                            if (slotTemplate.attributes.length > 0) {\n                                // case 1\n                                appendToTemplate(template, slotTemplate);\n                            }\n                            else {\n                                // case 2\n                                appendToTemplate(template, slotTemplate.content);\n                            }\n                        }\n                        else {\n                            appendToTemplate(template, slotTemplate);\n                        }\n                    }\n                    // after aggregating all the [au-slot] templates into a single one\n                    // compile it\n                    projectionCompilationContext = context._createChild();\n                    this._compileNode(template.content, projectionCompilationContext);\n                    projections[targetSlot] = {\n                        name: generateElementName(),\n                        type: definitionTypeElement,\n                        template,\n                        instructions: projectionCompilationContext.rows,\n                        needsCompile: false,\n                    };\n                }\n                elementInstruction.projections = projections;\n            }\n            if (needsMarker) {\n                if (isCustomElement && (hasContainerless || elDef.containerless)) {\n                    this._replaceByMarker(el, context);\n                }\n                else {\n                    this._markAsTarget(el, context);\n                }\n            }\n            shouldCompileContent = !isCustomElement || !elDef.containerless && !hasContainerless && processContentResult !== false;\n            if (shouldCompileContent && el.childNodes.length > 0) {\n                // 4.2.2\n                //    recursively compiles the child nodes into current context\n                child = el.firstChild;\n                while (child !== null) {\n                    child = this._compileNode(child, context);\n                }\n            }\n        }\n        // 5. returns the next node to be compiled\n        return nextSibling;\n    }\n    /** @internal */\n    _compileText(node, context) {\n        const parent = node.parentNode;\n        const expr = context._exprParser.parse(node.textContent, etInterpolation);\n        const next = node.nextSibling;\n        let parts;\n        let expressions;\n        let i;\n        let ii;\n        let part;\n        if (expr !== null) {\n            ({ parts, expressions } = expr);\n            // foreach normal part, turn into a standard text node\n            if ((part = parts[0])) {\n                insertBefore(parent, context._text(part), node);\n            }\n            for (i = 0, ii = expressions.length; ii > i; ++i) {\n                // foreach expression part, turn into a marker\n                insertManyBefore(parent, node, [\n                    // context.h(MARKER_NODE_NAME),\n                    context._marker(),\n                    // empty text node will not be cloned when doing fragment.cloneNode()\n                    // so give it an empty space instead\n                    context._text(' '),\n                ]);\n                // foreach normal part, turn into a standard text node\n                if ((part = parts[i + 1])) {\n                    insertBefore(parent, context._text(part), node);\n                }\n                // and the corresponding instruction\n                context.rows.push([new TextBindingInstruction(expressions[i])]);\n            }\n            parent.removeChild(node);\n        }\n        return next;\n    }\n    /** @internal */\n    _compileMultiBindings(node, attrRawValue, attrDef, context) {\n        // custom attribute + multiple values:\n        // my-attr=\"prop1: literal1 prop2.bind: ...; prop3: literal3\"\n        // my-attr=\"prop1.bind: ...; prop2.bind: ...\"\n        // my-attr=\"prop1: ${}; prop2.bind: ...; prop3: ${}\"\n        const bindableAttrsInfo = context._getBindables(attrDef);\n        const valueLength = attrRawValue.length;\n        const instructions = [];\n        let attrName = void 0;\n        let attrValue = void 0;\n        let start = 0;\n        let ch = 0;\n        let expr;\n        let attrSyntax;\n        let command;\n        let bindable;\n        for (let i = 0; i < valueLength; ++i) {\n            ch = attrRawValue.charCodeAt(i);\n            if (ch === 92 /* Char.Backslash */) {\n                ++i;\n                // Ignore whatever comes next because it's escaped\n            }\n            else if (ch === 58 /* Char.Colon */) {\n                attrName = attrRawValue.slice(start, i);\n                // Skip whitespace after colon\n                while (attrRawValue.charCodeAt(++i) <= 32 /* Char.Space */)\n                    ;\n                start = i;\n                for (; i < valueLength; ++i) {\n                    ch = attrRawValue.charCodeAt(i);\n                    if (ch === 92 /* Char.Backslash */) {\n                        ++i;\n                        // Ignore whatever comes next because it's escaped\n                    }\n                    else if (ch === 59 /* Char.Semicolon */) {\n                        attrValue = attrRawValue.slice(start, i);\n                        break;\n                    }\n                }\n                if (attrValue === void 0) {\n                    // No semicolon found, so just grab the rest of the value\n                    attrValue = attrRawValue.slice(start);\n                }\n                attrSyntax = context._attrParser.parse(attrName, attrValue);\n                // ================================================\n                // todo: should it always camel case???\n                // const attrTarget = camelCase(attrSyntax.target);\n                // ================================================\n                command = context._getCommand(attrSyntax);\n                bindable = bindableAttrsInfo.attrs[attrSyntax.target];\n                if (bindable == null) {\n                    throw createMappedError(707 /* ErrorNames.compiler_binding_to_non_bindable */, attrSyntax.target, attrDef.name);\n                }\n                if (command === null) {\n                    expr = context._exprParser.parse(attrValue, etInterpolation);\n                    instructions.push(expr === null\n                        ? new SetPropertyInstruction(attrValue, bindable.name)\n                        : new InterpolationInstruction(expr, bindable.name));\n                }\n                else {\n                    commandBuildInfo.node = node;\n                    commandBuildInfo.attr = attrSyntax;\n                    commandBuildInfo.bindable = bindable;\n                    commandBuildInfo.def = attrDef;\n                    instructions.push(command.build(commandBuildInfo, context._exprParser, context._attrMapper));\n                }\n                // Skip whitespace after semicolon\n                while (i < valueLength && attrRawValue.charCodeAt(++i) <= 32 /* Char.Space */)\n                    ;\n                start = i;\n                attrName = void 0;\n                attrValue = void 0;\n            }\n        }\n        resetCommandBuildInfo();\n        return instructions;\n    }\n    /** @internal */\n    _compileLocalElement(template, context) {\n        const elName = context.root.def.name;\n        const root = template;\n        const localTemplates = toArray(root.querySelectorAll('template[as-custom-element]'));\n        const numLocalTemplates = localTemplates.length;\n        if (numLocalTemplates === 0) {\n            return;\n        }\n        if (numLocalTemplates === root.childElementCount) {\n            throw createMappedError(708 /* ErrorNames.compiler_template_only_local_template */, elName);\n        }\n        const localTemplateNames = new Set();\n        const localElementTypes = [];\n        for (const localTemplate of localTemplates) {\n            if (localTemplate.parentNode !== root) {\n                throw createMappedError(709 /* ErrorNames.compiler_local_el_not_under_root */, elName);\n            }\n            const name = processTemplateName(elName, localTemplate, localTemplateNames);\n            const content = localTemplate.content;\n            const bindableEls = toArray(content.querySelectorAll('bindable'));\n            const properties = new Set();\n            const attributes = new Set();\n            const bindables = bindableEls.reduce((allBindables, bindableEl) => {\n                if (bindableEl.parentNode !== content) {\n                    throw createMappedError(710 /* ErrorNames.compiler_local_el_bindable_not_under_root */, name);\n                }\n                const property = bindableEl.getAttribute(\"name\" /* LocalTemplateBindableAttributes.name */);\n                if (property === null) {\n                    throw createMappedError(711 /* ErrorNames.compiler_local_el_bindable_name_missing */, bindableEl, name);\n                }\n                const attribute = bindableEl.getAttribute(\"attribute\" /* LocalTemplateBindableAttributes.attribute */);\n                if (attribute !== null\n                    && attributes.has(attribute)\n                    || properties.has(property)) {\n                    throw createMappedError(712 /* ErrorNames.compiler_local_el_bindable_duplicate */, properties, attribute);\n                }\n                else {\n                    if (attribute !== null) {\n                        attributes.add(attribute);\n                    }\n                    properties.add(property);\n                }\n                const ignoredAttributes = toArray(bindableEl.attributes).filter((attr) => !allowedLocalTemplateBindableAttributes.includes(attr.name));\n                if (ignoredAttributes.length > 0) {\n                    console.warn(`[DEV:aurelia] The attribute(s) ${ignoredAttributes.map(attr => attr.name).join(', ')} will be ignored for ${bindableEl.outerHTML}. Only ${allowedLocalTemplateBindableAttributes.join(', ')} are processed.`);\n                }\n                bindableEl.remove();\n                allBindables[property] = {\n                    name: property,\n                    attribute: attribute ?? void 0,\n                    mode: bindableEl.getAttribute(\"mode\" /* LocalTemplateBindableAttributes.mode */) ?? 'default'\n                };\n                return allBindables;\n            }, {});\n            class LocalDepType {\n            }\n            LocalDepType.$au = {\n                type: definitionTypeElement,\n                name,\n                template: localTemplate,\n                bindables,\n            };\n            Reflect.defineProperty(LocalDepType, 'name', { value: pascalCase(name) });\n            localElementTypes.push(LocalDepType);\n            root.removeChild(localTemplate);\n        }\n        // if we have a template like this\n        //\n        // my-app.html\n        // <template as-custom-element=\"le-1\">\n        //  <le-2></le-2>\n        // </template>\n        // <template as-custom-element=\"le-2\">...</template>\n        //\n        // without registering dependencies properly, <le-1> will not see <le-2> as a custom element\n        const compilationDeps = (context.root.def.dependencies ?? []).concat(context.root.def.Type == null ? emptyArray : [context.root.def.Type]);\n        for (const localElementType of localElementTypes) {\n            localElementType.dependencies = compilationDeps.concat(localElementTypes.filter(d => d !== localElementType));\n            context._addLocalDep(localElementType);\n        }\n    }\n    /** @internal */\n    _shouldReorderAttrs(el, instructions) {\n        const nodeName = el.nodeName;\n        return nodeName === 'INPUT' && orderSensitiveInputType[el.type] === 1\n            || nodeName === 'SELECT' && (el.hasAttribute('multiple')\n                || instructions?.some(i => i.type === propertyBinding && i.to === 'multiple'));\n    }\n    /** @internal */\n    _reorder(el, instructions) {\n        switch (el.nodeName) {\n            case 'INPUT': {\n                const _instructions = instructions;\n                // swap the order of checked and model/value attribute,\n                // so that the required observers are prepared for checked-observer\n                let modelOrValueOrMatcherIndex = void 0;\n                let checkedIndex = void 0;\n                let found = 0;\n                let instruction;\n                for (let i = 0; i < _instructions.length && found < 3; i++) {\n                    instruction = _instructions[i];\n                    switch (instruction.to) {\n                        case 'model':\n                        case 'value':\n                        case 'matcher':\n                            modelOrValueOrMatcherIndex = i;\n                            found++;\n                            break;\n                        case 'checked':\n                            checkedIndex = i;\n                            found++;\n                            break;\n                    }\n                }\n                if (checkedIndex !== void 0 && modelOrValueOrMatcherIndex !== void 0 && checkedIndex < modelOrValueOrMatcherIndex) {\n                    [_instructions[modelOrValueOrMatcherIndex], _instructions[checkedIndex]] = [_instructions[checkedIndex], _instructions[modelOrValueOrMatcherIndex]];\n                }\n                break;\n            }\n            case 'SELECT': {\n                const _instructions = instructions;\n                let valueIndex = 0;\n                let multipleIndex = 0;\n                // a variable to stop the loop as soon as we find both value & multiple binding indices\n                let found = 0;\n                let instruction;\n                // swap the order of multiple and value bindings\n                for (let i = 0; i < _instructions.length && found < 2; ++i) {\n                    instruction = _instructions[i];\n                    switch (instruction.to) {\n                        case 'multiple':\n                            multipleIndex = i;\n                            found++;\n                            break;\n                        case 'value':\n                            valueIndex = i;\n                            found++;\n                            break;\n                    }\n                    if (found === 2 && valueIndex < multipleIndex) {\n                        [_instructions[multipleIndex], _instructions[valueIndex]] = [_instructions[valueIndex], _instructions[multipleIndex]];\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * Mark an element as target with a special css class\n     * and return it\n     *\n     * @internal\n     */\n    _markAsTarget(el, context) {\n        insertBefore(el.parentNode, context._comment('au*'), el);\n        // el.classList.add('au');\n        return el;\n    }\n    /**\n     * Replace an element with a marker, and return the marker\n     *\n     * @internal\n     */\n    _replaceByMarker(node, context) {\n        if (isMarker(node)) {\n            return node;\n        }\n        // todo: assumption made: parentNode won't be null\n        const parent = node.parentNode;\n        // const marker = this._markAsTarget(context.h(MARKER_NODE_NAME));\n        const marker = context._marker();\n        // insertBefore(parent, marker, node);\n        insertManyBefore(parent, node, [\n            marker,\n            context._comment(auLocationStart),\n            context._comment(auLocationEnd),\n        ]);\n        parent.removeChild(node);\n        return marker;\n    }\n}\nTemplateCompiler.register = createImplementationRegister(ITemplateCompiler);\nconst TEMPLATE_NODE_NAME = 'TEMPLATE';\nconst isMarker = (el) => el.nodeValue === 'au*';\n// && isComment(nextSibling = el.nextSibling) && nextSibling.textContent === auStartComment\n// && isComment(nextSibling = el.nextSibling) && nextSibling.textContent === auEndComment;\n// const isComment = (el: Node | null): el is Comment => el?.nodeType === 8;\n// this class is intended to be an implementation encapsulating the information at the root level of a template\n// this works at the time this is created because everything inside a template should be retrieved\n// from the root itself.\n// if anytime in the future, where it's desirable to retrieve information from somewhere other than root\n// then consider dropping this\n// goal: hide the root container, and all the resources finding calls\nclass CompilationContext {\n    constructor(def, container, parent, root, instructions) {\n        this.hasSlot = false;\n        this.deps = null;\n        const hasParent = parent !== null;\n        this.c = container;\n        this.root = root === null ? this : root;\n        this.def = def;\n        this.parent = parent;\n        this._resourceResolver = hasParent ? parent._resourceResolver : container.get(IResourceResolver);\n        this._commandResolver = hasParent ? parent._commandResolver : container.get(IBindingCommandResolver);\n        this._templateFactory = hasParent ? parent._templateFactory : container.get(ITemplateElementFactory);\n        // todo: attr parser should be retrieved based in resource semantic (current leaf + root + ignore parent)\n        this._attrParser = hasParent ? parent._attrParser : container.get(IAttributeParser);\n        this._exprParser = hasParent ? parent._exprParser : container.get(IExpressionParser);\n        this._attrMapper = hasParent ? parent._attrMapper : container.get(IAttrMapper);\n        this._logger = hasParent ? parent._logger : container.get(ILogger);\n        if (typeof (this.p = hasParent ? parent.p : container.get(IPlatform)).document?.nodeType !== 'number') {\n            throw createMappedError(722 /* ErrorNames.compiler_no_dom_api */);\n        }\n        this.localEls = hasParent ? parent.localEls : new Set();\n        this.rows = instructions ?? [];\n    }\n    _addLocalDep(Type) {\n        (this.root.deps ??= []).push(Type);\n        this.root.c.register(Type);\n        return this;\n    }\n    _text(text) {\n        return this.p.document.createTextNode(text);\n    }\n    _comment(text) {\n        return this.p.document.createComment(text);\n    }\n    _marker() {\n        return this._comment('au*');\n    }\n    h(name) {\n        const el = this.p.document.createElement(name);\n        if (name === 'template') {\n            this.p.document.adoptNode(el.content);\n        }\n        return el;\n    }\n    t() {\n        return this.h('template');\n    }\n    /**\n     * Find the custom element definition of a given name\n     */\n    _findElement(name) {\n        return this._resourceResolver.el(this.c, name);\n    }\n    /**\n     * Find the custom attribute definition of a given name\n     */\n    _findAttr(name) {\n        return this._resourceResolver.attr(this.c, name);\n    }\n    _getBindables(def) {\n        return this._resourceResolver.bindables(def);\n    }\n    /**\n     * Create a new child compilation context\n     */\n    _createChild(instructions) {\n        return new CompilationContext(this.def, this.c, this, this.root, instructions);\n    }\n    /**\n     * Retrieve a binding command resource instance.\n     *\n     * @param name - The parsed `AttrSyntax`\n     *\n     * @returns An instance of the command if it exists, or `null` if it does not exist.\n     */\n    _getCommand(syntax) {\n        const name = syntax.command;\n        if (name === null) {\n            return null;\n        }\n        return this._commandResolver.get(this.c, name);\n    }\n}\nconst hasInlineBindings = (rawValue) => {\n    const len = rawValue.length;\n    let ch = 0;\n    let i = 0;\n    while (len > i) {\n        ch = rawValue.charCodeAt(i);\n        if (ch === 92 /* Char.Backslash */) {\n            ++i;\n            // Ignore whatever comes next because it's escaped\n        }\n        else if (ch === 58 /* Char.Colon */) {\n            return true;\n        }\n        else if (ch === 36 /* Char.Dollar */ && rawValue.charCodeAt(i + 1) === 123 /* Char.OpenBrace */) {\n            return false;\n        }\n        ++i;\n    }\n    return false;\n};\nconst resetCommandBuildInfo = () => {\n    commandBuildInfo.node\n        = commandBuildInfo.attr\n            = commandBuildInfo.bindable\n                = commandBuildInfo.def = null;\n};\nconst voidDefinition = { name: 'unnamed', type: definitionTypeElement };\nconst commandBuildInfo = {\n    node: null,\n    attr: null,\n    bindable: null,\n    def: null,\n};\nconst invalidSurrogateAttribute = {\n    'id': true,\n    'name': true,\n    'au-slot': true,\n    'as-element': true,\n};\nconst orderSensitiveInputType = {\n    checkbox: 1,\n    radio: 1,\n    // todo: range is also sensitive to order, for min/max\n};\nconst IResourceResolver = /*@__PURE__*/ tcCreateInterface('IResourceResolver');\nconst IBindingCommandResolver = /*@__PURE__*/ tcCreateInterface('IBindingCommandResolver', x => {\n    class DefaultBindingCommandResolver {\n        constructor() {\n            this._cache = new WeakMap();\n        }\n        get(c, name) {\n            let record = this._cache.get(c);\n            if (!record) {\n                this._cache.set(c, record = {});\n            }\n            return name in record ? record[name] : (record[name] = BindingCommand.get(c, name));\n        }\n    }\n    return x.singleton(DefaultBindingCommandResolver);\n});\n\nconst allowedLocalTemplateBindableAttributes = tcObjectFreeze([\n    \"name\" /* LocalTemplateBindableAttributes.name */,\n    \"attribute\" /* LocalTemplateBindableAttributes.attribute */,\n    \"mode\" /* LocalTemplateBindableAttributes.mode */\n]);\nconst localTemplateIdentifier = 'as-custom-element';\nconst processTemplateName = (owningElementName, localTemplate, localTemplateNames) => {\n    const name = localTemplate.getAttribute(localTemplateIdentifier);\n    if (name === null || name === '') {\n        throw createMappedError(715 /* ErrorNames.compiler_local_name_empty */, owningElementName);\n    }\n    if (localTemplateNames.has(name)) {\n        throw createMappedError(716 /* ErrorNames.compiler_duplicate_local_name */, name, owningElementName);\n    }\n    else {\n        localTemplateNames.add(name);\n        localTemplate.removeAttribute(localTemplateIdentifier);\n    }\n    return name;\n};\n/**\n * An interface describing the hooks a compilation process should invoke.\n *\n * A feature available to the default template compiler.\n */\nconst ITemplateCompilerHooks = /*@__PURE__*/ tcCreateInterface('ITemplateCompilerHooks');\nconst TemplateCompilerHooks = tcObjectFreeze({\n    name: /*@__PURE__*/ getResourceKeyFor('compiler-hooks'),\n    define(Type) {\n        return {\n            register(container) {\n                singletonRegistration(ITemplateCompilerHooks, Type).register(container);\n            }\n        };\n    },\n    findAll(container) {\n        return container.get(allResources(ITemplateCompilerHooks));\n    }\n});\n/**\n * Decorator: Indicates that the decorated class is a template compiler hooks.\n *\n * An instance of this class will be created and appropriate compilation hooks will be invoked\n * at different phases of the default compiler.\n */\n/* eslint-disable */\n// deepscan-disable-next-line\nconst templateCompilerHooks = (target, context) => {\n    return target === void 0 ? decorator : decorator(target, context);\n    function decorator(t, context) {\n        context.metadata[registrableMetadataKey] = TemplateCompilerHooks.define(t);\n        return t;\n    }\n};\n\nexport { AtPrefixedTriggerAttributePattern, AttrBindingCommand, AttrSyntax, AttributeBindingInstruction, AttributeParser, AttributePattern, BindingCommand, BindingCommandDefinition, BindingMode, CaptureBindingCommand, ClassBindingCommand, ColonPrefixedBindAttributePattern, DefaultBindingCommand, DotSeparatedAttributePattern, EventAttributePattern, ForBindingCommand, FromViewBindingCommand, HydrateAttributeInstruction, HydrateElementInstruction, HydrateLetElementInstruction, HydrateTemplateController, IAttrMapper, IAttributeParser, IAttributePattern, IBindingCommandResolver, IInstruction, IResourceResolver, ISyntaxInterpreter, ITemplateCompiler, ITemplateCompilerHooks, ITemplateElementFactory, InstructionType, InterpolationInstruction, Interpretation, IteratorBindingInstruction, LetBindingInstruction, ListenerBindingInstruction, MultiAttrInstruction, OneTimeBindingCommand, PropertyBindingInstruction, RefAttributePattern, RefBindingCommand, RefBindingInstruction, SetAttributeInstruction, SetClassAttributeInstruction, SetPropertyInstruction, SetStyleAttributeInstruction, SpreadElementPropBindingInstruction, SpreadTransferedBindingInstruction, SpreadValueBindingCommand, SpreadValueBindingInstruction, StyleBindingCommand, StylePropertyBindingInstruction, SyntaxInterpreter, TemplateCompiler, TemplateCompilerHooks, TextBindingInstruction, ToViewBindingCommand, TriggerBindingCommand, TwoWayBindingCommand, attributePattern, bindingCommand, generateElementName, templateCompilerHooks };\n//# sourceMappingURL=index.dev.mjs.map\n","import { DestructuringAssignmentSingleExpression, IExpressionParser } from '@aurelia/expression-parser';\nimport { DI, isObjectOrFunction, isFunction, isArray, isArrayIndex, noop, isSet, isMap, areEqual, isSymbol, Registration, resolve, IPlatform, ILogger, isObject, createLookup, emptyObject } from '@aurelia/kernel';\nimport { Metadata } from '@aurelia/metadata';\n\n/**\n * A shortcut to Object.prototype.hasOwnProperty\n * Needs to do explicit .call\n *\n * @internal\n */\nconst hasOwnProp = Object.prototype.hasOwnProperty;\n/**\n * Reflect does not throw on invalid property def\n *\n * @internal\n */\nconst rtDef = Reflect.defineProperty;\n/** @internal */\nfunction rtDefineHiddenProp(obj, key, value) {\n    rtDef(obj, key, {\n        configurable: true,\n        writable: true,\n        value\n    });\n    return value;\n}\n/** @internal */\nfunction ensureProto(proto, key, defaultValue) {\n    if (!(key in proto)) {\n        rtDefineHiddenProp(proto, key, defaultValue);\n    }\n}\n/** @internal */ const rtObjectAssign = Object.assign;\n/** @internal */ const rtObjectFreeze = Object.freeze;\n// this is used inside template literal, since TS errs without String(...value)\n/** @internal */ const rtSafeString = String;\n/** @internal */ const rtCreateInterface = DI.createInterface;\n/** @internal */ const rtGetMetadata = Metadata.get;\n/** @internal */ const rtDefineMetadata = Metadata.define;\n\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/* eslint-disable prefer-template */\n/** @internal */\nconst createMappedError = (code, ...details) => new Error(`AUR${rtSafeString(code).padStart(4, '0')}: ${getMessageByCode(code, ...details)}`)\n    ;\n\nconst errorsMap = {\n    [99 /* ErrorNames.method_not_implemented */]: 'Method {{0}} not implemented',\n    [101 /* ErrorNames.ast_behavior_not_found */]: `Ast eval error: binding behavior \"{{0}}\" could not be found. Did you forget to register it as a dependency?`,\n    [102 /* ErrorNames.ast_behavior_duplicated */]: `Ast eval error: binding behavior \"{{0}}\" already applied.`,\n    [103 /* ErrorNames.ast_converter_not_found */]: `Ast eval error: value converter \"{{0}}\" could not be found. Did you forget to register it as a dependency?`,\n    [105 /* ErrorNames.ast_$host_not_found */]: `Ast eval error: unable to find $host context. Did you forget [au-slot] attribute?`,\n    [106 /* ErrorNames.ast_no_assign_$host */]: `Ast eval error: invalid assignment. \"$host\" is a reserved keyword.`,\n    [107 /* ErrorNames.ast_not_a_function */]: `Ast eval error: expression is not a function.`,\n    [109 /* ErrorNames.ast_unknown_unary_operator */]: `Ast eval error: unknown unary operator: \"{{0}}\"`,\n    [108 /* ErrorNames.ast_unknown_binary_operator */]: `Ast eval error: unknown binary operator: \"{{0}}\"`,\n    [110 /* ErrorNames.ast_tagged_not_a_function */]: `Ast eval error: left-hand side of tagged template expression is not a function.`,\n    [111 /* ErrorNames.ast_name_is_not_a_function */]: `Ast eval error: expected \"{{0}}\" to be a function`,\n    [112 /* ErrorNames.ast_destruct_null */]: `Ast eval error: cannot use non-object value for destructuring assignment.`,\n    [113 /* ErrorNames.ast_increment_infinite_loop */]: `Ast eval error: infinite loop detected. Increment operators should only be used in event handlers.`,\n    [114 /* ErrorNames.ast_nullish_member_access */]: `Ast eval error: cannot access property \"{{0}}\" of {{1}}.`,\n    [115 /* ErrorNames.ast_nullish_keyed_access */]: `Ast eval error: cannot access key \"{{0}}\" of {{1}}.`,\n    [116 /* ErrorNames.ast_nullish_assignment */]: `Ast eval error: cannot assign value to property \"{{0}}\" of null/undefined.`,\n    [151 /* ErrorNames.parse_invalid_start */]: `Expression error: invalid start: \"{{0}}\"`,\n    [152 /* ErrorNames.parse_no_spread */]: `Expression error: spread operator is not supported: \"{{0}}\"`,\n    [153 /* ErrorNames.parse_expected_identifier */]: `Expression error: expected identifier: \"{{0}}\"`,\n    [154 /* ErrorNames.parse_invalid_member_expr */]: `Expression error: invalid member expression: \"{{0}}\"`,\n    [155 /* ErrorNames.parse_unexpected_end */]: `Expression error: unexpected end of expression: \"{{0}}\"`,\n    [156 /* ErrorNames.parse_unconsumed_token */]: `Expression error: unconsumed token: \"{{0}}\" at position {{1}} of \"{{2}}\"`,\n    [157 /* ErrorNames.parse_invalid_empty */]: `Expression error: invalid empty expression. Empty expression is only valid in event bindings (trigger, delegate, capture etc...)`,\n    [158 /* ErrorNames.parse_left_hand_side_not_assignable */]: `Expression error: left hand side of expression is not assignable: \"{{0}}\"`,\n    [159 /* ErrorNames.parse_expected_converter_identifier */]: `Expression error: expected identifier to come after value converter operator: \"{{0}}\"`,\n    [160 /* ErrorNames.parse_expected_behavior_identifier */]: `Expression error: expected identifier to come after binding behavior operator: {{0}}`,\n    [161 /* ErrorNames.parse_unexpected_keyword_of */]: `Expression error: unexpected keyword \"of\": \"{{0}}\"`,\n    [162 /* ErrorNames.parse_unexpected_keyword_import */]: `Expression error: unexpected keyword \"import\": \"{{0}}\"`,\n    [163 /* ErrorNames.parse_invalid_identifier_in_forof */]: `Expression error: invalid BindingIdentifier at left hand side of \"of\": \"{{0}}\" | kind: {{1}}`,\n    [164 /* ErrorNames.parse_invalid_identifier_object_literal_key */]: `Expression error: invalid or unsupported property definition in object literal: \"{{0}}\"`,\n    [165 /* ErrorNames.parse_unterminated_string */]: `Expression error: unterminated quote in string literal: \"{{0}}\"`,\n    [166 /* ErrorNames.parse_unterminated_template_string */]: `Expression error: unterminated template string: \"{{0}}\"`,\n    [167 /* ErrorNames.parse_missing_expected_token */]: `Expression error: missing expected token \"{{0}}\" in \"{{1}}\"`,\n    [168 /* ErrorNames.parse_unexpected_character */]: `Expression error: unexpected character: \"{{0}}\"`,\n    [170 /* ErrorNames.parse_unexpected_token_destructuring */]: `Expression error: unexpected \"{{0}}\" at position \"{{1}}\" for destructuring assignment in \"{{2}}\"`,\n    [171 /* ErrorNames.parse_unexpected_token_optional_chain */]: `Expression error: unexpected {{0}} at position \"{{1}}\" for optional chain in \"{{2}}\"`,\n    [172 /* ErrorNames.parse_invalid_tag_in_optional_chain */]: `Expression error: invalid tagged template on optional chain in \"{{1}}\"`,\n    [173 /* ErrorNames.parse_invalid_arrow_params */]: `Expression error: invalid arrow parameter list in \"{{0}}\"`,\n    [174 /* ErrorNames.parse_no_arrow_param_default_value */]: `Expression error: arrow function with default parameters is not supported: \"{{0}}\"`,\n    [175 /* ErrorNames.parse_no_arrow_param_destructuring */]: `Expression error: arrow function with destructuring parameters is not supported: \"{{0}}\"`,\n    [176 /* ErrorNames.parse_rest_must_be_last */]: `Expression error: rest parameter must be last formal parameter in arrow function: \"{{0}}\"`,\n    [178 /* ErrorNames.parse_no_arrow_fn_body */]: `Expression error: arrow function with function body is not supported: \"{{0}}\"`,\n    [179 /* ErrorNames.parse_unexpected_double_dot */]: `Expression error: unexpected token '.' at position \"{{1}}\" in \"{{0}}\"`,\n    [199 /* ErrorNames.observing_null_undefined */]: `Trying to observe property {{0}} on null/undefined`,\n    [203 /* ErrorNames.null_scope */]: `Trying to retrieve a property or build a scope from a null/undefined scope`,\n    [204 /* ErrorNames.create_scope_with_null_context */]: 'Trying to create a scope with null/undefined binding context',\n    [206 /* ErrorNames.switch_on_null_connectable */]: `Trying to switch to a null/undefined connectable`,\n    [207 /* ErrorNames.switch_active_connectable */]: `Trying to enter an active connectable`,\n    [208 /* ErrorNames.switch_off_null_connectable */]: `Trying to pop a null/undefined connectable`,\n    [209 /* ErrorNames.switch_off_inactive_connectable */]: `Trying to exit an inactive connectable`,\n    [210 /* ErrorNames.non_recognisable_collection_type */]: `Unrecognised collection type {{0:toString}}.`,\n    [217 /* ErrorNames.dirty_check_no_handler */]: 'There is no registration for IDirtyChecker interface. If you want to use your own dirty checker, make sure you register it.',\n    [218 /* ErrorNames.dirty_check_not_allowed */]: `Dirty checked is not permitted in this application. Property key {{0}} is being dirty checked.`,\n    [219 /* ErrorNames.dirty_check_setter_not_allowed */]: `Trying to set value for property {{0}} in dirty checker`,\n    [220 /* ErrorNames.assign_readonly_size */]: `Map/Set \"size\" is a readonly property`,\n    [221 /* ErrorNames.assign_readonly_readonly_property_from_computed */]: `Trying to assign value to readonly property \"{{0}}\" through computed observer.`,\n    [224 /* ErrorNames.invalid_observable_decorator_usage */]: `Invalid @observable decorator usage, cannot determine property name`,\n    [225 /* ErrorNames.stopping_a_stopped_effect */]: `Trying to stop an effect that has already been stopped`,\n    [226 /* ErrorNames.effect_maximum_recursion_reached */]: `Maximum number of recursive effect run reached. Consider handle effect dependencies differently.`,\n};\nconst getMessageByCode = (name, ...details) => {\n    let cooked = errorsMap[name];\n    for (let i = 0; i < details.length; ++i) {\n        const regex = new RegExp(`{{${i}(:.*)?}}`, 'g');\n        let matches = regex.exec(cooked);\n        while (matches != null) {\n            const method = matches[1]?.slice(1);\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            let value = details[i];\n            if (value != null) {\n                switch (method) {\n                    case 'typeof':\n                        value = typeof value;\n                        break;\n                    case 'toString':\n                        value = Object.prototype.toString.call(value);\n                        break;\n                    case 'join(!=)':\n                        value = value.join('!=');\n                        break;\n                    case 'element':\n                        value = value === '*' ? 'all elements' : `<${value} />`;\n                        break;\n                    default: {\n                        // property access\n                        if (method?.startsWith('.')) {\n                            value = rtSafeString(value[method.slice(1)]);\n                        }\n                        else {\n                            value = rtSafeString(value);\n                        }\n                    }\n                }\n            }\n            cooked = cooked.slice(0, matches.index) + value + cooked.slice(regex.lastIndex);\n            matches = regex.exec(cooked);\n        }\n    }\n    return cooked;\n};\n\nclass Scope {\n    constructor(parent, bindingContext, overrideContext, isBoundary) {\n        this.parent = parent;\n        this.bindingContext = bindingContext;\n        this.overrideContext = overrideContext;\n        this.isBoundary = isBoundary;\n    }\n    static getContext(scope, name, ancestor) {\n        if (scope == null) {\n            throw createMappedError(203 /* ErrorNames.null_scope */);\n        }\n        let overrideContext = scope.overrideContext;\n        let currentScope = scope;\n        if (ancestor > 0) {\n            // jump up the required number of ancestor contexts (eg $parent.$parent requires two jumps)\n            while (ancestor > 0) {\n                ancestor--;\n                currentScope = currentScope.parent;\n                if (currentScope == null) {\n                    return void 0;\n                }\n            }\n            overrideContext = currentScope.overrideContext;\n            // Here we are giving benefit of doubt considering the dev has used one or more `$parent` token, and thus should know what s/he is targeting.\n            return name in overrideContext ? overrideContext : currentScope.bindingContext;\n        }\n        // walk the scope hierarchy until\n        // the first scope that has the property in its contexts\n        // or\n        // the closet boundary scope\n        // -------------------------\n        // this behavior is different with v1\n        // where it would fallback to the immediate scope instead of the root one\n        // TODO: maybe avoid immediate loop and return earlier\n        // -------------------------\n        while (currentScope != null\n            && !currentScope.isBoundary\n            && !(name in currentScope.overrideContext)\n            && !(name in currentScope.bindingContext)) {\n            currentScope = currentScope.parent;\n        }\n        if (currentScope == null) {\n            return scope.bindingContext;\n        }\n        overrideContext = currentScope.overrideContext;\n        return name in overrideContext ? overrideContext : currentScope.bindingContext;\n    }\n    static create(bc, oc, isBoundary) {\n        if (bc == null) {\n            throw createMappedError(204 /* ErrorNames.create_scope_with_null_context */);\n        }\n        return new Scope(null, bc, oc ?? new OverrideContext(), isBoundary ?? false);\n    }\n    static fromParent(ps, bc, oc = new OverrideContext()) {\n        if (ps == null) {\n            throw createMappedError(203 /* ErrorNames.null_scope */);\n        }\n        return new Scope(ps, bc, oc, false);\n    }\n}\n/**\n * A class for creating context in synthetic scope to keep the number of classes of context in scope small\n */\nclass BindingContext {\n    constructor(key, value) {\n        if (key !== void 0) {\n            this[key] = value;\n        }\n    }\n}\nclass OverrideContext {\n}\n\n/* eslint-disable no-fallthrough */\nconst { astAssign, astEvaluate, astBind, astUnbind } = /*@__PURE__*/ (() => {\n    const ekAccessThis = 'AccessThis';\n    const ekAccessBoundary = 'AccessBoundary';\n    const ekAccessGlobal = 'AccessGlobal';\n    const ekAccessScope = 'AccessScope';\n    const ekArrayLiteral = 'ArrayLiteral';\n    const ekObjectLiteral = 'ObjectLiteral';\n    const ekPrimitiveLiteral = 'PrimitiveLiteral';\n    const ekNew = 'New';\n    const ekTemplate = 'Template';\n    const ekUnary = 'Unary';\n    const ekCallScope = 'CallScope';\n    const ekCallMember = 'CallMember';\n    const ekCallFunction = 'CallFunction';\n    const ekCallGlobal = 'CallGlobal';\n    const ekAccessMember = 'AccessMember';\n    const ekAccessKeyed = 'AccessKeyed';\n    const ekTaggedTemplate = 'TaggedTemplate';\n    const ekBinary = 'Binary';\n    const ekConditional = 'Conditional';\n    const ekAssign = 'Assign';\n    const ekArrowFunction = 'ArrowFunction';\n    const ekValueConverter = 'ValueConverter';\n    const ekBindingBehavior = 'BindingBehavior';\n    const ekArrayBindingPattern = 'ArrayBindingPattern';\n    const ekObjectBindingPattern = 'ObjectBindingPattern';\n    const ekBindingIdentifier = 'BindingIdentifier';\n    const ekForOfStatement = 'ForOfStatement';\n    const ekInterpolation = 'Interpolation';\n    const ekArrayDestructuring = 'ArrayDestructuring';\n    const ekObjectDestructuring = 'ObjectDestructuring';\n    const ekDestructuringAssignmentLeaf = 'DestructuringAssignmentLeaf';\n    const ekCustom = 'Custom';\n    const getContext = Scope.getContext;\n    // eslint-disable-next-line max-lines-per-function\n    function astEvaluate(ast, s, e, c) {\n        switch (ast.$kind) {\n            case ekAccessThis: {\n                let oc = s.overrideContext;\n                let currentScope = s;\n                let i = ast.ancestor;\n                while (i-- && oc) {\n                    currentScope = currentScope.parent;\n                    oc = currentScope?.overrideContext ?? null;\n                }\n                return i < 1 && currentScope ? currentScope.bindingContext : void 0;\n            }\n            case ekAccessBoundary: {\n                let currentScope = s;\n                while (currentScope != null\n                    && !currentScope.isBoundary) {\n                    currentScope = currentScope.parent;\n                }\n                return currentScope ? currentScope.bindingContext : void 0;\n            }\n            case ekAccessScope: {\n                const obj = getContext(s, ast.name, ast.ancestor);\n                if (c !== null) {\n                    c.observe(obj, ast.name);\n                }\n                const evaluatedValue = obj[ast.name];\n                if (evaluatedValue == null) {\n                    if (ast.name === '$host') {\n                        throw createMappedError(105 /* ErrorNames.ast_$host_not_found */);\n                    }\n                    return evaluatedValue;\n                }\n                return e?.boundFn && isFunction(evaluatedValue)\n                    ? evaluatedValue.bind(obj)\n                    : evaluatedValue;\n            }\n            case ekAccessGlobal:\n                return globalThis[ast.name];\n            case ekCallGlobal: {\n                const func = globalThis[ast.name];\n                if (isFunction(func)) {\n                    return func(...ast.args.map(a => astEvaluate(a, s, e, c)));\n                }\n                /* istanbul ignore next */\n                if (!e?.strict && func == null) {\n                    return void 0;\n                }\n                throw createMappedError(107 /* ErrorNames.ast_not_a_function */);\n            }\n            case ekArrayLiteral:\n                return ast.elements.map(expr => astEvaluate(expr, s, e, c));\n            case ekObjectLiteral: {\n                const instance = {};\n                for (let i = 0; i < ast.keys.length; ++i) {\n                    instance[ast.keys[i]] = astEvaluate(ast.values[i], s, e, c);\n                }\n                return instance;\n            }\n            case ekPrimitiveLiteral:\n                return ast.value;\n            case ekNew: {\n                const func = astEvaluate(ast.func, s, e, c);\n                if (isFunction(func)) {\n                    return new func(...ast.args.map(a => astEvaluate(a, s, e, c)));\n                }\n                throw createMappedError(107 /* ErrorNames.ast_not_a_function */);\n            }\n            case ekTemplate: {\n                let result = ast.cooked[0];\n                for (let i = 0; i < ast.expressions.length; ++i) {\n                    result += rtSafeString(astEvaluate(ast.expressions[i], s, e, c));\n                    result += ast.cooked[i + 1];\n                }\n                return result;\n            }\n            case ekUnary: {\n                const value = astEvaluate(ast.expression, s, e, c);\n                switch (ast.operation) {\n                    case 'void':\n                        return void value;\n                    case 'typeof':\n                        return typeof value;\n                    case '!':\n                        return !value;\n                    case '-':\n                        return -value;\n                    case '+':\n                        return +value;\n                    case '--':\n                        if (c != null)\n                            throw createMappedError(113 /* ErrorNames.ast_increment_infinite_loop */);\n                        return astAssign(ast.expression, s, e, c, value - 1) + ast.pos;\n                    case '++':\n                        if (c != null)\n                            throw createMappedError(113 /* ErrorNames.ast_increment_infinite_loop */);\n                        return astAssign(ast.expression, s, e, c, value + 1) - ast.pos;\n                    default:\n                        throw createMappedError(109 /* ErrorNames.ast_unknown_unary_operator */, ast.operation);\n                }\n            }\n            case ekCallScope: {\n                const context = getContext(s, ast.name, ast.ancestor);\n                if (context == null) {\n                    if (e?.strict) {\n                        throw createMappedError(114 /* ErrorNames.ast_nullish_member_access */, ast.name, context);\n                    }\n                    return void 0;\n                }\n                const fn = context[ast.name];\n                if (isFunction(fn)) {\n                    return fn.apply(context, ast.args.map(a => astEvaluate(a, s, e, c)));\n                }\n                if (fn == null) {\n                    if (e?.strict && !ast.optional) {\n                        throw createMappedError(111 /* ErrorNames.ast_name_is_not_a_function */, ast.name);\n                    }\n                    return void 0;\n                }\n                throw createMappedError(111 /* ErrorNames.ast_name_is_not_a_function */, ast.name);\n            }\n            case ekCallMember: {\n                const instance = astEvaluate(ast.object, s, e, c);\n                if (instance == null) {\n                    if (e?.strict && !ast.optionalMember) {\n                        throw createMappedError(114 /* ErrorNames.ast_nullish_member_access */, ast.name, instance);\n                    }\n                }\n                const fn = instance?.[ast.name];\n                if (fn == null) {\n                    if (!ast.optionalCall && e?.strict) {\n                        throw createMappedError(111 /* ErrorNames.ast_name_is_not_a_function */, ast.name);\n                    }\n                    return void 0;\n                }\n                if (!isFunction(fn)) {\n                    throw createMappedError(111 /* ErrorNames.ast_name_is_not_a_function */, ast.name);\n                }\n                const ret = fn.apply(instance, ast.args.map(a => astEvaluate(a, s, e, c)));\n                if (isArray(instance) && autoObserveArrayMethods.includes(ast.name)) {\n                    c?.observeCollection(instance);\n                }\n                return ret;\n            }\n            case ekCallFunction: {\n                const func = astEvaluate(ast.func, s, e, c);\n                if (isFunction(func)) {\n                    return func(...ast.args.map(a => astEvaluate(a, s, e, c)));\n                }\n                if (func == null) {\n                    if (!ast.optional && e?.strict) {\n                        throw createMappedError(107 /* ErrorNames.ast_not_a_function */);\n                    }\n                    return void 0;\n                }\n                throw createMappedError(107 /* ErrorNames.ast_not_a_function */);\n            }\n            case ekArrowFunction: {\n                const func = (...args) => {\n                    const params = ast.args;\n                    const rest = ast.rest;\n                    const lastIdx = params.length - 1;\n                    const context = params.reduce((map, param, i) => {\n                        if (rest && i === lastIdx) {\n                            map[param.name] = args.slice(i);\n                        }\n                        else {\n                            map[param.name] = args[i];\n                        }\n                        return map;\n                    }, {});\n                    const functionScope = Scope.fromParent(s, context);\n                    return astEvaluate(ast.body, functionScope, e, c);\n                };\n                return func;\n            }\n            case ekAccessMember: {\n                const instance = astEvaluate(ast.object, s, e, c);\n                if (instance == null) {\n                    if (!ast.optional && e?.strict) {\n                        throw createMappedError(114 /* ErrorNames.ast_nullish_member_access */, ast.name, instance);\n                    }\n                    return void 0;\n                }\n                if (c !== null && !ast.accessGlobal) {\n                    c.observe(instance, ast.name);\n                }\n                const ret = instance[ast.name];\n                return e?.boundFn && isFunction(ret)\n                    // event listener wants the returned function to be bound to the instance\n                    ? ret.bind(instance)\n                    : ret;\n            }\n            case ekAccessKeyed: {\n                const instance = astEvaluate(ast.object, s, e, c);\n                const key = astEvaluate(ast.key, s, e, c);\n                if (instance == null) {\n                    if (!ast.optional && e?.strict) {\n                        throw createMappedError(115 /* ErrorNames.ast_nullish_keyed_access */, key, instance);\n                    }\n                    return void 0;\n                }\n                if (c !== null && !ast.accessGlobal) {\n                    c.observe(instance, key);\n                }\n                return instance[key];\n            }\n            case ekTaggedTemplate: {\n                const results = ast.expressions.map(expr => astEvaluate(expr, s, e, c));\n                const func = astEvaluate(ast.func, s, e, c);\n                if (!isFunction(func)) {\n                    throw createMappedError(110 /* ErrorNames.ast_tagged_not_a_function */);\n                }\n                return func(ast.cooked, ...results);\n            }\n            case ekBinary: {\n                const left = ast.left;\n                const right = ast.right;\n                switch (ast.operation) {\n                    case '&&':\n                        // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n                        return astEvaluate(left, s, e, c) && astEvaluate(right, s, e, c);\n                    case '||':\n                        // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n                        return astEvaluate(left, s, e, c) || astEvaluate(right, s, e, c);\n                    case '??':\n                        return astEvaluate(left, s, e, c) ?? astEvaluate(right, s, e, c);\n                    case '==':\n                        // eslint-disable-next-line eqeqeq\n                        return astEvaluate(left, s, e, c) == astEvaluate(right, s, e, c);\n                    case '===':\n                        return astEvaluate(left, s, e, c) === astEvaluate(right, s, e, c);\n                    case '!=':\n                        // eslint-disable-next-line eqeqeq\n                        return astEvaluate(left, s, e, c) != astEvaluate(right, s, e, c);\n                    case '!==':\n                        return astEvaluate(left, s, e, c) !== astEvaluate(right, s, e, c);\n                    case 'instanceof': {\n                        const $right = astEvaluate(right, s, e, c);\n                        if (isFunction($right)) {\n                            return astEvaluate(left, s, e, c) instanceof $right;\n                        }\n                        return false;\n                    }\n                    case 'in': {\n                        const $right = astEvaluate(right, s, e, c);\n                        if (isObjectOrFunction($right)) {\n                            return astEvaluate(left, s, e, c) in $right;\n                        }\n                        return false;\n                    }\n                    case '+':\n                        return astEvaluate(left, s, e, c) + astEvaluate(right, s, e, c);\n                    case '-':\n                        return astEvaluate(left, s, e, c) - astEvaluate(right, s, e, c);\n                    case '*':\n                        return astEvaluate(left, s, e, c) * astEvaluate(right, s, e, c);\n                    case '/':\n                        return astEvaluate(left, s, e, c) / astEvaluate(right, s, e, c);\n                    case '%':\n                        return astEvaluate(left, s, e, c) % astEvaluate(right, s, e, c);\n                    case '**':\n                        return astEvaluate(left, s, e, c) ** astEvaluate(right, s, e, c);\n                    case '<':\n                        return astEvaluate(left, s, e, c) < astEvaluate(right, s, e, c);\n                    case '>':\n                        return astEvaluate(left, s, e, c) > astEvaluate(right, s, e, c);\n                    case '<=':\n                        return astEvaluate(left, s, e, c) <= astEvaluate(right, s, e, c);\n                    case '>=':\n                        return astEvaluate(left, s, e, c) >= astEvaluate(right, s, e, c);\n                    default:\n                        throw createMappedError(108 /* ErrorNames.ast_unknown_binary_operator */, ast.operation);\n                }\n            }\n            case ekConditional:\n                // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n                return astEvaluate(ast.condition, s, e, c) ? astEvaluate(ast.yes, s, e, c) : astEvaluate(ast.no, s, e, c);\n            case ekAssign: {\n                let value = astEvaluate(ast.value, s, e, c);\n                if (ast.op !== '=') {\n                    if (c != null) {\n                        throw createMappedError(113 /* ErrorNames.ast_increment_infinite_loop */);\n                    }\n                    const target = astEvaluate(ast.target, s, e, c);\n                    switch (ast.op) {\n                        case '/=':\n                            value = target / value;\n                            break;\n                        case '*=':\n                            value = target * value;\n                            break;\n                        case '+=':\n                            value = target + value;\n                            break;\n                        case '-=':\n                            value = target - value;\n                            break;\n                        default:\n                            throw createMappedError(108 /* ErrorNames.ast_unknown_binary_operator */, ast.op);\n                    }\n                }\n                return astAssign(ast.target, s, e, c, value);\n            }\n            case ekValueConverter: {\n                return e?.useConverter?.(ast.name, 'toView', astEvaluate(ast.expression, s, e, c), ast.args.map(a => astEvaluate(a, s, e, c)));\n            }\n            case ekBindingBehavior:\n                return astEvaluate(ast.expression, s, e, c);\n            case ekBindingIdentifier:\n                return ast.name;\n            case ekForOfStatement:\n                return astEvaluate(ast.iterable, s, e, c);\n            case ekInterpolation:\n                if (ast.isMulti) {\n                    let result = ast.parts[0];\n                    let i = 0;\n                    for (; i < ast.expressions.length; ++i) {\n                        result += rtSafeString(astEvaluate(ast.expressions[i], s, e, c));\n                        result += ast.parts[i + 1];\n                    }\n                    return result;\n                }\n                else {\n                    return `${ast.parts[0]}${astEvaluate(ast.firstExpression, s, e, c)}${ast.parts[1]}`;\n                }\n            case ekDestructuringAssignmentLeaf:\n                return astEvaluate(ast.target, s, e, c);\n            case ekArrayDestructuring: {\n                return ast.list.map(x => astEvaluate(x, s, e, c));\n            }\n            // TODO: this should come after batch\n            // as a destructuring expression like [x, y] = value\n            //\n            // should only trigger change only once:\n            // batch(() => {\n            //   object.x = value[0]\n            //   object.y = value[1]\n            // })\n            //\n            // instead of twice:\n            // object.x = value[0]\n            // object.y = value[1]\n            case ekArrayBindingPattern:\n            // TODO\n            // similar to array binding ast, this should only come after batch\n            // for a single notification per destructing,\n            // regardless number of property assignments on the scope binding context\n            case ekObjectBindingPattern:\n            case ekObjectDestructuring:\n            default:\n                return void 0;\n            case ekCustom:\n                return ast.evaluate(s, e, c);\n        }\n    }\n    function astAssign(ast, s, e, c, val) {\n        switch (ast.$kind) {\n            case ekAccessScope: {\n                if (ast.name === '$host') {\n                    throw createMappedError(106 /* ErrorNames.ast_no_assign_$host */);\n                }\n                const obj = getContext(s, ast.name, ast.ancestor);\n                return obj[ast.name] = val;\n            }\n            case ekAccessMember: {\n                const obj = astEvaluate(ast.object, s, e, c);\n                if (obj == null) {\n                    if (e?.strict) {\n                        // if ast optional and the optional assignment proposal goes ahead\n                        // we can allow this to be a no-op instead of throwing (check via ast.optional)\n                        // https://github.com/tc39/proposal-optional-chaining-assignment\n                        throw createMappedError(116 /* ErrorNames.ast_nullish_assignment */, ast.name);\n                    }\n                    // creating an object and assign it to the owning property of the ast\n                    // this is a good enough behavior, and it works well in v1\n                    astAssign(ast.object, s, e, c, { [ast.name]: val });\n                }\n                else if (isObjectOrFunction(obj)) {\n                    if (ast.name === 'length' && isArray(obj) && !isNaN(val)) {\n                        obj.splice(val);\n                    }\n                    else {\n                        obj[ast.name] = val;\n                    }\n                }\n                else ;\n                return val;\n            }\n            case ekAccessKeyed: {\n                const instance = astEvaluate(ast.object, s, e, c);\n                const key = astEvaluate(ast.key, s, e, c);\n                if (instance == null) {\n                    if (e?.strict) {\n                        // if ast optional and the optional assignment proposal goes ahead\n                        // we can allow this to be a no-op instead of throwing (check via ast.optional)\n                        // https://github.com/tc39/proposal-optional-chaining-assignment\n                        throw createMappedError(116 /* ErrorNames.ast_nullish_assignment */, key);\n                    }\n                    // creating an object and assign it to the owning property of the ast\n                    // this is a good enough behavior, and it works well in v1\n                    astAssign(ast.object, s, e, c, { [key]: val });\n                    return val;\n                }\n                if (isArray(instance)) {\n                    if (key === 'length' && !isNaN(val)) {\n                        instance.splice(val);\n                        return val;\n                    }\n                    if (isArrayIndex(key)) {\n                        instance.splice(key, 1, val);\n                        return val;\n                    }\n                }\n                return instance[key] = val;\n            }\n            case ekAssign:\n                astAssign(ast.value, s, e, c, val);\n                return astAssign(ast.target, s, e, c, val);\n            case ekValueConverter: {\n                val = e?.useConverter?.(ast.name, 'fromView', val, ast.args.map(a => astEvaluate(a, s, e, c)));\n                return astAssign(ast.expression, s, e, c, val);\n            }\n            case ekBindingBehavior:\n                return astAssign(ast.expression, s, e, c, val);\n            case ekArrayDestructuring:\n            case ekObjectDestructuring: {\n                const list = ast.list;\n                const len = list.length;\n                let i;\n                let item;\n                for (i = 0; i < len; i++) {\n                    item = list[i];\n                    switch (item.$kind) {\n                        case ekDestructuringAssignmentLeaf:\n                            astAssign(item, s, e, c, val);\n                            break;\n                        case ekArrayDestructuring:\n                        case ekObjectDestructuring: {\n                            if (typeof val !== 'object' || val === null) {\n                                throw createMappedError(112 /* ErrorNames.ast_destruct_null */);\n                            }\n                            let source = astEvaluate(item.source, Scope.create(val), e, null);\n                            if (source === void 0 && item.initializer) {\n                                source = astEvaluate(item.initializer, s, e, null);\n                            }\n                            astAssign(item, s, e, c, source);\n                            break;\n                        }\n                    }\n                }\n                break;\n            }\n            case ekDestructuringAssignmentLeaf: {\n                if (ast instanceof DestructuringAssignmentSingleExpression) {\n                    if (val == null) {\n                        return;\n                    }\n                    if (typeof val !== 'object') {\n                        throw createMappedError(112 /* ErrorNames.ast_destruct_null */);\n                    }\n                    let source = astEvaluate(ast.source, Scope.create(val), e, c);\n                    if (source === void 0 && ast.initializer) {\n                        source = astEvaluate(ast.initializer, s, e, c);\n                    }\n                    astAssign(ast.target, s, e, c, source);\n                }\n                else {\n                    if (val == null) {\n                        return;\n                    }\n                    if (typeof val !== 'object') {\n                        throw createMappedError(112 /* ErrorNames.ast_destruct_null */);\n                    }\n                    const indexOrProperties = ast.indexOrProperties;\n                    let restValue;\n                    if (isArrayIndex(indexOrProperties)) {\n                        if (!Array.isArray(val)) {\n                            throw createMappedError(112 /* ErrorNames.ast_destruct_null */);\n                        }\n                        restValue = val.slice(indexOrProperties);\n                    }\n                    else {\n                        restValue = Object\n                            .entries(val)\n                            .reduce((acc, [k, v]) => {\n                            if (!indexOrProperties.includes(k)) {\n                                acc[k] = v;\n                            }\n                            return acc;\n                            // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n                        }, {});\n                    }\n                    astAssign(ast.target, s, e, c, restValue);\n                }\n                break;\n            }\n            case ekCustom:\n                return ast.assign(s, e, val);\n            default:\n                return void 0;\n        }\n    }\n    function astBind(ast, s, b) {\n        switch (ast.$kind) {\n            case ekBindingBehavior: {\n                b.bindBehavior?.(ast.name, s, ast.args.map(a => astEvaluate(a, s, b, null)));\n                astBind(ast.expression, s, b);\n                break;\n            }\n            case ekValueConverter: {\n                b.bindConverter?.(ast.name);\n                astBind(ast.expression, s, b);\n                break;\n            }\n            case ekForOfStatement: {\n                astBind(ast.iterable, s, b);\n                break;\n            }\n            case ekCustom: {\n                ast.bind?.(s, b);\n            }\n        }\n    }\n    function astUnbind(ast, s, b) {\n        switch (ast.$kind) {\n            case ekBindingBehavior: {\n                b.unbindBehavior?.(ast.name, s);\n                astUnbind(ast.expression, s, b);\n                break;\n            }\n            case ekValueConverter: {\n                b.unbindConverter?.(ast.name);\n                astUnbind(ast.expression, s, b);\n                break;\n            }\n            case ekForOfStatement: {\n                astUnbind(ast.iterable, s, b);\n                break;\n            }\n            case ekCustom: {\n                ast.unbind?.(s, b);\n            }\n        }\n    }\n    const autoObserveArrayMethods = 'at map filter includes indexOf lastIndexOf findIndex find flat flatMap join reduce reduceRight slice every some sort'.split(' ');\n    // sort,      // bad supported, self mutation + unclear dependency\n    // push,      // not supported, self mutation + unclear dependency\n    // pop,       // not supported, self mutation + unclear dependency\n    // shift,     // not supported, self mutation + unclear dependency\n    // splice,    // not supported, self mutation + unclear dependency\n    // unshift,   // not supported, self mutation + unclear dependency\n    // reverse,   // not supported, self mutation + unclear dependency\n    // keys,    // not meaningful in template\n    // values,  // not meaningful in template\n    // entries, // not meaningful in template\n    return {\n        astEvaluate,\n        astAssign,\n        astBind,\n        astUnbind,\n    };\n})();\n\n/**\n * For Aurelia packages internal use only, do not use this in application code.\n *\n * Add ast evaluator mixin with throw implementation for all methods.\n */\nconst mixinNoopAstEvaluator = (() => (target) => {\n    const proto = target.prototype;\n    ['bindBehavior', 'unbindBehavior', 'bindConverter', 'unbindConverter', 'useConverter'].forEach(name => {\n        rtDefineHiddenProp(proto, name, () => { throw createMappedError(99 /* ErrorNames.method_not_implemented */, name); });\n    });\n})();\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable jsdoc/check-indentation */\n/* eslint-disable jsdoc/no-multi-asterisks */\nconst tsPending = 'pending';\nconst tsRunning = 'running';\nconst tsCompleted = 'completed';\nconst tsCanceled = 'canceled';\nconst resolvedPromise = Promise.resolve();\nlet runScheduled = false;\nlet isAutoRun = false;\nconst queue = [];\nconst recurringTasks = [];\nlet pendingAsyncCount = 0;\nlet settlePromise = null;\nlet taskErrors = [];\nlet settlePromiseResolve = null;\nlet settlePromiseReject = null;\nconst requestRun = () => {\n    if (!runScheduled) {\n        runScheduled = true;\n        void resolvedPromise.then(() => {\n            runScheduled = false;\n            isAutoRun = true;\n            runTasks();\n        });\n    }\n};\nconst signalSettled = (hasPerformedWork) => {\n    if (settlePromise && queue.length === 0 && pendingAsyncCount === 0) {\n        settlePromise = null;\n        if (taskErrors.length > 0) {\n            const errors = taskErrors;\n            taskErrors = [];\n            if (errors.length === 1) {\n                settlePromiseReject(errors[0]);\n            }\n            else {\n                settlePromiseReject(new AggregateError(errors, 'One or more tasks failed.'));\n            }\n        }\n        else {\n            settlePromiseResolve(hasPerformedWork);\n        }\n    }\n};\n/**\n * **Immediately drain** Aurelia's internal task queue.\n *\n * Normally the scheduler calls this automatically on the next micro-task\n * whenever you enqueue work with {@link queueTask} or {@link queueAsyncTask}.\n * Calling it yourself is only useful in **low-level tests, debugging sessions,\n * or custom instrumentation** where you need a _synchronous_ flush.\n *\n * ### What it does\n * 1. Removes each item from the queue (FIFO) and runs it.\n * 2. If an item queues more work, the loop continues until the queue is empty,\n *    up to **10 000 extra tasks**  after that a \"Potential deadlock\" error is\n *    thrown and the queue is cleared.\n * 3. Collects every uncaught exception.\n *    * When you invoke the function manually those errors are re-thrown \n *      either the single error or an `AggregateError` if several tasks failed.*\n *    * During the scheduler's automatic run they are _suppressed_ and will only\n *      surface through `tasksSettled()` or the runtime console, so the app\n *      keeps running.\n * 4. Signals the internal \"settled promise\" so `await tasksSettled()` continues\n *    once _all_ **synchronous** callbacks have finished (async promises may\n *    still be pending).\n *\n * > **Tip:** In most cases you should prefer `await tasksSettled()`; it waits\n * > for both the synchronous drain **and** any asynchronous work started by\n * > the tasks. `runTasks()` is only needed when you must stay purely\n * > synchronous (e.g. inside a non-async test).\n *\n * @throws Error            If a task throws and you called the function\n *                          directly.\n * @throws AggregateError   If multiple tasks throw.\n * @throws Error            \"Potential deadlock detected\" when > 10 000 extra\n *                          tasks are re-queued in one drain.\n *\n * @example\n * Synchronous assertion in a non-async test\n * ```ts\n * it('updates the DOM synchronously', () => {\n *   vm.value = 42;\n *   runTasks(); // flush queue synchronously\n *   expect(el.textContent).toBe('42');\n * });\n * ```\n *\n * @example\n * Debugging pending tasks in the browser console\n * ```ts\n * // In the app startup code\n * window.runTasks = runTasks;\n *\n * // After pausing in a breakpoint\n * window.runTasks(); // force the scheduler to drain now\n * ```\n *\n * @example\n * Fail fast when a task throws during manual drain\n * ```ts\n * try {\n *   runTasks();\n * } catch (e) {\n *   console.error('A queued operation failed:', e);\n *   throw e; // make the test fail\n * }\n * ```\n */\nconst runTasks = () => {\n    const isManualRun = !isAutoRun;\n    isAutoRun = false;\n    settlePromise ??= new Promise((resolve, reject) => {\n        settlePromiseResolve = resolve;\n        settlePromiseReject = reject;\n    });\n    let extraTaskCount = -queue.length;\n    const isEmpty = queue.length === 0;\n    while (queue.length > 0) {\n        if (++extraTaskCount > 10000) {\n            const error = new Error(`Potential deadlock detected. More than 10000 extra tasks were queued from within tasks.`);\n            queue.length = 0;\n            settlePromiseReject?.(error);\n            settlePromise = null;\n            throw error;\n        }\n        const task = queue.shift();\n        if (typeof task === 'function') {\n            try {\n                task();\n            }\n            catch (err) {\n                taskErrors.push(err);\n            }\n        }\n        else {\n            task.run();\n        }\n    }\n    // Make a copy; this is for testing, signalSettled will clear the array\n    const errors = taskErrors.slice();\n    signalSettled(!isEmpty);\n    if (isManualRun && errors.length > 0) {\n        if (errors.length === 1) {\n            throw errors[0];\n        }\n        else {\n            throw new AggregateError(errors, 'One or more tasks failed.');\n        }\n    }\n};\n/**\n * Gets a read-only copy of the list of all active recurring tasks.\n *\n * While the returned array is a copy, the `RecurringTask` objects within it\n * are the actual instances managed by the scheduler. This is useful for\n * inspection or for cleaning up all active tasks by iterating over the array\n * and calling `task.cancel()` on each one.\n *\n * @returns A new array containing all currently active {@link RecurringTask} instances.\n *\n * @example\n * Cleaning up after a test\n * ```ts\n * afterEach(() => {\n *   // Ensure no recurring tasks leak between tests\n *   for (const task of getRecurringTasks()) {\n *     task.cancel();\n *   }\n * });\n * ```\n *\n * @example\n * Inspecting active tasks for debugging\n * ```ts\n * function logActiveRecurringTasks() {\n *   const tasks = getRecurringTasks();\n *   if (tasks.length > 0) {\n *     console.log('Active recurring tasks:', tasks.map(t => `ID ${t.id}`));\n *   } else {\n *     console.log('No active recurring tasks.');\n *   }\n * }\n * ```\n */\nconst getRecurringTasks = () => {\n    return recurringTasks.slice();\n};\n/**\n * Return a promise that resolves once **all queued work has finished** and the\n * Aurelia scheduler is completely idle.\n *\n * Conceptually similar to a browser's \"micro-task drain\" (the classic\n * `await Promise.resolve()` trick) but extended to cover:\n *\n * * synchronous micro-tasks queued via {@link queueTask}\n * * asynchronous or delayed tasks queued via {@link queueAsyncTask}\n * * any promises those callbacks return\n *\n * Perfect for unit / component / e2e tests where you must wait for bindings,\n * observers, `requestAnimationFrame` chains and timers to flush **without\n * guessing a timeout**.\n *\n * #### Behaviour\n * | Situation                                                | Result                             |\n * |----------------------------------------------------------|------------------------------------|\n * | At least one task ran before the queue became empty      | **resolves `true`**                |\n * | Nothing was pending when you called the function         | **resolves `false`**               |\n * | One task throws                                          | **rejects** with that error        |\n * | Multiple tasks throw                                     | **rejects** with an `AggregateError` |\n *\n * Re-invocations while work is still pending return the **same** promise; once\n * everything settles, the next call starts a fresh cycle.\n *\n * @returns Promise<boolean> &mdash; `true` if any work was processed,\n *          otherwise `false`.\n *\n * @throws {*} Propagates the error(s) thrown by tasks, see table above.\n *\n * @example\n * <caption>Flush bindings in a component test\n * ```ts\n * vm.todoText = 'Write docs';\n * vm.addTodo();\n * await tasksSettled(); // wait for DOM & animations\n * expect(list.children.length).toBe(1);\n * ```\n *\n * @example\n * Playwright helper to wait for framework idle\n * ```ts\n * // In the app startup code\n * window.tasksSettled = tasksSettled;\n *\n * // helpers.ts\n * export async function waitForIdle(page: Page) {\n *   await page.evaluate(() => window.tasksSettled());\n * }\n *\n * await page.getByRole('button', { name: 'Save' }).click();\n * await waitForIdle(page); // no arbitrary sleeps\n * ```\n *\n * @example\n * Detect and surface aggregated task errors\n * ```ts\n * queueTask(() => { throw new Error('first'); });\n * queueTask(() => { throw new Error('second'); });\n *\n * try {\n *   await tasksSettled();\n * } catch (e) {\n *   if (e instanceof AggregateError) {\n *     console.log('Multiple failures:', e.errors.length);\n *   }\n * }\n * ```\n *\n * @example\n * Ensure every test exits cleanly using the boolean result\n * ```ts\n * afterEach(async () => {\n *   const didWork = await tasksSettled();\n *   if (didWork) {\n *     // Failing here highlights orphaned micro-tasks or timers left by the test\n *     throw new Error('Test left pending work on the Aurelia scheduler');\n *   }\n * });\n * ```\n */\nconst tasksSettled = () => {\n    // do not convert to async function (it will wrap the internal promise and cause test code to fail)\n    if (settlePromise) {\n        return settlePromise;\n    }\n    if (queue.length > 0 || pendingAsyncCount > 0) {\n        return settlePromise ??= new Promise((resolve, reject) => {\n            settlePromiseResolve = resolve;\n            settlePromiseReject = reject;\n        });\n    }\n    // Not strictly necessary but without this we need a lot of extra `await Promise.resolve()` in test code\n    return resolvedPromise.then(() => {\n        if (queue.length > 0 || pendingAsyncCount > 0) {\n            return settlePromise ??= new Promise((resolve, reject) => {\n                settlePromiseResolve = resolve;\n                settlePromiseReject = reject;\n            });\n        }\n        return false;\n    });\n};\n/**\n * Queue a **synchronous** callback onto Aurelia's internal task queue.\n *\n * The callback is executed in the same micro-task drain as bindings,\n * computed observers, and other framework internals, immediately after the\n * current call-stack has unwound.\n * Because these tasks are *fire-and-forget* they:\n *\n * * **cannot be awaited**  if you need an awaitable handle use\n *   {@link queueAsyncTask} instead;\n * * are still included in the bookkeeping for {@link tasksSettled}, so tests\n *   that `await tasksSettled()` will not proceed until every queued callback\n *   has run.\n *\n * **Intended audience**: framework contributors, advanced plug-ins, and custom\n * binding strategies. Typical application code rarely needs this API.\n *\n * @param callback - A *synchronous* function to execute after the current\n *                   JavaScript turn.  Any exception it throws is captured and\n *                   surfaced collectively via `tasksSettled()` or `runTasks()`.\n */\nconst queueTask = (callback) => {\n    requestRun();\n    queue.push(callback);\n};\n/**\n * Queue a callback to run **asynchronously** on Aurelia's central scheduler\n * and get back a {@link Task} object you can:\n *\n * * `await`  via `task.result`\n * * cancel  via `task.cancel()`\n * * inspect  via `task.status`\n *\n * Any callbacks scheduled this way are automatically tracked by the framework,\n * so `await tasksSettled()` waits until the all tasks (and any promises they return)\n * have finished.\n *\n * @template R The value returned by `callback`, or the value the promise it\n *             returns resolves to.\n *\n * @param callback  - A function to execute. It may be synchronous or asynchronous;\n *                    if it returns a promise, the scheduler treats the task as\n *                    *running* until that promise settles.\n *\n * @param options.delay  - Optional delay **in milliseconds** before the callback\n *                         is queued. While waiting, the task can still be\n *                         cancelled.\n *\n * @returns The {@link Task} representing the scheduled work.\n *\n * @throws {TaskAbortError} The task's `result` promise rejects with this error\n *                          if the task is cancelled before it starts.\n * @throws {*}              The task's `result` promise propagates any error\n *                          thrown by `callback`.\n *\n * ---\n *\n * @example\n * Component integration tests\n * ```ts\n * it('increments the view when the button is clicked', async () => {\n *   const { vm, host } = await createFixture(`<counter></counter>`);\n *   host.querySelector('button')!.click();\n *\n *   // This will resolve after every queued task has finished,\n *   // including rendering.\n *   await tasksSettled();\n *\n *   expect(host.textContent).toContain('1');\n * });\n * ```\n *\n * @example\n * Debounce a network search  cancel if the user keeps typing\n * ```ts\n * let current: Task<SearchResult[]> | null = null;\n *\n * function search(term: string) {\n *   current?.cancel(); // abort the previous call\n *\n *   current = queueAsyncTask(async () => {\n *     const resp = await fetch(`/api/search?q=${encodeURIComponent(term)}`);\n *     return resp.json() as Promise<SearchResult[]>;\n *   }, { delay: 300 }); // classic 300 ms debounce\n *\n *   return current.result; // awaitable by callers\n * }\n * ```\n *\n * @example\n * Schedule expensive canvas work onto the next animation frame (test-friendly)\n * ```ts\n * export function scheduleRender(frameData: Data) {\n *   queueAsyncTask(\n *     () => new Promise<void>(resolve => requestAnimationFrame(() => {\n *       draw(frameData); // expensive canvas work\n *       resolve();\n *     }))\n *   );\n * }\n * ```\n *\n * @example\n * Auto-dismiss a toast after 5 s (test-friendly)\n * ```ts\n * export function showToast(msg: string) {\n *   const toast = createToast(msg);\n *   document.body.appendChild(toast);\n *\n *   queueAsyncTask(() => toast.remove(), { delay: 5000 });\n * }\n * ```\n */\nconst queueAsyncTask = (callback, options) => {\n    const task = new Task(callback, options?.delay);\n    if (task.delay != null && task.delay > 0) {\n        ++pendingAsyncCount;\n        task._timerId = setTimeout(() => {\n            --pendingAsyncCount;\n            task._timerId = undefined;\n            if (task.status === tsCanceled) {\n                signalSettled(true);\n                return;\n            }\n            queue.push(task);\n            requestRun();\n        }, task.delay);\n    }\n    else {\n        queue.push(task);\n        requestRun();\n    }\n    return task;\n};\nclass TaskAbortError extends Error {\n    constructor(task) {\n        super(`Task ${task.id} was canceled.`);\n        this.task = task;\n    }\n}\n/**\n * A handle returned by {@link queueAsyncTask} that lets you observe and control\n * the life-cycle of a piece of scheduled work.\n *\n * Tasks move through **four immutable states**:\n *\n * | State      | Meaning | When it changes |\n * |------------|---------|-----------------|\n * | `\"pending\"`   | Waiting in the queue <br>(or in a `setTimeout` delay). | Immediately after creation. |\n * | `\"running\"`   | `callback` is executing. | When the scheduler dequeues the task. |\n * | `\"completed\"` | Callback (and any returned promise) settled. | After `callback` finishes / promise resolves. |\n * | `\"canceled\"`  | Task was aborted **or** callback/promise rejected. | When `cancel()` succeeds, or on error. |\n *\n * @template R Type of the value produced by the callback.\n */\nclass Task {\n    /**\n     * A promise that:\n     * * **fulfils** with the callback's return value, or\n     * * **rejects** with:\n     *   * whatever error the callback throws,\n     *   * whatever rejection the callback's promise yields, or\n     *   * a {@link TaskAbortError} if the task is canceled before it starts.\n     *\n     * Consumers typically `await` this to know when *their* task is done without\n     * caring about unrelated work still queued.\n     *\n     * @example\n     * ```ts\n     * const toastTask = queueAsyncTask(showToast, { delay: 5000 });\n     * await toastTask.result; // waits 5 s then resolves\n     * ```\n     */\n    get result() {\n        return this._result;\n    }\n    /**\n     * Current immutable status of the task.\n     *\n     * @example\n     * ```ts\n     * const task = queueAsyncTask(() => 123);\n     * console.log(task.status); // \"pending\"\n     * await task.result;\n     * console.log(task.status); // \"completed\"\n     * ```\n     */\n    get status() {\n        return this._status;\n    }\n    constructor(callback, delay) {\n        this.callback = callback;\n        this.delay = delay;\n        /**\n         * Unique, incrementing identifier  handy for logging / debugging.\n         */\n        this.id = ++Task._taskId;\n        /** @internal */\n        this._status = tsPending;\n        this._result = new Promise((resolve, reject) => {\n            this._resolve = resolve;\n            this._reject = reject;\n        });\n    }\n    /** @internal */\n    run() {\n        if (this._status !== tsPending) {\n            throw new Error(`Cannot run task in ${this._status} state`);\n        }\n        this._status = tsRunning;\n        let ret;\n        try {\n            ret = this.callback();\n        }\n        catch (err) {\n            this._status = tsCanceled;\n            this._reject(err);\n            taskErrors.push(err);\n            return;\n        }\n        if (ret instanceof Promise) {\n            ++pendingAsyncCount;\n            ret.then(result => {\n                this._status = tsCompleted;\n                this._resolve(result);\n            }).catch(err => {\n                this._status = tsCanceled;\n                this._reject(err);\n                taskErrors.push(err);\n            }).finally(() => {\n                --pendingAsyncCount;\n                signalSettled(true);\n            });\n        }\n        else {\n            this._status = tsCompleted;\n            this._resolve(ret);\n        }\n    }\n    /**\n     * Attempt to cancel the task **before it runs**.\n     *\n     * * If the task is still `\"pending\"` **and**:\n     *   * waiting in a `setTimeout`  the timer is cleared.\n     *   * sitting in the queue      it is removed.\n     *   The task transitions to `\"canceled\"` and `result` rejects with\n     *   {@link TaskAbortError}.\n     * * If the task is already `\"running\"` or `\"completed\"` nothing happens.\n     *\n     * @returns `true` when the task was successfully canceled,\n     *          otherwise `false`.\n     *\n     * @example\n     * ```ts\n     * const t = queueAsyncTask(fetchData, { delay: 300 });\n     * // user typed again before the debounce expired\n     * if (t.cancel()) console.log('Previous fetch aborted');\n     * ```\n     */\n    cancel() {\n        if (this._timerId !== undefined) {\n            clearTimeout(this._timerId);\n            --pendingAsyncCount;\n            this._timerId = undefined;\n            this._status = tsCanceled;\n            const abortErr = new TaskAbortError(this);\n            this._reject(abortErr);\n            // Attach a noop-catch so the promise is immediately handled and the host never\n            // emits an `unhandledRejection` for a *normal* cancel.\n            //\n            // IMPORTANT \n            // - `cancel()` MUST ONLY reject with the `TaskAbortError` we just created.\n            //   Nothing else is allowed to flow through `_reject()` here.\n            // - If you ever change that invariant (e.g. forward another error or add\n            //   logging-failures), you **must** either:\n            //     1. push the new error into `taskErrors` so the scheduler's aggregator\n            //        surfaces it, or\n            //     2. replace this with a *selective* handler that re-throws anything that\n            //        isn't a TaskAbortError.\n            //   Failing to do so will silently swallow real errors in dev builds.\n            void this._result.catch(noop);\n            signalSettled(true);\n            return true;\n        }\n        if (this._status === tsPending) {\n            const idx = queue.indexOf(this);\n            if (idx > -1) {\n                queue.splice(idx, 1);\n                this._status = tsCanceled;\n                const abortErr = new TaskAbortError(this);\n                this._reject(abortErr);\n                void this._result.catch(noop);\n                signalSettled(true);\n                return true;\n            }\n        }\n        return false;\n    }\n}\n/** @internal */\nTask._taskId = 0;\n/**\n * Queue a callback to run **repeatedly** on a given interval, managed by\n * Aurelia's central scheduler.\n *\n * Unlike a one-off task from {@link queueAsyncTask}, this creates a persistent,\n * timer-based operation that continues until explicitly canceled. Each\n * execution of the callback is pushed onto the normal task queue, ensuring\n * it runs with the same timing and error-handling as other framework tasks.\n *\n * This is useful for polling or any periodic background work that needs to be\n * test-friendly and integrated with Aurelia's life-cycle.\n *\n * @param callback  - The function to execute on each interval. Any exception\n *                    it throws is captured and surfaced collectively via\n *                    `tasksSettled()` or `runTasks()` (after awaiting `task.next()`).\n * @param opts.interval  - The delay **in milliseconds** between the end of one\n *                         execution and the start of the next. Defaults to `0`.\n * @returns A {@link RecurringTask} handle that lets you `cancel()` the\n *                                  repetition or use `await task.next()` to wait for\n *                                  the next run.\n */\nconst queueRecurringTask = (callback, opts) => {\n    const task = new RecurringTask(callback, Math.max(opts?.interval ?? 0, 0));\n    recurringTasks.push(task);\n    task._start();\n    return task;\n};\n/**\n * A handle returned by {@link queueRecurringTask} that lets you observe and\n * control a periodic, repeating task.\n *\n * Unlike a single-use {@link Task}, a `RecurringTask` does not have a status\n * or a final `result` promise. Instead, it continues to schedule itself on a\n * given interval until it is explicitly stopped.\n */\nclass RecurringTask {\n    constructor(_callback, _interval) {\n        this._callback = _callback;\n        this._interval = _interval;\n        this.id = ++RecurringTask._nextId;\n        /** @internal */\n        this._canceled = false;\n        /** @internal */\n        this._nextResolvers = [];\n    }\n    /** @internal */\n    run() {\n        try {\n            // TODO: possibly store return value to connect to resolver\n            this._callback();\n        }\n        catch (err) {\n            taskErrors.push(err);\n            return;\n        }\n    }\n    /** @internal */\n    _start() {\n        if (this._canceled) {\n            return;\n        }\n        this._timerId = setTimeout(() => {\n            this._tick();\n            if (!this._canceled) {\n                this._start();\n            }\n        }, this._interval);\n    }\n    /** @internal */\n    _tick() {\n        queue.push(this);\n        requestRun();\n        const resolvers = this._nextResolvers.splice(0);\n        for (const resolver of resolvers) {\n            resolver();\n        }\n    }\n    /**\n     * Returns a promise that resolves after the next time the task's callback\n     * is queued for execution.\n     *\n     * This is useful for synchronizing other work with the task's interval,\n     * especially in tests. If the task has already been canceled, it returns an\n     * immediately-resolved promise.\n     *\n     * @returns A promise that resolves when the next interval occurs.\n     *\n     * @example\n     * Synchronizing with a polling task in a test\n     * ```ts\n     * it('updates data on a polling interval', async () => {\n     *   let count = 0;\n     *   const poller = queueRecurringTask(() => count++, { interval: 100 });\n     *\n     *   await poller.next();\n     *   await tasksSettled();\n     *   expect(count).toBe(1);\n     *\n     *   await poller.next();\n     *   await tasksSettled();\n     *   expect(count).toBe(2);\n     *\n     *   poller.cancel();\n     * });\n     * ```\n     */\n    next() {\n        if (this._canceled) {\n            return Promise.resolve();\n        }\n        return new Promise(resolve => this._nextResolvers.push(resolve));\n    }\n    /**\n     * Permanently stops the recurring task.\n     *\n     * This action clears any pending timer, prevents future executions, removes\n     * the task from the scheduler's list of recurring tasks, and immediately\n     * resolves any pending promises created by `next()`.\n     *\n     * Once canceled, a recurring task cannot be restarted.\n     */\n    cancel() {\n        this._canceled = true;\n        if (this._timerId !== undefined) {\n            clearTimeout(this._timerId);\n            this._timerId = undefined;\n        }\n        const idx = recurringTasks.indexOf(this);\n        if (idx > -1) {\n            recurringTasks.splice(idx, 1);\n        }\n        const resolvers = this._nextResolvers.splice(0);\n        for (const resolve of resolvers) {\n            resolve();\n        }\n    }\n}\n/** @internal */\nRecurringTask._nextId = 0;\n\nconst ICoercionConfiguration = /*@__PURE__*/ DI.createInterface('ICoercionConfiguration');\n/** @internal */ const atNone = 0b0_000_000;\n/** @internal */ const atObserver = 0b0_000_001;\n/** @internal */ const atNode = 0b0_000_010;\n/** @internal */ const atLayout = 0b0_000_100;\nconst AccessorType = /*@__PURE__*/ rtObjectFreeze({\n    None: atNone,\n    Observer: atObserver,\n    Node: atNode,\n    // misc characteristic of accessors/observers when update\n    //\n    // by default, everything is synchronous\n    // except changes that are supposed to cause reflow/heavy computation\n    // an observer can use this flag to signal binding that don't carelessly tell it to update\n    // queue it instead\n    // todo: https://gist.github.com/paulirish/5d52fb081b3570c81e3a\n    // todo: https://csstriggers.com/\n    Layout: atLayout,\n});\nfunction copyIndexMap(existing, deletedIndices, deletedItems) {\n    const { length } = existing;\n    const arr = Array(length);\n    let i = 0;\n    while (i < length) {\n        arr[i] = existing[i];\n        ++i;\n    }\n    if (deletedIndices !== void 0) {\n        arr.deletedIndices = deletedIndices.slice(0);\n    }\n    else if (existing.deletedIndices !== void 0) {\n        arr.deletedIndices = existing.deletedIndices.slice(0);\n    }\n    else {\n        arr.deletedIndices = [];\n    }\n    if (deletedItems !== void 0) {\n        arr.deletedItems = deletedItems.slice(0);\n    }\n    else if (existing.deletedItems !== void 0) {\n        arr.deletedItems = existing.deletedItems.slice(0);\n    }\n    else {\n        arr.deletedItems = [];\n    }\n    arr.isIndexMap = true;\n    return arr;\n}\nfunction createIndexMap(length = 0) {\n    const arr = Array(length);\n    let i = 0;\n    while (i < length) {\n        arr[i] = i++;\n    }\n    arr.deletedIndices = [];\n    arr.deletedItems = [];\n    arr.isIndexMap = true;\n    return arr;\n}\nfunction cloneIndexMap(indexMap) {\n    const clone = indexMap.slice();\n    clone.deletedIndices = indexMap.deletedIndices.slice();\n    clone.deletedItems = indexMap.deletedItems.slice();\n    clone.isIndexMap = true;\n    return clone;\n}\nfunction isIndexMap(value) {\n    return isArray(value) && value.isIndexMap === true;\n}\n\nlet currBatch = new Map();\n// eslint-disable-next-line import/no-mutable-exports\nlet batching = false;\nfunction batch(fn) {\n    const prevBatch = currBatch;\n    const newBatch = currBatch = new Map();\n    batching = true;\n    try {\n        fn();\n    }\n    finally {\n        currBatch = null;\n        batching = false;\n        try {\n            let pair;\n            let subs;\n            let batchRecord;\n            let col;\n            let indexMap;\n            let hasChanges = false;\n            let i;\n            let ii;\n            for (pair of newBatch) {\n                subs = pair[0];\n                batchRecord = pair[1];\n                if (prevBatch?.has(subs)) {\n                    prevBatch.set(subs, batchRecord);\n                }\n                if (batchRecord[0] === 1) {\n                    subs.notify(batchRecord[1], batchRecord[2]);\n                }\n                else {\n                    col = batchRecord[1];\n                    indexMap = batchRecord[2];\n                    hasChanges = false;\n                    if (indexMap.deletedIndices.length > 0) {\n                        hasChanges = true;\n                    }\n                    else {\n                        for (i = 0, ii = indexMap.length; i < ii; ++i) {\n                            if (indexMap[i] !== i) {\n                                hasChanges = true;\n                                break;\n                            }\n                        }\n                    }\n                    if (hasChanges) {\n                        subs.notifyCollection(col, indexMap);\n                    }\n                }\n            }\n        }\n        finally {\n            currBatch = prevBatch;\n        }\n    }\n}\nfunction addCollectionBatch(subs, collection, indexMap) {\n    if (!currBatch.has(subs)) {\n        currBatch.set(subs, [2, collection, indexMap]);\n    }\n    else {\n        currBatch.get(subs)[2] = indexMap;\n    }\n}\nfunction addValueBatch(subs, newValue, oldValue) {\n    const batchRecord = currBatch.get(subs);\n    if (batchRecord === void 0) {\n        currBatch.set(subs, [1, newValue, oldValue]);\n    }\n    else {\n        batchRecord[1] = newValue;\n        batchRecord[2] = oldValue;\n    }\n}\n\nconst subscriberCollection = /*@__PURE__*/ (() => {\n    function subscriberCollection(target, context) {\n        return target == null ? subscriberCollectionDeco : subscriberCollectionDeco(target);\n    }\n    function getSubscriberRecord() {\n        return rtDefineHiddenProp(this, 'subs', new SubscriberRecord());\n    }\n    function addSubscriber(subscriber) {\n        return this.subs.add(subscriber);\n    }\n    function removeSubscriber(subscriber) {\n        return this.subs.remove(subscriber);\n    }\n    const decoratedTarget = new WeakSet();\n    function subscriberCollectionDeco(target, context) {\n        if (!decoratedTarget.has(target)) {\n            decoratedTarget.add(target);\n            const proto = target.prototype;\n            // not configurable, as in devtool, the getter could be invoked on the prototype,\n            // and become permanently broken\n            rtDef(proto, 'subs', { get: getSubscriberRecord });\n            ensureProto(proto, 'subscribe', addSubscriber);\n            ensureProto(proto, 'unsubscribe', removeSubscriber);\n        }\n        return target;\n    }\n    class SubscriberRecord {\n        constructor() {\n            this.count = 0;\n            /** @internal */\n            this._subs = [];\n            /** @internal */\n            this._requestDirtySubs = [];\n            /** @internal */\n            this._hasDirtySubs = false;\n        }\n        add(subscriber) {\n            if (this._subs.includes(subscriber)) {\n                return false;\n            }\n            this._subs[this._subs.length] = subscriber;\n            if ('handleDirty' in subscriber) {\n                this._requestDirtySubs[this._requestDirtySubs.length] = subscriber;\n                this._hasDirtySubs = true;\n            }\n            ++this.count;\n            return true;\n        }\n        remove(subscriber) {\n            let idx = this._subs.indexOf(subscriber);\n            if (idx !== -1) {\n                this._subs.splice(idx, 1);\n                idx = this._requestDirtySubs.indexOf(subscriber);\n                if (idx !== -1) {\n                    this._requestDirtySubs.splice(idx, 1);\n                    this._hasDirtySubs = this._requestDirtySubs.length > 0;\n                }\n                --this.count;\n                return true;\n            }\n            return false;\n        }\n        notify(val, oldVal) {\n            if (batching) {\n                addValueBatch(this, val, oldVal);\n                return;\n            }\n            /**\n             * Note: change handlers may have the side-effect of adding/removing subscribers to this collection during this\n             * callSubscribers invocation, so we're caching them all before invoking any.\n             * Subscribers added during this invocation are not invoked (and they shouldn't be).\n             * Subscribers removed during this invocation will still be invoked (and they also shouldn't be,\n             * however this is accounted for via $isBound and similar flags on the subscriber objects)\n             */\n            for (const sub of this._subs.slice(0)) {\n                sub.handleChange(val, oldVal);\n            }\n        }\n        notifyCollection(collection, indexMap) {\n            const _subs = this._subs.slice(0);\n            const len = _subs.length;\n            let i = 0;\n            for (; i < len; ++i) {\n                _subs[i].handleCollectionChange(collection, indexMap);\n            }\n            return;\n        }\n        notifyDirty() {\n            if (this._hasDirtySubs) {\n                for (const dirtySub of this._requestDirtySubs.slice(0)) {\n                    dirtySub.handleDirty();\n                }\n            }\n        }\n    }\n    return subscriberCollection;\n})();\n\nclass CollectionLengthObserver {\n    constructor(owner) {\n        this.owner = owner;\n        this.type = atObserver;\n        this._value = (this._obj = owner.collection).length;\n    }\n    getValue() {\n        return this._obj.length;\n    }\n    setValue(newValue) {\n        // if in the template, length is two-way bound directly\n        // then there's a chance that the new value is invalid\n        // add a guard so that we don't accidentally broadcast invalid values\n        if (newValue !== this._value) {\n            if (!Number.isNaN(newValue)) {\n                this._obj.splice(newValue);\n                this._value = this._obj.length;\n                // todo: maybe use splice so that it'll notify everything properly\n                // this._obj.length = newValue;\n                // this.subs.notify(newValue, currentValue);\n            }\n            else {\n                // eslint-disable-next-line no-console\n                console.warn(`Invalid value \"${newValue}\" for array length`);\n            }\n        }\n    }\n    handleDirty() {\n        if (this._value !== this._obj.length) {\n            this.subs.notifyDirty();\n        }\n    }\n    handleCollectionChange(_arr, _) {\n        const oldValue = this._value;\n        const value = this._obj.length;\n        if ((this._value = value) !== oldValue) {\n            this.subs.notifyDirty();\n            this.subs.notify(this._value, oldValue);\n        }\n    }\n}\n(() => {\n    implementLengthObserver(CollectionLengthObserver);\n})();\nclass CollectionSizeObserver {\n    constructor(owner) {\n        this.owner = owner;\n        this.type = atObserver;\n        this._value = (this._obj = owner.collection).size;\n    }\n    getValue() {\n        return this._obj.size;\n    }\n    setValue() {\n        throw createMappedError(220 /* ErrorNames.assign_readonly_size */);\n    }\n    handleDirty() {\n        if (this._value !== this._obj.size) {\n            this.subs.notifyDirty();\n        }\n    }\n    handleCollectionChange(_collection, _) {\n        const oldValue = this._value;\n        const value = this._obj.size;\n        if ((this._value = value) !== oldValue) {\n            this.subs.notify(this._value, oldValue);\n        }\n    }\n}\n(() => {\n    implementLengthObserver(CollectionSizeObserver);\n})();\nfunction implementLengthObserver(klass) {\n    const proto = klass.prototype;\n    ensureProto(proto, 'subscribe', subscribe);\n    ensureProto(proto, 'unsubscribe', unsubscribe);\n    return subscriberCollection(klass, null);\n}\nfunction subscribe(subscriber) {\n    if (this.subs.add(subscriber) && this.subs.count === 1) {\n        this.owner.subscribe(this);\n    }\n}\nfunction unsubscribe(subscriber) {\n    if (this.subs.remove(subscriber) && this.subs.count === 0) {\n        this.owner.subscribe(this);\n    }\n}\n\nconst getArrayObserver = /*@__PURE__*/ (() => {\n    // multiple applications of Aurelia wouldn't have different observers for the same Array object\n    const lookupMetadataKey = Symbol.for('__au_arr_obs__');\n    const observerLookup = (Array[lookupMetadataKey]\n        ?? rtDefineHiddenProp(Array, lookupMetadataKey, new WeakMap()));\n    // https://tc39.github.io/ecma262/#sec-sortcompare\n    function sortCompare(x, y) {\n        if (x === y) {\n            return 0;\n        }\n        x = x === null ? 'null' : x.toString();\n        y = y === null ? 'null' : y.toString();\n        return x < y ? -1 : 1;\n    }\n    function preSortCompare(x, y) {\n        if (x === void 0) {\n            if (y === void 0) {\n                return 0;\n            }\n            else {\n                return 1;\n            }\n        }\n        if (y === void 0) {\n            return -1;\n        }\n        return 0;\n    }\n    function insertionSort(arr, indexMap, from, to, compareFn) {\n        let velement, ielement, vtmp, itmp, order;\n        let i, j;\n        for (i = from + 1; i < to; i++) {\n            velement = arr[i];\n            ielement = indexMap[i];\n            for (j = i - 1; j >= from; j--) {\n                vtmp = arr[j];\n                itmp = indexMap[j];\n                order = compareFn(vtmp, velement);\n                if (order > 0) {\n                    arr[j + 1] = vtmp;\n                    indexMap[j + 1] = itmp;\n                }\n                else {\n                    break;\n                }\n            }\n            arr[j + 1] = velement;\n            indexMap[j + 1] = ielement;\n        }\n    }\n    function quickSort(arr, indexMap, from, to, compareFn) {\n        let thirdIndex = 0, i = 0;\n        let v0, v1, v2;\n        let i0, i1, i2;\n        let c01, c02, c12;\n        let vtmp, itmp;\n        let vpivot, ipivot, lowEnd, highStart;\n        let velement, ielement, order, vtopElement;\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n            if (to - from <= 10) {\n                insertionSort(arr, indexMap, from, to, compareFn);\n                return;\n            }\n            thirdIndex = from + ((to - from) >> 1);\n            v0 = arr[from];\n            i0 = indexMap[from];\n            v1 = arr[to - 1];\n            i1 = indexMap[to - 1];\n            v2 = arr[thirdIndex];\n            i2 = indexMap[thirdIndex];\n            c01 = compareFn(v0, v1);\n            if (c01 > 0) {\n                vtmp = v0;\n                itmp = i0;\n                v0 = v1;\n                i0 = i1;\n                v1 = vtmp;\n                i1 = itmp;\n            }\n            c02 = compareFn(v0, v2);\n            if (c02 >= 0) {\n                vtmp = v0;\n                itmp = i0;\n                v0 = v2;\n                i0 = i2;\n                v2 = v1;\n                i2 = i1;\n                v1 = vtmp;\n                i1 = itmp;\n            }\n            else {\n                c12 = compareFn(v1, v2);\n                if (c12 > 0) {\n                    vtmp = v1;\n                    itmp = i1;\n                    v1 = v2;\n                    i1 = i2;\n                    v2 = vtmp;\n                    i2 = itmp;\n                }\n            }\n            arr[from] = v0;\n            indexMap[from] = i0;\n            arr[to - 1] = v2;\n            indexMap[to - 1] = i2;\n            vpivot = v1;\n            ipivot = i1;\n            lowEnd = from + 1;\n            highStart = to - 1;\n            arr[thirdIndex] = arr[lowEnd];\n            indexMap[thirdIndex] = indexMap[lowEnd];\n            arr[lowEnd] = vpivot;\n            indexMap[lowEnd] = ipivot;\n            partition: for (i = lowEnd + 1; i < highStart; i++) {\n                velement = arr[i];\n                ielement = indexMap[i];\n                order = compareFn(velement, vpivot);\n                if (order < 0) {\n                    arr[i] = arr[lowEnd];\n                    indexMap[i] = indexMap[lowEnd];\n                    arr[lowEnd] = velement;\n                    indexMap[lowEnd] = ielement;\n                    lowEnd++;\n                }\n                else if (order > 0) {\n                    do {\n                        highStart--;\n                        // eslint-disable-next-line eqeqeq\n                        if (highStart == i) {\n                            break partition;\n                        }\n                        vtopElement = arr[highStart];\n                        order = compareFn(vtopElement, vpivot);\n                    } while (order > 0);\n                    arr[i] = arr[highStart];\n                    indexMap[i] = indexMap[highStart];\n                    arr[highStart] = velement;\n                    indexMap[highStart] = ielement;\n                    if (order < 0) {\n                        velement = arr[i];\n                        ielement = indexMap[i];\n                        arr[i] = arr[lowEnd];\n                        indexMap[i] = indexMap[lowEnd];\n                        arr[lowEnd] = velement;\n                        indexMap[lowEnd] = ielement;\n                        lowEnd++;\n                    }\n                }\n            }\n            if (to - highStart < lowEnd - from) {\n                quickSort(arr, indexMap, highStart, to, compareFn);\n                to = lowEnd;\n            }\n            else {\n                quickSort(arr, indexMap, from, lowEnd, compareFn);\n                from = highStart;\n            }\n        }\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const proto = Array.prototype;\n    const methods = ['push', 'unshift', 'pop', 'shift', 'splice', 'reverse', 'sort'];\n    let observe;\n    // let native: undefined | Pick<typeof proto, typeof methods[number]>;\n    function overrideArrayPrototypes() {\n        const $push = proto.push;\n        const $unshift = proto.unshift;\n        const $pop = proto.pop;\n        const $shift = proto.shift;\n        const $splice = proto.splice;\n        const $reverse = proto.reverse;\n        const $sort = proto.sort;\n        // native = { push: $push, unshift: $unshift, pop: $pop, shift: $shift, splice: $splice, reverse: $reverse, sort: $sort };\n        observe = {\n            // https://tc39.github.io/ecma262/#sec-array.prototype.push\n            push: function (...args) {\n                const o = observerLookup.get(this);\n                if (o === void 0) {\n                    return $push.apply(this, args);\n                }\n                const len = this.length;\n                const argCount = args.length;\n                if (argCount === 0) {\n                    return len;\n                }\n                this.length = o.indexMap.length = len + argCount;\n                let i = len;\n                while (i < this.length) {\n                    this[i] = args[i - len];\n                    o.indexMap[i] = -2;\n                    i++;\n                }\n                o.notify();\n                return this.length;\n            },\n            // https://tc39.github.io/ecma262/#sec-array.prototype.unshift\n            unshift: function (...args) {\n                const o = observerLookup.get(this);\n                if (o === void 0) {\n                    return $unshift.apply(this, args);\n                }\n                const argCount = args.length;\n                const inserts = new Array(argCount);\n                let i = 0;\n                while (i < argCount) {\n                    inserts[i++] = -2;\n                }\n                $unshift.apply(o.indexMap, inserts);\n                const len = $unshift.apply(this, args);\n                o.notify();\n                return len;\n            },\n            // https://tc39.github.io/ecma262/#sec-array.prototype.pop\n            pop: function () {\n                const o = observerLookup.get(this);\n                if (o === void 0) {\n                    return $pop.call(this);\n                }\n                const indexMap = o.indexMap;\n                const element = $pop.call(this);\n                // only mark indices as deleted if they actually existed in the original array\n                const index = indexMap.length - 1;\n                if (indexMap[index] > -1) {\n                    indexMap.deletedIndices.push(indexMap[index]);\n                    indexMap.deletedItems.push(element);\n                }\n                $pop.call(indexMap);\n                o.notify();\n                return element;\n            },\n            // https://tc39.github.io/ecma262/#sec-array.prototype.shift\n            shift: function () {\n                const o = observerLookup.get(this);\n                if (o === void 0) {\n                    return $shift.call(this);\n                }\n                const indexMap = o.indexMap;\n                const element = $shift.call(this);\n                // only mark indices as deleted if they actually existed in the original array\n                if (indexMap[0] > -1) {\n                    indexMap.deletedIndices.push(indexMap[0]);\n                    indexMap.deletedItems.push(element);\n                }\n                $shift.call(indexMap);\n                o.notify();\n                return element;\n            },\n            // https://tc39.github.io/ecma262/#sec-array.prototype.splice\n            splice: function (...args) {\n                const start = args[0];\n                const deleteCount = args[1];\n                const o = observerLookup.get(this);\n                if (o === void 0) {\n                    return $splice.apply(this, args);\n                }\n                const len = this.length;\n                const relativeStart = start | 0;\n                const actualStart = relativeStart < 0 ? Math.max((len + relativeStart), 0) : Math.min(relativeStart, len);\n                const indexMap = o.indexMap;\n                const argCount = args.length;\n                const actualDeleteCount = argCount === 0 ? 0 : argCount === 1 ? len - actualStart : deleteCount;\n                let i = actualStart;\n                if (actualDeleteCount > 0) {\n                    const to = i + actualDeleteCount;\n                    while (i < to) {\n                        // only mark indices as deleted if they actually existed in the original array\n                        if (indexMap[i] > -1) {\n                            indexMap.deletedIndices.push(indexMap[i]);\n                            indexMap.deletedItems.push(this[i]);\n                        }\n                        i++;\n                    }\n                }\n                i = 0;\n                if (argCount > 2) {\n                    const itemCount = argCount - 2;\n                    const inserts = new Array(itemCount);\n                    while (i < itemCount) {\n                        inserts[i++] = -2;\n                    }\n                    $splice.call(indexMap, start, deleteCount, ...inserts);\n                }\n                else {\n                    $splice.apply(indexMap, args);\n                }\n                const deleted = $splice.apply(this, args);\n                // only notify when there's deletion, or addition\n                if (actualDeleteCount > 0 || i > 0) {\n                    o.notify();\n                }\n                return deleted;\n            },\n            // https://tc39.github.io/ecma262/#sec-array.prototype.reverse\n            reverse: function () {\n                const o = observerLookup.get(this);\n                if (o === void 0) {\n                    $reverse.call(this);\n                    return this;\n                }\n                const len = this.length;\n                const middle = (len / 2) | 0;\n                let lower = 0;\n                while (lower !== middle) {\n                    const upper = len - lower - 1;\n                    const lowerValue = this[lower];\n                    const lowerIndex = o.indexMap[lower];\n                    const upperValue = this[upper];\n                    const upperIndex = o.indexMap[upper];\n                    this[lower] = upperValue;\n                    o.indexMap[lower] = upperIndex;\n                    this[upper] = lowerValue;\n                    o.indexMap[upper] = lowerIndex;\n                    lower++;\n                }\n                o.notify();\n                return this;\n            },\n            // https://tc39.github.io/ecma262/#sec-array.prototype.sort\n            // https://github.com/v8/v8/blob/master/src/js/array.js\n            sort: function (compareFn) {\n                const o = observerLookup.get(this);\n                if (o === void 0) {\n                    $sort.call(this, compareFn);\n                    return this;\n                }\n                let len = this.length;\n                if (len < 2) {\n                    return this;\n                }\n                quickSort(this, o.indexMap, 0, len, preSortCompare);\n                let i = 0;\n                while (i < len) {\n                    if (this[i] === void 0) {\n                        break;\n                    }\n                    i++;\n                }\n                if (compareFn === void 0 || !isFunction(compareFn) /* spec says throw a TypeError, should we do that too? */) {\n                    compareFn = sortCompare;\n                }\n                quickSort(this, o.indexMap, 0, i, compareFn);\n                // todo(fred): it shouldn't notify if the sort produce a stable array:\n                //             where every item has the same index before/after\n                //             though this is inefficient we loop a few times like this\n                let shouldNotify = false;\n                for (i = 0, len = o.indexMap.length; len > i; ++i) {\n                    if (o.indexMap[i] !== i) {\n                        shouldNotify = true;\n                        break;\n                    }\n                }\n                if (shouldNotify || batching) {\n                    o.notify();\n                }\n                return this;\n            }\n        };\n        for (const method of methods) {\n            rtDef(observe[method], 'observing', { value: true });\n        }\n    }\n    let enableArrayObservationCalled = false;\n    const observationEnabledKey = '__au_arr_on__';\n    function enableArrayObservation() {\n        if (observe === undefined) {\n            overrideArrayPrototypes();\n        }\n        // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n        if (!(rtGetMetadata(observationEnabledKey, Array) ?? false)) {\n            rtDefineMetadata(true, Array, observationEnabledKey);\n            for (const method of methods) {\n                if (proto[method].observing !== true) {\n                    rtDefineHiddenProp(proto, method, observe[method]);\n                }\n            }\n        }\n    }\n    class ArrayObserverImpl {\n        constructor(array) {\n            this.type = atObserver;\n            if (!enableArrayObservationCalled) {\n                enableArrayObservationCalled = true;\n                enableArrayObservation();\n            }\n            this.indexObservers = {};\n            this.collection = array;\n            this.indexMap = createIndexMap(array.length);\n            this.lenObs = void 0;\n            observerLookup.set(array, this);\n        }\n        notify() {\n            const subs = this.subs;\n            subs.notifyDirty();\n            const indexMap = this.indexMap;\n            if (batching) {\n                addCollectionBatch(subs, this.collection, indexMap);\n                return;\n            }\n            const arr = this.collection;\n            const length = arr.length;\n            this.indexMap = createIndexMap(length);\n            subs.notifyCollection(arr, indexMap);\n        }\n        getLengthObserver() {\n            return this.lenObs ??= new CollectionLengthObserver(this);\n        }\n        getIndexObserver(index) {\n            // It's unnecessary to destroy/recreate index observer all the time,\n            // so just create once, and add/remove instead\n            return this.indexObservers[index] ??= new ArrayIndexObserverImpl(this, index);\n        }\n    }\n    (() => {\n        subscriberCollection(ArrayObserverImpl, null);\n    })();\n    class ArrayIndexObserverImpl {\n        constructor(owner, index) {\n            this.owner = owner;\n            this.index = index;\n            this.doNotCache = true;\n            this.value = this.getValue();\n        }\n        getValue() {\n            return this.owner.collection[this.index];\n        }\n        setValue(newValue) {\n            if (newValue === this.getValue()) {\n                return;\n            }\n            const arrayObserver = this.owner;\n            const index = this.index;\n            const indexMap = arrayObserver.indexMap;\n            if (indexMap[index] > -1) {\n                indexMap.deletedIndices.push(indexMap[index]);\n            }\n            indexMap[index] = -2;\n            // do not need to update current value here\n            // as it will be updated inside handle collection change\n            arrayObserver.collection[index] = newValue;\n            arrayObserver.notify();\n        }\n        handleDirty() {\n            if (this.value !== this.getValue()) {\n                this.subs.notifyDirty();\n            }\n        }\n        /**\n         * From interface `ICollectionSubscriber`\n         */\n        handleCollectionChange(_arr, indexMap) {\n            const index = this.index;\n            const noChange = indexMap[index] === index;\n            if (noChange) {\n                return;\n            }\n            const prevValue = this.value;\n            const currValue = this.value = this.getValue();\n            if (prevValue !== currValue) {\n                this.subs.notify(currValue, prevValue);\n            }\n        }\n        subscribe(subscriber) {\n            if (this.subs.add(subscriber) && this.subs.count === 1) {\n                this.owner.subscribe(this);\n            }\n        }\n        unsubscribe(subscriber) {\n            if (this.subs.remove(subscriber) && this.subs.count === 0) {\n                this.owner.unsubscribe(this);\n            }\n        }\n    }\n    (() => {\n        subscriberCollection(ArrayIndexObserverImpl, null);\n    })();\n    return function getArrayObserver(array) {\n        let observer = observerLookup.get(array);\n        if (observer === void 0) {\n            observerLookup.set(array, observer = new ArrayObserverImpl(array));\n            enableArrayObservation();\n        }\n        return observer;\n    };\n})();\n\nconst getSetObserver = /*@__PURE__*/ (() => {\n    // multiple applications of Aurelia wouldn't have different observers for the same Set object\n    const lookupMetadataKey = Symbol.for('__au_set_obs__');\n    const observerLookup = (Set[lookupMetadataKey]\n        ?? rtDefineHiddenProp(Set, lookupMetadataKey, new WeakMap()));\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const { add: $add, clear: $clear, delete: $delete } = Set.prototype;\n    const methods = ['add', 'clear', 'delete'];\n    // note: we can't really do much with Set due to the internal data structure not being accessible so we're just using the native calls\n    // fortunately, add/delete/clear are easy to reconstruct for the indexMap\n    const observe = {\n        // https://tc39.github.io/ecma262/#sec-set.prototype.add\n        add: function (value) {\n            const o = observerLookup.get(this);\n            if (o === undefined) {\n                $add.call(this, value);\n                return this;\n            }\n            const oldSize = this.size;\n            $add.call(this, value);\n            const newSize = this.size;\n            if (newSize === oldSize) {\n                return this;\n            }\n            o.indexMap[oldSize] = -2;\n            o.notify();\n            return this;\n        },\n        // https://tc39.github.io/ecma262/#sec-set.prototype.clear\n        clear: function () {\n            const o = observerLookup.get(this);\n            if (o === undefined) {\n                return $clear.call(this);\n            }\n            const size = this.size;\n            if (size > 0) {\n                const indexMap = o.indexMap;\n                let i = 0;\n                // deepscan-disable-next-line\n                for (const key of this.keys()) {\n                    if (indexMap[i] > -1) {\n                        indexMap.deletedIndices.push(indexMap[i]);\n                        indexMap.deletedItems.push(key);\n                    }\n                    i++;\n                }\n                $clear.call(this);\n                indexMap.length = 0;\n                o.notify();\n            }\n            return undefined;\n        },\n        // https://tc39.github.io/ecma262/#sec-set.prototype.delete\n        delete: function (value) {\n            const o = observerLookup.get(this);\n            if (o === undefined) {\n                return $delete.call(this, value);\n            }\n            const size = this.size;\n            if (size === 0) {\n                return false;\n            }\n            let i = 0;\n            const indexMap = o.indexMap;\n            for (const entry of this.keys()) {\n                if (entry === value) {\n                    if (indexMap[i] > -1) {\n                        indexMap.deletedIndices.push(indexMap[i]);\n                        indexMap.deletedItems.push(entry);\n                    }\n                    indexMap.splice(i, 1);\n                    const deleteResult = $delete.call(this, value);\n                    if (deleteResult === true) {\n                        o.notify();\n                    }\n                    return deleteResult;\n                }\n                i++;\n            }\n            return false;\n        }\n    };\n    function enableSetObservation(set) {\n        for (const method of methods) {\n            rtDefineHiddenProp(set, method, observe[method]);\n        }\n    }\n    class SetObserverImpl {\n        constructor(observedSet) {\n            this.type = atObserver;\n            this.collection = observedSet;\n            this.indexMap = createIndexMap(observedSet.size);\n            this.lenObs = void 0;\n        }\n        notify() {\n            const subs = this.subs;\n            subs.notifyDirty();\n            const indexMap = this.indexMap;\n            if (batching) {\n                addCollectionBatch(subs, this.collection, indexMap);\n                return;\n            }\n            const set = this.collection;\n            const size = set.size;\n            this.indexMap = createIndexMap(size);\n            subs.notifyCollection(set, indexMap);\n        }\n        getLengthObserver() {\n            return this.lenObs ??= new CollectionSizeObserver(this);\n        }\n    }\n    subscriberCollection(SetObserverImpl, null);\n    return function getSetObserver(set) {\n        let observer = observerLookup.get(set);\n        if (observer === void 0) {\n            observerLookup.set(set, observer = new SetObserverImpl(set));\n            enableSetObservation(set);\n        }\n        return observer;\n    };\n})();\n\nconst getMapObserver = /*@__PURE__*/ (() => {\n    // multiple applications of Aurelia wouldn't have different observers for the same Map object\n    const lookupMetadataKey = Symbol.for('__au_map_obs__');\n    const observerLookup = (Map[lookupMetadataKey]\n        ?? rtDefineHiddenProp(Map, lookupMetadataKey, new WeakMap()));\n    const { set: $set, clear: $clear, delete: $delete } = Map.prototype;\n    const methods = ['set', 'clear', 'delete'];\n    // note: we can't really do much with Map due to the internal data structure not being accessible so we're just using the native calls\n    // fortunately, map/delete/clear are easy to reconstruct for the indexMap\n    const observe = {\n        // https://tc39.github.io/ecma262/#sec-map.prototype.map\n        set: function (key, value) {\n            const o = observerLookup.get(this);\n            if (o === undefined) {\n                $set.call(this, key, value);\n                return this;\n            }\n            const oldValue = this.get(key);\n            const oldSize = this.size;\n            $set.call(this, key, value);\n            const newSize = this.size;\n            if (newSize === oldSize) {\n                let i = 0;\n                for (const entry of this.entries()) {\n                    if (entry[0] === key) {\n                        if (entry[1] !== oldValue) {\n                            o.indexMap.deletedIndices.push(o.indexMap[i]);\n                            o.indexMap.deletedItems.push(entry);\n                            o.indexMap[i] = -2;\n                            o.notify();\n                        }\n                        return this;\n                    }\n                    i++;\n                }\n                return this;\n            }\n            o.indexMap[oldSize] = -2;\n            o.notify();\n            return this;\n        },\n        // https://tc39.github.io/ecma262/#sec-map.prototype.clear\n        clear: function () {\n            const o = observerLookup.get(this);\n            if (o === undefined) {\n                return $clear.call(this);\n            }\n            const size = this.size;\n            if (size > 0) {\n                const indexMap = o.indexMap;\n                let i = 0;\n                // deepscan-disable-next-line\n                for (const key of this.keys()) {\n                    if (indexMap[i] > -1) {\n                        indexMap.deletedIndices.push(indexMap[i]);\n                        indexMap.deletedItems.push(key);\n                    }\n                    i++;\n                }\n                $clear.call(this);\n                indexMap.length = 0;\n                o.notify();\n            }\n            return undefined;\n        },\n        // https://tc39.github.io/ecma262/#sec-map.prototype.delete\n        delete: function (value) {\n            const o = observerLookup.get(this);\n            if (o === undefined) {\n                return $delete.call(this, value);\n            }\n            const size = this.size;\n            if (size === 0) {\n                return false;\n            }\n            let i = 0;\n            const indexMap = o.indexMap;\n            for (const entry of this.keys()) {\n                if (entry === value) {\n                    if (indexMap[i] > -1) {\n                        indexMap.deletedIndices.push(indexMap[i]);\n                        indexMap.deletedItems.push(entry);\n                    }\n                    indexMap.splice(i, 1);\n                    const deleteResult = $delete.call(this, value);\n                    if (deleteResult === true) {\n                        o.notify();\n                    }\n                    return deleteResult;\n                }\n                ++i;\n            }\n            return false;\n        }\n    };\n    function enableMapObservation(map) {\n        for (const method of methods) {\n            rtDefineHiddenProp(map, method, observe[method]);\n        }\n    }\n    class MapObserverImpl {\n        constructor(map) {\n            this.type = atObserver;\n            this.collection = map;\n            this.indexMap = createIndexMap(map.size);\n            this.lenObs = void 0;\n        }\n        notify() {\n            const subs = this.subs;\n            subs.notifyDirty();\n            const indexMap = this.indexMap;\n            if (batching) {\n                addCollectionBatch(subs, this.collection, indexMap);\n                return;\n            }\n            const map = this.collection;\n            const size = map.size;\n            this.indexMap = createIndexMap(size);\n            subs.notifyCollection(map, indexMap);\n        }\n        getLengthObserver() {\n            return this.lenObs ??= new CollectionSizeObserver(this);\n        }\n    }\n    subscriberCollection(MapObserverImpl, null);\n    return function getMapObserver(map) {\n        let observer = observerLookup.get(map);\n        if (observer === void 0) {\n            observerLookup.set(map, observer = new MapObserverImpl(map));\n            enableMapObservation(map);\n        }\n        return observer;\n    };\n})();\n\nconst connectableDecorator = /*@__PURE__*/ (() => {\n    class BindingObserverRecord {\n        constructor(b) {\n            this.version = 0;\n            this.count = 0;\n            // a map of the observers (subscribables) that the owning binding of this record\n            // is currently subscribing to. The values are the version of the observers,\n            // as the observers version may need to be changed during different evaluation\n            /** @internal */\n            this.o = new Map();\n            this.b = b;\n        }\n        /**\n         * Add, and subscribe to a given observer\n         */\n        add(observer) {\n            if (!this.o.has(observer)) {\n                observer.subscribe(this.b);\n                ++this.count;\n            }\n            this.o.set(observer, this.version);\n        }\n        /**\n         * Unsubscribe the observers that are not up to date with the record version\n         */\n        clear() {\n            this.o.forEach(unsubscribeStale, this);\n            this.count = this.o.size;\n        }\n        clearAll() {\n            this.o.forEach(unsubscribeAll, this);\n            this.o.clear();\n            this.count = 0;\n        }\n    }\n    function unsubscribeAll(version, subscribable) {\n        subscribable.unsubscribe(this.b);\n    }\n    function unsubscribeStale(version, subscribable) {\n        if (this.version !== version) {\n            subscribable.unsubscribe(this.b);\n            this.o.delete(subscribable);\n        }\n    }\n    function getObserverRecord() {\n        return rtDefineHiddenProp(this, 'obs', new BindingObserverRecord(this));\n    }\n    function observe(obj, key) {\n        this.obs.add(this.oL.getObserver(obj, key));\n    }\n    function observeCollection(collection) {\n        let observer;\n        if (isArray(collection)) {\n            observer = getArrayObserver(collection);\n        }\n        else if (isSet(collection)) {\n            observer = getSetObserver(collection);\n        }\n        else if (isMap(collection)) {\n            observer = getMapObserver(collection);\n        }\n        else {\n            throw createMappedError(210 /* ErrorNames.non_recognisable_collection_type */, collection);\n        }\n        this.obs.add(observer);\n    }\n    function subscribeTo(subscribable) {\n        this.obs.add(subscribable);\n    }\n    function noopHandleChange() {\n        throw createMappedError(99 /* ErrorNames.method_not_implemented */, 'handleChange');\n    }\n    function noopHandleCollectionChange() {\n        throw createMappedError(99 /* ErrorNames.method_not_implemented */, 'handleCollectionChange');\n    }\n    return function connectableDecorator(target, context) {\n        const proto = target.prototype;\n        ensureProto(proto, 'observe', observe);\n        ensureProto(proto, 'observeCollection', observeCollection);\n        ensureProto(proto, 'subscribeTo', subscribeTo);\n        rtDef(proto, 'obs', { get: getObserverRecord });\n        // optionally add these two methods to normalize a connectable impl\n        // though don't override if it already exists\n        ensureProto(proto, 'handleChange', noopHandleChange);\n        ensureProto(proto, 'handleCollectionChange', noopHandleCollectionChange);\n        return target;\n    };\n})();\nfunction connectable(target, context) {\n    return target == null ? connectableDecorator : connectableDecorator(target, context);\n}\n\n/**\n * Current subscription collector\n */\n// eslint-disable-next-line import/no-mutable-exports\nlet _connectable = null;\nconst connectables = [];\n// eslint-disable-next-line\nlet connecting = false;\n// todo: layer based collection pause/resume?\nfunction pauseConnecting() {\n    connecting = false;\n}\nfunction resumeConnecting() {\n    connecting = true;\n}\nfunction currentConnectable() {\n    return _connectable;\n}\nfunction enterConnectable(connectable) {\n    if (connectable == null) {\n        throw createMappedError(206 /* ErrorNames.switch_on_null_connectable */);\n    }\n    if (_connectable == null) {\n        _connectable = connectable;\n        connectables[0] = _connectable;\n        connecting = true;\n        return;\n    }\n    if (_connectable === connectable) {\n        throw createMappedError(207 /* ErrorNames.switch_active_connectable */);\n    }\n    connectables.push(connectable);\n    _connectable = connectable;\n    connecting = true;\n}\nfunction exitConnectable(connectable) {\n    if (connectable == null) {\n        throw createMappedError(208 /* ErrorNames.switch_off_null_connectable */);\n    }\n    if (_connectable !== connectable) {\n        throw createMappedError(209 /* ErrorNames.switch_off_inactive_connectable */);\n    }\n    connectables.pop();\n    _connectable = connectables.length > 0 ? connectables[connectables.length - 1] : null;\n    connecting = _connectable != null;\n}\nconst ConnectableSwitcher = /*@__PURE__*/ rtObjectFreeze({\n    get current() {\n        return _connectable;\n    },\n    get connecting() {\n        return connecting;\n    },\n    enter: enterConnectable,\n    exit: exitConnectable,\n    pause: pauseConnecting,\n    resume: resumeConnecting,\n});\n\nconst R$get = Reflect.get;\nconst toStringTag = Object.prototype.toString;\nconst proxyMap = new WeakMap();\n/** @internal */\nconst nowrapClassKey = '__au_nw__';\n/** @internal */\nconst nowrapPropKey = '__au_nw';\nfunction canWrap(obj) {\n    switch (toStringTag.call(obj)) {\n        case '[object Object]':\n            // enable inheritance decoration\n            return obj.constructor[nowrapClassKey] !== true;\n        case '[object Array]':\n        case '[object Map]':\n        case '[object Set]':\n            // it's unlikely that methods on the following 2 objects need to be observed for changes\n            // so while they are valid/ we don't wrap them either\n            // case '[object Math]':\n            // case '[object Reflect]':\n            return true;\n        default:\n            return false;\n    }\n}\nconst rawKey = '__raw__';\nfunction wrap(v) {\n    return canWrap(v) ? getProxy(v) : v;\n}\nfunction getProxy(obj) {\n    // deepscan-disable-next-line\n    return proxyMap.get(obj) ?? createProxy(obj);\n}\nfunction getRaw(obj) {\n    // todo: get in a weakmap if null/undef\n    return obj[rawKey] ?? obj;\n}\nfunction unwrap(v) {\n    // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n    return canWrap(v) && v[rawKey] || v;\n}\nfunction doNotCollect(object, key) {\n    if (key === 'constructor'\n        || key === '__proto__'\n        // probably should revert to v1 naming style for consistency with builtin?\n        // __o__ is shorters & less chance of conflict with other libs as well\n        || key === '$observers'\n        || key === Symbol.toPrimitive\n        || key === Symbol.toStringTag\n        // limit to string first\n        // symbol can be added later\n        // looking up from the constructor means inheritance is supported\n        || object.constructor[`${nowrapPropKey}_${rtSafeString(key)}__`] === true) {\n        return true;\n    }\n    // ensure Proxy spec compliance, value of non-configurable and non-writable property MUST be returned as is\n    // https://262.ecma-international.org/8.0/#sec-proxy-object-internal-methods-and-internal-slots-get-p-receiver\n    const descriptor = Reflect.getOwnPropertyDescriptor(object, key);\n    return descriptor?.configurable === false && descriptor.writable === false;\n}\nfunction createProxy(obj) {\n    const handler = isArray(obj)\n        ? arrayHandler\n        : isMap(obj) || isSet(obj)\n            ? collectionHandler\n            : objectHandler;\n    const proxiedObj = new Proxy(obj, handler);\n    proxyMap.set(obj, proxiedObj);\n    proxyMap.set(proxiedObj, proxiedObj);\n    return proxiedObj;\n}\nconst objectHandler = {\n    get(target, key, receiver) {\n        // maybe use symbol?\n        if (key === rawKey) {\n            return target;\n        }\n        const connectable = currentConnectable();\n        if (!connecting || doNotCollect(target, key) || connectable == null) {\n            return R$get(target, key, receiver);\n        }\n        // todo: static\n        connectable.observe(target, key);\n        return wrap(R$get(target, key, receiver));\n    },\n    deleteProperty(target, p) {\n        {\n            // eslint-disable-next-line no-console\n            console.warn(`[DEV:aurelia] deletion of a property will not always be working with Aurelia observation system, as it depends on getter/setter installation.`);\n        }\n        // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n        return delete target[p];\n    },\n};\nconst arrayHandler = {\n    get(target, key, receiver) {\n        // maybe use symbol?\n        if (key === rawKey) {\n            return target;\n        }\n        if (!connecting || doNotCollect(target, key) || _connectable == null) {\n            return R$get(target, key, receiver);\n        }\n        switch (key) {\n            case 'length':\n                _connectable.observe(target, 'length');\n                return target.length;\n            case 'map':\n                return wrappedArrayMap;\n            case 'includes':\n                return wrappedArrayIncludes;\n            case 'indexOf':\n                return wrappedArrayIndexOf;\n            case 'lastIndexOf':\n                return wrappedArrayLastIndexOf;\n            case 'every':\n                return wrappedArrayEvery;\n            case 'filter':\n                return wrappedArrayFilter;\n            case 'find':\n                return wrappedArrayFind;\n            case 'findIndex':\n                return wrappedArrayFindIndex;\n            case 'flat':\n                return wrappedArrayFlat;\n            case 'flatMap':\n                return wrappedArrayFlatMap;\n            case 'join':\n                return wrappedArrayJoin;\n            case 'push':\n                return wrappedArrayPush;\n            case 'pop':\n                return wrappedArrayPop;\n            case 'reduce':\n                return wrappedReduce;\n            case 'reduceRight':\n                return wrappedReduceRight;\n            case 'reverse':\n                return wrappedArrayReverse;\n            case 'shift':\n                return wrappedArrayShift;\n            case 'unshift':\n                return wrappedArrayUnshift;\n            case 'slice':\n                return wrappedArraySlice;\n            case 'splice':\n                return wrappedArraySplice;\n            case 'some':\n                return wrappedArraySome;\n            case 'sort':\n                return wrappedArraySort;\n            case 'keys':\n                return wrappedKeys;\n            case 'values':\n            case Symbol.iterator:\n                return wrappedValues;\n            case 'entries':\n                return wrappedEntries;\n        }\n        _connectable.observe(target, key);\n        return wrap(R$get(target, key, receiver));\n    },\n    // for (let i in array) ...\n    ownKeys(target) {\n        currentConnectable()?.observe(target, 'length');\n        return Reflect.ownKeys(target);\n    },\n};\nfunction wrappedArrayMap(cb, thisArg) {\n    const raw = getRaw(this);\n    const res = raw.map((v, i) => \n    // do we wrap `thisArg`?\n    unwrap(cb.call(thisArg, wrap(v), i, this)));\n    observeCollection(_connectable, raw);\n    return wrap(res);\n}\nfunction wrappedArrayEvery(cb, thisArg) {\n    const raw = getRaw(this);\n    const res = raw.every((v, i) => cb.call(thisArg, wrap(v), i, this));\n    observeCollection(_connectable, raw);\n    return res;\n}\nfunction wrappedArrayFilter(cb, thisArg) {\n    const raw = getRaw(this);\n    const res = raw.filter((v, i) => \n    // do we wrap `thisArg`?\n    unwrap(cb.call(thisArg, wrap(v), i, this)));\n    observeCollection(_connectable, raw);\n    return wrap(res);\n}\nfunction wrappedArrayIncludes(v) {\n    const raw = getRaw(this);\n    const res = raw.includes(unwrap(v));\n    observeCollection(_connectable, raw);\n    return res;\n}\nfunction wrappedArrayIndexOf(v) {\n    const raw = getRaw(this);\n    const res = raw.indexOf(unwrap(v));\n    observeCollection(_connectable, raw);\n    return res;\n}\nfunction wrappedArrayLastIndexOf(v) {\n    const raw = getRaw(this);\n    const res = raw.lastIndexOf(unwrap(v));\n    observeCollection(_connectable, raw);\n    return res;\n}\nfunction wrappedArrayFindIndex(cb, thisArg) {\n    const raw = getRaw(this);\n    const res = raw.findIndex((v, i) => unwrap(cb.call(thisArg, wrap(v), i, this)));\n    observeCollection(_connectable, raw);\n    return res;\n}\nfunction wrappedArrayFind(cb, thisArg) {\n    const raw = getRaw(this);\n    const res = raw.find((v, i) => cb(wrap(v), i, this), thisArg);\n    observeCollection(_connectable, raw);\n    return wrap(res);\n}\nfunction wrappedArrayFlat() {\n    const raw = getRaw(this);\n    observeCollection(_connectable, raw);\n    return wrap(raw.flat());\n}\nfunction wrappedArrayFlatMap(cb, thisArg) {\n    const raw = getRaw(this);\n    observeCollection(_connectable, raw);\n    return getProxy(raw.flatMap((v, i) => wrap(cb.call(thisArg, wrap(v), i, this))));\n}\nfunction wrappedArrayJoin(separator) {\n    const raw = getRaw(this);\n    observeCollection(_connectable, raw);\n    return raw.join(separator);\n}\nfunction wrappedArrayPop() {\n    return wrap(getRaw(this).pop());\n}\nfunction wrappedArrayPush(...args) {\n    return getRaw(this).push(...args);\n}\nfunction wrappedArrayShift() {\n    return wrap(getRaw(this).shift());\n}\nfunction wrappedArrayUnshift(...args) {\n    return getRaw(this).unshift(...args);\n}\nfunction wrappedArraySplice(...args) {\n    return wrap(getRaw(this).splice(...args));\n}\nfunction wrappedArrayReverse(..._args) {\n    return wrap(getRaw(this).reverse());\n}\nfunction wrappedArraySome(cb, thisArg) {\n    const raw = getRaw(this);\n    const res = raw.some((v, i) => unwrap(cb.call(thisArg, wrap(v), i, this)));\n    observeCollection(_connectable, raw);\n    return res;\n}\nfunction wrappedArraySort(cb) {\n    const raw = getRaw(this);\n    const res = raw.sort(cb);\n    observeCollection(_connectable, raw);\n    return wrap(res);\n}\nfunction wrappedArraySlice(start, end) {\n    const raw = getRaw(this);\n    observeCollection(_connectable, raw);\n    return getProxy(raw.slice(start, end));\n}\nfunction wrappedReduce(cb, initValue) {\n    const raw = getRaw(this);\n    const res = raw.reduce((curr, v, i) => cb(curr, wrap(v), i, this), initValue);\n    observeCollection(_connectable, raw);\n    return wrap(res);\n}\nfunction wrappedReduceRight(cb, initValue) {\n    const raw = getRaw(this);\n    const res = raw.reduceRight((curr, v, i) => cb(curr, wrap(v), i, this), initValue);\n    observeCollection(_connectable, raw);\n    return wrap(res);\n}\n// the below logic takes inspiration from Vue, Mobx\n// much thanks to them for working out this\nconst collectionHandler = {\n    get(target, key, receiver) {\n        // maybe use symbol?\n        if (key === rawKey) {\n            return target;\n        }\n        const connectable = currentConnectable();\n        if (!connecting || doNotCollect(target, key) || connectable == null) {\n            return R$get(target, key, receiver);\n        }\n        switch (key) {\n            case 'size':\n                connectable.observe(target, 'size');\n                return target.size;\n            case 'clear':\n                return wrappedClear;\n            case 'delete':\n                return wrappedDelete;\n            case 'forEach':\n                return wrappedForEach;\n            case 'add':\n                if (isSet(target)) {\n                    return wrappedAdd;\n                }\n                break;\n            case 'get':\n                if (isMap(target)) {\n                    return wrappedGet;\n                }\n                break;\n            case 'set':\n                if (isMap(target)) {\n                    return wrappedSet;\n                }\n                break;\n            case 'has':\n                return wrappedHas;\n            case 'keys':\n                return wrappedKeys;\n            case 'values':\n                return wrappedValues;\n            case 'entries':\n                return wrappedEntries;\n            case Symbol.iterator:\n                return isMap(target) ? wrappedEntries : wrappedValues;\n        }\n        return wrap(R$get(target, key, receiver));\n    },\n};\nfunction wrappedForEach(cb, thisArg) {\n    const raw = getRaw(this);\n    observeCollection(_connectable, raw);\n    return raw.forEach((v, key) => {\n        cb.call(/* should wrap or not?? */ thisArg, wrap(v), wrap(key), this);\n    });\n}\nfunction wrappedHas(v) {\n    const raw = getRaw(this);\n    observeCollection(_connectable, raw);\n    return raw.has(unwrap(v));\n}\nfunction wrappedGet(k) {\n    const raw = getRaw(this);\n    observeCollection(_connectable, raw);\n    return wrap(raw.get(unwrap(k)));\n}\nfunction wrappedSet(k, v) {\n    return wrap(getRaw(this).set(unwrap(k), unwrap(v)));\n}\nfunction wrappedAdd(v) {\n    return wrap(getRaw(this).add(unwrap(v)));\n}\nfunction wrappedClear() {\n    return wrap(getRaw(this).clear());\n}\nfunction wrappedDelete(k) {\n    return wrap(getRaw(this).delete(unwrap(k)));\n}\nfunction wrappedKeys() {\n    const raw = getRaw(this);\n    observeCollection(_connectable, raw);\n    const iterator = raw.keys();\n    return {\n        next() {\n            const next = iterator.next();\n            const value = next.value;\n            const done = next.done;\n            return done\n                ? { value: void 0, done }\n                : { value: wrap(value), done };\n        },\n        [Symbol.iterator]() {\n            return this;\n        },\n    };\n}\nfunction wrappedValues() {\n    const raw = getRaw(this);\n    observeCollection(_connectable, raw);\n    const iterator = raw.values();\n    return {\n        next() {\n            const next = iterator.next();\n            const value = next.value;\n            const done = next.done;\n            return done\n                ? { value: void 0, done }\n                : { value: wrap(value), done };\n        },\n        [Symbol.iterator]() {\n            return this;\n        },\n    };\n}\nfunction wrappedEntries() {\n    const raw = getRaw(this);\n    observeCollection(_connectable, raw);\n    const iterator = raw.entries();\n    // return a wrapped iterator which returns observed versions of the\n    // values emitted from the real iterator\n    return {\n        next() {\n            const next = iterator.next();\n            const value = next.value;\n            const done = next.done;\n            return done\n                ? { value: void 0, done }\n                : { value: [wrap(value[0]), wrap(value[1])], done };\n        },\n        [Symbol.iterator]() {\n            return this;\n        },\n    };\n}\nconst observeCollection = (connectable, collection) => connectable?.observeCollection(collection);\nconst ProxyObservable = /*@__PURE__*/ rtObjectFreeze({\n    getProxy,\n    getRaw,\n    wrap,\n    unwrap,\n    rawKey,\n});\n\nclass ComputedObserver {\n    constructor(obj, get, set, observerLocator, flush = 'async') {\n        this.type = atObserver;\n        /** @internal */\n        this._oldValue = void 0;\n        /** @internal */\n        this._value = void 0;\n        /** @internal */\n        this._notified = false;\n        // todo: maybe use a counter allow recursive call to a certain level\n        /** @internal */\n        this._isQueued = false;\n        /** @internal */\n        this._isDirty = false;\n        /** @internal */\n        this._callback = void 0;\n        /** @internal */\n        this._coercer = void 0;\n        /** @internal */\n        this._coercionConfig = void 0;\n        this._obj = obj;\n        this._wrapped = wrap(obj);\n        this.$get = get;\n        this.$set = set;\n        this.oL = observerLocator;\n        this._flush = flush;\n    }\n    init(value) {\n        this._value = value;\n        this._isDirty = false;\n    }\n    getValue() {\n        if (this.subs.count === 0) {\n            return this.$get.call(this._obj, this._obj, this);\n        }\n        if (this._isDirty) {\n            this.compute();\n            this._isDirty = false;\n            this._notified = false;\n        }\n        return this._value;\n    }\n    // deepscan-disable-next-line\n    setValue(v) {\n        if (isFunction(this.$set)) {\n            if (this._coercer !== void 0) {\n                v = this._coercer.call(null, v, this._coercionConfig);\n            }\n            if (!areEqual(v, this._value)) {\n                this.$set.call(this._obj, v);\n                this.run();\n            }\n        }\n        else {\n            throw createMappedError(221 /* ErrorNames.assign_readonly_readonly_property_from_computed */);\n        }\n    }\n    useCoercer(coercer, coercionConfig) {\n        this._coercer = coercer;\n        this._coercionConfig = coercionConfig;\n        return true;\n    }\n    useCallback(callback) {\n        this._callback = callback;\n        return true;\n    }\n    handleDirty() {\n        if (!this._isDirty) {\n            this._isDirty = true;\n            this.subs.notifyDirty();\n        }\n    }\n    handleChange() {\n        this._isDirty = true;\n        if (this.subs.count > 0) {\n            this.run();\n        }\n    }\n    handleCollectionChange() {\n        this._isDirty = true;\n        if (this.subs.count > 0) {\n            this.run();\n        }\n    }\n    subscribe(subscriber) {\n        // in theory, a collection subscriber could be added before a property subscriber\n        // and it should be handled similarly in subscribeToCollection\n        // though not handling for now, and wait until the merge of normal + collection subscription\n        if (this.subs.add(subscriber) && this.subs.count === 1) {\n            // start collecting dependencies\n            this._oldValue = this.compute();\n            this._isDirty = false;\n            this._notified = false;\n        }\n    }\n    unsubscribe(subscriber) {\n        if (this.subs.remove(subscriber) && this.subs.count === 0) {\n            this._isDirty = true;\n            this.obs.clearAll();\n            this._oldValue = void 0;\n            this._notified = true;\n        }\n    }\n    run() {\n        if (this._flush === 'sync') {\n            this._run();\n            return;\n        }\n        if (this._isQueued) {\n            return;\n        }\n        this._isQueued = true;\n        queueTask(() => {\n            this._isQueued = false;\n            this._run();\n        });\n    }\n    /** @internal */\n    _run() {\n        const currValue = this._value;\n        const oldValue = this._oldValue;\n        const newValue = this.compute();\n        this._isDirty = false;\n        // there's case where the _value property was updated without notifying subscribers\n        // such is the case when this computed observer value was requested\n        // before the dependencies of this observer notify it of their changes\n        //\n        // if we are to notify whenever we are computing new value, it'd cause a depth first & potentially circular update\n        // (subscriber of this observer requests value -> this observer re-computes -> subscribers gets updated)\n        // so we are only notifying subscribers when it's the actual notify phase\n        if (!this._notified || !areEqual(newValue, currValue)) {\n            // todo: wrong timing, this should be after notify\n            this._callback?.(newValue, oldValue);\n            this.subs.notify(newValue, oldValue);\n            this._oldValue = this._value = newValue;\n            this._notified = true;\n        }\n    }\n    compute() {\n        this.obs.version++;\n        try {\n            enterConnectable(this);\n            return this._value = unwrap(this.$get.call(this._wrapped, this._wrapped, this));\n        }\n        finally {\n            this.obs.clear();\n            exitConnectable(this);\n        }\n    }\n}\n(() => {\n    connectable(ComputedObserver, null);\n    subscriberCollection(ComputedObserver, null);\n})();\n\n/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\n\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n    var e = new Error(message);\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\n/** @internal */\nconst computedPropInfo = (() => {\n    const map = new WeakMap();\n    const normalizeKey = (key) => {\n        return isSymbol(key) ? key : String(key);\n    };\n    return {\n        get: (obj, key) => map.get(obj)?.get(normalizeKey(key)),\n        _getFlush: (obj, key) => {\n            return map.get(obj)?.get(normalizeKey(key))?.flush;\n        },\n        set: (obj, key, value) => {\n            if (!map.has(obj)) {\n                map.set(obj, new Map());\n            }\n            map.get(obj).set(normalizeKey(key), value);\n        }\n    };\n})();\n\n/**\n * Decorate a getter to configure various aspects of the computed property created by the getter.\n *\n * Example usage:\n *\n * ```ts\n * export class MyElement {\n *  \\@computed({ flush: 'sync' })\n *   public get prop(): number {\n *     return 24;\n *   }\n * }\n * ```\n */\nfunction computed(options) {\n    return function decorator(target, context) {\n        context.addInitializer(function () {\n            const flush = options.flush ?? 'async';\n            computedPropInfo.set(this, context.name, { flush });\n        });\n    };\n}\n\nconst IDirtyChecker = /*@__PURE__*/ rtCreateInterface('IDirtyChecker', x => x.callback(() => {\n        throw createMappedError(217 /* ErrorNames.dirty_check_no_handler */);\n    })\n    );\nconst DirtyCheckSettings = {\n    /**\n     * Default: `6`\n     *\n     * Adjust the global dirty check frequency.\n     * Measures in \"timeouts per check\", such that (given a default of 250 timeouts per second in modern browsers):\n     * - A value of 1 will result in 250 dirty checks per second (or 1 dirty check per second for an inactive tab)\n     * - A value of 25 will result in 10 dirty checks per second (or 1 dirty check per 25 seconds for an inactive tab)\n     */\n    timeoutsPerCheck: 25,\n    /**\n     * Default: `false`\n     *\n     * Disable dirty-checking entirely. Properties that cannot be observed without dirty checking\n     * or an adapter, will simply not be observed.\n     */\n    disabled: false,\n    /**\n     * Default: `false`\n     *\n     * Throw an error if a property is being dirty-checked.\n     */\n    throw: false,\n    /**\n     * Resets all dirty checking settings to the framework's defaults.\n     */\n    resetToDefault() {\n        this.timeoutsPerCheck = 6;\n        this.disabled = false;\n        this.throw = false;\n    }\n};\nclass DirtyChecker {\n    static register(c) {\n        c.register(Registration.singleton(this, this), Registration.aliasTo(this, IDirtyChecker));\n    }\n    constructor() {\n        this.tracked = [];\n        /** @internal */\n        this._task = null;\n        /** @internal */\n        this._elapsedFrames = 0;\n        this.p = resolve(IPlatform);\n        this.check = () => {\n            if (DirtyCheckSettings.disabled) {\n                return;\n            }\n            if (++this._elapsedFrames < DirtyCheckSettings.timeoutsPerCheck) {\n                return;\n            }\n            this._elapsedFrames = 0;\n            const tracked = this.tracked.slice(0);\n            const len = tracked.length;\n            let current;\n            let i = 0;\n            for (; i < len; ++i) {\n                current = tracked[i];\n                if (current.isDirty()) {\n                    current.flush();\n                }\n            }\n        };\n        subscriberCollection(DirtyCheckProperty, null);\n    }\n    createProperty(obj, key) {\n        if (DirtyCheckSettings.throw) {\n            throw createMappedError(218 /* ErrorNames.dirty_check_not_allowed */, key);\n        }\n        return new DirtyCheckProperty(this, obj, key);\n    }\n    addProperty(property) {\n        this.tracked.push(property);\n        if (this.tracked.length === 1) {\n            this._task = queueRecurringTask(this.check, { interval: 0 });\n        }\n    }\n    removeProperty(property) {\n        this.tracked.splice(this.tracked.indexOf(property), 1);\n        if (this.tracked.length === 0) {\n            this._task.cancel();\n            this._task = null;\n        }\n    }\n}\nclass DirtyCheckProperty {\n    constructor(dirtyChecker, obj, key) {\n        this.obj = obj;\n        this.key = key;\n        this.type = atNone;\n        /** @internal */\n        this._oldValue = void 0;\n        this._dirtyChecker = dirtyChecker;\n    }\n    getValue() {\n        return this.obj[this.key];\n    }\n    setValue(_v) {\n        // todo: this should be allowed, probably\n        // but the construction of dirty checker should throw instead\n        throw createMappedError(219 /* ErrorNames.dirty_check_setter_not_allowed */, this.key);\n    }\n    isDirty() {\n        return this._oldValue !== this.obj[this.key];\n    }\n    flush() {\n        const oldValue = this._oldValue;\n        const newValue = this.getValue();\n        this._oldValue = newValue;\n        this.subs.notify(newValue, oldValue);\n    }\n    subscribe(subscriber) {\n        if (this.subs.add(subscriber) && this.subs.count === 1) {\n            this._oldValue = this.obj[this.key];\n            this._dirtyChecker.addProperty(this);\n        }\n    }\n    unsubscribe(subscriber) {\n        if (this.subs.remove(subscriber) && this.subs.count === 0) {\n            this._dirtyChecker.removeProperty(this);\n        }\n    }\n}\n\nclass PrimitiveObserver {\n    get doNotCache() { return true; }\n    constructor(obj, key) {\n        this.type = atNone;\n        this._obj = obj;\n        this._key = key;\n    }\n    getValue() {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-explicit-any\n        return this._obj[this._key];\n    }\n    setValue() { }\n    subscribe() { }\n    unsubscribe() { }\n}\n\nclass PropertyAccessor {\n    constructor() {\n        // the only thing can be guaranteed is it's an object\n        // even if this property accessor is used to access an element\n        this.type = atNone;\n    }\n    getValue(obj, key) {\n        return obj[key];\n    }\n    setValue(value, obj, key) {\n        obj[key] = value;\n    }\n}\n\n/**\n * Observer for the mutation of object property value employing getter-setter strategy.\n * This is used for observing object properties that has no decorator.\n */\nclass SetterObserver {\n    constructor(obj, key) {\n        // todo(bigopon): tweak the flag based on typeof obj (array/set/map/iterator/proxy etc...)\n        this.type = atObserver;\n        /** @internal */\n        this._value = void 0;\n        /** @internal */\n        this._observing = false;\n        /** @internal */\n        this._callback = void 0;\n        /** @internal */\n        this._coercer = void 0;\n        /** @internal */\n        this._coercionConfig = void 0;\n        this._obj = obj;\n        this._key = key;\n    }\n    getValue() {\n        return this._value;\n    }\n    setValue(newValue) {\n        if (this._coercer !== void 0) {\n            newValue = this._coercer.call(void 0, newValue, this._coercionConfig);\n        }\n        const oldValue = this._value;\n        if (this._observing) {\n            if (areEqual(newValue, this._value)) {\n                return;\n            }\n            this._value = newValue;\n            this.subs.notifyDirty();\n            this.subs.notify(newValue, oldValue);\n            // only call the callback if _value is the same with newValue\n            // which means if during subs.notify() the value of this observer is changed\n            // then it's the job of that setValue() to call the callback\n            if (areEqual(newValue, this._value)) {\n                this._callback?.(newValue, oldValue);\n            }\n        }\n        else {\n            // If subscribe() has been called, the target property descriptor is replaced by these getter/setter methods,\n            // so calling obj[propertyKey] will actually return this.value.\n            // However, if subscribe() was not yet called (indicated by !this.observing), the target descriptor\n            // is unmodified and we need to explicitly set the property value.\n            // This will happen in one-time, to-view and two-way bindings during bind, meaning that the bind will not actually update the target value.\n            // This wasn't visible in vCurrent due to connect-queue always doing a delayed update, so in many cases it didn't matter whether bind updated the target or not.\n            this._value = this._obj[this._key] = newValue;\n            this._callback?.(newValue, oldValue);\n        }\n    }\n    useCallback(callback) {\n        this._callback = callback;\n        this.start();\n        return true;\n    }\n    useCoercer(coercer, coercionConfig) {\n        this._coercer = coercer;\n        this._coercionConfig = coercionConfig;\n        this.start();\n        return true;\n    }\n    subscribe(subscriber) {\n        if (this._observing === false) {\n            this.start();\n        }\n        this.subs.add(subscriber);\n    }\n    start() {\n        if (this._observing === false) {\n            this._observing = true;\n            this._value = this._obj[this._key];\n            rtDef(this._obj, this._key, {\n                enumerable: true,\n                configurable: true,\n                get: rtObjectAssign(( /* Setter Observer */) => this.getValue(), { getObserver: () => this }),\n                set: (/* Setter Observer */ value) => {\n                    this.setValue(value);\n                },\n            });\n        }\n        return this;\n    }\n    stop() {\n        if (this._observing) {\n            rtDef(this._obj, this._key, {\n                enumerable: true,\n                configurable: true,\n                writable: true,\n                value: this._value,\n            });\n            this._observing = false;\n            // todo(bigopon/fred): add .removeAllSubscribers()\n        }\n        return this;\n    }\n}\n(() => {\n    subscriberCollection(SetterObserver, null);\n})();\n\nconst propertyAccessor = new PropertyAccessor();\nconst IObserverLocator = /*@__PURE__*/ rtCreateInterface('IObserverLocator', x => x.singleton(ObserverLocator));\nconst INodeObserverLocator = /*@__PURE__*/ rtCreateInterface('INodeObserverLocator', x => x.cachedCallback(handler => {\n    {\n        handler.getAll(ILogger).forEach(logger => {\n            logger.error('Using default INodeObserverLocator implementation. Will not be able to observe nodes (HTML etc...).');\n        });\n    }\n    return new DefaultNodeObserverLocator();\n}));\nclass DefaultNodeObserverLocator {\n    handles() {\n        return false;\n    }\n    getObserver() {\n        return propertyAccessor;\n    }\n    getAccessor() {\n        return propertyAccessor;\n    }\n}\nconst IComputedObserverLocator = /*@__PURE__*/ rtCreateInterface('IComputedObserverLocator', x => x.singleton(class DefaultLocator {\n    getObserver(obj, key, pd, requestor) {\n        const observer = new ComputedObserver(obj, pd.get, pd.set, requestor, computedPropInfo._getFlush(obj, key));\n        rtDef(obj, key, {\n            enumerable: pd.enumerable,\n            configurable: true,\n            get: rtObjectAssign((( /* Computed Observer */) => observer.getValue()), { getObserver: () => observer }),\n            set: (/* Computed Observer */ v) => {\n                observer.setValue(v);\n            },\n        });\n        return observer;\n    }\n}));\nclass ObserverLocator {\n    constructor() {\n        /** @internal */ this._adapters = [];\n        /** @internal */ this._dirtyChecker = resolve(IDirtyChecker);\n        /** @internal */ this._nodeObserverLocator = resolve(INodeObserverLocator);\n        /** @internal */ this._computedObserverLocator = resolve(IComputedObserverLocator);\n    }\n    addAdapter(adapter) {\n        this._adapters.push(adapter);\n    }\n    getObserver(obj, key) {\n        if (obj == null) {\n            throw createMappedError(199 /* ErrorNames.observing_null_undefined */, key);\n        }\n        if (!isObject(obj)) {\n            return new PrimitiveObserver(obj, isFunction(key) ? '' : key);\n        }\n        if (isFunction(key)) {\n            return new ComputedObserver(obj, key, void 0, this);\n        }\n        const lookup = getObserverLookup(obj);\n        let observer = lookup[key];\n        if (observer === void 0) {\n            observer = this.createObserver(obj, key);\n            if (!observer.doNotCache) {\n                lookup[key] = observer;\n            }\n        }\n        return observer;\n    }\n    getAccessor(obj, key) {\n        const cached = obj.$observers?.[key];\n        if (cached !== void 0) {\n            return cached;\n        }\n        if (this._nodeObserverLocator.handles(obj, key, this)) {\n            return this._nodeObserverLocator.getAccessor(obj, key, this);\n        }\n        return propertyAccessor;\n    }\n    getArrayObserver(observedArray) {\n        return getArrayObserver(observedArray);\n    }\n    getMapObserver(observedMap) {\n        return getMapObserver(observedMap);\n    }\n    getSetObserver(observedSet) {\n        return getSetObserver(observedSet);\n    }\n    createObserver(obj, key) {\n        if (this._nodeObserverLocator.handles(obj, key, this)) {\n            return this._nodeObserverLocator.getObserver(obj, key, this);\n        }\n        switch (key) {\n            case 'length':\n                if (isArray(obj)) {\n                    return getArrayObserver(obj).getLengthObserver();\n                }\n                break;\n            case 'size':\n                if (isMap(obj)) {\n                    return getMapObserver(obj).getLengthObserver();\n                }\n                else if (isSet(obj)) {\n                    return getSetObserver(obj).getLengthObserver();\n                }\n                break;\n            default:\n                if (isArray(obj) && isArrayIndex(key)) {\n                    return getArrayObserver(obj).getIndexObserver(Number(key));\n                }\n                break;\n        }\n        let pd = getOwnPropDesc(obj, key);\n        // Only instance properties will yield a descriptor here, otherwise walk up the proto chain\n        if (pd === void 0) {\n            let proto = getProto(obj);\n            while (proto !== null) {\n                pd = getOwnPropDesc(proto, key);\n                if (pd === void 0) {\n                    proto = getProto(proto);\n                }\n                else {\n                    break;\n                }\n            }\n        }\n        // If the descriptor does not have a 'value' prop, it must have a getter and/or setter\n        if (pd !== void 0 && !hasOwnProp.call(pd, 'value')) {\n            let obs = this._getAdapterObserver(obj, key, pd);\n            if (obs == null) {\n                obs = (pd.get?.getObserver)?.(obj);\n            }\n            // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n            return obs == null\n                ? pd.configurable\n                    // ? this._createComputedObserver(obj, key, pd, true)\n                    ? this._computedObserverLocator.getObserver(obj, key, pd, this)\n                    : this._dirtyChecker.createProperty(obj, key)\n                : obs;\n        }\n        // Ordinary get/set observation (the common use case)\n        // TODO: think about how to handle a data property that does not sit on the instance (should we do anything different?)\n        return new SetterObserver(obj, key);\n    }\n    // /** @internal */\n    // private _createComputedObserver(obj: object, key: PropertyKey, pd: PropertyDescriptor, useProxy?: boolean) {\n    //   const observer = new ComputedObserver(obj, pd.get!, pd.set, this, !!useProxy);\n    //   def(obj, key, {\n    //     enumerable: pd.enumerable,\n    //     configurable: true,\n    //     get: objectAssign(((/* Computed Observer */) => observer.getValue()) as ObservableGetter, { getObserver: () => observer }),\n    //     set: (/* Computed Observer */v) => {\n    //       observer.setValue(v);\n    //     },\n    //   });\n    //   return observer;\n    // }\n    /** @internal */\n    _getAdapterObserver(obj, key, pd) {\n        if (this._adapters.length > 0) {\n            for (const adapter of this._adapters) {\n                const observer = adapter.getObserver(obj, key, pd, this);\n                if (observer != null) {\n                    return observer;\n                }\n            }\n        }\n        return null;\n    }\n}\n// T extends unknown[]\n//   ? ArrayObserver\n//   : T extends Map<unknown, unknown>\n//     ? MapObserver\n//     : T extends Set<unknown>\n//       ? SetObserver\n//       :\nconst getCollectionObserver = (collection) => {\n    let obs;\n    if (isArray(collection)) {\n        obs = getArrayObserver(collection);\n    }\n    else if (isMap(collection)) {\n        obs = getMapObserver(collection);\n    }\n    else if (isSet(collection)) {\n        obs = getSetObserver(collection);\n    }\n    return obs;\n};\nconst getProto = Object.getPrototypeOf;\nconst getOwnPropDesc = Object.getOwnPropertyDescriptor;\nconst getObserverLookup = (instance) => {\n    let lookup = instance.$observers;\n    if (lookup === void 0) {\n        rtDef(instance, '$observers', { value: lookup = createLookup() });\n    }\n    return lookup;\n};\n\nconst IObservation = /*@__PURE__*/ rtCreateInterface('IObservation', x => x.singleton(Observation));\nclass Observation {\n    constructor() {\n        /** @internal */\n        this.oL = resolve(IObserverLocator);\n        /** @internal */\n        this._parser = resolve(IExpressionParser);\n    }\n    run(fn) {\n        const effect = new RunEffect(this.oL, fn);\n        // todo: batch effect run after it's in\n        effect.run();\n        return effect;\n    }\n    watch(obj, getter, callback, options) {\n        // eslint-disable-next-line no-undef-init\n        let $oldValue = undefined;\n        let running = false;\n        let cleanupTask;\n        const observer = this.oL.getObserver(obj, getter);\n        const handleChange = (newValue, oldValue) => {\n            cleanupTask?.();\n            cleanupTask = void 0;\n            const result = callback(newValue, $oldValue = oldValue);\n            if (isFunction(result)) {\n                cleanupTask = result;\n            }\n        };\n        const handler = {\n            handleChange\n        };\n        const run = () => {\n            if (running)\n                return;\n            running = true;\n            observer.subscribe(handler);\n            handleChange(observer.getValue(), $oldValue);\n        };\n        const stop = () => {\n            if (!running)\n                return;\n            running = false;\n            observer.unsubscribe(handler);\n            cleanupTask?.();\n            cleanupTask = void 0;\n        };\n        if (options?.immediate !== false) {\n            run();\n        }\n        return { run, stop };\n    }\n    watchExpression(obj, expression, callback, options) {\n        let running = false;\n        let cleanupTask;\n        const handleChange = (newValue, oldValue) => {\n            cleanupTask?.();\n            cleanupTask = void 0;\n            const result = callback(newValue, oldValue);\n            if (isFunction(result)) {\n                cleanupTask = result;\n            }\n        };\n        const observer = new ExpressionObserver(Scope.create(obj), this.oL, this._parser.parse(expression, 'IsProperty'), handleChange);\n        const run = () => {\n            if (running)\n                return;\n            running = true;\n            observer.run();\n        };\n        const stop = () => {\n            if (!running)\n                return;\n            running = false;\n            observer.stop();\n            cleanupTask?.();\n            cleanupTask = void 0;\n        };\n        if (options?.immediate !== false) {\n            run();\n        }\n        return { run, stop };\n    }\n}\nclass RunEffect {\n    constructor(oL, fn) {\n        this.oL = oL;\n        this.fn = fn;\n        // to configure this, potentially a 2nd parameter is needed for run\n        this.maxRunCount = 10;\n        this.queued = false;\n        this.running = false;\n        this.runCount = 0;\n        this.stopped = false;\n        /** @internal */\n        this._cleanupTask = undefined;\n        this.run = () => {\n            if (this.stopped) {\n                throw createMappedError(225 /* ErrorNames.stopping_a_stopped_effect */);\n            }\n            if (this.running) {\n                return;\n            }\n            ++this.runCount;\n            this.running = true;\n            this.queued = false;\n            ++this.obs.version;\n            try {\n                this._cleanupTask?.call(void 0);\n                enterConnectable(this);\n                this._cleanupTask = this.fn(this);\n            }\n            finally {\n                this.obs.clear();\n                this.running = false;\n                exitConnectable(this);\n            }\n            // when doing this.fn(this), there's a chance that it has recursive effect\n            // continue to run for a certain number before bailing\n            // whenever there's a dependency change while running, this.queued will be true\n            // so we use it as an indicator to continue to run the effect\n            if (this.queued) {\n                if (this.runCount > this.maxRunCount) {\n                    this.runCount = 0;\n                    throw createMappedError(226 /* ErrorNames.effect_maximum_recursion_reached */);\n                }\n                this.run();\n            }\n            else {\n                this.runCount = 0;\n            }\n        };\n        this.stop = () => {\n            this._cleanupTask?.call(void 0);\n            this._cleanupTask = void 0;\n            this.stopped = true;\n            this.obs.clearAll();\n        };\n    }\n    handleChange() {\n        this.queued = true;\n        this.run();\n    }\n    handleCollectionChange() {\n        this.queued = true;\n        this.run();\n    }\n}\n(() => {\n    connectable(RunEffect, null);\n})();\nclass ExpressionObserver {\n    constructor(scope, oL, expression, callback) {\n        this.oL = oL;\n        /** @internal */\n        this._value = void 0;\n        // see Listener binding for explanation\n        /** @internal */\n        this.boundFn = false;\n        this._scope = scope;\n        this.ast = expression;\n        this._callback = callback;\n    }\n    handleChange() {\n        this.run();\n    }\n    handleCollectionChange() {\n        this.run();\n    }\n    run() {\n        this.obs.version++;\n        const oldValue = this._value;\n        const value = astEvaluate(this.ast, this._scope, this, this);\n        this.obs.clear();\n        if (!areEqual(value, oldValue)) {\n            this._value = value;\n            this._callback.call(void 0, value, oldValue);\n        }\n    }\n    stop() {\n        this.obs.clearAll();\n        this._value = void 0;\n    }\n}\n(() => {\n    connectable(ExpressionObserver, null);\n    mixinNoopAstEvaluator(ExpressionObserver);\n})();\n\nconst observable = /*@__PURE__*/ (() => {\n    function getObserversLookup(obj) {\n        if (obj.$observers === void 0) {\n            rtDef(obj, '$observers', { value: {} });\n            // todo: define in a weakmap\n        }\n        return obj.$observers;\n    }\n    const noValue = {};\n    // impl, wont be seen\n    function observable(targetOrConfig, context) {\n        if (!SetterNotifier.mixed) {\n            SetterNotifier.mixed = true;\n            subscriberCollection(SetterNotifier, null);\n        }\n        let isClassDecorator = false;\n        let config;\n        if (typeof targetOrConfig === 'object') {\n            config = targetOrConfig;\n        }\n        else if (targetOrConfig != null) {\n            config = { name: targetOrConfig };\n            isClassDecorator = true;\n        }\n        else {\n            config = emptyObject;\n        }\n        // case: @observable() prop\n        if (arguments.length === 0) {\n            return function (target, context) {\n                if (context.kind !== 'field')\n                    throw createMappedError(224 /* ErrorNames.invalid_observable_decorator_usage */);\n                return createFieldInitializer(context);\n            };\n        }\n        // case: @observable prop\n        if (context?.kind === 'field')\n            return createFieldInitializer(context);\n        // case:  @observable(PropertyKey) class\n        if (isClassDecorator) {\n            return function (target, context) {\n                createDescriptor(target, config.name, () => noValue, true);\n            };\n        }\n        // case: @observable({...}) class | @observable({...}) prop\n        return function (target, context) {\n            switch (context.kind) {\n                case 'field': return createFieldInitializer(context);\n                case 'class': return createDescriptor(target, config.name, () => noValue, true);\n                default: throw createMappedError(224 /* ErrorNames.invalid_observable_decorator_usage */);\n            }\n        };\n        function createFieldInitializer(context) {\n            let $initialValue;\n            context.addInitializer(function () {\n                createDescriptor(this, context.name, () => $initialValue, false);\n            });\n            return function (initialValue) {\n                return $initialValue = initialValue;\n            };\n        }\n        function createDescriptor(target, property, initialValue, targetIsClass) {\n            // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing, @typescript-eslint/strict-boolean-expressions\n            const callback = config.callback || `${rtSafeString(property)}Changed`;\n            const $set = config.set;\n            const observableGetter = function () {\n                const notifier = getNotifier(this, property, callback, initialValue, $set);\n                currentConnectable()?.subscribeTo(notifier);\n                return notifier.getValue();\n            };\n            observableGetter.getObserver = function (obj) {\n                return getNotifier(obj, property, callback, initialValue, $set);\n            };\n            const descriptor = {\n                enumerable: true,\n                configurable: true,\n                get: observableGetter,\n                set(newValue) {\n                    getNotifier(this, property, callback, initialValue, $set).setValue(newValue);\n                }\n            };\n            if (targetIsClass)\n                rtDef(target.prototype, property, descriptor);\n            else\n                rtDef(target, property, descriptor);\n        }\n    }\n    function getNotifier(obj, key, callbackKey, initialValue, set) {\n        const lookup = getObserversLookup(obj);\n        let notifier = lookup[key];\n        if (notifier == null) {\n            const $initialValue = initialValue();\n            notifier = new SetterNotifier(obj, callbackKey, set, $initialValue === noValue ? void 0 : $initialValue);\n            lookup[key] = notifier;\n        }\n        return notifier;\n    }\n    class SetterNotifier {\n        constructor(obj, callbackKey, set, initialValue) {\n            this.type = atObserver;\n            /** @internal */\n            this._value = void 0;\n            /** @internal */\n            this._oldValue = void 0;\n            this._obj = obj;\n            this._setter = set;\n            this._hasSetter = isFunction(set);\n            const callback = obj[callbackKey];\n            this.cb = isFunction(callback) ? callback : void 0;\n            this._value = initialValue;\n        }\n        getValue() {\n            return this._value;\n        }\n        setValue(value) {\n            if (this._hasSetter) {\n                value = this._setter(value);\n            }\n            if (!areEqual(value, this._value)) {\n                this._oldValue = this._value;\n                this._value = value;\n                this.subs.notifyDirty();\n                this.subs.notify(this._value, this._oldValue);\n                // if the value has been changed during the notify, don't call the callback\n                // it's the job of the last .setValue() to call the callback\n                if (areEqual(value, this._value)) {\n                    this.cb?.call(this._obj, this._value, this._oldValue);\n                }\n            }\n        }\n    }\n    SetterNotifier.mixed = false;\n    /*\n              | typescript       | babel\n    ----------|------------------|-------------------------\n    property  | config           | config\n    w/parens  | target, key      | target, key, descriptor\n    ----------|------------------|-------------------------\n    property  | target, key      | target, key, descriptor\n    no parens | n/a              | n/a\n    ----------|------------------|-------------------------\n    class     | config           | config\n              | target           | target\n    */\n    return observable;\n})();\n\n/**\n * A decorator to signal proxy observation shouldn't make an effort to wrap an object\n */\nfunction nowrap(target, context) {\n    return arguments.length === 0 ? decorator : decorator(target, context);\n    function decorator(target, context) {\n        switch (context.kind) {\n            case 'class':\n                rtDefineHiddenProp(target, nowrapClassKey, true);\n                break;\n            case 'field':\n                context.addInitializer(function () {\n                    const target = this.constructor;\n                    const property = `${nowrapPropKey}_${rtSafeString(context.name)}__`;\n                    if (property in target)\n                        return;\n                    rtDefineHiddenProp(target, property, true);\n                });\n                break;\n        }\n    }\n}\n/* eslint-enable */\n\nexport { AccessorType, BindingContext, CollectionLengthObserver, CollectionSizeObserver, ComputedObserver, ConnectableSwitcher, DirtyCheckProperty, DirtyCheckSettings, DirtyChecker, ICoercionConfiguration, IComputedObserverLocator, IDirtyChecker, INodeObserverLocator, IObservation, IObserverLocator, Observation, ObserverLocator, PrimitiveObserver, PropertyAccessor, ProxyObservable, RecurringTask, Scope, SetterObserver, Task, TaskAbortError, astAssign, astBind, astEvaluate, astUnbind, batch, cloneIndexMap, computed, connectable, copyIndexMap, createIndexMap, getCollectionObserver, getObserverLookup, getRecurringTasks, isIndexMap, mixinNoopAstEvaluator, nowrap, observable, queueAsyncTask, queueRecurringTask, queueTask, runTasks, subscriberCollection, tasksSettled };\n//# sourceMappingURL=index.dev.mjs.map\n","const tsPending = 'pending';\nconst tsRunning = 'running';\nconst tsCompleted = 'completed';\nconst tsCanceled = 'canceled';\n/* eslint-disable @typescript-eslint/no-explicit-any */\nconst lookup = new Map();\nconst notImplemented = (name) => {\n    return () => {\n        throw createError(`AUR1005: The PLATFORM did not receive a valid reference to the global function '${name}'.`) // TODO: link to docs describing how to fix this issue\n            ;\n    };\n};\nclass Platform {\n    constructor(g, overrides = {}) {\n        this.macroTaskRequested = false;\n        this.macroTaskHandle = -1;\n        this.globalThis = g;\n        'decodeURI decodeURIComponent encodeURI encodeURIComponent Date Reflect console'.split(' ').forEach(prop => {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n            this[prop] = prop in overrides ? overrides[prop] : g[prop];\n        });\n        'clearInterval clearTimeout queueMicrotask setInterval setTimeout'.split(' ').forEach(method => {\n            // eslint-disable-next-line\n            this[method] = method in overrides ? overrides[method] : g[method]?.bind(g) ?? notImplemented(method);\n        });\n        this.performanceNow = 'performanceNow' in overrides ? overrides.performanceNow : g.performance?.now?.bind(g.performance) ?? notImplemented('performance.now');\n        this.flushMacroTask = this.flushMacroTask.bind(this);\n        this.taskQueue = new TaskQueue(this, this.requestMacroTask.bind(this), this.cancelMacroTask.bind(this));\n    }\n    static getOrCreate(g, overrides = {}) {\n        let platform = lookup.get(g);\n        if (platform === void 0) {\n            lookup.set(g, platform = new Platform(g, overrides));\n        }\n        return platform;\n    }\n    static set(g, platform) {\n        lookup.set(g, platform);\n    }\n    requestMacroTask() {\n        this.macroTaskRequested = true;\n        if (this.macroTaskHandle === -1) {\n            this.macroTaskHandle = this.setTimeout(this.flushMacroTask, 0);\n        }\n    }\n    cancelMacroTask() {\n        this.macroTaskRequested = false;\n        if (this.macroTaskHandle > -1) {\n            this.clearTimeout(this.macroTaskHandle);\n            this.macroTaskHandle = -1;\n        }\n    }\n    flushMacroTask() {\n        this.macroTaskHandle = -1;\n        if (this.macroTaskRequested === true) {\n            this.macroTaskRequested = false;\n            this.taskQueue.flush();\n        }\n    }\n}\nclass TaskQueue {\n    get isEmpty() {\n        return (this._pendingAsyncCount === 0 &&\n            this._processing.length === 0 &&\n            this._pending.length === 0 &&\n            this._delayed.length === 0);\n    }\n    /**\n     * Persistent tasks will re-queue themselves indefinitely until they are explicitly canceled,\n     * so we consider them 'infinite work' whereas non-persistent (one-off) tasks are 'finite work'.\n     *\n     * This `hasNoMoreFiniteWork` getters returns true if either all remaining tasks are persistent, or if there are no more tasks.\n     *\n     * If that is the case, we can resolve the promise that was created when `yield()` is called.\n     *\n     * @internal\n     */\n    get _hasNoMoreFiniteWork() {\n        return (this._pendingAsyncCount === 0 &&\n            this._processing.every(isPersistent) &&\n            this._pending.every(isPersistent) &&\n            this._delayed.every(isPersistent));\n    }\n    constructor(platform, $request, $cancel) {\n        this.platform = platform;\n        this.$request = $request;\n        this.$cancel = $cancel;\n        /** @internal */ this._suspenderTask = void 0;\n        /** @internal */ this._pendingAsyncCount = 0;\n        /** @internal */\n        this._processing = [];\n        /** @internal */\n        this._pending = [];\n        /** @internal */\n        this._delayed = [];\n        /** @internal */\n        this._flushRequested = false;\n        /** @internal */\n        this._yieldPromise = void 0;\n        /** @internal */\n        this._lastRequest = 0;\n        /** @internal */\n        this._lastFlush = 0;\n        /** @internal */\n        this._requestFlush = () => {\n            if (this._tracer.enabled) {\n                this._tracer.enter(this, 'requestFlush');\n            }\n            if (!this._flushRequested) {\n                this._flushRequested = true;\n                this._lastRequest = this._now();\n                this.$request();\n            }\n            if (this._tracer.enabled) {\n                this._tracer.leave(this, 'requestFlush');\n            }\n        };\n        this._now = platform.performanceNow;\n        this._tracer = new Tracer(platform.console);\n    }\n    flush(now = this._now()) {\n        if (this._tracer.enabled) {\n            this._tracer.enter(this, 'flush');\n        }\n        this._flushRequested = false;\n        this._lastFlush = now;\n        // Only process normally if we are *not* currently waiting for an async task to finish\n        if (this._suspenderTask === void 0) {\n            let curr;\n            if (this._pending.length > 0) {\n                this._processing.push(...this._pending);\n                this._pending.length = 0;\n            }\n            if (this._delayed.length > 0) {\n                for (let i = 0; i < this._delayed.length; ++i) {\n                    curr = this._delayed[i];\n                    if (curr.queueTime <= now) {\n                        this._processing.push(curr);\n                        this._delayed.splice(i--, 1);\n                    }\n                }\n            }\n            let cur;\n            while (this._processing.length > 0) {\n                (cur = this._processing.shift()).run();\n                // If it's still running, it can only be an async task\n                if (cur.status === tsRunning) {\n                    if (cur.suspend === true) {\n                        this._suspenderTask = cur;\n                        this._requestFlush();\n                        if (this._tracer.enabled) {\n                            this._tracer.leave(this, 'flush early async');\n                        }\n                        return;\n                    }\n                    else {\n                        ++this._pendingAsyncCount;\n                    }\n                }\n            }\n            if (this._pending.length > 0) {\n                this._processing.push(...this._pending);\n                this._pending.length = 0;\n            }\n            if (this._delayed.length > 0) {\n                for (let i = 0; i < this._delayed.length; ++i) {\n                    curr = this._delayed[i];\n                    if (curr.queueTime <= now) {\n                        this._processing.push(curr);\n                        this._delayed.splice(i--, 1);\n                    }\n                }\n            }\n            if (this._processing.length > 0 || this._delayed.length > 0 || this._pendingAsyncCount > 0) {\n                this._requestFlush();\n            }\n            if (this._yieldPromise !== void 0 &&\n                this._hasNoMoreFiniteWork) {\n                const p = this._yieldPromise;\n                this._yieldPromise = void 0;\n                p.resolve();\n            }\n        }\n        else {\n            // If we are still waiting for an async task to finish, just schedule the next flush and do nothing else.\n            // Should the task finish before the next flush is invoked,\n            // the callback to `completeAsyncTask` will have reset `this.suspenderTask` back to undefined so processing can return back to normal next flush.\n            this._requestFlush();\n        }\n        if (this._tracer.enabled) {\n            this._tracer.leave(this, 'flush full');\n        }\n    }\n    /**\n     * Cancel the next flush cycle (and/or the macrotask that schedules the next flush cycle, in case this is a microtask queue), if it was requested.\n     *\n     * This operation is idempotent and will do nothing if no flush is scheduled.\n     */\n    cancel() {\n        if (this._tracer.enabled) {\n            this._tracer.enter(this, 'cancel');\n        }\n        if (this._flushRequested) {\n            this.$cancel();\n            this._flushRequested = false;\n        }\n        if (this._tracer.enabled) {\n            this._tracer.leave(this, 'cancel');\n        }\n    }\n    /**\n     * Returns a promise that, when awaited, resolves when:\n     * - all *non*-persistent (including async) tasks have finished;\n     * - the last-added persistent task has run exactly once;\n     *\n     * This operation is idempotent: the same promise will be returned until it resolves.\n     *\n     * If `yield()` is called multiple times in a row when there are one or more persistent tasks in the queue, each call will await exactly one cycle of those tasks.\n     */\n    async yield() {\n        if (this._tracer.enabled) {\n            this._tracer.enter(this, 'yield');\n        }\n        if (this.isEmpty) {\n            if (this._tracer.enabled) {\n                this._tracer.leave(this, 'yield empty');\n            }\n        }\n        else {\n            if (this._yieldPromise === void 0) {\n                if (this._tracer.enabled) {\n                    this._tracer.trace(this, 'yield - creating promise');\n                }\n                this._yieldPromise = createExposedPromise();\n            }\n            await this._yieldPromise;\n            if (this._tracer.enabled) {\n                this._tracer.leave(this, 'yield task');\n            }\n        }\n    }\n    queueTask(callback, opts) {\n        if (this._tracer.enabled) {\n            this._tracer.enter(this, 'queueTask');\n        }\n        const { delay, preempt, persistent, suspend } = { ...defaultQueueTaskOptions, ...opts };\n        if (preempt) {\n            if (delay > 0) {\n                throw preemptDelayComboError();\n            }\n            if (persistent) {\n                throw preemptyPersistentComboError();\n            }\n        }\n        if (this._processing.length === 0) {\n            this._requestFlush();\n        }\n        const time = this._now();\n        const task = new Task(this._tracer, this, time, time + delay, preempt, persistent, suspend, callback);\n        if (preempt) {\n            this._processing[this._processing.length] = task;\n        }\n        else if (delay === 0) {\n            this._pending[this._pending.length] = task;\n        }\n        else {\n            this._delayed[this._delayed.length] = task;\n        }\n        if (this._tracer.enabled) {\n            this._tracer.leave(this, 'queueTask');\n        }\n        return task;\n    }\n    /**\n     * Remove the task from this queue.\n     */\n    remove(task) {\n        if (this._tracer.enabled) {\n            this._tracer.enter(this, 'remove');\n        }\n        let idx = this._processing.indexOf(task);\n        if (idx > -1) {\n            this._processing.splice(idx, 1);\n            if (this._tracer.enabled) {\n                this._tracer.leave(this, 'remove processing');\n            }\n            return;\n        }\n        idx = this._pending.indexOf(task);\n        if (idx > -1) {\n            this._pending.splice(idx, 1);\n            if (this._tracer.enabled) {\n                this._tracer.leave(this, 'remove pending');\n            }\n            return;\n        }\n        idx = this._delayed.indexOf(task);\n        if (idx > -1) {\n            this._delayed.splice(idx, 1);\n            if (this._tracer.enabled) {\n                this._tracer.leave(this, 'remove delayed');\n            }\n            return;\n        }\n        if (this._tracer.enabled) {\n            this._tracer.leave(this, 'remove error');\n        }\n        throw createError(`Task #${task.id} could not be found`);\n    }\n    /**\n     * Reset the persistent task back to its pending state, preparing it for being invoked again on the next flush.\n     *\n     * @internal\n     */\n    _resetPersistentTask(task) {\n        if (this._tracer.enabled) {\n            this._tracer.enter(this, 'resetPersistentTask');\n        }\n        task.reset(this._now());\n        if (task.createdTime === task.queueTime) {\n            this._pending[this._pending.length] = task;\n        }\n        else {\n            this._delayed[this._delayed.length] = task;\n        }\n        if (this._tracer.enabled) {\n            this._tracer.leave(this, 'resetPersistentTask');\n        }\n    }\n    /**\n     * Notify the queue that this async task has had its promise resolved, so that the queue can proceed with consecutive tasks on the next flush.\n     *\n     * @internal\n     */\n    _completeAsyncTask(task) {\n        if (this._tracer.enabled) {\n            this._tracer.enter(this, 'completeAsyncTask');\n        }\n        if (task.suspend === true) {\n            if (this._suspenderTask !== task) {\n                if (this._tracer.enabled) {\n                    this._tracer.leave(this, 'completeAsyncTask error');\n                }\n                throw createError(`Async task completion mismatch: suspenderTask=${this._suspenderTask?.id}, task=${task.id}`);\n            }\n            this._suspenderTask = void 0;\n        }\n        else {\n            --this._pendingAsyncCount;\n        }\n        if (this._yieldPromise !== void 0 &&\n            this._hasNoMoreFiniteWork) {\n            const p = this._yieldPromise;\n            this._yieldPromise = void 0;\n            p.resolve();\n        }\n        if (this.isEmpty) {\n            this.cancel();\n        }\n        if (this._tracer.enabled) {\n            this._tracer.leave(this, 'completeAsyncTask');\n        }\n    }\n}\nclass TaskAbortError extends Error {\n    constructor(task) {\n        super('Task was canceled.');\n        this.task = task;\n    }\n}\nlet id = 0;\nclass Task {\n    get result() {\n        const result = this._result;\n        if (result === void 0) {\n            switch (this._status) {\n                case tsPending: {\n                    const promise = this._result = createExposedPromise();\n                    this._resolve = promise.resolve;\n                    this._reject = promise.reject;\n                    return promise;\n                }\n                /* istanbul ignore next */\n                case tsRunning:\n                    throw createError('Trying to await task from within task will cause a deadlock.');\n                case tsCompleted:\n                    return this._result = Promise.resolve();\n                case tsCanceled:\n                    return this._result = Promise.reject(new TaskAbortError(this));\n            }\n        }\n        return result;\n    }\n    get status() {\n        return this._status;\n    }\n    constructor(tracer, taskQueue, createdTime, queueTime, preempt, persistent, suspend, callback) {\n        this.taskQueue = taskQueue;\n        this.createdTime = createdTime;\n        this.queueTime = queueTime;\n        this.preempt = preempt;\n        this.persistent = persistent;\n        this.suspend = suspend;\n        this.callback = callback;\n        this.id = ++id;\n        /** @internal */ this._resolve = void 0;\n        /** @internal */ this._reject = void 0;\n        /** @internal */\n        this._result = void 0;\n        /** @internal */\n        this._status = tsPending;\n        this._tracer = tracer;\n    }\n    run(time = this.taskQueue.platform.performanceNow()) {\n        if (this._tracer.enabled) {\n            this._tracer.enter(this, 'run');\n        }\n        if (this._status !== tsPending) {\n            if (this._tracer.enabled) {\n                this._tracer.leave(this, 'run error');\n            }\n            throw createError(`Cannot run task in ${this._status} state`);\n        }\n        // this.persistent could be changed while the task is running (this can only be done by the task itself if canceled, and is a valid way of stopping a loop)\n        // so we deliberately reference this.persistent instead of the local variable, but we keep it around to know whether the task *was* persistent before running it,\n        // so we can set the correct cancelation state.\n        const { persistent, taskQueue, callback, _resolve: resolve, _reject: reject, createdTime, } = this;\n        let ret;\n        this._status = tsRunning;\n        try {\n            ret = callback(time - createdTime);\n            if (ret instanceof Promise) {\n                ret.then($ret => {\n                    if (this.persistent) {\n                        taskQueue._resetPersistentTask(this);\n                    }\n                    else {\n                        if (persistent) {\n                            // Persistent tasks never reach completed status. They're either pending, running, or canceled.\n                            this._status = tsCanceled;\n                        }\n                        else {\n                            this._status = tsCompleted;\n                        }\n                        this.dispose();\n                    }\n                    taskQueue._completeAsyncTask(this);\n                    if (true && this._tracer.enabled) {\n                        this._tracer.leave(this, 'run async then');\n                    }\n                    if (resolve !== void 0) {\n                        resolve($ret);\n                    }\n                })\n                    .catch((err) => {\n                    if (!this.persistent) {\n                        this.dispose();\n                    }\n                    taskQueue._completeAsyncTask(this);\n                    if (true && this._tracer.enabled) {\n                        this._tracer.leave(this, 'run async catch');\n                    }\n                    if (reject !== void 0) {\n                        reject(err);\n                    }\n                    else {\n                        throw err;\n                    }\n                });\n            }\n            else {\n                if (this.persistent) {\n                    taskQueue._resetPersistentTask(this);\n                }\n                else {\n                    if (persistent) {\n                        // Persistent tasks never reach completed status. They're either pending, running, or canceled.\n                        this._status = tsCanceled;\n                    }\n                    else {\n                        this._status = tsCompleted;\n                    }\n                    this.dispose();\n                }\n                if (true && this._tracer.enabled) {\n                    this._tracer.leave(this, 'run sync success');\n                }\n                if (resolve !== void 0) {\n                    resolve(ret);\n                }\n            }\n        }\n        catch (err) {\n            if (!this.persistent) {\n                this.dispose();\n            }\n            if (this._tracer.enabled) {\n                this._tracer.leave(this, 'run sync error');\n            }\n            if (reject !== void 0) {\n                reject(err);\n            }\n            else {\n                throw err;\n            }\n        }\n    }\n    cancel() {\n        if (this._tracer.enabled) {\n            this._tracer.enter(this, 'cancel');\n        }\n        if (this._status === tsPending) {\n            const taskQueue = this.taskQueue;\n            const reject = this._reject;\n            taskQueue.remove(this);\n            if (taskQueue.isEmpty) {\n                taskQueue.cancel();\n            }\n            this._status = tsCanceled;\n            this.dispose();\n            if (reject !== void 0) {\n                reject(new TaskAbortError(this));\n            }\n            if (this._tracer.enabled) {\n                this._tracer.leave(this, 'cancel true =pending');\n            }\n            return true;\n        }\n        else if (this._status === tsRunning && this.persistent) {\n            this.persistent = false;\n            if (this._tracer.enabled) {\n                this._tracer.leave(this, 'cancel true =running+persistent');\n            }\n            return true;\n        }\n        if (this._tracer.enabled) {\n            this._tracer.leave(this, 'cancel false');\n        }\n        return false;\n    }\n    reset(time) {\n        if (this._tracer.enabled) {\n            this._tracer.enter(this, 'reset');\n        }\n        const delay = this.queueTime - this.createdTime;\n        this.createdTime = time;\n        this.queueTime = time + delay;\n        this._status = tsPending;\n        this._resolve = void 0;\n        this._reject = void 0;\n        this._result = void 0;\n        if (this._tracer.enabled) {\n            this._tracer.leave(this, 'reset');\n        }\n    }\n    dispose() {\n        if (this._tracer.enabled) {\n            this._tracer.trace(this, 'dispose');\n        }\n        this.callback = (void 0);\n        this._resolve = void 0;\n        this._reject = void 0;\n        this._result = void 0;\n    }\n}\nclass Tracer {\n    constructor(console) {\n        this.console = console;\n        this.enabled = false;\n        this.depth = 0;\n    }\n    enter(obj, method) {\n        this.log(`${'  '.repeat(this.depth++)}> `, obj, method);\n    }\n    leave(obj, method) {\n        this.log(`${'  '.repeat(--this.depth)}< `, obj, method);\n    }\n    trace(obj, method) {\n        this.log(`${'  '.repeat(this.depth)}- `, obj, method);\n    }\n    log(prefix, obj, method) {\n        if (obj instanceof TaskQueue) {\n            const processing = obj._processing.length;\n            const pending = obj._pending.length;\n            const delayed = obj._delayed.length;\n            const flushReq = obj._flushRequested;\n            const susTask = !!obj._suspenderTask;\n            const info = `processing=${processing} pending=${pending} delayed=${delayed} flushReq=${flushReq} susTask=${susTask}`;\n            this.console.log(`${prefix}[Q.${method}] ${info}`);\n        }\n        else {\n            const id = obj['id'];\n            const created = Math.round(obj['createdTime'] * 10) / 10;\n            const queue = Math.round(obj['queueTime'] * 10) / 10;\n            const preempt = obj['preempt'];\n            const persistent = obj['persistent'];\n            const suspend = obj['suspend'];\n            const status = obj['_status'];\n            const info = `id=${id} created=${created} queue=${queue} preempt=${preempt} persistent=${persistent} status=${status} suspend=${suspend}`;\n            this.console.log(`${prefix}[T.${method}] ${info}`);\n        }\n    }\n}\nconst defaultQueueTaskOptions = {\n    delay: 0,\n    preempt: false,\n    persistent: false,\n    suspend: false,\n};\nlet $resolve;\nlet $reject;\nconst executor = (resolve, reject) => {\n    $resolve = resolve;\n    $reject = reject;\n};\n/**\n * Efficiently create a promise where the `resolve` and `reject` functions are stored as properties on the prommise itself.\n */\nconst createExposedPromise = () => {\n    const p = new Promise(executor);\n    p.resolve = $resolve;\n    p.reject = $reject;\n    return p;\n};\nconst isPersistent = (task) => task.persistent;\nconst preemptDelayComboError = () => createError(`AUR1006: Invalid arguments: preempt cannot be combined with a greater-than-zero delay`)\n    ;\nconst preemptyPersistentComboError = () => createError(`AUR1007: Invalid arguments: preempt cannot be combined with persistent`)\n    ;\nconst createError = (msg) => new Error(msg);\n/**\n * Retrieve internal tasks information of a TaskQueue\n */\nconst reportTaskQueue = (taskQueue) => {\n    const processing = taskQueue._processing;\n    const pending = taskQueue._pending;\n    const delayed = taskQueue._delayed;\n    const flushReq = taskQueue._flushRequested;\n    return { processing, pending, delayed, flushRequested: flushReq };\n};\n/**\n * Flush a taskqueue and cancel all the tasks that are queued by the flush\n * Mainly for debugging purposes\n */\nconst ensureEmpty = (taskQueue) => {\n    taskQueue.flush();\n    taskQueue._pending.forEach((x) => x.cancel());\n};\n\nexport { Platform, Task, TaskAbortError, TaskQueue, ensureEmpty, reportTaskQueue };\n//# sourceMappingURL=index.dev.mjs.map\n","import { Platform, TaskQueue } from '@aurelia/platform';\n\nclass BrowserPlatform extends Platform {\n    static getOrCreate(g, overrides = {}) {\n        let platform = BrowserPlatform._lookup.get(g);\n        if (platform === void 0) {\n            BrowserPlatform._lookup.set(g, platform = new BrowserPlatform(g, overrides));\n        }\n        return platform;\n    }\n    static set(g, platform) {\n        BrowserPlatform._lookup.set(g, platform);\n    }\n    /**\n     * @deprecated Use `platform.domQueue` instead.\n     */\n    get domWriteQueue() {\n        {\n            this.console.log('[DEV:aurelia] platform.domQueue is deprecated, please use platform.domQueue instead.');\n        }\n        return this.domQueue;\n    }\n    /**\n     * @deprecated Use `platform.domQueue` instead.\n     */\n    get domReadQueue() {\n        {\n            this.console.log('[DEV:aurelia] platform.domReadQueue has been removed, please use platform.domQueue instead.');\n        }\n        return this.domQueue;\n    }\n    constructor(g, overrides = {}) {\n        super(g, overrides);\n        const notImplemented = (name) => () => {\n            // TODO: link to docs describing how to fix this issue\n            throw new Error(`The PLATFORM did not receive a valid reference to the global function '${name}'.`);\n        };\n        ('Node Element HTMLElement CustomEvent CSSStyleSheet ShadowRoot MutationObserver '\n            + 'window document customElements')\n            .split(' ')\n            // eslint-disable-next-line\n            .forEach(prop => this[prop] = prop in overrides ? overrides[prop] : g[prop]);\n        'fetch requestAnimationFrame cancelAnimationFrame'.split(' ').forEach(prop => \n        // eslint-disable-next-line\n        this[prop] = prop in overrides ? overrides[prop] : (g[prop]?.bind(g) ?? notImplemented(prop)));\n        this.domQueue = (() => {\n            let domRequested = false;\n            let domHandle = -1;\n            const requestDomFlush = () => {\n                domRequested = true;\n                if (domHandle === -1) {\n                    domHandle = this.requestAnimationFrame(flushDomQueue);\n                }\n            };\n            const cancelDomFlush = () => {\n                domRequested = false;\n                if (domHandle > -1) {\n                    this.cancelAnimationFrame(domHandle);\n                    domHandle = -1;\n                }\n            };\n            const flushDomQueue = () => {\n                domHandle = -1;\n                if (domRequested === true) {\n                    domRequested = false;\n                    domQueue.flush();\n                }\n            };\n            const domQueue = new TaskQueue(this, requestDomFlush, cancelDomFlush);\n            return domQueue;\n        })();\n    }\n}\n/** @internal */\nBrowserPlatform._lookup = new WeakMap();\n\nexport { BrowserPlatform };\n//# sourceMappingURL=index.dev.mjs.map\n","import { Protocol, isString, createLookup, getPrototypeChain, kebabCase, noop, DI, Registration, firstDefined, mergeArrays, isFunction, resourceBaseName, resource, getResourceKeyFor, resolve, IPlatform as IPlatform$1, emptyArray, ILogger, registrableMetadataKey, isArray, all, isObject, own, InstanceProvider, IContainer, toArray, areEqual, optionalResource, optional, LogLevel, onResolveAll, isPromise, onResolve, fromDefinitionOrDefault, pascalCase, fromAnnotationOrDefinitionOrTypeOrDefault, fromAnnotationOrTypeOrDefault, isSymbol, createImplementationRegister, IServiceLocator, emptyObject, isNumber, isSet, isMap, transient } from '@aurelia/kernel';\nimport { BindingMode, InstructionType, ITemplateCompiler, IInstruction, TemplateCompilerHooks, IAttrMapper, IResourceResolver, TemplateCompiler, AttributePattern, AttrSyntax, RefAttributePattern, DotSeparatedAttributePattern, EventAttributePattern, AtPrefixedTriggerAttributePattern, ColonPrefixedBindAttributePattern, DefaultBindingCommand, OneTimeBindingCommand, FromViewBindingCommand, ToViewBindingCommand, TwoWayBindingCommand, ForBindingCommand, RefBindingCommand, TriggerBindingCommand, CaptureBindingCommand, ClassBindingCommand, StyleBindingCommand, AttrBindingCommand, SpreadValueBindingCommand } from '@aurelia/template-compiler';\nexport { BindingCommand, BindingMode } from '@aurelia/template-compiler';\nimport { Metadata } from '@aurelia/metadata';\nimport { AccessorType, astEvaluate, queueAsyncTask, queueTask, astBind, astUnbind, connectable, astAssign, subscriberCollection, Scope, IObserverLocator, ConnectableSwitcher, ProxyObservable, ICoercionConfiguration, tasksSettled, PropertyAccessor, INodeObserverLocator, IDirtyChecker, getObserverLookup, SetterObserver, createIndexMap, getCollectionObserver as getCollectionObserver$1, BindingContext, DirtyChecker } from '@aurelia/runtime';\nimport { BrowserPlatform } from '@aurelia/platform-browser';\nimport { AccessScopeExpression, IExpressionParser, ExpressionParser } from '@aurelia/expression-parser';\n\n/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\n\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n    var e = new Error(message);\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\n/** @internal */ const { default: defaultMode, oneTime, toView, fromView, twoWay } = BindingMode;\n\n/** @internal */ const getMetadata = Metadata.get;\n/** @internal */ const hasMetadata = Metadata.has;\n/** @internal */ const defineMetadata = Metadata.define;\nconst { annotation } = Protocol;\n/** @internal */ const getAnnotationKeyFor = annotation.keyFor;\n\nconst O = Object;\n/** @internal */ const safeString = String;\n/** @internal */ const baseObjectPrototype = O.prototype;\n/** @internal */ const hasOwnProperty = baseObjectPrototype.hasOwnProperty;\n/** @internal */ const objectFreeze = O.freeze;\n/** @internal */ const objectAssign = O.assign;\n/** @internal */ const getOwnPropertyNames = O.getOwnPropertyNames;\n/** @internal */ const objectKeys = O.keys;\nconst IsDataAttribute = /*@__PURE__*/ createLookup();\n/** @internal */ const isDataAttribute = (obj, key, svgAnalyzer) => {\n    if (IsDataAttribute[key] === true) {\n        return true;\n    }\n    if (!isString(key)) {\n        return false;\n    }\n    const prefix = key.slice(0, 5);\n    // https://html.spec.whatwg.org/multipage/dom.html#wai-aria\n    // https://html.spec.whatwg.org/multipage/dom.html#custom-data-attribute\n    return IsDataAttribute[key] =\n        prefix === 'aria-' ||\n            prefix === 'data-' ||\n            svgAnalyzer.isStandardSvgAttribute(obj, key);\n};\n/** @internal */ const rethrow = (err) => { throw err; };\n/** @internal */\nconst def = Reflect.defineProperty;\n/** @internal */\nconst defineHiddenProp = (obj, key, value) => {\n    def(obj, key, {\n        enumerable: false,\n        configurable: true,\n        writable: true,\n        value\n    });\n    return value;\n};\n/** @internal */\nconst addSignalListener = (signaler, signal, listener) => signaler.addSignalListener(signal, listener);\n/** @internal */\nconst removeSignalListener = (signaler, signal, listener) => signaler.removeSignalListener(signal, listener);\n/** ExpressionType */\n/** @internal */ const etInterpolation = 'Interpolation';\n/** @internal */ const etIsIterator = 'IsIterator';\n/** @internal */ const etIsFunction = 'IsFunction';\n/** @internal */ const etIsProperty = 'IsProperty';\n/** TaskStatus */\n/** @internal */ const tsPending = 'pending';\n/** @internal */ const tsRunning = 'running';\n/** AccessorType */\n/** @internal */ const atObserver = AccessorType.Observer;\n/** @internal */ const atNode = AccessorType.Node;\n/** @internal */ const atLayout = AccessorType.Layout;\n\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/* eslint-disable prefer-template */\n/** @internal */\nconst createMappedError = (code, ...details) => {\n        const paddedCode = safeString(code).padStart(4, '0');\n        const message = getMessageByCode(code, ...details);\n        const link = `https://docs.aurelia.io/developer-guides/error-messages/runtime-html/aur${paddedCode}`;\n        return new Error(`AUR${paddedCode}: ${message}\\n\\nFor more information, see: ${link}`);\n    }\n    ;\n\nconst errorsMap = {\n    [99 /* ErrorNames.method_not_implemented */]: 'Method {{0}} not implemented',\n    [101 /* ErrorNames.ast_behavior_not_found */]: `Ast eval error: binding behavior \"{{0}}\" could not be found. Did you forget to register it as a dependency?`,\n    [102 /* ErrorNames.ast_behavior_duplicated */]: `Ast eval error: binding behavior \"{{0}}\" already applied.`,\n    [103 /* ErrorNames.ast_converter_not_found */]: `Ast eval error: value converter \"{{0}}\" could not be found. Did you forget to register it as a dependency?`,\n    [105 /* ErrorNames.ast_$host_not_found */]: `Ast eval error: unable to find $host context. Did you forget [au-slot] attribute?`,\n    [106 /* ErrorNames.ast_no_assign_$host */]: `Ast eval error: invalid assignment. \"$host\" is a reserved keyword.`,\n    [107 /* ErrorNames.ast_not_a_function */]: `Ast eval error: expression is not a function.`,\n    [109 /* ErrorNames.ast_unknown_unary_operator */]: `Ast eval error: unknown unary operator: \"{{0}}\"`,\n    [108 /* ErrorNames.ast_unknown_binary_operator */]: `Ast eval error: unknown binary operator: \"{{0}}\"`,\n    [110 /* ErrorNames.ast_tagged_not_a_function */]: `Ast eval error: left-hand side of tagged template expression is not a function.`,\n    [111 /* ErrorNames.ast_name_is_not_a_function */]: `Ast eval error: expected \"{{0}}\" to be a function`,\n    [112 /* ErrorNames.ast_destruct_null */]: `Ast eval error: cannot use non-object value for destructuring assignment.`,\n    [113 /* ErrorNames.ast_increment_infinite_loop */]: `Ast eval error: infinite loop detected. Increment operators should only be used in event handlers.`,\n    [114 /* ErrorNames.ast_nullish_member_access */]: `Ast eval error: cannot access property \"{{0}}\" of {{1}}.`,\n    [115 /* ErrorNames.ast_nullish_keyed_access */]: `Ast eval error: cannot access key \"{{0}}\" of {{1}}.`,\n    [116 /* ErrorNames.ast_nullish_assignment */]: `Ast eval error: cannot assign value to property \"{{0}}\" of null/undefined.`,\n    [151 /* ErrorNames.binding_behavior_def_not_found */]: `No binding behavior definition found for type {{0:name}}`,\n    [152 /* ErrorNames.value_converter_def_not_found */]: `No value converter definition found for type {{0:name}}`,\n    [153 /* ErrorNames.element_existed */]: `Element \"{{0}}\" has already been registered.`,\n    [154 /* ErrorNames.attribute_existed */]: `Attribute \"{{0}}\" has already been registered.`,\n    [155 /* ErrorNames.value_converter_existed */]: `Value converter {{0}} has already been registered.`,\n    [156 /* ErrorNames.binding_behavior_existed */]: `Binding behavior {{0}} has already been registered.`,\n    [157 /* ErrorNames.binding_command_existed */]: `Binding command {{0}} has already been registered.`,\n    [203 /* ErrorNames.null_scope */]: `Trying to retrieve a property or build a scope from a null/undefined scope`,\n    [204 /* ErrorNames.create_scope_with_null_context */]: 'Trying to create a scope with null/undefined binding context',\n    [227 /* ErrorNames.invalid_bindable_decorator_usage_symbol */]: `@bindable is not supported for properties that uses a symbol for name. Use a string for the property name instead.`,\n    [228 /* ErrorNames.invalid_bindable_decorator_usage_class_without_configuration */]: `@bindable cannot be used as a class decorator when no configuration object is supplied.`,\n    [229 /* ErrorNames.invalid_bindable_decorator_usage_class_without_property_name_configuration */]: `@bindable cannot be used as a class decorator when no property name is supplied in the configuration object.`,\n    [500 /* ErrorNames.controller_cached_not_found */]: `There is no cached controller for the provided ViewModel: {{0}}`,\n    [501 /* ErrorNames.controller_no_shadow_on_containerless */]: `Invalid combination: cannot combine the containerless custom element option with Shadow DOM.`,\n    [502 /* ErrorNames.controller_activating_disposed */]: `Trying to activate a disposed controller: {{0}}.`,\n    [503 /* ErrorNames.controller_activation_unexpected_state */]: `Controller at {{0}} is in an unexpected state: {{1}} during activation.`,\n    [504 /* ErrorNames.controller_activation_synthetic_no_scope */]: `Synthetic view at {{0}} is being activated with null/undefined scope.`,\n    [505 /* ErrorNames.controller_deactivation_unexpected_state */]: `Controller at {{0}} is in an unexpected state: {{1}} during deactivation.`,\n    [506 /* ErrorNames.controller_watch_invalid_callback */]: `Invalid callback for @watch decorator: {{0}}`,\n    [507 /* ErrorNames.controller_property_not_coercible */]: `Observer for bindable property {{0}} does not support coercion.`,\n    [508 /* ErrorNames.controller_property_no_change_handler */]: `Observer for property {{0}} does not support change handler.`,\n    [759 /* ErrorNames.attribute_def_not_found */]: `No attribute definition found for type {{0:name}}`,\n    [760 /* ErrorNames.element_def_not_found */]: `No element definition found for type {{0:name}}`,\n    [761 /* ErrorNames.element_only_name */]: `Cannot create a custom element definition with only a name and no type: {{0}}`,\n    [762 /* ErrorNames.node_is_not_a_host */]: `Trying to retrieve a custom element controller from a node, but the provided node <{{0:nodeName}} /> is not a custom element or containerless host.`,\n    [763 /* ErrorNames.node_is_not_a_host2 */]: `Trying to retrieve a custom element controller from a node, but the provided node <{{0:nodeName}} /> is not a custom element or containerless host.`,\n    [764 /* ErrorNames.node_is_not_part_of_aurelia_app */]: `Trying to retrieve a custom element controller from a node.`\n        + ` But the provided node <{{0:nodeName}} /> does not appear to be part of an Aurelia app DOM tree,`\n        + ` or it was added to the DOM in a way that Aurelia cannot properly resolve its position in the component tree.`,\n    [765 /* ErrorNames.node_is_not_part_of_aurelia_app2 */]: `Trying to retrieve a custom element controller from a node.`\n        + ` But the provided node <{{0:nodeName}} /> does not appear to be part of an Aurelia app DOM tree,`\n        + ` or it was added to the DOM in a way that Aurelia cannot properly resolve its position in the component tree.`,\n    [766 /* ErrorNames.invalid_process_content_hook */]: `Invalid @processContent hook. Expected the hook to be a function (when defined in a class, it needs to be a static function) but got a {{0:typeof}}.`,\n    [652 /* ErrorNames.node_observer_strategy_not_found */]: `Aurelia is unable to observe property {{0}}. Register observation mapping with .useConfig().`,\n    [653 /* ErrorNames.node_observer_mapping_existed */]: `Mapping for property {{0}} of <{{1}} /> already exists`,\n    [654 /* ErrorNames.select_observer_array_on_non_multi_select */]: `Array values can only be bound to a multi-select.`,\n    [714 /* ErrorNames.compiler_primary_already_existed */]: `Template compilation error: primary already exists on element/attribute \"{{0}}\"`,\n    [719 /* ErrorNames.compiler_attr_mapper_duplicate_mapping */]: `Attribute {{0}} has been already registered for {{1:element}}`,\n    [767 /* ErrorNames.root_not_found */]: `Aurelia.root was accessed without a valid root.`,\n    [768 /* ErrorNames.aurelia_instance_existed_in_container */]: `An instance of Aurelia is already registered with the container or an ancestor of it.`,\n    [769 /* ErrorNames.invalid_platform_impl */]: `Failed to initialize the platform object. The host element's ownerDocument does not have a defaultView, did you create the host from a DOMParser and forget to call adoptNode()?`,\n    [770 /* ErrorNames.no_composition_root */]: `Aurelia.start() was called without a composition root`,\n    [771 /* ErrorNames.invalid_dispose_call */]: `The aurelia instance must be fully stopped before it can be disposed`,\n    [750 /* ErrorNames.not_supported_view_ref_api */]: `view.ref is not supported. If you are migrating from v1, this can be understood as the controller.`,\n    [751 /* ErrorNames.ref_not_found */]: `Attempted to reference \"{{0}}\", but it was not found amongst the target's API.`,\n    [752 /* ErrorNames.element_res_not_found */]: `Element {{0:.res}} is not registered in {{1:name}}.`,\n    [753 /* ErrorNames.attribute_res_not_found */]: `Attribute {{0:.res}} is not registered in {{1:name}}.`,\n    [754 /* ErrorNames.attribute_tc_res_not_found */]: `Attribute {{0:.res}} is not registered in {{1:name}}.`,\n    [755 /* ErrorNames.view_factory_provider_not_ready */]: `Cannot resolve ViewFactory before the provider was prepared.`,\n    [756 /* ErrorNames.view_factory_invalid_name */]: `Cannot resolve ViewFactory without a (valid) name.`,\n    [757 /* ErrorNames.rendering_mismatch_length */]: `AUR0757: The compiled template is not aligned with the render instructions. There are {{0}} targets and {{1}} instructions.`,\n    [772 /* ErrorNames.watch_null_config */]: `Invalid @watch decorator config. Expected an expression or a fn but received null/undefined.`,\n    [773 /* ErrorNames.watch_invalid_change_handler */]: `Invalid @watch decorator change handler config.`\n        + `Method \"{{0}}\" not found in class {{1}}`,\n    [774 /* ErrorNames.watch_non_method_decorator_usage */]: `Invalid @watch decorator usage: decorated target {{0}} is not a class method.`,\n    [775 /* ErrorNames.repeat_invalid_key_binding_command */]: `Invalid command \"{{0}}\" usage with [repeat]`,\n    [776 /* ErrorNames.repeat_extraneous_binding */]: `Invalid [repeat] usage, found extraneous target \"{{0}}\"`,\n    [777 /* ErrorNames.repeat_non_iterable */]: `Unsupported: [repeat] cannot iterate over {{0:toString}}`,\n    [778 /* ErrorNames.repeat_non_countable */]: `Unsupported: [repeat] cannot count {{0:toString}}`,\n    [814 /* ErrorNames.repeat_mismatch_length */]: `[repeat] encountered an error: number of views != number of items {{0:join(!=)}}`,\n    [779 /* ErrorNames.portal_invalid_insert_position */]: 'Invalid portal insertion position: {{0}}',\n    [801 /* ErrorNames.self_behavior_invalid_usage */]: `\"& self\" binding behavior only supports listener binding via trigger/capture command.`,\n    [802 /* ErrorNames.update_trigger_behavior_no_triggers */]: `\"& updateTrigger\" invalid usage. This binding behavior requires at least one event name argument: eg <input value.bind=\"firstName & updateTrigger:'blur'\">`,\n    [803 /* ErrorNames.update_trigger_invalid_usage */]: `\"& updateTrigger\" invalid usage. This binding behavior can only be applied to two-way/ from-view bindings.`,\n    [805 /* ErrorNames.au_compose_invalid_scope_behavior */]: `Invalid scope behavior \"{{0}}\" on <au-compose />. Only \"scoped\" or \"auto\" allowed.`,\n    // originally not supported\n    [806 /* ErrorNames.au_compose_component_name_not_found */]: `<au-compose /> couldn't find a custom element with name \"{{0}}\", did you forget to register it locally or globally?`,\n    [807 /* ErrorNames.au_compose_invalid_run */]: `Composition has already been activated/deactivated. Id: {{0:controller}}`,\n    [808 /* ErrorNames.au_compose_duplicate_deactivate */]: `Composition has already been deactivated.`,\n    [810 /* ErrorNames.else_without_if */]: `Invalid [else] usage, it should follow an [if]`,\n    [811 /* ErrorNames.portal_query_empty */]: `Invalid portal strict target query, empty query.`,\n    [812 /* ErrorNames.portal_no_target */]: `Invalid portal strict target resolution, target not found.`,\n    [813 /* ErrorNames.promise_invalid_usage */]: `Invalid [pending]/[then]/[catch] usage. The parent [promise].resolve not found; only \"*[promise.resolve] > *[pending|then|catch]\" relation is supported.`,\n    [815 /* ErrorNames.switch_invalid_usage */]: `Invalid [case/default-case] usage. The parent [switch] not found; only \"*[switch] > *[case|default-case]\" relation is supported.`,\n    [816 /* ErrorNames.switch_no_multiple_default */]: `Invalid [default-case] usage. Multiple 'default-case's are not allowed.`,\n    [817 /* ErrorNames.signal_behavior_invalid_usage */]: `\"& signal\" binding behavior can only be used with bindings that have a \"handleChange\" method`,\n    [818 /* ErrorNames.signal_behavior_no_signals */]: `\"& signal\" invalid usage. At least one signal name must be passed to the signal behavior, e.g. \"expr & signal:'my-signal'\"`,\n    [819 /* ErrorNames.spreading_bindable_onto_non_component */]: 'Spreading to bindables onto non custom element',\n    [820 /* ErrorNames.spreading_invalid_target */]: `Invalid spread target {{0}}`,\n    [9999 /* ErrorNames.no_spread_scope_context_found */]: 'No scope context for spread binding.',\n    [9998 /* ErrorNames.no_spread_template_controller */]: 'Spread binding does not support spreading custom attributes/template controllers. Did you build the spread instruction manually?',\n    [9997 /* ErrorNames.marker_malformed */]: `Marker is malformed. This likely happens when a compiled template has been modified.`\n        + ` Did you accidentally modified some compiled template? You can modify template before compilation with compiling Template compiler hook.`,\n    [9996 /* ErrorNames.binding_already_has_rate_limited */]: `Invalid usage, a rate limit has already been applied. Did you have both throttle and debounce on the same binding?`,\n    [9995 /* ErrorNames.binding_already_has_target_subscriber */]: `The binding already has a target subscriber.`,\n    [9994 /* ErrorNames.attr_behavior_invalid_binding */]: `\"& attr\" can be only used on property binding. It's used on {{0:ctor}}`,\n    [9993 /* ErrorNames.update_trigger_behavior_not_supported */]: '\"& updateTrigger\" binding behavior only works with the default implementation of Aurelia HTML observation. Implement your own node observation + updateTrigger',\n    [9992 /* ErrorNames.update_trigger_behavior_node_property_not_observable */]: `\"& updateTrigger\" uses node observer to observe, but it does not know how to use events to observe property <{{0:target@property}} />`,\n    [9991 /* ErrorNames.children_decorator_invalid_usage */]: `Invalid @children usage. @children decorator can only be used on a field`,\n    [9990 /* ErrorNames.slotted_decorator_invalid_usage */]: `Invalid @slotted usage. @slotted decorator can only be used on a field`,\n    [9989 /* ErrorNames.children_invalid_query */]: `Invalid query selector. Only selectors with alpha-numeric characters, or $all are allowed. Got {{0}} instead.`\n};\nconst getMessageByCode = (name, ...details) => {\n    let cooked = errorsMap[name];\n    for (let i = 0; i < details.length; ++i) {\n        const regex = new RegExp(`{{${i}(:.*)?}}`, 'g');\n        let matches = regex.exec(cooked);\n        while (matches != null) {\n            const method = matches[1]?.slice(1);\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            let value = details[i];\n            if (value != null) {\n                switch (method) {\n                    case 'nodeName':\n                        value = value.nodeName.toLowerCase();\n                        break;\n                    case 'name':\n                        value = value.name;\n                        break;\n                    case 'typeof':\n                        value = typeof value;\n                        break;\n                    case 'ctor':\n                        value = value.constructor.name;\n                        break;\n                    case 'controller':\n                        value = value.controller.name;\n                        break;\n                    case 'target@property':\n                        value = `${value.target}@${value.targetProperty}`;\n                        break;\n                    case 'toString':\n                        value = Object.prototype.toString.call(value);\n                        break;\n                    case 'join(!=)':\n                        value = value.join('!=');\n                        break;\n                    case 'bindingCommandHelp':\n                        value = getBindingCommandHelp(value);\n                        break;\n                    case 'element':\n                        value = value === '*' ? 'all elements' : `<${value} />`;\n                        break;\n                    default: {\n                        // property access\n                        if (method?.startsWith('.')) {\n                            value = safeString(value[method.slice(1)]);\n                        }\n                        else {\n                            value = safeString(value);\n                        }\n                    }\n                }\n            }\n            cooked = cooked.slice(0, matches.index) + value + cooked.slice(regex.lastIndex);\n            matches = regex.exec(cooked);\n        }\n    }\n    return cooked;\n};\nfunction getBindingCommandHelp(name) {\n    switch (name) {\n        case 'delegate':\n            return `\\nThe \".delegate\" binding command has been removed in v2.`\n                + ` Binding command \".trigger\" should be used instead.`\n                + ` If you are migrating v1 application, install compat package`\n                + ` to add back the \".delegate\" binding command for ease of migration.`;\n        case 'call':\n            return `\\nThe \".call\" binding command has been removed in v2.`\n                + ` If you want to pass a callback that preserves the context of the function call,`\n                + ` you can use lambda instead. Refer to lambda expression doc for more details.`;\n        default:\n            return '';\n    }\n}\n\nfunction bindable(configOrPropOrTarget, context) {\n    let configOrProp = void 0;\n    function decorator(_target, context) {\n        let $prop;\n        switch (context.kind) {\n            case 'getter':\n            case 'field': {\n                const prop = context.name;\n                // We are not supporting a bindable that uses a symbol for name.\n                // Maybe we can later have a binding command like foo.sym=\"bar\" that creates bindable instruction for `Symbol.for('sym')`, as target property.\n                if (typeof prop !== 'string')\n                    throw createMappedError(227 /* ErrorNames.invalid_bindable_decorator_usage_symbol */);\n                $prop = prop;\n                break;\n            }\n            case 'class':\n                if (configOrProp == null)\n                    throw createMappedError(228 /* ErrorNames.invalid_bindable_decorator_usage_class_without_configuration */);\n                if (typeof configOrProp == 'string') {\n                    $prop = configOrProp;\n                }\n                else {\n                    const prop = configOrProp.name;\n                    if (!prop)\n                        throw createMappedError(229 /* ErrorNames.invalid_bindable_decorator_usage_class_without_property_name_configuration */);\n                    if (typeof prop !== 'string')\n                        throw createMappedError(227 /* ErrorNames.invalid_bindable_decorator_usage_symbol */);\n                    $prop = prop;\n                }\n                break;\n        }\n        const config = configOrProp == null || typeof configOrProp === 'string'\n            ? { name: $prop }\n            : configOrProp;\n        const metadata = (context.metadata[baseName] ??= createLookup());\n        metadata[$prop] = BindableDefinition.create($prop, config);\n    }\n    if (arguments.length > 1) {\n        // Non invocation:\n        // - @bindable\n        configOrProp = {};\n        decorator(configOrPropOrTarget, context);\n        return;\n    }\n    else if (isString(configOrPropOrTarget)) {\n        // ClassDecorator\n        // - @bindable('bar')\n        // Direct call:\n        // - @bindable('bar')(Foo)\n        configOrProp = configOrPropOrTarget;\n        return decorator;\n    }\n    // Invocation with or w/o opts:\n    // - @bindable()\n    // - @bindable({...opts})\n    configOrProp = configOrPropOrTarget === void 0 ? {} : configOrPropOrTarget;\n    return decorator;\n}\nconst baseName = /*@__PURE__*/ getAnnotationKeyFor('bindables');\nconst Bindable = objectFreeze({\n    name: baseName,\n    keyFrom: (name) => `${baseName}:${name}`,\n    from(...bindableLists) {\n        const bindables = {};\n        const isArray = Array.isArray;\n        function addName(name) {\n            bindables[name] = BindableDefinition.create(name);\n        }\n        function addDescription(name, def) {\n            bindables[name] = def instanceof BindableDefinition ? def : BindableDefinition.create(name, def === true ? {} : def);\n        }\n        function addList(maybeList) {\n            if (isArray(maybeList)) {\n                maybeList.forEach(nameOrDef => isString(nameOrDef) ? addName(nameOrDef) : addDescription(nameOrDef.name, nameOrDef));\n            }\n            else if (maybeList instanceof BindableDefinition) {\n                bindables[maybeList.name] = maybeList;\n            }\n            else if (maybeList !== void 0) {\n                objectKeys(maybeList).forEach(name => addDescription(name, maybeList[name]));\n            }\n        }\n        bindableLists.forEach(addList);\n        return bindables;\n    },\n    getAll(Type) {\n        const defs = [];\n        const prototypeChain = getPrototypeChain(Type);\n        let iProto = prototypeChain.length;\n        let Class;\n        while (--iProto >= 0) {\n            Class = prototypeChain[iProto];\n            const bindableMetadata = getMetadata(baseName, Class);\n            if (bindableMetadata == null)\n                continue;\n            defs.push(...Object.values(bindableMetadata));\n        }\n        return defs;\n    },\n    /** @internal */\n    _add(bindable, Type) {\n        let bindables = getMetadata(baseName, Type);\n        if (bindables == null) {\n            defineMetadata(bindables = createLookup(), Type, baseName);\n        }\n        bindables[bindable.name] = bindable;\n    }\n});\nclass BindableDefinition {\n    constructor(attribute, callback, mode, primary, name, set) {\n        this.attribute = attribute;\n        this.callback = callback;\n        this.mode = mode;\n        this.primary = primary;\n        this.name = name;\n        this.set = set;\n    }\n    static create(prop, def = {}) {\n        const mode = (def.mode ?? toView);\n        return new BindableDefinition(def.attribute ?? kebabCase(prop), def.callback ?? `${prop}Changed`, isString(mode) ? BindingMode[mode] ?? defaultMode : mode, def.primary ?? false, def.name ?? prop, def.set ?? getInterceptor(def));\n    }\n}\nfunction coercer(target, context) {\n    context.addInitializer(function () {\n        Coercer.define(this, context.name);\n    });\n}\nconst Coercer = {\n    key: /*@__PURE__*/ getAnnotationKeyFor('coercer'),\n    define(target, property) {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-explicit-any\n        defineMetadata(target[property].bind(target), target, Coercer.key);\n    },\n    for(target) {\n        return getMetadata(Coercer.key, target);\n    }\n};\nfunction getInterceptor(def = {}) {\n    // TS5.x does not emit design:type metadata any longer for the new TC39 decorator proposal implementation.\n    // Hence, we needs to be solely reliant on the user-provided type in the bindable definition.\n    const type = def.type ?? null;\n    if (type == null) {\n        return noop;\n    }\n    let coercer;\n    switch (type) {\n        case Number:\n        case Boolean:\n        case String:\n        case BigInt:\n            coercer = type;\n            break;\n        default: {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-explicit-any\n            const $coercer = type.coerce;\n            coercer = typeof $coercer === 'function'\n                ? $coercer.bind(type)\n                : (Coercer.for(type) ?? noop);\n            break;\n        }\n    }\n    return coercer === noop\n        ? coercer\n        : createCoercer(coercer, def.nullable);\n}\nfunction createCoercer(coercer, nullable) {\n    return function (value, coercionConfiguration) {\n        if (!coercionConfiguration?.enableCoercion)\n            return value;\n        return ((nullable ?? ((coercionConfiguration?.coerceNullish ?? false) ? false : true)) && value == null)\n            ? value\n            : coercer(value, coercionConfiguration);\n    };\n}\n\n/** @internal */\nconst createInterface = DI.createInterface;\n/** @internal */\nconst singletonRegistration = Registration.singleton;\n/** @internal */\nconst aliasRegistration = Registration.aliasTo;\n/** @internal */\nconst instanceRegistration = Registration.instance;\n/** @internal */\nRegistration.callback;\n/** @internal */\nRegistration.transient;\n/** @internal */\nconst registerResolver = (ctn, key, resolver) => ctn.registerResolver(key, resolver);\nfunction alias(...aliases) {\n    return function (target, context) {\n        context.addInitializer(function () {\n            const key = getAnnotationKeyFor('aliases');\n            const existing = getMetadata(key, this);\n            if (existing === void 0) {\n                defineMetadata(aliases, this, key);\n            }\n            else {\n                existing.push(...aliases);\n            }\n        });\n    };\n}\nfunction registerAliases(aliases, resource, key, container) {\n    for (let i = 0, ii = aliases.length; i < ii; ++i) {\n        aliasRegistration(key, resource.keyFrom(aliases[i])).register(container);\n    }\n}\n\n/** @internal */ const dtElement = 'custom-element';\n/** @internal */ const dtAttribute = 'custom-attribute';\n/** @internal */ const getDefinitionFromStaticAu = (\n// eslint-disable-next-line @typescript-eslint/ban-types\nType, typeName, createDef, metadataKey = '__au_static_resource__') => {\n    let def = getMetadata(metadataKey, Type);\n    if (def == null) {\n        if (Type.$au?.type === typeName) {\n            def = createDef(Type.$au, Type);\n            defineMetadata(def, Type, metadataKey);\n        }\n    }\n    return def;\n};\n\nfunction bindingBehavior(nameOrDef) {\n    return function (target, context) {\n        context.addInitializer(function () {\n            BindingBehavior.define(nameOrDef, this);\n        });\n        return target;\n    };\n}\nclass BindingBehaviorDefinition {\n    constructor(Type, name, aliases, key) {\n        this.Type = Type;\n        this.name = name;\n        this.aliases = aliases;\n        this.key = key;\n    }\n    static create(nameOrDef, Type) {\n        let name;\n        let def;\n        if (isString(nameOrDef)) {\n            name = nameOrDef;\n            def = { name };\n        }\n        else {\n            name = nameOrDef.name;\n            def = nameOrDef;\n        }\n        return new BindingBehaviorDefinition(Type, firstDefined(getBehaviorAnnotation(Type, 'name'), name), mergeArrays(getBehaviorAnnotation(Type, 'aliases'), def.aliases, Type.aliases), BindingBehavior.keyFrom(name));\n    }\n    register(container, aliasName) {\n        const $Type = this.Type;\n        const key = typeof aliasName === 'string' ? getBindingBehaviorKeyFrom(aliasName) : this.key;\n        const aliases = this.aliases;\n        if (!container.has(key, false)) {\n            container.register(container.has($Type, false) ? null : singletonRegistration($Type, $Type), aliasRegistration($Type, key), ...aliases.map(alias => aliasRegistration($Type, getBindingBehaviorKeyFrom(alias))));\n        } /* istanbul ignore next */\n        else {\n            // eslint-disable-next-line no-console\n            console.warn(`[DEV:aurelia] ${createMappedError(156 /* ErrorNames.binding_behavior_existed */, this.name)}`);\n        }\n    }\n}\n/** @internal */ const behaviorTypeName = 'binding-behavior';\nconst bbBaseName = /*@__PURE__*/ getResourceKeyFor(behaviorTypeName);\nconst getBehaviorAnnotation = (Type, prop) => getMetadata(getAnnotationKeyFor(prop), Type);\nconst getBindingBehaviorKeyFrom = (name) => `${bbBaseName}:${name}`;\nconst BindingBehavior = /*@__PURE__*/ objectFreeze({\n    name: bbBaseName,\n    keyFrom: getBindingBehaviorKeyFrom,\n    isType(value) {\n        return isFunction(value) && (hasMetadata(bbBaseName, value) || value.$au?.type === behaviorTypeName);\n    },\n    define(nameOrDef, Type) {\n        const definition = BindingBehaviorDefinition.create(nameOrDef, Type);\n        const $Type = definition.Type;\n        // registration of resource name is a requirement for the resource system in kernel (module-loader)\n        defineMetadata(definition, $Type, bbBaseName, resourceBaseName);\n        return $Type;\n    },\n    getDefinition(Type) {\n        const def = getMetadata(bbBaseName, Type)\n            ?? getDefinitionFromStaticAu(Type, behaviorTypeName, BindingBehaviorDefinition.create);\n        if (def === void 0) {\n            throw createMappedError(151 /* ErrorNames.binding_behavior_def_not_found */, Type);\n        }\n        return def;\n    },\n    find(container, name) {\n        const Type = container.find(behaviorTypeName, name);\n        return Type == null\n            ? null\n            : getMetadata(bbBaseName, Type) ?? getDefinitionFromStaticAu(Type, behaviorTypeName, BindingBehaviorDefinition.create) ?? null;\n    },\n    get(container, name) {\n        {\n            try {\n                return container.get(resource(getBindingBehaviorKeyFrom(name)));\n            }\n            catch (ex) {\n                // eslint-disable-next-line no-console\n                console.error('[DEV:aurelia] Cannot retrieve binding behavior with name', name);\n                throw ex;\n            }\n        }\n        return container.get(resource(getBindingBehaviorKeyFrom(name)));\n    },\n});\n\nconst originalModesMap = new Map();\nconst createConfig = (name) => ({ type: behaviorTypeName, name });\nclass BindingModeBehavior {\n    bind(scope, binding) {\n        originalModesMap.set(binding, binding.mode);\n        binding.mode = this.mode;\n    }\n    unbind(scope, binding) {\n        binding.mode = originalModesMap.get(binding);\n        originalModesMap.delete(binding);\n    }\n}\nclass OneTimeBindingBehavior extends BindingModeBehavior {\n    get mode() { return oneTime; }\n}\nOneTimeBindingBehavior.$au = createConfig('oneTime');\nclass ToViewBindingBehavior extends BindingModeBehavior {\n    get mode() { return toView; }\n}\nToViewBindingBehavior.$au = createConfig('toView');\nclass FromViewBindingBehavior extends BindingModeBehavior {\n    get mode() { return fromView; }\n}\nFromViewBindingBehavior.$au = createConfig('fromView');\nclass TwoWayBindingBehavior extends BindingModeBehavior {\n    get mode() { return twoWay; }\n}\nTwoWayBindingBehavior.$au = createConfig('twoWay');\n\nconst bindingHandlerMap$1 = new WeakMap();\nconst defaultDelay$1 = 200;\nclass DebounceBindingBehavior {\n    constructor() {\n        /** @internal */\n        this._platform = resolve(IPlatform$1);\n    }\n    bind(scope, binding, delay, signals) {\n        const opts = {\n            type: 'debounce',\n            delay: delay ?? defaultDelay$1,\n            now: this._platform.performanceNow,\n            queue: this._platform.taskQueue,\n            signals: isString(signals) ? [signals] : (signals ?? emptyArray),\n        };\n        const handler = binding.limit?.(opts);\n        if (handler == null) {\n            /* istanbul ignore next */\n            {\n                // eslint-disable-next-line no-console\n                console.warn(`Binding ${binding.constructor.name} does not support debounce rate limiting`);\n            }\n        }\n        else {\n            bindingHandlerMap$1.set(binding, handler);\n        }\n    }\n    unbind(scope, binding) {\n        bindingHandlerMap$1.get(binding)?.dispose();\n        bindingHandlerMap$1.delete(binding);\n    }\n}\nDebounceBindingBehavior.$au = {\n    type: behaviorTypeName,\n    name: 'debounce',\n};\n\nconst ISignaler = /*@__PURE__*/ createInterface('ISignaler', x => x.singleton(Signaler));\nclass Signaler {\n    constructor() {\n        this.signals = createLookup();\n    }\n    dispatchSignal(name) {\n        const listeners = this.signals[name];\n        if (listeners === undefined) {\n            return;\n        }\n        let listener;\n        for (listener of listeners.keys()) {\n            listener.handleChange(undefined, undefined);\n        }\n    }\n    addSignalListener(name, listener) {\n        (this.signals[name] ??= new Set()).add(listener);\n    }\n    removeSignalListener(name, listener) {\n        this.signals[name]?.delete(listener);\n    }\n}\n\nclass SignalBindingBehavior {\n    constructor() {\n        /** @internal */\n        this._lookup = new Map();\n        /** @internal */\n        this._signaler = resolve(ISignaler);\n    }\n    bind(scope, binding, ...names) {\n        if (!('handleChange' in binding)) {\n            throw createMappedError(817 /* ErrorNames.signal_behavior_invalid_usage */);\n        }\n        if (names.length === 0) {\n            throw createMappedError(818 /* ErrorNames.signal_behavior_no_signals */);\n        }\n        this._lookup.set(binding, names);\n        let name;\n        for (name of names) {\n            addSignalListener(this._signaler, name, binding);\n        }\n    }\n    unbind(scope, binding) {\n        const names = this._lookup.get(binding);\n        this._lookup.delete(binding);\n        let name;\n        for (name of names) {\n            removeSignalListener(this._signaler, name, binding);\n        }\n    }\n}\nSignalBindingBehavior.$au = {\n    type: behaviorTypeName,\n    name: 'signal',\n};\n\nconst bindingHandlerMap = new WeakMap();\nconst defaultDelay = 200;\nclass ThrottleBindingBehavior {\n    constructor() {\n        ({ performanceNow: this._now, taskQueue: this._taskQueue } = resolve(IPlatform$1));\n    }\n    bind(scope, binding, delay, signals) {\n        const opts = {\n            type: 'throttle',\n            delay: delay ?? defaultDelay,\n            now: this._now,\n            queue: this._taskQueue,\n            signals: isString(signals) ? [signals] : (signals ?? emptyArray),\n        };\n        const handler = binding.limit?.(opts);\n        if (handler == null) {\n            /* istanbul ignore next */\n            {\n                // eslint-disable-next-line no-console\n                console.warn(`Binding ${binding.constructor.name} does not support debounce rate limiting`);\n            }\n        }\n        else {\n            bindingHandlerMap.set(binding, handler);\n        }\n    }\n    unbind(scope, binding) {\n        bindingHandlerMap.get(binding)?.dispose();\n        bindingHandlerMap.delete(binding);\n    }\n}\nThrottleBindingBehavior.$au = {\n    type: behaviorTypeName,\n    name: 'throttle',\n};\n\nconst IAppTask = /*@__PURE__*/ createInterface('IAppTask');\nclass $AppTask {\n    constructor(slot, key, cb) {\n        /** @internal */\n        this.c = (void 0);\n        this.slot = slot;\n        this.k = key;\n        this.cb = cb;\n    }\n    register(container) {\n        return this.c = container.register(instanceRegistration(IAppTask, this));\n    }\n    run() {\n        const key = this.k;\n        const cb = this.cb;\n        return (key === null\n            ? cb()\n            : cb(this.c.get(key)));\n    }\n}\nconst AppTask = objectFreeze({\n    /**\n     * Returns a task that will run just before the root component is created by DI\n     */\n    creating: createAppTaskSlotHook('creating'),\n    /**\n     * Returns a task that will run after instantiating the root controller,\n     * but before compiling its view (thus means before instantiating the child elements inside it)\n     *\n     * good chance for a router to do some initial work, or initial routing related in general\n     */\n    hydrating: createAppTaskSlotHook('hydrating'),\n    /**\n     * Return a task that will run after the hydration of the root controller,\n     * but before hydrating the child element inside\n     *\n     * good chance for a router to do some initial work, or initial routing related in general\n     */\n    hydrated: createAppTaskSlotHook('hydrated'),\n    /**\n     * Return a task that will run right before the root component is activated.\n     * In this phase, scope hierarchy is formed, and bindings are getting bound\n     */\n    activating: createAppTaskSlotHook('activating'),\n    /**\n     * Return a task that will run right after the root component is activated - the app is now running\n     */\n    activated: createAppTaskSlotHook('activated'),\n    /**\n     * Return a task that will runs right before the root component is deactivated.\n     * In this phase, scope hierarchy is unlinked, and bindings are getting unbound\n     */\n    deactivating: createAppTaskSlotHook('deactivating'),\n    /**\n     * Return a task that will run right after the root component is deactivated\n     */\n    deactivated: createAppTaskSlotHook('deactivated'),\n});\nfunction createAppTaskSlotHook(slotName) {\n    function appTaskFactory(keyOrCallback, callback) {\n        if (isFunction(callback)) {\n            return new $AppTask(slotName, keyOrCallback, callback);\n        }\n        return new $AppTask(slotName, null, keyOrCallback);\n    }\n    return appTaskFactory;\n}\n\nconst IPlatform = IPlatform$1;\n\nclass Refs {\n}\nconst refs = /*@__PURE__*/ (() => {\n    const refsMap = new WeakMap();\n    let hideProp = false;\n    return new class {\n        get hideProp() {\n            return hideProp;\n        }\n        set hideProp(value) {\n            hideProp = value;\n        }\n        get(node, name) {\n            return refsMap.get(node)?.[name] ?? null;\n        }\n        set(node, name, controller) {\n            const ref = refsMap.get(node) ?? (refsMap.set(node, new Refs()), refsMap.get(node));\n            if (name in ref) {\n                throw new Error(`Node already associated with a controller, remove the ref \"${name}\" first before associating with another controller`);\n            }\n            if (!hideProp) {\n                node.$au ??= ref;\n            }\n            return (ref[name] = controller);\n        }\n    }();\n})();\nconst INode = /*@__PURE__*/ createInterface('INode');\n\nfunction watch(expressionOrPropertyAccessFn, changeHandlerOrCallbackOrOptions, optionsOrUndefined) {\n    if (expressionOrPropertyAccessFn == null) {\n        throw createMappedError(772 /* ErrorNames.watch_null_config */);\n    }\n    return function decorator(\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    target, context) {\n        const isClassDecorator = context.kind === 'class';\n        let options;\n        let changeHandler;\n        // basic validation\n        if (isClassDecorator) {\n            if (!isFunction(changeHandlerOrCallbackOrOptions)\n                && (changeHandlerOrCallbackOrOptions == null\n                    || !(changeHandlerOrCallbackOrOptions in target.prototype))) {\n                throw createMappedError(773 /* ErrorNames.watch_invalid_change_handler */, `${safeString(changeHandlerOrCallbackOrOptions)}@${target.name}}`);\n            }\n            changeHandler = changeHandlerOrCallbackOrOptions;\n            options = optionsOrUndefined ?? {};\n        }\n        else {\n            if (!isFunction(target) || context.static) {\n                throw createMappedError(774 /* ErrorNames.watch_non_method_decorator_usage */, context.name);\n            }\n            changeHandler = target;\n            options = changeHandlerOrCallbackOrOptions ?? {};\n        }\n        const watchDef = new WatchDefinition(expressionOrPropertyAccessFn, changeHandler, options.flush);\n        if (isClassDecorator) {\n            addDefinition(target);\n        }\n        else {\n            // instance method decorator initializer is called for each instance\n            let added = false;\n            context.addInitializer(function () {\n                if (!added) {\n                    added = true;\n                    addDefinition(this.constructor);\n                }\n            });\n        }\n        function addDefinition(type) {\n            Watch.add(type, watchDef);\n            // if the code looks like this:\n            // @watch(...)\n            // @customAttribute(...)\n            // class Abc {}\n            //\n            // then @watch is called after @customAttribute\n            // which means the attribute definition won't have the watch definition\n            //\n            // temporarily works around this order sensitivity by manually add the watch def\n            // manual\n            if (isAttributeType(type)) {\n                getAttributeDefinition(type).watches.push(watchDef);\n            }\n            if (isElementType(type)) {\n                getElementDefinition(type).watches.push(watchDef);\n            }\n        }\n    };\n}\nclass WatchDefinition {\n    constructor(expression, callback, flush = 'async') {\n        this.expression = expression;\n        this.callback = callback;\n        this.flush = flush;\n    }\n}\nconst Watch = /*@__PURE__*/ (() => {\n    const watches = new WeakMap();\n    return objectFreeze({\n        add(Type, definition) {\n            let defs = watches.get(Type);\n            if (defs == null) {\n                watches.set(Type, defs = []);\n            }\n            defs.push(definition);\n        },\n        getDefinitions(Type) {\n            return watches.get(Type) ?? emptyArray;\n        }\n    });\n})();\n\nfunction customAttribute(nameOrDef) {\n    return function (target, context) {\n        context.addInitializer(function () {\n            defineAttribute(nameOrDef, this);\n        });\n        return target;\n    };\n}\nfunction templateController(nameOrDef) {\n    return function (target, context) {\n        context.addInitializer(function () {\n            defineAttribute(isString(nameOrDef)\n                ? { isTemplateController: true, name: nameOrDef }\n                : { isTemplateController: true, ...nameOrDef }, this);\n        });\n        return target;\n    };\n}\nclass CustomAttributeDefinition {\n    // a simple marker to distinguish between Custom Element definition & Custom attribute definition\n    get type() { return dtAttribute; }\n    constructor(Type, name, aliases, key, defaultBindingMode, isTemplateController, bindables, noMultiBindings, watches, dependencies, containerStrategy) {\n        this.Type = Type;\n        this.name = name;\n        this.aliases = aliases;\n        this.key = key;\n        this.defaultBindingMode = defaultBindingMode;\n        this.isTemplateController = isTemplateController;\n        this.bindables = bindables;\n        this.noMultiBindings = noMultiBindings;\n        this.watches = watches;\n        this.dependencies = dependencies;\n        this.containerStrategy = containerStrategy;\n    }\n    static create(nameOrDef, Type) {\n        let name;\n        let def;\n        if (isString(nameOrDef)) {\n            name = nameOrDef;\n            def = { name };\n        }\n        else {\n            name = nameOrDef.name;\n            def = nameOrDef;\n        }\n        const mode = firstDefined(getAttributeAnnotation(Type, 'defaultBindingMode'), def.defaultBindingMode, Type.defaultBindingMode, toView);\n        for (const bindable of Object.values(Bindable.from(def.bindables))) {\n            Bindable._add(bindable, Type);\n        }\n        return new CustomAttributeDefinition(Type, firstDefined(getAttributeAnnotation(Type, 'name'), name), mergeArrays(getAttributeAnnotation(Type, 'aliases'), def.aliases, Type.aliases), getAttributeKeyFrom(name), isString(mode) ? BindingMode[mode] ?? defaultMode : mode, firstDefined(getAttributeAnnotation(Type, 'isTemplateController'), def.isTemplateController, Type.isTemplateController, false), Bindable.from(...Bindable.getAll(Type), getAttributeAnnotation(Type, 'bindables'), Type.bindables, def.bindables), firstDefined(getAttributeAnnotation(Type, 'noMultiBindings'), def.noMultiBindings, Type.noMultiBindings, false), mergeArrays(Watch.getDefinitions(Type), Type.watches), mergeArrays(getAttributeAnnotation(Type, 'dependencies'), def.dependencies, Type.dependencies), firstDefined(getAttributeAnnotation(Type, 'containerStrategy'), def.containerStrategy, Type.containerStrategy, 'reuse'));\n    }\n    register(container, aliasName) {\n        const $Type = this.Type;\n        const key = typeof aliasName === 'string' ? getAttributeKeyFrom(aliasName) : this.key;\n        const aliases = this.aliases;\n        if (!container.has(key, false)) {\n            container.register(container.has($Type, false) ? null : singletonRegistration($Type, $Type), aliasRegistration($Type, key), ...aliases.map(alias => aliasRegistration($Type, getAttributeKeyFrom(alias))));\n        } /* istanbul ignore next */\n        else {\n            if (CustomAttributeDefinition.warnDuplicate) {\n                container.get(ILogger).warn(createMappedError(154 /* ErrorNames.attribute_existed */, this.name));\n            }\n            /* istanbul ignore if */\n            {\n                // eslint-disable-next-line no-console\n                console.warn(`[DEV:aurelia] ${createMappedError(154 /* ErrorNames.attribute_existed */, this.name)}`);\n            }\n        }\n    }\n    toString() {\n        return `au:ca:${this.name}`;\n    }\n}\nCustomAttributeDefinition.warnDuplicate = true;\n/** @internal */ const attrTypeName = 'custom-attribute';\nconst attributeBaseName = /*@__PURE__*/ getResourceKeyFor(attrTypeName);\nconst getAttributeKeyFrom = (name) => `${attributeBaseName}:${name}`;\nconst getAttributeAnnotation = (Type, prop) => getMetadata(getAnnotationKeyFor(prop), Type);\n/** @internal */\nconst isAttributeType = (value) => {\n    return isFunction(value) && (hasMetadata(attributeBaseName, value)\n        || value.$au?.type === attrTypeName);\n};\n/** @internal */\nconst findAttributeControllerFor = (node, name) => {\n    return (refs.get(node, getAttributeKeyFrom(name)) ?? void 0);\n};\n/** @internal */\nconst defineAttribute = (nameOrDef, Type) => {\n    const definition = CustomAttributeDefinition.create(nameOrDef, Type);\n    const $Type = definition.Type;\n    defineMetadata(definition, $Type, attributeBaseName, resourceBaseName);\n    return $Type;\n};\n/** @internal */\n// eslint-disable-next-line @typescript-eslint/ban-types\nconst getAttributeDefinition = (Type) => {\n    const def = getMetadata(attributeBaseName, Type)\n        ?? getDefinitionFromStaticAu(Type, attrTypeName, CustomAttributeDefinition.create);\n    if (def === void 0) {\n        throw createMappedError(759 /* ErrorNames.attribute_def_not_found */, Type);\n    }\n    return def;\n};\nconst findClosestControllerByName = (node, attrNameOrType) => {\n    let key = '';\n    let attrName = '';\n    if (isString(attrNameOrType)) {\n        key = getAttributeKeyFrom(attrNameOrType);\n        attrName = attrNameOrType;\n    }\n    else {\n        const definition = getAttributeDefinition(attrNameOrType);\n        key = definition.key;\n        attrName = definition.name;\n    }\n    let cur = node;\n    while (cur !== null) {\n        const controller = refs.get(cur, key);\n        if (controller?.is(attrName)) {\n            return controller;\n        }\n        cur = getEffectiveParentNode(cur);\n    }\n    return null;\n};\nconst CustomAttribute = /*@__PURE__*/ objectFreeze({\n    name: attributeBaseName,\n    keyFrom: getAttributeKeyFrom,\n    isType: isAttributeType,\n    for: findAttributeControllerFor,\n    closest: findClosestControllerByName,\n    define: defineAttribute,\n    getDefinition: getAttributeDefinition,\n    annotate(Type, prop, value) {\n        defineMetadata(value, Type, getAnnotationKeyFor(prop));\n    },\n    getAnnotation: getAttributeAnnotation,\n    find(c, name) {\n        const Type = c.find(attrTypeName, name);\n        return Type === null\n            ? null\n            : getMetadata(attributeBaseName, Type)\n                ?? getDefinitionFromStaticAu(Type, attrTypeName, CustomAttributeDefinition.create)\n                ?? null;\n    },\n});\n\nconst ILifecycleHooks = /*@__PURE__*/ createInterface('ILifecycleHooks');\nclass LifecycleHooksEntry {\n    constructor(definition, instance) {\n        this.definition = definition;\n        this.instance = instance;\n    }\n}\n/**\n * This definition has no specific properties yet other than the type, but is in place for future extensions.\n *\n * See: https://github.com/aurelia/aurelia/issues/1044\n */\nclass LifecycleHooksDefinition {\n    constructor(Type, propertyNames) {\n        this.Type = Type;\n        this.propertyNames = propertyNames;\n    }\n    /**\n     * @param def - Placeholder for future extensions. Currently always an empty object.\n     */\n    static create(def, Type) {\n        const propertyNames = new Set();\n        let proto = Type.prototype;\n        while (proto !== baseObjectPrototype) {\n            for (const name of getOwnPropertyNames(proto)) {\n                // This is the only check we will do for now. Filtering on e.g. function types might not always work properly when decorators come into play. This would need more testing first.\n                if (name !== 'constructor' && !name.startsWith('_')) {\n                    propertyNames.add(name);\n                }\n            }\n            proto = Object.getPrototypeOf(proto);\n        }\n        return new LifecycleHooksDefinition(Type, propertyNames);\n    }\n}\nconst LifecycleHooks = /*@__PURE__*/ (() => {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const containerLookup = new WeakMap();\n    // const lhBaseName = getAnnotationKeyFor('lifecycle-hooks');\n    const definitionMap = new WeakMap();\n    return objectFreeze({\n        // name: lhBaseName,\n        /**\n         * @param def - Placeholder for future extensions. Currently always an empty object.\n         */\n        define(def, Type) {\n            const definition = LifecycleHooksDefinition.create(def, Type);\n            const $Type = definition.Type;\n            definitionMap.set($Type, definition);\n            return {\n                register(container) {\n                    singletonRegistration(ILifecycleHooks, $Type).register(container);\n                }\n            };\n        },\n        /**\n         * @param ctx - The container where the resolution starts\n         * @param Type - The constructor of the Custom element/ Custom attribute with lifecycle metadata\n         */\n        resolve(ctx) {\n            let lookup = containerLookup.get(ctx);\n            if (lookup === void 0) {\n                containerLookup.set(ctx, lookup = new LifecycleHooksLookupImpl());\n                const root = ctx.root;\n                const instances = root === ctx\n                    ? ctx.getAll(ILifecycleHooks)\n                    // if it's not root, only resolve it from the current context when it has the resolver\n                    // to maintain resources semantic: current -> root\n                    : ctx.has(ILifecycleHooks, false)\n                        ? root.getAll(ILifecycleHooks).concat(ctx.getAll(ILifecycleHooks))\n                        : root.getAll(ILifecycleHooks);\n                let instance;\n                let definition;\n                let entry;\n                let name;\n                let entries;\n                for (instance of instances) {\n                    definition = definitionMap.get(instance.constructor);\n                    entry = new LifecycleHooksEntry(definition, instance);\n                    for (name of definition.propertyNames) {\n                        entries = lookup[name];\n                        if (entries === void 0) {\n                            lookup[name] = [entry];\n                        }\n                        else {\n                            entries.push(entry);\n                        }\n                    }\n                }\n            }\n            return lookup;\n        },\n    });\n})();\nclass LifecycleHooksLookupImpl {\n}\nfunction lifecycleHooks(target, context) {\n    function decorator(target, context) {\n        const metadata = context?.metadata ?? (target[Symbol.metadata] ??= Object.create(null));\n        metadata[registrableMetadataKey] = LifecycleHooks.define({}, target);\n        return target;\n    }\n    return target == null ? decorator : decorator(target, context);\n}\n\nfunction valueConverter(nameOrDef) {\n    return function (target, context) {\n        context.addInitializer(function () {\n            ValueConverter.define(nameOrDef, this);\n        });\n        return target;\n    };\n}\nclass ValueConverterDefinition {\n    constructor(Type, name, aliases, key) {\n        this.Type = Type;\n        this.name = name;\n        this.aliases = aliases;\n        this.key = key;\n    }\n    static create(nameOrDef, Type) {\n        let name;\n        let def;\n        if (isString(nameOrDef)) {\n            name = nameOrDef;\n            def = { name };\n        }\n        else {\n            name = nameOrDef.name;\n            def = nameOrDef;\n        }\n        return new ValueConverterDefinition(Type, firstDefined(getConverterAnnotation(Type, 'name'), name), mergeArrays(getConverterAnnotation(Type, 'aliases'), def.aliases, Type.aliases), ValueConverter.keyFrom(name));\n    }\n    register(container, aliasName) {\n        const $Type = this.Type;\n        const key = typeof aliasName === 'string' ? getValueConverterKeyFrom(aliasName) : this.key;\n        const aliases = this.aliases;\n        if (!container.has(key, false)) {\n            container.register(container.has($Type, false) ? null : singletonRegistration($Type, $Type), aliasRegistration($Type, key), ...aliases.map(alias => aliasRegistration($Type, getValueConverterKeyFrom(alias))));\n        } /* istanbul ignore next */\n        else {\n            // eslint-disable-next-line no-console\n            console.warn(`[DEV:aurelia] ${createMappedError(155 /* ErrorNames.value_converter_existed */, this.name)}`);\n        }\n    }\n}\n/** @internal */ const converterTypeName = 'value-converter';\nconst vcBaseName = /*@__PURE__*/ getResourceKeyFor(converterTypeName);\nconst getConverterAnnotation = (Type, prop) => getMetadata(getAnnotationKeyFor(prop), Type);\nconst getValueConverterKeyFrom = (name) => `${vcBaseName}:${name}`;\nconst ValueConverter = objectFreeze({\n    name: vcBaseName,\n    keyFrom: getValueConverterKeyFrom,\n    isType(value) {\n        return isFunction(value)\n            && (hasMetadata(vcBaseName, value) || value.$au?.type === converterTypeName);\n    },\n    define(nameOrDef, Type) {\n        const definition = ValueConverterDefinition.create(nameOrDef, Type);\n        const $Type = definition.Type;\n        // registration of resource name is a requirement for the resource system in kernel (module-loader)\n        defineMetadata(definition, $Type, vcBaseName, resourceBaseName);\n        return $Type;\n    },\n    getDefinition(Type) {\n        const def = getMetadata(vcBaseName, Type) ?? getDefinitionFromStaticAu(Type, converterTypeName, ValueConverterDefinition.create);\n        if (def === void 0) {\n            throw createMappedError(152 /* ErrorNames.value_converter_def_not_found */, Type);\n        }\n        return def;\n    },\n    annotate(Type, prop, value) {\n        defineMetadata(value, Type, getAnnotationKeyFor(prop));\n    },\n    getAnnotation: getConverterAnnotation,\n    find(container, name) {\n        const Type = container.find(converterTypeName, name);\n        return Type == null\n            ? null\n            : getMetadata(vcBaseName, Type) ?? getDefinitionFromStaticAu(Type, converterTypeName, ValueConverterDefinition.create) ?? null;\n    },\n    get(container, name) {\n        {\n            try {\n                return container.get(resource(getValueConverterKeyFrom(name)));\n            }\n            catch (ex) {\n                // eslint-disable-next-line no-console\n                console.error('[DEV:aurelia] Cannot retrieve value converter with name', name);\n                throw ex;\n            }\n        }\n        return container.get(resource(getValueConverterKeyFrom(name)));\n    },\n});\n\n/**\n * A subscriber that is used for subcribing to target observer & invoking `updateSource` on a binding\n */\nclass BindingTargetSubscriber {\n    constructor(b, \n    // flush queue is a way to handle the notification order in a synchronous change notification system\n    // without a flush queue, changes are notified depth first\n    // with    a flush queue, changes are notified breadth first\n    flushQueue) {\n        /** @internal */\n        this._value = void 0;\n        this.b = b;\n        this._flushQueue = flushQueue;\n    }\n    flush() {\n        // when the owning binding is unbound, there's cases where this subscriber still queued\n        // and will be flushed\n        // adding this check so that it does flush at an inappropriate time\n        // todo: maybe consider a way to dequeue this as well if necessary\n        if (this.b.isBound) {\n            this.b.updateSource(this._value);\n        }\n    }\n    // deepscan-disable-next-line\n    handleChange(value, _) {\n        const b = this.b;\n        if (value !== astEvaluate(b.ast, b._scope, b, null)) {\n            this._value = value;\n            this._flushQueue.add(this);\n        }\n    }\n}\n/**\n * Implement method `useScope` in a common way for a binding. For internal use only for size saving.\n */\nconst mixinUseScope = /*@__PURE__*/ (() => {\n    function useScope(scope) {\n        this._scope = scope;\n    }\n    return (target) => {\n        defineHiddenProp(target.prototype, 'useScope', useScope);\n    };\n})();\n/**\n * Turns a class into AST evaluator with support for value converter & binding behavior. For internal use only\n */\nconst mixinAstEvaluator = /*@__PURE__*/ (() => {\n    class ResourceLookup {\n    }\n    const converterResourceLookupCache = new WeakMap();\n    const behaviorResourceLookupCache = new WeakMap();\n    const appliedBehaviors = new WeakMap();\n    function evaluatorGet(key) {\n        return this.l.get(key);\n    }\n    function evaluatorGetBehavior(b, name) {\n        let resourceLookup = behaviorResourceLookupCache.get(b);\n        if (resourceLookup == null) {\n            behaviorResourceLookupCache.set(b, resourceLookup = new ResourceLookup());\n        }\n        return resourceLookup[name] ??= BindingBehavior.get(b.l, name);\n    }\n    function evaluatorBindBehavior(name, scope, args) {\n        const behavior = evaluatorGetBehavior(this, name);\n        if (behavior == null) {\n            throw createMappedError(101 /* ErrorNames.ast_behavior_not_found */, name);\n        }\n        let applied = appliedBehaviors.get(this);\n        if (applied == null) {\n            appliedBehaviors.set(this, applied = {});\n        }\n        if (applied[name]) {\n            throw createMappedError(102 /* ErrorNames.ast_behavior_duplicated */, name);\n        }\n        // todo: remove casting\n        // there should be a base \"mixinAstEvaluator\" factory that takes parameters to handle behaviors/converters\n        // so observation infra can be free of template oriented features: behaviors/converters\n        // or anything that is not supposed to be supporting binding behavior shouldn't be using this mixin\n        behavior.bind?.(scope, this, ...args);\n    }\n    function evaluatorUnbindBehavior(name, scope) {\n        const behavior = evaluatorGetBehavior(this, name);\n        const applied = appliedBehaviors.get(this);\n        // todo: remove casting\n        // there should be a base \"mixinAstEvaluator\" factory that takes parameters to handle behaviors/converters\n        // so observation infra can be free of template oriented features: behaviors/converters\n        // or anything that is not supposed to be supporting binding behavior shouldn't be using this mixin\n        behavior?.unbind?.(scope, this);\n        if (applied != null) {\n            applied[name] = false;\n        }\n    }\n    function evaluatorGetConverter(b, name) {\n        let resourceLookup = converterResourceLookupCache.get(b);\n        if (resourceLookup == null) {\n            converterResourceLookupCache.set(b, resourceLookup = new ResourceLookup());\n        }\n        return resourceLookup[name] ??= ValueConverter.get(b.l, name);\n    }\n    function evaluatorBindConverter(name) {\n        const vc = evaluatorGetConverter(this, name);\n        if (vc == null) {\n            throw createMappedError(103 /* ErrorNames.ast_converter_not_found */, name);\n        }\n        const signals = vc.signals;\n        if (signals != null) {\n            const signaler = this.l.get(ISignaler);\n            const ii = signals.length;\n            let i = 0;\n            for (; i < ii; ++i) {\n                // note: the cast is expected. To connect, it just needs to be a IConnectable\n                // though to work with signal, it needs to have `handleChange`\n                // so having `handleChange` as a guard in the connectable as a safe measure is needed\n                // to make sure signaler works\n                signaler.addSignalListener(signals[i], this);\n            }\n        }\n    }\n    function evaluatorUnbindConverter(name) {\n        const vc = evaluatorGetConverter(this, name);\n        if (vc?.signals === void 0) {\n            return;\n        }\n        const signaler = this.l.get(ISignaler);\n        let i = 0;\n        for (; i < vc.signals.length; ++i) {\n            signaler.removeSignalListener(vc.signals[i], this);\n        }\n    }\n    function evaluatorUseConverter(name, mode, value, args) {\n        const vc = evaluatorGetConverter(this, name);\n        if (vc == null) {\n            throw createMappedError(103 /* ErrorNames.ast_converter_not_found */, name);\n        }\n        // Get the value converter instance to check for withContext\n        const withContext = vc.withContext === true;\n        // Compose caller context\n        let callerContext = null;\n        if (withContext) {\n            const hydrationContext = this.l.get(IHydrationContext);\n            const controller = hydrationContext.controller;\n            const viewModel = controller.viewModel;\n            callerContext = {\n                source: viewModel,\n                binding: this,\n            };\n        }\n        switch (mode) {\n            case 'toView': {\n                if ('toView' in vc) {\n                    return withContext\n                        ? vc.toView(value, callerContext, ...args)\n                        : vc.toView(value, ...args);\n                }\n                return value;\n            }\n            case 'fromView': {\n                if ('fromView' in vc) {\n                    return withContext\n                        ? vc.fromView?.(value, callerContext, ...args)\n                        : vc.fromView?.(value, ...args);\n                }\n                return value;\n            }\n        }\n    }\n    return (target) => {\n        const proto = target.prototype;\n        defineHiddenProp(proto, 'get', (evaluatorGet));\n        defineHiddenProp(proto, 'bindBehavior', (evaluatorBindBehavior));\n        defineHiddenProp(proto, 'unbindBehavior', (evaluatorUnbindBehavior));\n        defineHiddenProp(proto, 'bindConverter', (evaluatorBindConverter));\n        defineHiddenProp(proto, 'unbindConverter', (evaluatorUnbindConverter));\n        defineHiddenProp(proto, 'useConverter', (evaluatorUseConverter));\n    };\n})();\nconst IFlushQueue = /*@__PURE__*/ createInterface('IFlushQueue', x => x.singleton(FlushQueue));\nclass FlushQueue {\n    constructor() {\n        /** @internal */\n        this._flushing = false;\n        /** @internal */\n        this._items = new Set();\n    }\n    get count() {\n        return this._items.size;\n    }\n    add(flushable) {\n        this._items.add(flushable);\n        if (this._flushing) {\n            return;\n        }\n        this._flushing = true;\n        try {\n            this._items.forEach(flushItem);\n        }\n        finally {\n            this._flushing = false;\n        }\n    }\n    clear() {\n        this._items.clear();\n        this._flushing = false;\n    }\n}\nconst flushItem = function (item, _, items) {\n    items.delete(item);\n    item.flush();\n};\n/**\n * A mixing for bindings to implement a set of default behvaviors for rate limiting their calls.\n *\n * For internal use only\n */\nconst mixingBindingLimited = /*@__PURE__*/ (() => {\n    const withLimitationBindings = new WeakSet();\n    /**\n     * A helper for creating rated limited functions for binding. For internal use only\n     */\n    const debounced = (opts, callOriginal, binding) => {\n        let limiterTask;\n        let task;\n        let latestValue;\n        let isPending = false;\n        const callOriginalCallback = () => callOriginal(latestValue);\n        const fn = (v) => {\n            latestValue = v;\n            if (binding.isBound) {\n                task = limiterTask;\n                limiterTask = queueAsyncTask(callOriginalCallback, { delay: opts.delay });\n                task?.cancel();\n            }\n            else {\n                callOriginalCallback();\n            }\n        };\n        const dispose = fn.dispose = () => {\n            task?.cancel();\n            limiterTask?.cancel();\n            task = limiterTask = void 0;\n        };\n        fn.flush = () => {\n            // only call callback when there's actually task being queued\n            isPending = limiterTask?.status === tsPending;\n            dispose();\n            if (isPending) {\n                callOriginalCallback();\n            }\n        };\n        return fn;\n    };\n    /**\n     * A helper for creating rated limited functions for binding. For internal use only\n     */\n    const throttled = (opts, callOriginal, binding) => {\n        let limiterTask;\n        let task;\n        let last = 0;\n        let elapsed = 0;\n        let latestValue;\n        let isPending = false;\n        const now = () => opts.now();\n        const callOriginalCallback = () => callOriginal(latestValue);\n        const fn = (v) => {\n            latestValue = v;\n            if (binding.isBound) {\n                elapsed = now() - last;\n                task = limiterTask;\n                if (elapsed > opts.delay) {\n                    last = now();\n                    callOriginalCallback();\n                }\n                else {\n                    // Queue the new one before canceling the old one, to prevent early yield\n                    limiterTask = queueAsyncTask(() => {\n                        last = now();\n                        callOriginalCallback();\n                    }, { delay: opts.delay - elapsed });\n                }\n                task?.cancel();\n            }\n            else {\n                callOriginalCallback();\n            }\n        };\n        const dispose = fn.dispose = () => {\n            task?.cancel();\n            limiterTask?.cancel();\n            task = limiterTask = void 0;\n        };\n        fn.flush = () => {\n            // only call callback when there's actually task being queued\n            isPending = limiterTask?.status === tsPending;\n            dispose();\n            if (isPending) {\n                callOriginalCallback();\n            }\n        };\n        return fn;\n    };\n    return (target, getMethodName) => {\n        defineHiddenProp(target.prototype, 'limit', function (opts) {\n            if (withLimitationBindings.has(this)) {\n                throw createMappedError(9996 /* ErrorNames.binding_already_has_rate_limited */);\n            }\n            withLimitationBindings.add(this);\n            const prop = getMethodName(this, opts);\n            const signals = opts.signals;\n            const signaler = signals.length > 0 ? this.get(ISignaler) : null;\n            const originalFn = this[prop];\n            const callOriginal = (...args) => originalFn.call(this, ...args);\n            const limitedFn = opts.type === 'debounce'\n                ? debounced(opts, callOriginal, this)\n                : throttled(opts, callOriginal, this);\n            const signalListener = signaler ? { handleChange: limitedFn.flush } : null;\n            this[prop] = limitedFn;\n            if (signaler) {\n                signals.forEach(s => addSignalListener(signaler, s, signalListener));\n            }\n            return {\n                dispose: () => {\n                    if (signaler) {\n                        signals.forEach(s => removeSignalListener(signaler, s, signalListener));\n                    }\n                    withLimitationBindings.delete(this);\n                    limitedFn.dispose();\n                    // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n                    delete this[prop];\n                }\n            };\n        });\n    };\n})();\nconst createPrototypeMixer = ((mixed = new WeakSet()) => {\n    return (mixer) => {\n        return function () {\n            if (!mixed.has(this)) {\n                mixed.add(this);\n                mixer.call(this);\n            }\n        };\n    };\n})();\n\n/**\n * Attribute binding. Handle attribute binding betwen view/view model. Understand Html special attributes\n */\nclass AttributeBinding {\n    constructor(controller, locator, observerLocator, ast, target, \n    // some attributes may have inner structure\n    // such as class -> collection of class names\n    // such as style -> collection of style rules\n    //\n    // for normal attributes, targetAttribute and targetProperty are the same and can be ignore\n    targetAttribute, \n    // is the classes to be toggled\n    targetProperty, mode, strict) {\n        this.targetAttribute = targetAttribute;\n        this.targetProperty = targetProperty;\n        this.mode = mode;\n        this.strict = strict;\n        this.isBound = false;\n        /** @internal */\n        this._scope = void 0;\n        /** @internal */\n        this._isQueued = false;\n        /** @internal */\n        this._value = void 0;\n        // see Listener binding for explanation\n        /** @internal */\n        this.boundFn = false;\n        /** @internal */\n        this._isMulti = false;\n        this.l = locator;\n        this.ast = ast;\n        this._controller = controller;\n        this.target = target;\n        this.oL = observerLocator;\n        // eslint-disable-next-line @typescript-eslint/prefer-includes\n        if ((this._isMulti = targetProperty.indexOf(' ') > -1)\n            && !AttributeBinding._splitString.has(targetProperty)) {\n            // split the string once and cache it\n            AttributeBinding._splitString.set(targetProperty, targetProperty.split(' '));\n        }\n    }\n    updateTarget(value) {\n        const target = this.target;\n        const targetAttribute = this.targetAttribute;\n        const targetProperty = this.targetProperty;\n        switch (targetAttribute) {\n            case 'class':\n                if (this._isMulti) {\n                    // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n                    const force = !!value;\n                    for (const cls of AttributeBinding._splitString.get(targetProperty)) {\n                        target.classList.toggle(cls, force);\n                    }\n                }\n                else {\n                    // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n                    target.classList.toggle(targetProperty, !!value);\n                }\n                break;\n            case 'style': {\n                let priority = '';\n                let newValue = safeString(value);\n                if (isString(newValue) && newValue.includes('!important')) {\n                    priority = 'important';\n                    newValue = newValue.replace('!important', '');\n                }\n                target.style.setProperty(targetProperty, newValue, priority);\n                break;\n            }\n            default: {\n                if (value == null) {\n                    target.removeAttribute(targetAttribute);\n                }\n                else {\n                    target.setAttribute(targetAttribute, safeString(value));\n                }\n            }\n        }\n    }\n    handleChange() {\n        if (!this.isBound)\n            return;\n        if (this._isQueued)\n            return;\n        this._isQueued = true;\n        queueTask(() => {\n            this._isQueued = false;\n            if (!this.isBound)\n                return;\n            this.obs.version++;\n            const newValue = astEvaluate(this.ast, this._scope, this, (this.mode & toView) > 0 ? this : null);\n            this.obs.clear();\n            if (newValue !== this._value) {\n                this._value = newValue;\n                this.updateTarget(newValue);\n            }\n        });\n    }\n    // todo: based off collection and handle update accordingly instead off always start\n    handleCollectionChange() {\n        this.handleChange();\n    }\n    bind(scope) {\n        if (this.isBound) {\n            if (this._scope === scope)\n                return;\n            this.unbind();\n        }\n        this._scope = scope;\n        astBind(this.ast, scope, this);\n        if (this.mode & (toView | oneTime)) {\n            this.updateTarget(this._value = astEvaluate(this.ast, scope, this, (this.mode & toView) > 0 ? this : null));\n        }\n        this.isBound = true;\n    }\n    unbind() {\n        if (!this.isBound)\n            return;\n        this.isBound = false;\n        astUnbind(this.ast, this._scope, this);\n        this._scope = void 0;\n        this._value = void 0;\n        this.obs.clearAll();\n    }\n}\n/** @internal */\nAttributeBinding.mix = createPrototypeMixer(() => {\n    mixinUseScope(AttributeBinding);\n    mixingBindingLimited(AttributeBinding, () => 'updateTarget');\n    connectable(AttributeBinding, null);\n    mixinAstEvaluator(AttributeBinding);\n});\n/** @internal */\nAttributeBinding._splitString = new Map();\n\nclass InterpolationBinding {\n    constructor(controller, locator, observerLocator, ast, target, targetProperty, mode, strict) {\n        this.ast = ast;\n        this.target = target;\n        this.targetProperty = targetProperty;\n        this.mode = mode;\n        this.strict = strict;\n        this.isBound = false;\n        /** @internal */\n        this._scope = void 0;\n        /** @internal */\n        this._isQueued = false;\n        this._controller = controller;\n        this.oL = observerLocator;\n        this._targetObserver = observerLocator.getAccessor(target, targetProperty);\n        const expressions = ast.expressions;\n        const partBindings = this.partBindings = Array(expressions.length);\n        const ii = expressions.length;\n        let i = 0;\n        for (; ii > i; ++i) {\n            partBindings[i] = new InterpolationPartBinding(expressions[i], target, targetProperty, locator, observerLocator, strict, this);\n        }\n    }\n    /** @internal */\n    _handlePartChange() {\n        if (!this.isBound)\n            return;\n        const shouldQueue = this._controller.state !== activating && (this._targetObserver.type & atLayout) > 0;\n        if (shouldQueue) {\n            if (this._isQueued)\n                return;\n            this._isQueued = true;\n            queueTask(() => {\n                this._isQueued = false;\n                if (!this.isBound)\n                    return;\n                this.updateTarget();\n            });\n        }\n        else {\n            this.updateTarget();\n        }\n    }\n    updateTarget() {\n        const partBindings = this.partBindings;\n        const ast = this.ast;\n        const target = this.target;\n        const targetProperty = this.targetProperty;\n        const staticParts = ast.parts;\n        const ii = partBindings.length;\n        let result = '';\n        let i = 0;\n        if (ii === 1) {\n            // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n            result = staticParts[0] + partBindings[0]._evaluate() + staticParts[1];\n        }\n        else {\n            result = staticParts[0];\n            for (; ii > i; ++i) {\n                // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n                result += partBindings[i]._evaluate() + staticParts[i + 1];\n            }\n        }\n        this._targetObserver.setValue(result, target, targetProperty);\n    }\n    bind(scope) {\n        if (this.isBound) {\n            if (this._scope === scope)\n                return;\n            this.unbind();\n        }\n        this._scope = scope;\n        const partBindings = this.partBindings;\n        const ii = partBindings.length;\n        let i = 0;\n        for (; ii > i; ++i) {\n            partBindings[i].bind(scope);\n        }\n        this.updateTarget();\n        this.isBound = true;\n    }\n    unbind() {\n        if (!this.isBound)\n            return;\n        this.isBound = false;\n        this._scope = void 0;\n        const partBindings = this.partBindings;\n        const ii = partBindings.length;\n        let i = 0;\n        for (; ii > i; ++i) {\n            partBindings[i].unbind();\n        }\n    }\n    /**\n     * Start using a given observer to update the target\n     */\n    useAccessor(accessor) {\n        this._targetObserver = accessor;\n    }\n}\nclass InterpolationPartBinding {\n    constructor(ast, target, targetProperty, locator, observerLocator, strict, owner) {\n        this.ast = ast;\n        this.target = target;\n        this.targetProperty = targetProperty;\n        this.strict = strict;\n        this.owner = owner;\n        // at runtime, mode may be overriden by binding behavior\n        // but it wouldn't matter here, just start with something for later check\n        this.mode = toView;\n        this.isBound = false;\n        /** @internal */\n        this._value = '';\n        // see Listener binding for explanation\n        /** @internal */\n        this.boundFn = false;\n        /** @internal */\n        this._isDirty = false;\n        this.l = locator;\n        this.oL = observerLocator;\n    }\n    updateTarget() {\n        this.owner._handlePartChange();\n    }\n    handleChange() {\n        if (!this.isBound)\n            return;\n        this._isDirty = true;\n        this.updateTarget();\n    }\n    handleCollectionChange() {\n        if (!this.isBound)\n            return;\n        this._isDirty = true;\n        this.updateTarget();\n    }\n    /** @internal */\n    _evaluate() {\n        if (!this._isDirty)\n            return this._value;\n        this.obs.version++;\n        const newValue = astEvaluate(this.ast, this._scope, this, (this.mode & toView) > 0 ? this : null);\n        this.obs.clear();\n        // unlike handleChange, this is always called\n        this._value = newValue;\n        if (isArray(newValue)) {\n            this.observeCollection(newValue);\n        }\n        this._isDirty = false;\n        return this._value;\n    }\n    bind(scope) {\n        if (this.isBound) {\n            if (this._scope === scope)\n                return;\n            this.unbind();\n        }\n        this._scope = scope;\n        astBind(this.ast, scope, this);\n        this._value = astEvaluate(this.ast, this._scope, this, (this.mode & toView) > 0 ? this : null);\n        if (isArray(this._value)) {\n            this.observeCollection(this._value);\n        }\n        this._isDirty = false;\n        this.isBound = true;\n    }\n    unbind() {\n        if (!this.isBound)\n            return;\n        this.isBound = false;\n        this._value = void 0;\n        this._isDirty = false;\n        astUnbind(this.ast, this._scope, this);\n        this._scope = void 0;\n        this.obs.clearAll();\n    }\n}\n/** @internal */\nInterpolationPartBinding.mix = createPrototypeMixer(() => {\n    mixinUseScope(InterpolationPartBinding);\n    mixingBindingLimited(InterpolationPartBinding, () => 'updateTarget');\n    connectable(InterpolationPartBinding, null);\n    mixinAstEvaluator(InterpolationPartBinding);\n});\n\n/**\n * A binding for handling the element content interpolation\n */\nclass ContentBinding {\n    constructor(controller, locator, observerLocator, p, ast, target, strict) {\n        this.p = p;\n        this.ast = ast;\n        this.target = target;\n        this.strict = strict;\n        this.isBound = false;\n        // at runtime, mode may be overriden by binding behavior\n        // but it wouldn't matter here, just start with something for later check\n        this.mode = toView;\n        /** @internal */\n        this._isQueued = false;\n        /** @internal */\n        this._value = '';\n        /** @internal */\n        this._needsRemoveNode = false;\n        // see Listener binding for explanation\n        /** @internal */\n        this.boundFn = false;\n        this.l = locator;\n        this._controller = controller;\n        this.oL = observerLocator;\n    }\n    updateTarget(value) {\n        const target = this.target;\n        const oldValue = this._value;\n        this._value = value;\n        if (this._needsRemoveNode) {\n            oldValue.parentNode?.removeChild(oldValue);\n            this._needsRemoveNode = false;\n        }\n        if (value instanceof this.p.Node) {\n            target.parentNode?.insertBefore(value, target);\n            value = '';\n            this._needsRemoveNode = true;\n        }\n        target.textContent = safeString(value ?? '');\n    }\n    handleChange() {\n        if (!this.isBound)\n            return;\n        if (this._isQueued)\n            return;\n        this._isQueued = true;\n        queueTask(() => {\n            this._isQueued = false;\n            if (!this.isBound)\n                return;\n            this.obs.version++;\n            const newValue = astEvaluate(this.ast, this._scope, this, (this.mode & toView) > 0 ? this : null);\n            this.obs.clear();\n            if (newValue !== this._value) {\n                this.updateTarget(newValue);\n            }\n        });\n    }\n    handleCollectionChange() {\n        if (!this.isBound)\n            return;\n        if (this._isQueued)\n            return;\n        this._isQueued = true;\n        queueTask(() => {\n            this._isQueued = false;\n            if (!this.isBound)\n                return;\n            this.obs.version++;\n            const v = this._value = astEvaluate(this.ast, this._scope, this, (this.mode & toView) > 0 ? this : null);\n            this.obs.clear();\n            if (isArray(v)) {\n                this.observeCollection(v);\n            }\n            this.updateTarget(v);\n        });\n    }\n    bind(scope) {\n        if (this.isBound) {\n            if (this._scope === scope)\n                return;\n            this.unbind();\n        }\n        this._scope = scope;\n        astBind(this.ast, scope, this);\n        const v = this._value = astEvaluate(this.ast, this._scope, this, (this.mode & toView) > 0 ? this : null);\n        if (isArray(v)) {\n            this.observeCollection(v);\n        }\n        this.updateTarget(v);\n        this.isBound = true;\n    }\n    unbind() {\n        if (!this.isBound)\n            return;\n        this.isBound = false;\n        astUnbind(this.ast, this._scope, this);\n        if (this._needsRemoveNode) {\n            this._value.parentNode?.removeChild(this._value);\n        }\n        // TODO: should existing value (either connected node, or a string)\n        // be removed when this binding is unbound?\n        // this.updateTarget('');\n        this._scope = void 0;\n        this.obs.clearAll();\n    }\n}\n/** @internal */\nContentBinding.mix = createPrototypeMixer(() => {\n    mixinUseScope(ContentBinding);\n    mixingBindingLimited(ContentBinding, () => 'updateTarget');\n    connectable(ContentBinding, null);\n    mixinAstEvaluator(ContentBinding);\n});\n\nclass LetBinding {\n    constructor(locator, observerLocator, ast, targetProperty, toBindingContext, strict) {\n        this.ast = ast;\n        this.targetProperty = targetProperty;\n        this.isBound = false;\n        /** @internal */\n        this._scope = void 0;\n        this.target = null;\n        // see Listener binding for explanation\n        /** @internal */\n        this.boundFn = false;\n        this.l = locator;\n        this.oL = observerLocator;\n        this.strict = strict;\n        this._toBindingContext = toBindingContext;\n    }\n    updateTarget() {\n        this.target[this.targetProperty] = this._value;\n    }\n    handleChange() {\n        if (!this.isBound)\n            return;\n        this.obs.version++;\n        this._value = astEvaluate(this.ast, this._scope, this, this);\n        this.obs.clear();\n        this.updateTarget();\n    }\n    handleCollectionChange() {\n        this.handleChange();\n    }\n    bind(_scope) {\n        if (this.isBound) {\n            if (this._scope === _scope)\n                return;\n            this.unbind();\n        }\n        this._scope = _scope;\n        this.target = (this._toBindingContext ? _scope.bindingContext : _scope.overrideContext);\n        astBind(this.ast, _scope, this);\n        this._value = astEvaluate(this.ast, this._scope, this, this);\n        this.updateTarget();\n        this.isBound = true;\n    }\n    unbind() {\n        if (!this.isBound)\n            return;\n        this.isBound = false;\n        astUnbind(this.ast, this._scope, this);\n        this._scope = void 0;\n        this.obs.clearAll();\n    }\n}\n/**\n * The renderer can call this method to prepare the prototype,\n * so that it can be effectively tree shaken before decorator can be officially applied with tree shaking.\n * @internal\n */\nLetBinding.mix = createPrototypeMixer(() => {\n    mixinUseScope(LetBinding);\n    mixingBindingLimited(LetBinding, () => 'updateTarget');\n    connectable(LetBinding, null);\n    mixinAstEvaluator(LetBinding);\n});\n\nclass PropertyBinding {\n    constructor(controller, locator, observerLocator, ast, target, targetProperty, mode, strict) {\n        this.ast = ast;\n        this.target = target;\n        this.targetProperty = targetProperty;\n        this.mode = mode;\n        this.strict = strict;\n        this.isBound = false;\n        /** @internal */\n        this._scope = void 0;\n        /** @internal */\n        this._targetObserver = void 0;\n        /** @internal */\n        this._isQueued = false;\n        /** @internal */\n        this._targetSubscriber = null;\n        // see Listener binding for explanation\n        /** @internal */\n        this.boundFn = false;\n        this.l = locator;\n        this._controller = controller;\n        this.oL = observerLocator;\n    }\n    updateTarget(value) {\n        this._targetObserver.setValue(value, this.target, this.targetProperty);\n    }\n    updateSource(value) {\n        astAssign(this.ast, this._scope, this, null, value);\n    }\n    handleChange() {\n        if (!this.isBound)\n            return;\n        const shouldQueue = this._controller.state !== activating && (this._targetObserver.type & atLayout) > 0;\n        if (shouldQueue) {\n            if (this._isQueued)\n                return;\n            this._isQueued = true;\n            queueTask(() => {\n                this._isQueued = false;\n                if (!this.isBound)\n                    return;\n                this._handleChange();\n            });\n        }\n        else {\n            this._handleChange();\n        }\n    }\n    /** @internal */\n    _handleChange() {\n        this.obs.version++;\n        const newValue = astEvaluate(this.ast, this._scope, this, (this.mode & toView) > 0 ? this : null);\n        this.obs.clear();\n        this.updateTarget(newValue);\n    }\n    // todo: based off collection and handle update accordingly instead off always start\n    handleCollectionChange() {\n        this.handleChange();\n    }\n    bind(scope) {\n        if (this.isBound) {\n            if (this._scope === scope)\n                return;\n            this.unbind();\n        }\n        this._scope = scope;\n        astBind(this.ast, scope, this);\n        const observerLocator = this.oL;\n        const $mode = this.mode;\n        let targetObserver = this._targetObserver;\n        if (!targetObserver) {\n            if ($mode & fromView) {\n                targetObserver = observerLocator.getObserver(this.target, this.targetProperty);\n            }\n            else {\n                targetObserver = observerLocator.getAccessor(this.target, this.targetProperty);\n            }\n            this._targetObserver = targetObserver;\n        }\n        const shouldConnect = ($mode & toView) > 0;\n        if ($mode & (toView | oneTime)) {\n            this.updateTarget(astEvaluate(this.ast, this._scope, this, shouldConnect ? this : null));\n        }\n        if ($mode & fromView) {\n            targetObserver.subscribe(this._targetSubscriber ??= new BindingTargetSubscriber(this, this.l.get(IFlushQueue)));\n            if (!shouldConnect) {\n                this.updateSource(targetObserver.getValue(this.target, this.targetProperty));\n            }\n        }\n        this.isBound = true;\n    }\n    unbind() {\n        if (!this.isBound)\n            return;\n        this.isBound = false;\n        if (this._targetSubscriber) {\n            this._targetObserver.unsubscribe(this._targetSubscriber);\n            this._targetSubscriber = null;\n        }\n        astUnbind(this.ast, this._scope, this);\n        this._scope = void 0;\n        this.obs.clearAll();\n    }\n    /**\n     * Start using a given observer to listen to changes on the target of this binding\n     */\n    useTargetObserver(observer) {\n        this._targetObserver?.unsubscribe(this);\n        (this._targetObserver = observer).subscribe(this);\n    }\n    /**\n     * Provide a subscriber for target change observation.\n     *\n     * Binding behaviors can use this to setup custom observation handling during bind lifecycle\n     * to alter the update source behavior during bind phase of this binding.\n     */\n    useTargetSubscriber(subscriber) {\n        if (this._targetSubscriber != null) {\n            throw createMappedError(9995 /* ErrorNames.binding_already_has_target_subscriber */);\n        }\n        this._targetSubscriber = subscriber;\n    }\n}\n/** @internal */\nPropertyBinding.mix = createPrototypeMixer(() => {\n    mixinUseScope(PropertyBinding);\n    mixingBindingLimited(PropertyBinding, (propBinding) => (propBinding.mode & fromView) ? 'updateSource' : 'updateTarget');\n    connectable(PropertyBinding, null);\n    mixinAstEvaluator(PropertyBinding);\n});\n\nclass RefBinding {\n    constructor(locator, oL, ast, target, strict) {\n        this.oL = oL;\n        this.ast = ast;\n        this.target = target;\n        this.strict = strict;\n        this.isBound = false;\n        /** @internal */\n        this._scope = void 0;\n        this.l = locator;\n    }\n    updateSource() {\n        if (this.isBound) {\n            this.obs.version++;\n            astAssign(this.ast, this._scope, this, this, this.target);\n            this.obs.clear();\n        }\n        else {\n            astAssign(this.ast, this._scope, this, null, null);\n        }\n    }\n    handleChange() {\n        if (this.isBound) {\n            this.updateSource();\n        }\n    }\n    handleCollectionChange() {\n        if (this.isBound) {\n            this.updateSource();\n        }\n    }\n    bind(scope) {\n        if (this.isBound) {\n            if (this._scope === scope)\n                return;\n            this.unbind();\n        }\n        this._scope = scope;\n        astBind(this.ast, scope, this);\n        this.isBound = true;\n        this.updateSource();\n    }\n    unbind() {\n        if (!this.isBound)\n            return;\n        this.isBound = false;\n        this.obs.clearAll();\n        if (astEvaluate(this.ast, this._scope, this, null) === this.target) {\n            this.updateSource();\n        }\n        astUnbind(this.ast, this._scope, this);\n        this._scope = void 0;\n    }\n}\nRefBinding.mix = createPrototypeMixer(() => {\n    connectable(RefBinding, null);\n    mixingBindingLimited(RefBinding, () => 'updateSource');\n    mixinUseScope(RefBinding);\n    mixinAstEvaluator(RefBinding);\n});\n\nclass ListenerBindingOptions {\n    constructor(prevent, capture = false, onError) {\n        this.prevent = prevent;\n        this.capture = capture;\n        this.onError = onError;\n    }\n}\n/**\n * Listener binding. Handle event binding between view and view model\n */\nclass ListenerBinding {\n    constructor(locator, ast, target, targetEvent, options, modifiedEventHandler, strict) {\n        this.ast = ast;\n        this.target = target;\n        this.targetEvent = targetEvent;\n        this.strict = strict;\n        this.isBound = false;\n        /**\n         * Whether this binding only handles events originate from the target this binding is bound to\n         */\n        this.self = false;\n        /**\n         * Indicates if this binding evaluates an ast and get a function, that function should be bound\n         * to the instance it is on\n         *\n         * @internal\n         */\n        this.boundFn = true;\n        /** @internal */\n        this._modifiedEventHandler = null;\n        this.l = locator;\n        this._options = options;\n        this._modifiedEventHandler = modifiedEventHandler;\n    }\n    callSource(event) {\n        const overrideContext = this._scope.overrideContext;\n        overrideContext.$event = event;\n        let result = astEvaluate(this.ast, this._scope, this, null);\n        delete overrideContext.$event;\n        if (isFunction(result)) {\n            result = result(event);\n        }\n        if (result !== true && this._options.prevent) {\n            event.preventDefault();\n        }\n    }\n    handleEvent(event) {\n        if (this.self) {\n            if (this.target !== event.composedPath()[0]) {\n                /* istanbul ignore next */\n                return;\n            }\n        }\n        if (this._modifiedEventHandler?.(event) !== false) {\n            try {\n                this.callSource(event);\n            }\n            catch (ex) {\n                this._options.onError(event, ex);\n            }\n        }\n    }\n    bind(scope) {\n        if (this.isBound) {\n            if (this._scope === scope)\n                return;\n            this.unbind();\n        }\n        this._scope = scope;\n        astBind(this.ast, scope, this);\n        this.target.addEventListener(this.targetEvent, this, this._options);\n        this.isBound = true;\n    }\n    unbind() {\n        if (!this.isBound)\n            return;\n        this.isBound = false;\n        astUnbind(this.ast, this._scope, this);\n        this._scope = void 0;\n        this.target.removeEventListener(this.targetEvent, this, this._options);\n    }\n}\n/** @internal */\nListenerBinding.mix = createPrototypeMixer(function () {\n    mixinUseScope(ListenerBinding);\n    mixingBindingLimited(ListenerBinding, () => 'callSource');\n    mixinAstEvaluator(ListenerBinding);\n});\nconst IModifiedEventHandlerCreator = /*@__PURE__*/ createInterface('IEventModifier');\nconst IKeyMapping = /*@__PURE__*/ createInterface('IKeyMapping', x => x.instance({\n    meta: objectFreeze(['ctrl', 'alt', 'shift', 'meta']),\n    keys: {\n        escape: 'Escape',\n        enter: 'Enter',\n        space: 'Space',\n        tab: 'tab',\n        // by default, maps the key a-z and A-Z to their respective keycodes\n        ...Array.from({ length: 25 }).reduce((acc, _, idx) => {\n            // map keycode of upper case character from A-Z\n            let char = String.fromCharCode(idx + 65);\n            acc[idx + 65] = char;\n            // map keycode and character code of lower case character from a-z\n            char = String.fromCharCode(idx + 97);\n            acc[idx + 97] = acc[char] = char;\n            return acc;\n        }, {})\n    },\n}));\nclass ModifiedMouseEventHandler {\n    constructor() {\n        this.type = ['click', 'mousedown', 'mousemove', 'mouseup', 'dblclick', 'contextmenu'];\n        /** @internal */\n        this._mapping = resolve(IKeyMapping);\n        /** @internal */\n        this._mouseButtons = ['left', 'middle', 'right'];\n    }\n    static register(c) {\n        c.register(singletonRegistration(IModifiedEventHandlerCreator, ModifiedMouseEventHandler));\n    }\n    getHandler(modifier) {\n        const modifiers = modifier.split(/[:+.]/);\n        return ((event) => {\n            let prevent = false;\n            let stop = false;\n            let m;\n            for (m of modifiers) {\n                switch (m) {\n                    case 'prevent':\n                        prevent = true;\n                        continue;\n                    case 'stop':\n                        stop = true;\n                        continue;\n                    case 'left':\n                    case 'middle':\n                    case 'right':\n                        if (event.button !== this._mouseButtons.indexOf(m))\n                            return false;\n                        continue;\n                }\n                if (this._mapping.meta.includes(m) && event[`${m}Key`] !== true) {\n                    return false;\n                }\n                {\n                    // eslint-disable-next-line no-console\n                    console.warn(`Modifier '${m}' is not supported for mouse events.`);\n                }\n            }\n            if (prevent)\n                event.preventDefault();\n            if (stop)\n                event.stopPropagation();\n            return true;\n        });\n    }\n}\nclass ModifiedKeyboardEventHandler {\n    constructor() {\n        /** @internal */\n        this._mapping = resolve(IKeyMapping);\n        this.type = ['keydown', 'keyup'];\n    }\n    static register(c) {\n        c.register(singletonRegistration(IModifiedEventHandlerCreator, ModifiedKeyboardEventHandler));\n    }\n    getHandler(modifier) {\n        const modifiers = modifier.split(/[:+.]/);\n        return ((event) => {\n            let prevent = false;\n            let stop = false;\n            let mod;\n            for (mod of modifiers) {\n                switch (mod) {\n                    case 'prevent':\n                        prevent = true;\n                        continue;\n                    case 'stop':\n                        stop = true;\n                        continue;\n                }\n                if (this._mapping.meta.includes(mod)) {\n                    if (event[`${mod}Key`] !== true) {\n                        return false;\n                    }\n                    continue;\n                }\n                const mappedKey = this._mapping.keys[mod];\n                if (mappedKey !== event.key) {\n                    return false;\n                }\n                {\n                    // eslint-disable-next-line no-console\n                    console.warn(`Modifier '${mod}' is not supported for keyboard event with key \"${event.key}\".`);\n                }\n            }\n            if (prevent)\n                event.preventDefault();\n            if (stop)\n                event.stopPropagation();\n            return true;\n        });\n    }\n}\n/**\n * A generic event handler that can be used for any event type\n */\nclass ModifiedEventHandler {\n    constructor() {\n        this.type = ['$ALL'];\n    }\n    static register(c) {\n        c.register(singletonRegistration(IModifiedEventHandlerCreator, ModifiedEventHandler));\n    }\n    getHandler(modifier) {\n        const modifiers = modifier.split(/[:+.]/);\n        return ((event) => {\n            let prevent = false;\n            let stop = false;\n            let mod;\n            for (mod of modifiers) {\n                switch (mod) {\n                    case 'prevent':\n                        prevent = true;\n                        continue;\n                    case 'stop':\n                        stop = true;\n                        continue;\n                }\n                {\n                    // eslint-disable-next-line no-console\n                    console.warn(`Modifier '${mod}' is not supported for event \"${event.type}\".`);\n                }\n            }\n            if (prevent)\n                event.preventDefault();\n            if (stop)\n                event.stopPropagation();\n            return true;\n        });\n    }\n}\nconst IEventModifier = /*@__PURE__*/ createInterface('IEventModifierHandler', x => x.instance({\n    getHandler: () => {\n        {\n            // eslint-disable-next-line no-console\n            console.warn('No event modifier handler registered');\n        }\n        /* istanbul ignore next */\n        return null;\n    }\n}));\nclass EventModifier {\n    constructor() {\n        /** @internal */\n        this._reg = resolve(all(IModifiedEventHandlerCreator))\n            .reduce((acc, cur) => {\n            const types = isArray(cur.type) ? cur.type : [cur.type];\n            types.forEach(t => acc[t] = cur);\n            return acc;\n        }, {});\n    }\n    static register(c) {\n        c.register(singletonRegistration(IEventModifier, EventModifier));\n    }\n    getHandler(type, modifier) {\n        return isString(modifier) ? (this._reg[type] ?? this._reg.$ALL)?.getHandler(modifier) ?? null : null;\n    }\n}\nconst EventModifierRegistration = {\n    register(c) {\n        c.register(EventModifier, ModifiedMouseEventHandler, ModifiedKeyboardEventHandler, ModifiedEventHandler);\n    }\n};\n\nconst IViewFactory = /*@__PURE__*/ createInterface('IViewFactory');\nclass ViewFactory {\n    constructor(container, def) {\n        this.isCaching = false;\n        /** @internal */\n        this._cache = null;\n        /** @internal */\n        this._cacheSize = -1;\n        this.name = def.name;\n        this.container = container;\n        this.def = def;\n    }\n    setCacheSize(size, doNotOverrideIfAlreadySet) {\n        // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n        if (size) {\n            if (size === '*') {\n                size = ViewFactory.maxCacheSize;\n            }\n            else if (isString(size)) {\n                size = parseInt(size, 10);\n            }\n            if (this._cacheSize === -1 || !doNotOverrideIfAlreadySet) {\n                this._cacheSize = size;\n            }\n        }\n        if (this._cacheSize > 0) {\n            this._cache = [];\n        }\n        else {\n            this._cache = null;\n        }\n        this.isCaching = this._cacheSize > 0;\n    }\n    canReturnToCache(_controller) {\n        return this._cache != null && this._cache.length < this._cacheSize;\n    }\n    tryReturnToCache(controller) {\n        if (this.canReturnToCache(controller)) {\n            this._cache.push(controller);\n            return true;\n        }\n        return false;\n    }\n    create(parentController) {\n        const cache = this._cache;\n        let controller;\n        if (cache != null && cache.length > 0) {\n            controller = cache.pop();\n            return controller;\n        }\n        controller = Controller.$view(this, parentController);\n        return controller;\n    }\n}\nViewFactory.maxCacheSize = 0xFFFF;\n\n/** @internal */\nconst createLocation = /*@__PURE__*/ (() => {\n    const createComment = (p, text) => p.document.createComment(text);\n    return (p) => {\n        const locationEnd = createComment(p, 'au-end');\n        locationEnd.$start = createComment(p, 'au-start');\n        return locationEnd;\n    };\n})();\n/** @internal */\nconst insertManyBefore = (parent, target, newChildNodes) => {\n    if (parent === null) {\n        return;\n    }\n    const ii = newChildNodes.length;\n    let i = 0;\n    while (ii > i) {\n        parent.insertBefore(newChildNodes[i], target);\n        ++i;\n    }\n};\n/** @internal */\nconst createMutationObserver = (node, callback) => new node.ownerDocument.defaultView.MutationObserver(callback);\n/** @internal */\nconst isElement = (node) => node.nodeType === 1;\n\n/** @internal */\nconst defaultSlotName = 'default';\n/** @internal */\nconst auslotAttr = 'au-slot';\n/**\n * Describing the projection information statically available for a custom element\n */\nconst IAuSlotsInfo = /*@__PURE__*/ createInterface('IAuSlotsInfo');\nclass AuSlotsInfo {\n    constructor(projectedSlots) {\n        this.projectedSlots = projectedSlots;\n    }\n}\nconst IAuSlotWatcher = /*@__PURE__*/ createInterface('IAuSlotWatcher');\nclass AuSlotWatcherBinding {\n    constructor(obj, callback, slotName, query) {\n        /** @internal */\n        this._slots = new Set();\n        /** @internal */\n        this._nodes = emptyArray;\n        this.isBound = false;\n        this._callback = (this._obj = obj)[callback];\n        this.slotName = slotName;\n        this._query = query;\n    }\n    bind() {\n        this.isBound = true;\n    }\n    unbind() {\n        this.isBound = false;\n    }\n    getValue() {\n        return this._nodes;\n    }\n    watch(slot) {\n        if (!this._slots.has(slot)) {\n            this._slots.add(slot);\n            slot.subscribe(this);\n        }\n    }\n    unwatch(slot) {\n        if (this._slots.delete(slot)) {\n            slot.unsubscribe(this);\n        }\n    }\n    handleSlotChange(slot, nodes) {\n        if (!this.isBound) {\n            return;\n        }\n        const oldNodes = this._nodes;\n        const $nodes = [];\n        const query = this._query;\n        let $slot;\n        let node;\n        for ($slot of this._slots) {\n            for (node of $slot === slot ? nodes : $slot.nodes) {\n                if (query === '$all' || (isElement(node) && (query === '*' || node.matches(query)))) {\n                    $nodes[$nodes.length] = node;\n                }\n            }\n        }\n        if ($nodes.length !== oldNodes.length || $nodes.some((n, i) => n !== oldNodes[i])) {\n            this._nodes = $nodes;\n            this._callback?.call(this._obj, $nodes);\n            this.subs.notify($nodes, oldNodes);\n        }\n    }\n    /* istanbul ignore next */\n    get() {\n        throw createMappedError(99 /* ErrorNames.method_not_implemented */, 'get');\n    }\n}\nclass SlottedLifecycleHooks {\n    constructor(_def) {\n        this._def = _def;\n    }\n    register(c) {\n        instanceRegistration(ILifecycleHooks, this).register(c);\n    }\n    hydrating(vm, controller) {\n        const $def = this._def;\n        const watcher = new AuSlotWatcherBinding(vm, $def.callback ?? `${safeString($def.name)}Changed`, $def.slotName ?? 'default', $def.query ?? '*');\n        def(vm, $def.name, {\n            enumerable: true,\n            configurable: true,\n            get: objectAssign(( /* SlotWatcherBinding */) => watcher.getValue(), { getObserver: () => watcher }),\n            set: ( /* SlotWatcherBinding */) => { }\n        });\n        instanceRegistration(IAuSlotWatcher, watcher).register(controller.container);\n        controller.addBinding(watcher);\n    }\n}\nfunction slotted(queryOrDef, slotName) {\n    if (!mixed) {\n        mixed = true;\n        subscriberCollection(AuSlotWatcherBinding, null);\n        lifecycleHooks()(SlottedLifecycleHooks, null);\n    }\n    const dependenciesKey = getAnnotationKeyFor('dependencies');\n    // function decorator($target: {}, $prop: symbol | string, desc?: PropertyDecorator): void {\n    function decorator(_, context) {\n        if (context.kind !== 'field')\n            throw createMappedError(9990 /* ErrorNames.slotted_decorator_invalid_usage */);\n        const config = (typeof queryOrDef === 'object'\n            ? queryOrDef\n            : {\n                query: queryOrDef,\n                slotName,\n                name: ''\n            });\n        config.name = context.name;\n        const dependencies = (context.metadata[dependenciesKey] ??= []);\n        dependencies.push(new SlottedLifecycleHooks(config));\n    }\n    return decorator;\n}\nlet mixed = false;\n\n/**\n * The public methods of this binding emulates the necessary of an IHydratableController,\n * which mainly is the addBinding method since a spread binding\n * is a surrogate of other bindings created from the captured attrs\n */\nclass SpreadBinding {\n    /**\n     * Create a list of SpreadBinding by searching for captured attributes in HydrationContexts\n     * from a container\n     */\n    static create(hydrationContext, target, \n    /**\n     * To be supplied to the compilation of spread' attrs\n     * Sometimes in dynamic compilation scenario, this could be used to influence\n     * what attributes can be compiled into (i.e bindable vs normal)\n     */\n    targetDef, rendering, compiler, platform, exprParser, observerLocator) {\n        const bindings = [];\n        const renderers = rendering.renderers;\n        const getHydrationContext = (ancestor) => {\n            let currentLevel = ancestor;\n            let currentContext = hydrationContext;\n            while (currentContext != null && currentLevel > 0) {\n                currentContext = currentContext.parent;\n                --currentLevel;\n            }\n            if (currentContext == null) {\n                throw createMappedError(9999 /* ErrorNames.no_spread_scope_context_found */);\n            }\n            return currentContext;\n        };\n        const renderSpreadInstruction = (ancestor) => {\n            const context = getHydrationContext(ancestor);\n            const spreadBinding = new SpreadBinding(context);\n            const instructions = compiler.compileSpread(context.controller.definition, context.instruction?.captures ?? emptyArray, context.controller.container, target, targetDef);\n            let inst;\n            for (inst of instructions) {\n                switch (inst.type) {\n                    case InstructionType.spreadTransferedBinding:\n                        renderSpreadInstruction(ancestor + 1);\n                        break;\n                    case InstructionType.spreadElementProp:\n                        renderers[inst.instruction.type].render(spreadBinding, findElementControllerFor(target), inst.instruction, platform, exprParser, observerLocator);\n                        break;\n                    default:\n                        renderers[inst.type].render(spreadBinding, target, inst, platform, exprParser, observerLocator);\n                }\n            }\n            bindings.push(spreadBinding);\n        };\n        renderSpreadInstruction(0);\n        return bindings;\n    }\n    get container() {\n        return this.locator;\n    }\n    get definition() {\n        return this.$controller.definition;\n    }\n    get state() {\n        return this.$controller.state;\n    }\n    constructor(hydrationContext) {\n        this.isBound = false;\n        /** @internal */ this._innerBindings = [];\n        this.locator = (this.$controller = (this._hydrationContext = hydrationContext).controller).container;\n    }\n    get(key) {\n        return this.locator.get(key);\n    }\n    bind(_scope) {\n        if (this.isBound)\n            return;\n        this.isBound = true;\n        const innerScope = this.scope = this._hydrationContext.controller.scope.parent ?? void 0;\n        if (innerScope == null) {\n            throw createMappedError(9999 /* ErrorNames.no_spread_scope_context_found */);\n        }\n        this._innerBindings.forEach(b => b.bind(innerScope));\n    }\n    unbind() {\n        this._innerBindings.forEach(b => b.unbind());\n        this.isBound = false;\n    }\n    addBinding(binding) {\n        this._innerBindings.push(binding);\n    }\n    addChild(controller) {\n        if (controller.vmKind !== vmkCa) {\n            throw createMappedError(9998 /* ErrorNames.no_spread_template_controller */);\n        }\n        this.$controller.addChild(controller);\n    }\n}\nclass SpreadValueBinding {\n    constructor(controller, target, targetKeys, ast, ol, l, strict) {\n        this.target = target;\n        this.targetKeys = targetKeys;\n        this.ast = ast;\n        this.strict = strict;\n        this.isBound = false;\n        /** @internal */\n        this._scope = void 0;\n        // see Listener binding for explanation\n        /** @internal */\n        this.boundFn = false;\n        /** @internal */\n        this._bindingCache = {};\n        // not a static weakmap because we want to clear the cache when the binding is disposed\n        // also different binding at different logic with the same object shouldn't be sharing the same override context\n        /** @internal */\n        this._scopeCache = new WeakMap();\n        this._controller = controller;\n        this.oL = ol;\n        this.l = l;\n    }\n    updateTarget() {\n        this.obs.version++;\n        const newValue = astEvaluate(this.ast, this._scope, this, this);\n        this.obs.clear();\n        this._createBindings(newValue, true);\n    }\n    handleChange() {\n        if (!this.isBound)\n            return;\n        this.updateTarget();\n    }\n    handleCollectionChange() {\n        if (!this.isBound)\n            return;\n        this.updateTarget();\n    }\n    bind(scope) {\n        if (this.isBound) {\n            if (this._scope === scope)\n                return;\n            this.unbind();\n        }\n        this.isBound = true;\n        this._scope = scope;\n        astBind(this.ast, scope, this);\n        const value = astEvaluate(this.ast, scope, this, this);\n        this._createBindings(value, false);\n    }\n    unbind() {\n        if (!this.isBound)\n            return;\n        this.isBound = false;\n        astUnbind(this.ast, this._scope, this);\n        this._scope = void 0;\n        let key;\n        // can also try to keep track of what the active bindings are\n        // but we know in our impl, all unbind are idempotent\n        // so just be simple and unbind all\n        for (key in this._bindingCache) {\n            this._bindingCache[key].unbind();\n        }\n    }\n    /**\n     * @internal\n     */\n    _createBindings(value, unbind) {\n        let key;\n        if (!isObject(value)) {\n            /* istanbul ignore if */\n            {\n                // eslint-disable-next-line no-console\n                console.warn(`[DEV:aurelia] $bindable spread is given a non object for properties: \"${this.targetKeys.join(', ')}\" of ${this.target.constructor.name}`);\n            }\n            for (key in this._bindingCache) {\n                this._bindingCache[key]?.unbind();\n            }\n            return;\n        }\n        let binding;\n        // use a cache as we don't wanna cause bindings to \"move\" (bind/unbind)\n        // whenever there's a new evaluation\n        let scope = this._scopeCache.get(value);\n        if (scope == null) {\n            this._scopeCache.set(value, scope = Scope.fromParent(this._scope, value));\n        }\n        for (key of this.targetKeys) {\n            binding = this._bindingCache[key];\n            if (key in value) {\n                if (binding == null) {\n                    binding = this._bindingCache[key] = new PropertyBinding(this._controller, this.l, this.oL, SpreadValueBinding._astCache[key] ??= new AccessScopeExpression(key, 0), this.target, key, BindingMode.toView, this.strict);\n                }\n                binding.bind(scope);\n            }\n            else if (unbind) {\n                binding?.unbind();\n            }\n        }\n    }\n}\n/** @internal */\nSpreadValueBinding.mix = createPrototypeMixer(() => {\n    mixinUseScope(SpreadValueBinding);\n    mixingBindingLimited(SpreadValueBinding, () => 'updateTarget');\n    connectable(SpreadValueBinding, null);\n    mixinAstEvaluator(SpreadValueBinding);\n});\n/** @internal */\nSpreadValueBinding._astCache = {};\n\nconst addListener = (target, name, handler, options) => {\n    target.addEventListener(name, handler, options);\n};\nconst removeListener = (target, name, handler, options) => {\n    target.removeEventListener(name, handler, options);\n};\n/** @internal */\nconst mixinNodeObserverUseConfig = (target) => {\n    let event;\n    const prototype = target.prototype;\n    defineHiddenProp(prototype, 'subscribe', function (subscriber) {\n        if (this.subs.add(subscriber) && this.subs.count === 1) {\n            for (event of this._config.events) {\n                addListener(this._el, event, this);\n            }\n            this._listened = true;\n            this._start?.();\n        }\n    });\n    defineHiddenProp(prototype, 'unsubscribe', function (subscriber) {\n        if (this.subs.remove(subscriber) && this.subs.count === 0) {\n            for (event of this._config.events) {\n                removeListener(this._el, event, this);\n            }\n            this._listened = false;\n            this._stop?.();\n        }\n    });\n    defineHiddenProp(prototype, 'useConfig', function (config) {\n        this._config = config;\n        if (this._listened) {\n            for (event of this._config.events) {\n                removeListener(this._el, event, this);\n            }\n            for (event of this._config.events) {\n                addListener(this._el, event, this);\n            }\n        }\n    });\n};\n/** @internal */\nconst mixinNoopSubscribable = (target) => {\n    defineHiddenProp(target.prototype, 'subscribe', noop);\n    defineHiddenProp(target.prototype, 'unsubscribe', noop);\n};\n\nclass ClassAttributeAccessor {\n    get doNotCache() { return true; }\n    constructor(obj, mapping = {}) {\n        this.obj = obj;\n        this.mapping = mapping;\n        this.type = (atNode | atLayout);\n        /** @internal */\n        this._value = '';\n        /** @internal */\n        this._nameIndex = {};\n        /** @internal */\n        this._version = 0;\n    }\n    getValue() {\n        return this._value;\n    }\n    setValue(newValue) {\n        if (newValue !== this._value) {\n            this._value = newValue;\n            this._flushChanges();\n        }\n    }\n    /** @internal */\n    _flushChanges() {\n        const nameIndex = this._nameIndex;\n        const version = ++this._version;\n        const classList = this.obj.classList;\n        const classesToAdd = getClassesToAdd(this._value);\n        const ii = classesToAdd.length;\n        let i = 0;\n        let name;\n        // Get strings split on a space not including empties\n        if (ii > 0) {\n            for (; i < ii; i++) {\n                name = classesToAdd[i];\n                name = this.mapping[name] || name;\n                if (name.length === 0) {\n                    continue;\n                }\n                nameIndex[name] = this._version;\n                classList.add(name);\n            }\n        }\n        // First call to setValue?  We're done.\n        if (version === 1) {\n            return;\n        }\n        for (name in nameIndex) {\n            name = this.mapping[name] || name;\n            if (nameIndex[name] === version) {\n                continue;\n            }\n            // TODO: this has the side-effect that classes already present which are added again,\n            // will be removed if they're not present in the next update.\n            // Better would be do have some configurability for this behavior, allowing the user to\n            // decide whether initial classes always need to be kept, always removed, or something in between\n            classList.remove(name);\n        }\n    }\n}\n(() => {\n    mixinNoopSubscribable(ClassAttributeAccessor);\n})();\nfunction getClassesToAdd(object) {\n    if (isString(object)) {\n        return splitClassString(object);\n    }\n    if (typeof object !== 'object') {\n        return emptyArray;\n    }\n    if (isArray(object)) {\n        const len = object.length;\n        if (len > 0) {\n            const classes = [];\n            let i = 0;\n            for (; len > i; ++i) {\n                classes.push(...getClassesToAdd(object[i]));\n            }\n            return classes;\n        }\n        else {\n            return emptyArray;\n        }\n    }\n    const classes = [];\n    let property;\n    for (property in object) {\n        // Let non typical values also evaluate true so disable bool check\n        // eslint-disable-next-line no-extra-boolean-cast\n        if (Boolean(object[property])) {\n            // We must do this in case object property has a space in the name which results in two classes\n            if (property.includes(' ')) {\n                classes.push(...splitClassString(property));\n            }\n            else {\n                classes.push(property);\n            }\n        }\n    }\n    return classes;\n}\nfunction splitClassString(classString) {\n    const matches = classString.match(/\\S+/g);\n    if (matches === null) {\n        return emptyArray;\n    }\n    return matches;\n}\n\n/**\n * Create a resolver for a given key that will only resolve from the nearest hydration context.\n *\n * @internal\n */\nconst fromHydrationContext = (key) => ({\n    $isResolver: true,\n    resolve(_, requestor) {\n        return requestor.get(IHydrationContext).controller.container.get(own(key));\n    }\n});\n\nconst IRenderer = /*@__PURE__*/ createInterface('IRenderer');\nfunction renderer(target, context) {\n    const metadata = context?.metadata ?? (target[Symbol.metadata] ??= Object.create(null));\n    metadata[registrableMetadataKey] = {\n        register(container) {\n            singletonRegistration(IRenderer, target).register(container);\n        }\n    };\n    return target;\n}\nfunction ensureExpression(parser, srcOrExpr, expressionType) {\n    if (isString(srcOrExpr)) {\n        return parser.parse(srcOrExpr, expressionType);\n    }\n    return srcOrExpr;\n}\nfunction getTarget(potentialTarget) {\n    if (potentialTarget.viewModel != null) {\n        return potentialTarget.viewModel;\n    }\n    return potentialTarget;\n}\nfunction getRefTarget(refHost, refTargetName) {\n    if (refTargetName === 'element') {\n        return refHost;\n    }\n    switch (refTargetName) {\n        case 'controller':\n            // this means it supports returning undefined\n            return findElementControllerFor(refHost);\n        case 'view':\n            throw createMappedError(750 /* ErrorNames.not_supported_view_ref_api */);\n        case 'component':\n            // this means it supports returning undefined\n            return findElementControllerFor(refHost).viewModel;\n        default: {\n            const caController = findAttributeControllerFor(refHost, refTargetName);\n            if (caController !== void 0) {\n                return caController.viewModel;\n            }\n            const ceController = findElementControllerFor(refHost, { name: refTargetName });\n            if (ceController === void 0) {\n                throw createMappedError(751 /* ErrorNames.ref_not_found */, refTargetName);\n            }\n            return ceController.viewModel;\n        }\n    }\n}\nconst SetPropertyRenderer = /*@__PURE__*/ renderer(class SetPropertyRenderer {\n    constructor() {\n        this.target = InstructionType.setProperty;\n    }\n    render(renderingCtrl, target, instruction) {\n        const obj = getTarget(target);\n        if (obj.$observers?.[instruction.to] !== void 0) {\n            obj.$observers[instruction.to].setValue(instruction.value);\n        }\n        else {\n            obj[instruction.to] = instruction.value;\n        }\n    }\n}, null);\nconst CustomElementRenderer = /*@__PURE__*/ renderer(class CustomElementRenderer {\n    constructor() {\n        /** @internal */ this._rendering = resolve(IRendering);\n        this.target = InstructionType.hydrateElement;\n    }\n    render(renderingCtrl, target, instruction, platform, exprParser, observerLocator) {\n        /* eslint-disable prefer-const */\n        let def;\n        let component;\n        let childCtrl;\n        const res = instruction.res;\n        const projections = instruction.projections;\n        const ctxContainer = renderingCtrl.container;\n        switch (typeof res) {\n            case 'string':\n                def = CustomElement.find(ctxContainer, res);\n                if (def == null) {\n                    throw createMappedError(752 /* ErrorNames.element_res_not_found */, instruction, renderingCtrl);\n                }\n                break;\n            // constructor based instruction\n            // will be enabled later if needed.\n            // As both AOT + runtime based can use definition for perf\n            // -----------------\n            // case 'function':\n            //   def = CustomElement.getDefinition(res);\n            //   break;\n            default:\n                def = res;\n        }\n        const containerless = instruction.containerless || def.containerless;\n        const location = containerless ? convertToRenderLocation(target) : null;\n        const container = createElementContainer(\n        /* platform         */ platform, \n        /* parentController */ renderingCtrl, \n        /* host             */ target, \n        /* instruction      */ instruction, \n        /* location         */ location, \n        /* SlotsInfo      */ projections == null ? void 0 : new AuSlotsInfo(objectKeys(projections)));\n        component = container.invoke(def.Type);\n        childCtrl = Controller.$el(\n        /* own container       */ container, \n        /* viewModel           */ component, \n        /* host                */ target, \n        /* instruction         */ instruction, \n        /* definition          */ def, \n        /* location            */ location);\n        const renderers = this._rendering.renderers;\n        const props = instruction.props;\n        const ii = props.length;\n        let i = 0;\n        let propInst;\n        while (ii > i) {\n            propInst = props[i];\n            renderers[propInst.type].render(renderingCtrl, childCtrl, propInst, platform, exprParser, observerLocator);\n            ++i;\n        }\n        renderingCtrl.addChild(childCtrl);\n        /* eslint-enable prefer-const */\n    }\n}, null);\nconst CustomAttributeRenderer = /*@__PURE__*/ renderer(class CustomAttributeRenderer {\n    constructor() {\n        /** @internal */ this._rendering = resolve(IRendering);\n        this.target = InstructionType.hydrateAttribute;\n    }\n    render(\n    /**\n     * The cotroller that is currently invoking this renderer\n     */\n    renderingCtrl, target, \n    // <CustomAttributeDefinition> as we assume it's always used with the default resources resolver\n    instruction, platform, exprParser, observerLocator) {\n        /* eslint-disable prefer-const */\n        let ctxContainer = renderingCtrl.container;\n        let def;\n        switch (typeof instruction.res) {\n            case 'string':\n                def = CustomAttribute.find(ctxContainer, instruction.res);\n                if (def == null) {\n                    throw createMappedError(753 /* ErrorNames.attribute_res_not_found */, instruction, renderingCtrl);\n                }\n                break;\n            // constructor based instruction\n            // will be enabled later if needed.\n            // As both AOT + runtime based can use definition for perf\n            // -----------------\n            // case 'function':\n            //   def = CustomAttribute.getDefinition(instruction.res);\n            //   break;\n            default:\n                def = instruction.res;\n        }\n        const results = invokeAttribute(\n        /* platform         */ platform, \n        /* attr definition  */ def, \n        /* parentController */ renderingCtrl, \n        /* host             */ target, \n        /* instruction      */ instruction, \n        /* viewFactory      */ void 0, \n        /* location         */ void 0);\n        const childController = Controller.$attr(\n        /* context ct */ results.ctn, \n        /* viewModel  */ results.vm, \n        /* host       */ target, \n        /* definition */ def);\n        refs.set(target, def.key, childController);\n        const renderers = this._rendering.renderers;\n        const props = instruction.props;\n        const ii = props.length;\n        let i = 0;\n        let propInst;\n        while (ii > i) {\n            propInst = props[i];\n            renderers[propInst.type].render(renderingCtrl, childController, propInst, platform, exprParser, observerLocator);\n            ++i;\n        }\n        renderingCtrl.addChild(childController);\n        /* eslint-enable prefer-const */\n    }\n}, null);\nconst TemplateControllerRenderer = /*@__PURE__*/ renderer(class TemplateControllerRenderer {\n    constructor() {\n        /** @internal */ this._rendering = resolve(IRendering);\n        this.target = InstructionType.hydrateTemplateController;\n    }\n    render(renderingCtrl, target, \n    // <CustomAttributeDefinition> as we assume it's always used with the default resources resolver\n    instruction, platform, exprParser, observerLocator) {\n        /* eslint-disable prefer-const */\n        let ctxContainer = renderingCtrl.container;\n        let def;\n        switch (typeof instruction.res) {\n            case 'string':\n                def = CustomAttribute.find(ctxContainer, instruction.res);\n                if (def == null) {\n                    throw createMappedError(754 /* ErrorNames.attribute_tc_res_not_found */, instruction, renderingCtrl);\n                }\n                break;\n            // constructor based instruction\n            // will be enabled later if needed.\n            // As both AOT + runtime based can use definition for perf\n            // -----------------\n            // case 'function':\n            //   def = CustomAttribute.getDefinition(instruction.res);\n            //   break;\n            default:\n                def = instruction.res;\n        }\n        // const viewFactory = this._rendering.getViewFactory(\n        //   instruction.def,\n        //   ctxContainer\n        // );\n        const viewFactory = this._rendering.getViewFactory(instruction.def, def.containerStrategy === 'new'\n            ? ctxContainer.createChild({ inheritParentResources: true })\n            : ctxContainer);\n        const renderLocation = convertToRenderLocation(target);\n        const results = invokeAttribute(\n        /* platform         */ platform, \n        /* attr definition  */ def, \n        /* parentController */ renderingCtrl, \n        /* host             */ target, \n        /* instruction      */ instruction, \n        /* viewFactory      */ viewFactory, \n        /* location         */ renderLocation);\n        const childController = Controller.$attr(\n        /* container ct */ results.ctn, \n        /* viewModel    */ results.vm, \n        /* host         */ target, \n        /* definition   */ def);\n        refs.set(renderLocation, def.key, childController);\n        results.vm.link?.(renderingCtrl, childController, target, instruction);\n        const renderers = this._rendering.renderers;\n        const props = instruction.props;\n        const ii = props.length;\n        let i = 0;\n        let propInst;\n        while (ii > i) {\n            propInst = props[i];\n            renderers[propInst.type].render(renderingCtrl, childController, propInst, platform, exprParser, observerLocator);\n            ++i;\n        }\n        renderingCtrl.addChild(childController);\n        /* eslint-enable prefer-const */\n    }\n}, null);\nconst LetElementRenderer = /*@__PURE__*/ renderer(class LetElementRenderer {\n    constructor() {\n        this.target = InstructionType.hydrateLetElement;\n        LetBinding.mix();\n    }\n    render(renderingCtrl, target, instruction, platform, exprParser, observerLocator) {\n        target.remove();\n        const childInstructions = instruction.instructions;\n        const toBindingContext = instruction.toBindingContext;\n        const container = renderingCtrl.container;\n        const ii = childInstructions.length;\n        let childInstruction;\n        let expr;\n        let i = 0;\n        while (ii > i) {\n            childInstruction = childInstructions[i];\n            expr = ensureExpression(exprParser, childInstruction.from, etIsProperty);\n            renderingCtrl.addBinding(new LetBinding(container, observerLocator, expr, childInstruction.to, toBindingContext, renderingCtrl.strict ?? false));\n            ++i;\n        }\n    }\n}, null);\nconst RefBindingRenderer = /*@__PURE__*/ renderer(class RefBindingRenderer {\n    constructor() {\n        this.target = InstructionType.refBinding;\n        RefBinding.mix();\n    }\n    render(renderingCtrl, target, instruction, platform, exprParser, observerLocator) {\n        renderingCtrl.addBinding(new RefBinding(renderingCtrl.container, observerLocator, ensureExpression(exprParser, instruction.from, etIsProperty), getRefTarget(target, instruction.to), renderingCtrl.strict ?? false));\n    }\n}, null);\nconst InterpolationBindingRenderer = /*@__PURE__*/ renderer(class InterpolationBindingRenderer {\n    constructor() {\n        this.target = InstructionType.interpolation;\n        InterpolationPartBinding.mix();\n    }\n    render(renderingCtrl, target, instruction, platform, exprParser, observerLocator) {\n        const container = renderingCtrl.container;\n        const binding = new InterpolationBinding(renderingCtrl, container, observerLocator, ensureExpression(exprParser, instruction.from, etInterpolation), getTarget(target), instruction.to, toView, renderingCtrl.strict ?? false);\n        if (instruction.to === 'class' && binding.target.nodeType > 0) {\n            const cssMapping = container.get(fromHydrationContext(ICssClassMapping));\n            binding.useAccessor(new ClassAttributeAccessor(binding.target, cssMapping));\n        }\n        renderingCtrl.addBinding(binding);\n    }\n}, null);\nconst PropertyBindingRenderer = /*@__PURE__*/ renderer(class PropertyBindingRenderer {\n    constructor() {\n        this.target = InstructionType.propertyBinding;\n        PropertyBinding.mix();\n    }\n    render(renderingCtrl, target, instruction, platform, exprParser, observerLocator) {\n        const container = renderingCtrl.container;\n        const binding = new PropertyBinding(renderingCtrl, container, observerLocator, ensureExpression(exprParser, instruction.from, etIsProperty), getTarget(target), instruction.to, instruction.mode, renderingCtrl.strict ?? false);\n        if (instruction.to === 'class' && binding.target.nodeType > 0) {\n            const cssMapping = container.get(fromHydrationContext(ICssClassMapping));\n            binding.useTargetObserver(new ClassAttributeAccessor(binding.target, cssMapping));\n        }\n        renderingCtrl.addBinding(binding);\n    }\n}, null);\nconst IteratorBindingRenderer = /*@__PURE__*/ renderer(class IteratorBindingRenderer {\n    constructor() {\n        this.target = InstructionType.iteratorBinding;\n        PropertyBinding.mix();\n    }\n    render(renderingCtrl, target, instruction, platform, exprParser, observerLocator) {\n        renderingCtrl.addBinding(new PropertyBinding(renderingCtrl, renderingCtrl.container, observerLocator, ensureExpression(exprParser, instruction.forOf, etIsIterator), getTarget(target), instruction.to, toView, renderingCtrl.strict ?? false));\n    }\n}, null);\nconst TextBindingRenderer = /*@__PURE__*/ renderer(class TextBindingRenderer {\n    constructor() {\n        this.target = InstructionType.textBinding;\n        ContentBinding.mix();\n    }\n    render(renderingCtrl, target, instruction, platform, exprParser, observerLocator) {\n        renderingCtrl.addBinding(new ContentBinding(renderingCtrl, renderingCtrl.container, observerLocator, platform, ensureExpression(exprParser, instruction.from, etIsProperty), target, renderingCtrl.strict ?? false));\n    }\n}, null);\nconst IListenerBindingOptions = createInterface('IListenerBindingOptions', x => x.singleton(class {\n    constructor() {\n        /** @internal */\n        this.p = resolve(IPlatform);\n        this.prevent = false;\n        this.onError = (event, error) => {\n            const errorEvent = new this.p.CustomEvent('au-event-error', { cancelable: true, detail: { event, error } });\n            this.p.window.dispatchEvent(errorEvent);\n            if (errorEvent.defaultPrevented) {\n                return;\n            }\n            throw error;\n        };\n    }\n}));\nconst ListenerBindingRenderer = /*@__PURE__*/ renderer(class ListenerBindingRenderer {\n    constructor() {\n        this.target = InstructionType.listenerBinding;\n        /** @internal */\n        this._modifierHandler = resolve(IEventModifier);\n        /** @internal */\n        this._defaultOptions = resolve(IListenerBindingOptions);\n        ListenerBinding.mix();\n    }\n    render(renderingCtrl, target, instruction, platform, exprParser) {\n        renderingCtrl.addBinding(new ListenerBinding(renderingCtrl.container, ensureExpression(exprParser, instruction.from, etIsFunction), target, instruction.to, new ListenerBindingOptions(this._defaultOptions.prevent, instruction.capture, this._defaultOptions.onError), this._modifierHandler.getHandler(instruction.to, instruction.modifier), renderingCtrl.strict ?? false));\n    }\n}, null);\nconst SetAttributeRenderer = /*@__PURE__*/ renderer(class SetAttributeRenderer {\n    constructor() {\n        this.target = InstructionType.setAttribute;\n    }\n    render(_, target, instruction) {\n        target.setAttribute(instruction.to, instruction.value);\n    }\n}, null);\nconst SetClassAttributeRenderer = /*@__PURE__*/ renderer(class SetClassAttributeRenderer {\n    constructor() {\n        this.target = InstructionType.setClassAttribute;\n    }\n    render(_, target, instruction) {\n        addClasses(target.classList, instruction.value);\n    }\n}, null);\nconst SetStyleAttributeRenderer = /*@__PURE__*/ renderer(class SetStyleAttributeRenderer {\n    constructor() {\n        this.target = InstructionType.setStyleAttribute;\n    }\n    render(_, target, instruction) {\n        target.style.cssText += instruction.value;\n    }\n}, null);\n/* istanbul ignore next */\nconst ambiguousStyles = [\n    'height',\n    'width',\n    'border-width',\n    'padding',\n    'padding-left',\n    'padding-right',\n    'padding-top',\n    'padding-right',\n    'padding-inline',\n    'padding-block',\n    'margin',\n    'margin-left',\n    'margin-right',\n    'margin-top',\n    'margin-bottom',\n    'margin-inline',\n    'margin-block',\n    'top',\n    'right',\n    'bottom',\n    'left',\n];\nconst StylePropertyBindingRenderer = /*@__PURE__*/ renderer(class StylePropertyBindingRenderer {\n    constructor() {\n        this.target = InstructionType.stylePropertyBinding;\n        PropertyBinding.mix();\n    }\n    render(renderingCtrl, target, instruction, platform, exprParser, observerLocator) {\n        {\n            /* istanbul ignore next */\n            if (ambiguousStyles.includes(instruction.to)) {\n                renderingCtrl.addBinding(new DevStylePropertyBinding(renderingCtrl, renderingCtrl.container, observerLocator, ensureExpression(exprParser, instruction.from, etIsProperty), target.style, instruction.to, toView, renderingCtrl.strict ?? false));\n                return;\n            }\n        }\n        renderingCtrl.addBinding(new PropertyBinding(renderingCtrl, renderingCtrl.container, observerLocator, ensureExpression(exprParser, instruction.from, etIsProperty), target.style, instruction.to, toView, renderingCtrl.strict ?? false));\n    }\n}, null);\n/* istanbul ignore next */\nclass DevStylePropertyBinding extends PropertyBinding {\n    updateTarget(value) {\n        if (typeof value === 'number' && value > 0) {\n            // eslint-disable-next-line no-console\n            console.warn(`[DEV]: Setting number ${value} as value for style.${this.targetProperty}. Did you meant \"${value}px\"?`);\n        }\n        return super.updateTarget(value);\n    }\n}\nconst AttributeBindingRenderer = /*@__PURE__*/ renderer(class AttributeBindingRenderer {\n    constructor() {\n        this.target = InstructionType.attributeBinding;\n        AttributeBinding.mix();\n    }\n    render(renderingCtrl, target, instruction, platform, exprParser, observerLocator) {\n        const container = renderingCtrl.container;\n        const classMapping = container.has(ICssClassMapping, false)\n            ? container.get(ICssClassMapping)\n            : null;\n        renderingCtrl.addBinding(new AttributeBinding(renderingCtrl, container, observerLocator, ensureExpression(exprParser, instruction.from, etIsProperty), target, instruction.attr /* targetAttribute */, classMapping == null\n            ? instruction.to /* targetKey */\n            : instruction.to.split(/\\s/g).map(c => classMapping[c] ?? c).join(' '), toView, renderingCtrl.strict ?? false));\n    }\n}, null);\nconst SpreadRenderer = /*@__PURE__*/ renderer(class SpreadRenderer {\n    constructor() {\n        /** @internal */ this._compiler = resolve(ITemplateCompiler);\n        /** @internal */ this._rendering = resolve(IRendering);\n        this.target = InstructionType.spreadTransferedBinding;\n    }\n    render(renderingCtrl, target, instruction, platform, exprParser, observerLocator) {\n        SpreadBinding.create(renderingCtrl.container.get(IHydrationContext), target, void 0, this._rendering, this._compiler, platform, exprParser, observerLocator)\n            .forEach(b => renderingCtrl.addBinding(b));\n    }\n}, null);\nconst SpreadValueRenderer = /*@__PURE__*/ renderer(class SpreadValueRenderer {\n    constructor() {\n        this.target = InstructionType.spreadValueBinding;\n        SpreadValueBinding.mix();\n    }\n    render(renderingCtrl, target, instruction, platform, exprParser, observerLocator) {\n        const instructionTarget = instruction.target;\n        if (instructionTarget === '$bindables') {\n            renderingCtrl.addBinding(new SpreadValueBinding(renderingCtrl, target.viewModel, objectKeys(target.definition.bindables), exprParser.parse(instruction.from, etIsProperty), observerLocator, renderingCtrl.container, renderingCtrl.strict ?? false));\n        }\n        else {\n            throw createMappedError(820 /* ErrorNames.spreading_invalid_target */, instructionTarget);\n        }\n    }\n}, null);\n// http://jsben.ch/7n5Kt\nfunction addClasses(classList, className) {\n    const len = className.length;\n    let start = 0;\n    for (let i = 0; i < len; ++i) {\n        if (className.charCodeAt(i) === 0x20) {\n            if (i !== start) {\n                classList.add(className.slice(start, i));\n            }\n            start = i + 1;\n        }\n        else if (i + 1 === len) {\n            classList.add(className.slice(start));\n        }\n    }\n}\n// const createSurrogateBinding = (context: IHydrationContext<object>) =>\n//   new SpreadBinding([], context) as SpreadBinding & IHydratableController;\nconst controllerProviderName = 'IController';\nconst instructionProviderName = 'IInstruction';\nconst locationProviderName = 'IRenderLocation';\nconst slotInfoProviderName = 'ISlotsInfo';\nfunction createElementContainer(p, renderingCtrl, host, instruction, location, auSlotsInfo) {\n    const ctn = renderingCtrl.container.createChild();\n    registerHostNode(ctn, host, p);\n    registerResolver(ctn, IController, new InstanceProvider(controllerProviderName, renderingCtrl));\n    registerResolver(ctn, IInstruction, new InstanceProvider(instructionProviderName, instruction));\n    registerResolver(ctn, IRenderLocation, location == null\n        ? noLocationProvider\n        : new RenderLocationProvider(location));\n    registerResolver(ctn, IViewFactory, noViewFactoryProvider);\n    registerResolver(ctn, IAuSlotsInfo, auSlotsInfo == null\n        ? noAuSlotProvider\n        : new InstanceProvider(slotInfoProviderName, auSlotsInfo));\n    return ctn;\n}\nclass ViewFactoryProvider {\n    get $isResolver() { return true; }\n    constructor(\n    /**\n     * The factory instance that this provider will resolves to,\n     * until explicitly overridden by prepare call\n     */\n    factory) {\n        this.f = factory;\n    }\n    resolve() {\n        const f = this.f;\n        if (f === null) {\n            throw createMappedError(755 /* ErrorNames.view_factory_provider_not_ready */);\n        }\n        if (!isString(f.name) || f.name.length === 0) {\n            throw createMappedError(756 /* ErrorNames.view_factory_invalid_name */);\n        }\n        return f;\n    }\n}\nfunction invokeAttribute(p, definition, $renderingCtrl, host, instruction, viewFactory, location, auSlotsInfo) {\n    const renderingCtrl = $renderingCtrl instanceof Controller\n        ? $renderingCtrl\n        : $renderingCtrl.$controller;\n    const ctn = renderingCtrl.container.createChild();\n    registerHostNode(ctn, host, p);\n    registerResolver(ctn, IController, new InstanceProvider(controllerProviderName, renderingCtrl));\n    registerResolver(ctn, IInstruction, new InstanceProvider(instructionProviderName, instruction));\n    registerResolver(ctn, IRenderLocation, location == null\n        ? noLocationProvider\n        : new InstanceProvider(locationProviderName, location));\n    registerResolver(ctn, IViewFactory, viewFactory == null\n        ? noViewFactoryProvider\n        : new ViewFactoryProvider(viewFactory));\n    registerResolver(ctn, IAuSlotsInfo, noAuSlotProvider\n        );\n    return { vm: ctn.invoke(definition.Type), ctn };\n}\nclass RenderLocationProvider {\n    get name() { return 'IRenderLocation'; }\n    get $isResolver() { return true; }\n    constructor(_location) {\n        this._location = _location;\n    }\n    resolve() {\n        return this._location;\n    }\n}\nconst noLocationProvider = new RenderLocationProvider(null);\nconst noViewFactoryProvider = new ViewFactoryProvider(null);\nconst noAuSlotProvider = new InstanceProvider(slotInfoProviderName, new AuSlotsInfo(emptyArray));\n\nconst IRendering = /*@__PURE__*/ createInterface('IRendering', x => x.singleton(Rendering));\nclass Rendering {\n    get renderers() {\n        return this._renderers ??= this._ctn.getAll(IRenderer, false).reduce((all, r) => {\n            {\n                if (all[r.target] !== void 0) {\n                    // eslint-disable-next-line no-console\n                    console.warn(`[DEV:aurelia] Renderer for target ${r.target} already exists.`);\n                }\n            }\n            all[r.target] ??= r;\n            return all;\n        }, createLookup());\n    }\n    constructor() {\n        /** @internal */\n        this._compilationCache = new WeakMap();\n        /** @internal */\n        this._fragmentCache = new WeakMap();\n        const ctn = this._ctn = resolve(IContainer).root;\n        const p = this._platform = ctn.get(IPlatform);\n        this._exprParser = ctn.get(IExpressionParser);\n        this._observerLocator = ctn.get(IObserverLocator);\n        this._marker = p.document.createElement('au-m');\n        this._empty = new FragmentNodeSequence(p, p.document.createDocumentFragment());\n    }\n    compile(definition, container) {\n        const compiler = container.get(ITemplateCompiler);\n        const compiledMap = this._compilationCache;\n        let compiled = compiledMap.get(definition);\n        if (compiled == null) {\n            compiledMap.set(definition, compiled = CustomElementDefinition.create(definition.needsCompile\n                ? compiler.compile(definition, container)\n                : definition));\n        }\n        return compiled;\n    }\n    getViewFactory(definition, container) {\n        return new ViewFactory(container, CustomElementDefinition.getOrCreate(definition));\n    }\n    createNodes(definition) {\n        if (definition.enhance === true) {\n            return new FragmentNodeSequence(this._platform, this._transformMarker(definition.template));\n        }\n        let fragment;\n        let needsImportNode = false;\n        const cache = this._fragmentCache;\n        const p = this._platform;\n        const doc = p.document;\n        if (cache.has(definition)) {\n            fragment = cache.get(definition);\n        }\n        else {\n            const template = definition.template;\n            let tpl;\n            if (template == null) {\n                fragment = null;\n            }\n            else if (template instanceof p.Node) {\n                if (template.nodeName === 'TEMPLATE') {\n                    fragment = template.content;\n                    needsImportNode = true;\n                }\n                else {\n                    (fragment = doc.createDocumentFragment()).appendChild(template.cloneNode(true));\n                }\n            }\n            else {\n                tpl = doc.createElement('template');\n                if (isString(template)) {\n                    tpl.innerHTML = template;\n                }\n                fragment = tpl.content;\n                needsImportNode = true;\n            }\n            this._transformMarker(fragment);\n            cache.set(definition, fragment);\n        }\n        return fragment == null\n            ? this._empty\n            : new FragmentNodeSequence(this._platform, needsImportNode\n                ? doc.importNode(fragment, true)\n                : doc.adoptNode(fragment.cloneNode(true)));\n    }\n    render(controller, targets, definition, host) {\n        const rows = definition.instructions;\n        const renderers = this.renderers;\n        const ii = targets.length;\n        let i = 0;\n        let j = 0;\n        let jj = rows.length;\n        let row;\n        let instruction;\n        let target;\n        if (ii !== jj) {\n            throw createMappedError(757 /* ErrorNames.rendering_mismatch_length */, ii, jj);\n        }\n        // host is only null when rendering a synthetic view\n        // but we have a check here so that we dont need to read surrogates unnecessarily\n        if (host != null) {\n            row = definition.surrogates;\n            if ((jj = row.length) > 0) {\n                j = 0;\n                while (jj > j) {\n                    instruction = row[j];\n                    renderers[instruction.type].render(controller, host, instruction, this._platform, this._exprParser, this._observerLocator);\n                    ++j;\n                }\n            }\n        }\n        if (ii > 0) {\n            while (ii > i) {\n                row = rows[i];\n                target = targets[i];\n                j = 0;\n                jj = row.length;\n                while (jj > j) {\n                    instruction = row[j];\n                    renderers[instruction.type].render(controller, target, instruction, this._platform, this._exprParser, this._observerLocator);\n                    ++j;\n                }\n                ++i;\n            }\n        }\n    }\n    /** @internal */\n    _transformMarker(fragment) {\n        if (fragment == null) {\n            return null;\n        }\n        const walker = this._platform.document.createTreeWalker(fragment, /* NodeFilter.SHOW_COMMENT */ 128);\n        let currentNode;\n        while ((currentNode = walker.nextNode()) != null) {\n            if (currentNode.nodeValue === 'au*') {\n                currentNode.parentNode.replaceChild(walker.currentNode = this._marker.cloneNode(), currentNode);\n            }\n        }\n        return fragment;\n        // below is a homemade \"comment query selector that seems to be as efficient as the TreeWalker\n        // also it works with very minimal set of APIs (.nextSibling, .parentNode, .insertBefore, .removeChild)\n        // while TreeWalker maynot be always available in platform that we may potentially support\n        //\n        // so leaving it here just in case we need it again, TreeWalker is slightly less code\n        // let parent: Node = fragment;\n        // let current: Node | null | undefined = parent.firstChild;\n        // let next: Node | null | undefined = null;\n        // while (current != null) {\n        //   if (current.nodeType === 8 && current.nodeValue === 'au*') {\n        //     next = current.nextSibling!;\n        //     parent.removeChild(current);\n        //     parent.insertBefore(this._marker(), next);\n        //     if (next.nodeType === 8) {\n        //       current = next.nextSibling;\n        //       // todo: maybe validate?\n        //     } else {\n        //       current = next;\n        //     }\n        //   }\n        //   next = current?.firstChild;\n        //   if (next == null) {\n        //     next = current?.nextSibling;\n        //     if (next == null) {\n        //       current = parent.nextSibling;\n        //       parent = parent.parentNode!;\n        //       // needs to keep walking up all the way til a valid next node\n        //       while (current == null && parent != null) {\n        //         current = parent.nextSibling;\n        //         parent = parent.parentNode!;\n        //       }\n        //     } else {\n        //       current = next;\n        //     }\n        //   } else {\n        //     parent = current!;\n        //     current = next;\n        //   }\n        // }\n        // return fragment;\n    }\n}\n\n/**\n * There are 2 implementations of CSS registry: css module registry and shadow dom registry.\n *\n * - CSS registry alters the way class bindings work via altering templates and register interfaces that will alter bindings to class attribute.\n *\n * - Shadow dom registry regisiters some interfaces with the custom element container to handle shadow dom styles.\n * Shadow DOM abtraction summary:\n * CSS registry ---(register)---> IShadowDOMStyleFactory ---(createStyles)---> IShadowDOMStyles ---(applyTo)---> ShadowRoot\n */\n/**\n * create a registry to register CSS module handling for a custom element.\n * The resulting registry can be registered as a dependency of a custom element.\n */\nfunction cssModules(...modules) {\n    return new CSSModulesProcessorRegistry(modules);\n}\nclass CSSModulesProcessorRegistry {\n    constructor(modules) {\n        this.modules = modules;\n    }\n    register(container) {\n        let existingMapping = container.get(own(ICssClassMapping));\n        if (existingMapping == null) {\n            container.register(instanceRegistration(ICssClassMapping, existingMapping = createLookup()));\n        }\n        /* istanbul ignore if */\n        {\n            for (const mapping of this.modules) {\n                for (const originalClass in mapping) {\n                    if (originalClass in existingMapping) {\n                        // eslint-disable-next-line no-console\n                        console.warn(`[DEV:aurelia] CSS class mapping for class \"${originalClass}\": \"${mapping[originalClass]}\" is overridden by \"${existingMapping[originalClass]}\"`);\n                    }\n                    existingMapping[originalClass] = mapping[originalClass];\n                }\n            }\n        }\n        class CompilingHook {\n            compiling(template) {\n                const isTemplate = template.tagName === 'TEMPLATE';\n                const container = isTemplate\n                    ? template.content\n                    : template;\n                const plainClasses = [template, ...toArray(container.querySelectorAll('[class]'))];\n                for (const element of plainClasses) {\n                    const classes = element.getAttributeNode('class');\n                    // we always include container, so there's a case where classes is null\n                    if (classes == null) {\n                        continue;\n                    }\n                    const newClasses = classes.value.split(/\\s+/g).map(x => existingMapping[x] || x).join(' ');\n                    classes.value = newClasses;\n                }\n            }\n        }\n        container.register(TemplateCompilerHooks.define(CompilingHook));\n    }\n}\n/**\n * Creates a registry to register shadow dom styles handling for a custom element.\n * The resulting registry can be registered as a dependency of a custom element.\n */\nfunction shadowCSS(...css) {\n    return new ShadowDOMRegistry(css);\n}\nconst IShadowDOMStyleFactory = /*@__PURE__*/ createInterface('IShadowDOMStyleFactory', x => x.cachedCallback(handler => {\n    if (AdoptedStyleSheetsStyles.supported(handler.get(IPlatform))) {\n        return handler.get(AdoptedStyleSheetsStylesFactory);\n    }\n    return handler.get(StyleElementStylesFactory);\n}));\nclass ShadowDOMRegistry {\n    constructor(css) {\n        this.css = css;\n    }\n    register(container) {\n        const sharedStyles = container.get(IShadowDOMGlobalStyles);\n        const factory = container.get(IShadowDOMStyleFactory);\n        container.register(instanceRegistration(IShadowDOMStyles, factory.createStyles(this.css, sharedStyles)));\n    }\n}\nclass AdoptedStyleSheetsStylesFactory {\n    constructor() {\n        this.p = resolve(IPlatform);\n        this.cache = new Map();\n    }\n    createStyles(localStyles, sharedStyles) {\n        return new AdoptedStyleSheetsStyles(this.p, localStyles, this.cache, sharedStyles);\n    }\n}\n// not really needed nowadays since all browsers support adopted style sheet\n// though keep it here for a bit longer before removing\n/* istanbul ignore next */\nclass StyleElementStylesFactory {\n    constructor() {\n        this.p = resolve(IPlatform);\n    }\n    createStyles(localStyles, sharedStyles) {\n        return new StyleElementStyles(this.p, localStyles, sharedStyles);\n    }\n}\nconst IShadowDOMStyles = /*@__PURE__*/ createInterface('IShadowDOMStyles');\nconst IShadowDOMGlobalStyles = /*@__PURE__*/ createInterface('IShadowDOMGlobalStyles', x => x.instance({ applyTo: noop }));\nclass AdoptedStyleSheetsStyles {\n    constructor(p, localStyles, styleSheetCache, sharedStyles = null) {\n        this.sharedStyles = sharedStyles;\n        this.styleSheets = localStyles.map(x => {\n            let sheet;\n            if (x instanceof p.CSSStyleSheet) {\n                sheet = x;\n            }\n            else {\n                sheet = styleSheetCache.get(x);\n                if (sheet === void 0) {\n                    sheet = new p.CSSStyleSheet();\n                    sheet.replaceSync(x);\n                    styleSheetCache.set(x, sheet);\n                }\n            }\n            return sheet;\n        });\n    }\n    static supported(p) {\n        return 'adoptedStyleSheets' in p.ShadowRoot.prototype;\n    }\n    applyTo(shadowRoot) {\n        if (this.sharedStyles !== null) {\n            this.sharedStyles.applyTo(shadowRoot);\n        }\n        // https://wicg.github.io/construct-stylesheets/\n        // https://developers.google.com/web/updates/2019/02/constructable-stylesheets\n        shadowRoot.adoptedStyleSheets = [\n            ...shadowRoot.adoptedStyleSheets,\n            ...this.styleSheets\n        ];\n    }\n}\nclass StyleElementStyles {\n    constructor(p, localStyles, sharedStyles = null) {\n        this.p = p;\n        this.localStyles = localStyles;\n        this.sharedStyles = sharedStyles;\n    }\n    applyTo(shadowRoot) {\n        const styles = this.localStyles;\n        const p = this.p;\n        for (let i = styles.length - 1; i > -1; --i) {\n            const element = p.document.createElement('style');\n            element.innerHTML = styles[i];\n            shadowRoot.prepend(element);\n        }\n        if (this.sharedStyles !== null) {\n            this.sharedStyles.applyTo(shadowRoot);\n        }\n    }\n}\nconst StyleConfiguration = {\n    shadowDOM(config) {\n        return AppTask.creating(IContainer, container => {\n            if (config.sharedStyles != null) {\n                const factory = container.get(IShadowDOMStyleFactory);\n                container.register(instanceRegistration(IShadowDOMGlobalStyles, factory.createStyles(config.sharedStyles, null)));\n            }\n        });\n    }\n};\n\nconst { enter, exit } = ConnectableSwitcher;\nconst { wrap, unwrap } = ProxyObservable;\nclass ComputedWatcher {\n    get value() {\n        return this._value;\n    }\n    constructor(obj, observerLocator, $get, cb, flush = 'async') {\n        this.obj = obj;\n        this.$get = $get;\n        this.isBound = false;\n        /** @internal */\n        this._isQueued = false;\n        /** @internal */\n        this._computeDepth = 0;\n        /** @internal */\n        this._value = void 0;\n        this._callback = cb;\n        this.oL = observerLocator;\n        this._flush = flush;\n    }\n    handleChange() {\n        this.run();\n    }\n    handleCollectionChange() {\n        this.run();\n    }\n    bind() {\n        if (this.isBound)\n            return;\n        this.compute();\n        this.isBound = true;\n    }\n    unbind() {\n        if (!this.isBound)\n            return;\n        this.isBound = false;\n        this.obs.clearAll();\n    }\n    run() {\n        if (!this.isBound)\n            return;\n        if (this._flush === 'sync') {\n            this._run();\n            return;\n        }\n        if (this._isQueued)\n            return;\n        this._isQueued = true;\n        queueTask(() => {\n            this._isQueued = false;\n            this._run();\n        });\n    }\n    /** @internal */\n    _run() {\n        if (!this.isBound)\n            return;\n        const obj = this.obj;\n        const oldValue = this._value;\n        if (++this._computeDepth > 100) {\n            // todo: error code\n            throw new Error(`AURXXXX: Possible infinitely recursive side-effect detected in a watcher.`);\n        }\n        const newValue = this.compute();\n        if (!areEqual(newValue, oldValue)) {\n            this._callback.call(obj, newValue, oldValue, obj);\n        }\n        if (!this._isQueued) {\n            this._computeDepth = 0;\n        }\n    }\n    compute() {\n        this.obs.version++;\n        try {\n            enter(this);\n            return this._value = unwrap(this.$get.call(void 0, wrap(this.obj), this));\n        }\n        finally {\n            this.obs.clear();\n            exit(this);\n        }\n    }\n}\n(() => {\n    connectable(ComputedWatcher, null);\n})();\nclass ExpressionWatcher {\n    get value() {\n        return this._value;\n    }\n    constructor(scope, l, oL, expression, callback, flush = 'async') {\n        this.scope = scope;\n        this.l = l;\n        this.oL = oL;\n        this.isBound = false;\n        /** @internal */\n        this._isQueued = false;\n        // see Listener binding for explanation\n        /** @internal */\n        this.boundFn = false;\n        this.obj = scope.bindingContext;\n        this._expression = expression;\n        this._callback = callback;\n        this._flush = flush;\n    }\n    handleChange() {\n        this.run();\n    }\n    handleCollectionChange() {\n        this.run();\n    }\n    run() {\n        if (!this.isBound)\n            return;\n        if (this._flush === 'sync') {\n            this._run();\n            return;\n        }\n        if (this._isQueued)\n            return;\n        this._isQueued = true;\n        queueTask(() => {\n            this._isQueued = false;\n            this._run();\n        });\n    }\n    /** @internal */\n    _run() {\n        if (!this.isBound)\n            return;\n        const expr = this._expression;\n        const obj = this.obj;\n        const oldValue = this._value;\n        this.obs.version++;\n        const value = astEvaluate(expr, this.scope, this, this);\n        this.obs.clear();\n        if (!areEqual(value, oldValue)) {\n            this._value = value;\n            this._callback.call(obj, value, oldValue, obj);\n        }\n    }\n    bind() {\n        if (this.isBound)\n            return;\n        this.obs.version++;\n        this._value = astEvaluate(this._expression, this.scope, this, this);\n        this.obs.clear();\n        this.isBound = true;\n    }\n    unbind() {\n        if (!this.isBound)\n            return;\n        this.isBound = false;\n        this.obs.clearAll();\n        this._value = void 0;\n    }\n}\n(() => {\n    connectable(ExpressionWatcher, null);\n    mixinAstEvaluator(ExpressionWatcher);\n})();\n\n/* eslint-disable @typescript-eslint/no-unnecessary-type-assertion */\nclass Controller {\n    get lifecycleHooks() {\n        return this._lifecycleHooks;\n    }\n    get isActive() {\n        return (this.state & (activating | activated)) > 0 && (this.state & deactivating) === 0;\n    }\n    get name() {\n        if (this.parent === null) {\n            switch (this.vmKind) {\n                case vmkCa:\n                    return `[${this.definition.name}]`;\n                case vmkCe:\n                    return this.definition.name;\n                case vmkSynth:\n                    return this.viewFactory.name;\n            }\n        }\n        switch (this.vmKind) {\n            case vmkCa:\n                return `${this.parent.name}>[${this.definition.name}]`;\n            case vmkCe:\n                return `${this.parent.name}>${this.definition.name}`;\n            case vmkSynth:\n                return this.viewFactory.name === this.parent.definition?.name\n                    ? `${this.parent.name}[view]`\n                    : `${this.parent.name}[view:${this.viewFactory.name}]`;\n        }\n    }\n    get viewModel() {\n        return this._vm;\n    }\n    set viewModel(v) {\n        this._vm = v;\n        this._vmHooks = v == null || this.vmKind === vmkSynth ? HooksDefinition.none : new HooksDefinition(v);\n    }\n    get strict() {\n        return this.definition?.strict;\n    }\n    constructor(container, vmKind, definition, \n    /**\n     * The viewFactory. Only present for synthetic views.\n     */\n    viewFactory, \n    /**\n     * The backing viewModel. Only present for custom attributes and elements.\n     */\n    viewModel, \n    /**\n     * The physical host dom node.\n     *\n     * For containerless elements, this node will be removed from the DOM and replaced by a comment, which is assigned to the `location` property.\n     *\n     * For ShadowDOM elements, this will be the original declaring element, NOT the shadow root (the shadow root is stored on the `shadowRoot` property)\n     */\n    host, \n    /**\n     * The render location replacement for the host on containerless elements\n     */\n    location) {\n        this.container = container;\n        this.vmKind = vmKind;\n        this.definition = definition;\n        this.viewFactory = viewFactory;\n        this.host = host;\n        this.head = null;\n        this.tail = null;\n        this.next = null;\n        this.parent = null;\n        this.bindings = null;\n        this.children = null;\n        this.hasLockedScope = false;\n        this.scope = null;\n        this.isBound = false;\n        /** @internal */\n        this._isBindingDone = false;\n        this.mountTarget = targetNone;\n        this.shadowRoot = null;\n        this.nodes = null;\n        this.location = null;\n        /** @internal */\n        this._lifecycleHooks = null;\n        this.state = none;\n        /** @internal */\n        this._fullyNamed = false;\n        this.$initiator = null;\n        this.$resolve = void 0;\n        this.$reject = void 0;\n        this.$promise = void 0;\n        /** @internal */\n        this._activatingStack = 0;\n        /** @internal */\n        this._detachingStack = 0;\n        /** @internal */\n        this._unbindingStack = 0;\n        this._vm = viewModel;\n        this._vmHooks = vmKind === vmkSynth ? HooksDefinition.none : new HooksDefinition(viewModel);\n        {\n            this.logger = null;\n            this.debug = false;\n        }\n        this.location = location;\n        this._rendering = container.root.get(IRendering);\n    }\n    static getCached(viewModel) {\n        return controllerLookup.get(viewModel);\n    }\n    static getCachedOrThrow(viewModel) {\n        const $el = Controller.getCached(viewModel);\n        if ($el === void 0) {\n            throw createMappedError(500 /* ErrorNames.controller_cached_not_found */, viewModel);\n        }\n        return $el;\n    }\n    /**\n     * Create a controller for a custom element based on a given set of parameters\n     *\n     * @param ctn - The own container of the custom element\n     * @param viewModel - The view model object (can be any object if a definition is specified)\n     *\n     * Semi private API\n     */\n    static $el(ctn, viewModel, host, hydrationInst, \n    // Use this when `instance.constructor` is not a custom element type\n    // to pass on the CustomElement definition\n    definition = void 0, \n    // the associated render location of the host\n    // if the element is containerless\n    location = null) {\n        if (controllerLookup.has(viewModel)) {\n            return controllerLookup.get(viewModel);\n        }\n        {\n            if (definition == null) {\n                try {\n                    definition = getElementDefinition(viewModel.constructor);\n                }\n                catch (ex) {\n                    // eslint-disable-next-line\n                    console.error(`[DEV:aurelia] Custom element definition not found for creating a controller with host: <${host.nodeName} /> and component ${viewModel.constructor.name || '(Anonymous) class'}`);\n                    throw ex;\n                }\n            }\n        }\n        registerResolver(ctn, definition.Type, new InstanceProvider(definition.key, viewModel, definition.Type));\n        const controller = new Controller(\n        /* container      */ ctn, \n        /* vmKind         */ vmkCe, \n        /* definition     */ definition, \n        /* viewFactory    */ null, \n        /* viewModel      */ viewModel, \n        /* host           */ host, \n        /* location       */ location);\n        // the hydration context this controller is provided with\n        const hydrationContext = ctn.get(optional(IHydrationContext));\n        if (definition.dependencies.length > 0) {\n            ctn.register(...definition.dependencies);\n        }\n        // each CE controller provides its own hydration context for its internal template\n        registerResolver(ctn, IHydrationContext, new InstanceProvider('IHydrationContext', new HydrationContext(controller, hydrationInst, hydrationContext)));\n        controllerLookup.set(viewModel, controller);\n        if (hydrationInst == null || hydrationInst.hydrate !== false) {\n            controller._hydrateCustomElement(hydrationInst);\n        }\n        return controller;\n    }\n    /**\n     * Create a controller for a custom attribute based on a given set of parameters\n     *\n     * @param ctn - own container associated with the custom attribute object\n     * @param viewModel - the view model object\n     * @param host - host element where this custom attribute is used\n     * @param flags - todo(comment)\n     * @param definition - the definition of the custom attribute,\n     * will be used to override the definition associated with the view model object contructor if given\n     */\n    static $attr(ctn, viewModel, host, \n    /**\n     * The definition that will be used to hydrate the custom attribute view model\n     *\n     * If not given, will be the one associated with the constructor of the attribute view model given.\n     */\n    definition) {\n        if (controllerLookup.has(viewModel)) {\n            return controllerLookup.get(viewModel);\n        }\n        definition = definition ?? getAttributeDefinition(viewModel.constructor);\n        registerResolver(ctn, definition.Type, new InstanceProvider(definition.key, viewModel, definition.Type));\n        const controller = new Controller(\n        /* own ct         */ ctn, \n        /* vmKind         */ vmkCa, \n        /* definition     */ definition, \n        /* viewFactory    */ null, \n        /* viewModel      */ viewModel, \n        /* host           */ host, \n        /* location       */ null);\n        if (definition.dependencies.length > 0) {\n            ctn.register(...definition.dependencies);\n        }\n        controllerLookup.set(viewModel, controller);\n        controller._hydrateCustomAttribute();\n        return controller;\n    }\n    /**\n     * Create a synthetic view (controller) for a given factory\n     *\n     * @param viewFactory - todo(comment)\n     * @param flags - todo(comment)\n     * @param parentController - the parent controller to connect the created view with. Used in activation\n     *\n     * Semi private API\n     */\n    static $view(viewFactory, parentController = void 0) {\n        const controller = new Controller(\n        /* container      */ viewFactory.container, \n        /* vmKind         */ vmkSynth, \n        /* definition     */ null, \n        /* viewFactory    */ viewFactory, \n        /* viewModel      */ null, \n        /* host           */ null, \n        /* location       */ null);\n        controller.parent = parentController ?? null;\n        controller._hydrateSynthetic();\n        return controller;\n    }\n    /** @internal */\n    _hydrateCustomElement(hydrationInst) {\n        {\n            this.logger = this.container.get(ILogger).root;\n            this.debug = this.logger.config.level <= LogLevel.debug;\n            if (this.debug) {\n                this.logger = this.logger.scopeTo(this.name);\n            }\n        }\n        const container = this.container;\n        const instance = this._vm;\n        const definition = this.definition;\n        this.scope = Scope.create(instance, null, true);\n        if (definition.watches.length > 0) {\n            createWatchers(this, container, definition, instance);\n        }\n        createObservers(this, definition, instance);\n        this._lifecycleHooks = LifecycleHooks.resolve(container);\n        // Support Recursive Components by adding self to own context\n        container.register(definition.Type);\n        // definition.register(container);\n        if (definition.injectable !== null) {\n            registerResolver(container, definition.injectable, new InstanceProvider('definition.injectable', instance));\n        }\n        // If this is the root controller, then the AppRoot will invoke things in the following order:\n        // - Controller.hydrateCustomElement\n        // - runAppTasks('hydrating') // may return a promise\n        // - Controller.compile\n        // - runAppTasks('hydrated') // may return a promise\n        // - Controller.compileChildren\n        // This keeps hydration synchronous while still allowing the composition root compile hooks to do async work.\n        if (hydrationInst == null || hydrationInst.hydrate !== false) {\n            this._hydrate();\n            this._hydrateChildren();\n        }\n    }\n    /** @internal */\n    _hydrate() {\n        if (this._lifecycleHooks.hydrating != null) {\n            this._lifecycleHooks.hydrating.forEach(callHydratingHook, this);\n        }\n        if (this._vmHooks._hydrating) {\n            /* istanbul ignore next */\n            if (this.debug) {\n                this.logger.trace(`invoking hydrating() hook`);\n            }\n            this._vm.hydrating(this);\n        }\n        const definition = this.definition;\n        const compiledDef = this._compiledDef = this._rendering.compile(definition, this.container);\n        const shadowOptions = compiledDef.shadowOptions;\n        const hasSlots = compiledDef.hasSlots;\n        const containerless = compiledDef.containerless;\n        const host = this.host;\n        let location = this.location;\n        if (containerless && location == null) {\n            location = this.location = convertToRenderLocation(host);\n        }\n        setRef(host, elementBaseName, this);\n        setRef(host, definition.key, this);\n        if (shadowOptions !== null || hasSlots) {\n            if (location != null) {\n                throw createMappedError(501 /* ErrorNames.controller_no_shadow_on_containerless */);\n            }\n            setRef(this.shadowRoot = host.attachShadow(shadowOptions ?? defaultShadowOptions), elementBaseName, this);\n            setRef(this.shadowRoot, definition.key, this);\n            this.mountTarget = targetShadowRoot;\n        }\n        else if (location != null) {\n            // when template compiler encounter a \"containerless\" attribute\n            // it replaces the element with a render location\n            // making the controller receive the same comment node as both host and location\n            // todo: consider making template compiler less eager to replace\n            //       this has performance implication when using ad-hoc containerless\n            if (host !== location) {\n                setRef(location, elementBaseName, this);\n                setRef(location, definition.key, this);\n            }\n            this.mountTarget = targetLocation;\n        }\n        else {\n            this.mountTarget = targetHost;\n        }\n        this._vm.$controller = this;\n        this.nodes = this._rendering.createNodes(compiledDef);\n        if (this._lifecycleHooks.hydrated !== void 0) {\n            this._lifecycleHooks.hydrated.forEach(callHydratedHook, this);\n        }\n        if (this._vmHooks._hydrated) {\n            /* istanbul ignore next */\n            if (this.debug) {\n                this.logger.trace(`invoking hydrated() hook`);\n            }\n            this._vm.hydrated(this);\n        }\n    }\n    /** @internal */\n    _hydrateChildren() {\n        this._rendering.render(\n        /* controller */ this, \n        /* targets    */ this.nodes.findTargets(), \n        /* definition */ this._compiledDef, \n        /* host       */ this.host);\n        if (this._lifecycleHooks.created !== void 0) {\n            this._lifecycleHooks.created.forEach(callCreatedHook, this);\n        }\n        if (this._vmHooks._created) {\n            /* istanbul ignore next */\n            if (this.debug) {\n                this.logger.trace(`invoking created() hook`);\n            }\n            this._vm.created(this);\n        }\n    }\n    /** @internal */\n    _hydrateCustomAttribute() {\n        const definition = this.definition;\n        const instance = this._vm;\n        if (definition.watches.length > 0) {\n            createWatchers(this, this.container, definition, instance);\n        }\n        createObservers(this, definition, instance);\n        instance.$controller = this;\n        this._lifecycleHooks = LifecycleHooks.resolve(this.container);\n        if (this._lifecycleHooks.created !== void 0) {\n            this._lifecycleHooks.created.forEach(callCreatedHook, this);\n        }\n        if (this._vmHooks._created) {\n            /* istanbul ignore next */\n            if (this.debug) {\n                this.logger.trace(`invoking created() hook`);\n            }\n            this._vm.created(this);\n        }\n    }\n    /** @internal */\n    _hydrateSynthetic() {\n        this._compiledDef = this._rendering.compile(this.viewFactory.def, this.container);\n        this._rendering.render(\n        /* controller */ this, \n        /* targets    */ (this.nodes = this._rendering.createNodes(this._compiledDef)).findTargets(), \n        /* definition */ this._compiledDef, \n        /* host       */ void 0);\n    }\n    activate(initiator, parent, scope) {\n        switch (this.state) {\n            case none:\n            case deactivated:\n                if (!(parent === null || parent.isActive)) {\n                    // If this is not the root, and the parent is either:\n                    // 1. Not activated, or activating children OR\n                    // 2. Deactivating itself\n                    // abort.\n                    return;\n                }\n                // Otherwise, proceed normally.\n                // 'deactivated' and 'none' are treated the same because, from an activation perspective, they mean the same thing.\n                this.state = activating;\n                break;\n            case activated:\n                // If we're already activated, no need to do anything.\n                return;\n            case disposed:\n                throw createMappedError(502 /* ErrorNames.controller_activating_disposed */, this.name);\n            default:\n                throw createMappedError(503 /* ErrorNames.controller_activation_unexpected_state */, this.name, stringifyState(this.state));\n        }\n        this.parent = parent;\n        if (this.debug && !this._fullyNamed) {\n            this._fullyNamed = true;\n            (this.logger ??= this.container.get(ILogger).root.scopeTo(this.name)).trace(`activate()`);\n        }\n        switch (this.vmKind) {\n            case vmkCe:\n                // Custom element scope is created and assigned during hydration\n                this.scope.parent = scope ?? null;\n                break;\n            case vmkCa:\n                this.scope = scope ?? null;\n                break;\n            case vmkSynth:\n                // maybe only check when there's not already a scope\n                if (scope === void 0 || scope === null) {\n                    throw createMappedError(504 /* ErrorNames.controller_activation_synthetic_no_scope */, this.name);\n                }\n                if (!this.hasLockedScope) {\n                    this.scope = scope;\n                }\n                break;\n        }\n        this.$initiator = initiator;\n        // opposing leave is called in attach() (which will trigger attached())\n        this._enterActivating();\n        let ret = void 0;\n        if (this.vmKind !== vmkSynth && this._lifecycleHooks.binding != null) {\n            /* istanbul ignore next */\n            if (this.debug) {\n                this.logger.trace(`lifecycleHooks.binding()`);\n            }\n            ret = onResolveAll(...this._lifecycleHooks.binding.map(callBindingHook, this));\n        }\n        if (this._vmHooks._binding) {\n            /* istanbul ignore next */\n            if (this.debug) {\n                this.logger.trace(`binding()`);\n            }\n            ret = onResolveAll(ret, this._vm.binding(this.$initiator, this.parent));\n        }\n        if (isPromise(ret)) {\n            this._ensurePromise();\n            ret.then(() => {\n                this._isBindingDone = true;\n                if (this.state !== activating) {\n                    // because controller can be deactivated, during a long running promise in the binding phase\n                    this._leaveActivating();\n                }\n                else {\n                    this.bind();\n                }\n            }).catch((err) => {\n                this._reject(err);\n            });\n            return this.$promise;\n        }\n        this._isBindingDone = true;\n        this.bind();\n        return this.$promise;\n    }\n    bind() {\n        /* istanbul ignore next */\n        if (this.debug) {\n            this.logger.trace(`bind()`);\n        }\n        let i = 0;\n        let ii = 0;\n        let ret = void 0;\n        if (this.bindings !== null) {\n            i = 0;\n            ii = this.bindings.length;\n            while (ii > i) {\n                this.bindings[i].bind(this.scope);\n                ++i;\n            }\n        }\n        if (this.vmKind !== vmkSynth && this._lifecycleHooks.bound != null) {\n            /* istanbul ignore next */\n            if (this.debug) {\n                this.logger.trace(`lifecycleHooks.bound()`);\n            }\n            ret = onResolveAll(...this._lifecycleHooks.bound.map(callBoundHook, this));\n        }\n        if (this._vmHooks._bound) {\n            /* istanbul ignore next */\n            if (this.debug) {\n                this.logger.trace(`bound()`);\n            }\n            ret = onResolveAll(ret, this._vm.bound(this.$initiator, this.parent));\n        }\n        if (isPromise(ret)) {\n            this._ensurePromise();\n            ret.then(() => {\n                this.isBound = true;\n                // because controller can be deactivated, during a long running promise in the bound phase\n                if (this.state !== activating) {\n                    this._leaveActivating();\n                }\n                else {\n                    this._attach();\n                }\n            }).catch((err) => {\n                this._reject(err);\n            });\n            return;\n        }\n        this.isBound = true;\n        this._attach();\n    }\n    /** @internal */\n    _append(...nodes) {\n        switch (this.mountTarget) {\n            case targetHost:\n                this.host.append(...nodes);\n                break;\n            case targetShadowRoot:\n                this.shadowRoot.append(...nodes);\n                break;\n            case targetLocation: {\n                let i = 0;\n                for (; i < nodes.length; ++i) {\n                    this.location.parentNode.insertBefore(nodes[i], this.location);\n                }\n                break;\n            }\n        }\n    }\n    /** @internal */\n    _attach() {\n        /* istanbul ignore next */\n        if (this.debug) {\n            this.logger.trace(`attach()`);\n        }\n        switch (this.mountTarget) {\n            case targetHost:\n                this.nodes.appendTo(this.host, this.definition != null && this.definition.enhance);\n                break;\n            case targetShadowRoot: {\n                const container = this.container;\n                const styles = container.has(IShadowDOMStyles, false)\n                    ? container.get(IShadowDOMStyles)\n                    : container.get(IShadowDOMGlobalStyles);\n                styles.applyTo(this.shadowRoot);\n                this.nodes.appendTo(this.shadowRoot);\n                break;\n            }\n            case targetLocation:\n                this.nodes.insertBefore(this.location);\n                break;\n        }\n        let i = 0;\n        let ret = void 0;\n        if (this.vmKind !== vmkSynth && this._lifecycleHooks.attaching != null) {\n            /* istanbul ignore next */\n            if (this.debug) {\n                this.logger.trace(`lifecycleHooks.attaching()`);\n            }\n            ret = onResolveAll(...this._lifecycleHooks.attaching.map(callAttachingHook, this));\n        }\n        if (this._vmHooks._attaching) {\n            /* istanbul ignore next */\n            if (this.debug) {\n                this.logger.trace(`attaching()`);\n            }\n            ret = onResolveAll(ret, this._vm.attaching(this.$initiator, this.parent));\n        }\n        if (isPromise(ret)) {\n            this._ensurePromise();\n            this._enterActivating();\n            ret.then(() => {\n                this._leaveActivating();\n            }).catch((err) => {\n                this._reject(err);\n            });\n        }\n        // attaching() and child activation run in parallel, and attached() is called when both are finished\n        if (this.children !== null) {\n            for (; i < this.children.length; ++i) {\n                // Any promises returned from child activation are cumulatively awaited before this.$promise resolves\n                void this.children[i].activate(this.$initiator, this, this.scope);\n            }\n        }\n        // attached() is invoked by Controller#leaveActivating when `activatingStack` reaches 0\n        this._leaveActivating();\n    }\n    deactivate(initiator, _parent) {\n        let prevActivation = void 0;\n        switch ((this.state & ~released)) {\n            case activated:\n                this.state = deactivating;\n                break;\n            case activating:\n                this.state = deactivating;\n                // we are about to deactivate, the error from activation can be ignored\n                prevActivation = this.$promise?.catch(err => {\n                        this.logger.warn('The activation error will be ignored, as the controller is already scheduled for deactivation. The activation was rejected with: %s', err);\n                    }\n                    );\n                break;\n            case none:\n            case deactivated:\n            case disposed:\n            case deactivated | disposed:\n                // If we're already deactivated (or even disposed), or never activated in the first place, no need to do anything.\n                return;\n            default:\n                throw createMappedError(505 /* ErrorNames.controller_deactivation_unexpected_state */, this.name, this.state);\n        }\n        /* istanbul-ignore-next */\n        if (this.debug) {\n            this.logger.trace(`deactivate()`);\n        }\n        this.$initiator = initiator;\n        if (initiator === this) {\n            this._enterDetaching();\n        }\n        let i = 0;\n        let ret;\n        if (this.children !== null) {\n            for (i = 0; i < this.children.length; ++i) {\n                // Child promise results are tracked by enter/leave combo's\n                void this.children[i].deactivate(initiator, this);\n            }\n        }\n        return onResolve(prevActivation, () => {\n            if (this.isBound) {\n                if (this.vmKind !== vmkSynth && this._lifecycleHooks.detaching != null) {\n                    if (this.debug) {\n                        this.logger.trace(`lifecycleHooks.detaching()`);\n                    }\n                    ret = onResolveAll(...this._lifecycleHooks.detaching.map(callDetachingHook, this));\n                }\n                if (this._vmHooks._detaching) {\n                    if (this.debug) {\n                        this.logger.trace(`detaching()`);\n                    }\n                    ret = onResolveAll(ret, this._vm.detaching(this.$initiator, this.parent));\n                }\n            }\n            if (isPromise(ret)) {\n                this._ensurePromise();\n                initiator._enterDetaching();\n                ret.then(() => {\n                    initiator._leaveDetaching();\n                }).catch((err) => {\n                    initiator._reject(err);\n                });\n            }\n            // Note: if a 3rd party plugin happens to do any async stuff in a template controller before calling deactivate on its view,\n            // then the linking will become out of order.\n            // For framework components, this shouldn't cause issues.\n            // We can only prevent that by linking up after awaiting the detaching promise, which would add an extra tick + a fair bit of\n            // overhead on this hot path, so it's (for now) a deliberate choice to not account for such situation.\n            // Just leaving the note here so that we know to look here if a weird detaching-related timing issue is ever reported.\n            if (initiator.head === null) {\n                initiator.head = this;\n            }\n            else {\n                initiator.tail.next = this;\n            }\n            initiator.tail = this;\n            if (initiator !== this) {\n                // Only detaching is called + the linked list is built when any controller that is not the initiator, is deactivated.\n                // The rest is handled by the initiator.\n                // This means that descendant controllers have to make sure to await the initiator's promise before doing any subsequent\n                // controller api calls, or race conditions might occur.\n                return;\n            }\n            this._leaveDetaching();\n            return this.$promise;\n        });\n    }\n    removeNodes() {\n        switch (this.vmKind) {\n            case vmkCe:\n            case vmkSynth:\n                this.nodes.remove();\n                this.nodes.unlink();\n        }\n    }\n    unbind() {\n        /* istanbul ignore next */\n        if (this.debug) {\n            this.logger.trace(`unbind()`);\n        }\n        let i = 0;\n        if (this.bindings !== null) {\n            for (; i < this.bindings.length; ++i) {\n                this.bindings[i].unbind();\n            }\n        }\n        this.parent = null;\n        switch (this.vmKind) {\n            case vmkCa:\n                this.scope = null;\n                break;\n            case vmkSynth:\n                if (!this.hasLockedScope) {\n                    this.scope = null;\n                }\n                if ((this.state & released) === released &&\n                    !this.viewFactory.tryReturnToCache(this) &&\n                    this.$initiator === this) {\n                    this.dispose();\n                }\n                break;\n            case vmkCe:\n                this.scope.parent = null;\n                break;\n        }\n        this.state = deactivated;\n        this.$initiator = null;\n        this._resolve();\n    }\n    /** @internal */\n    _ensurePromise() {\n        if (this.$promise === void 0) {\n            this.$promise = new Promise((resolve, reject) => {\n                this.$resolve = resolve;\n                this.$reject = reject;\n            });\n            if (this.$initiator !== this) {\n                this.parent._ensurePromise();\n            }\n        }\n    }\n    /** @internal */\n    _resolve() {\n        if (this.$promise !== void 0) {\n            _resolve = this.$resolve;\n            this.$resolve = this.$reject = this.$promise = void 0;\n            _resolve();\n            _resolve = void 0;\n        }\n    }\n    /** @internal */\n    _reject(err) {\n        if (this.$promise !== void 0) {\n            _reject = this.$reject;\n            this.$resolve = this.$reject = this.$promise = void 0;\n            _reject(err);\n            _reject = void 0;\n        }\n        if (this.$initiator !== this) {\n            this.parent._reject(err);\n        }\n    }\n    /** @internal */\n    _enterActivating() {\n        ++this._activatingStack;\n        if (this.$initiator !== this) {\n            this.parent._enterActivating();\n        }\n    }\n    /** @internal */\n    _leaveActivating() {\n        if (this.state !== activating) {\n            --this._activatingStack;\n            // skip doing rest of the work if the controller is deactivated.\n            this._resolve();\n            if (this.$initiator !== this) {\n                this.parent._leaveActivating();\n            }\n            return;\n        }\n        if (--this._activatingStack === 0) {\n            if (this.vmKind !== vmkSynth && this._lifecycleHooks.attached != null) {\n                _retPromise = onResolveAll(...this._lifecycleHooks.attached.map(callAttachedHook, this));\n            }\n            if (this._vmHooks._attached) {\n                /* istanbul ignore next */\n                if (this.debug) {\n                    this.logger.trace(`attached()`);\n                }\n                _retPromise = onResolveAll(_retPromise, this._vm.attached(this.$initiator));\n            }\n            if (isPromise(_retPromise)) {\n                this._ensurePromise();\n                _retPromise.then(() => {\n                    this.state = activated;\n                    // Resolve this.$promise, signaling that activation is done (path 1 of 2)\n                    this._resolve();\n                    if (this.$initiator !== this) {\n                        this.parent._leaveActivating();\n                    }\n                }).catch((err) => {\n                    this._reject(err);\n                });\n                _retPromise = void 0;\n                return;\n            }\n            _retPromise = void 0;\n            this.state = activated;\n            // Resolve this.$promise (if present), signaling that activation is done (path 2 of 2)\n            this._resolve();\n        }\n        if (this.$initiator !== this) {\n            this.parent._leaveActivating();\n        }\n    }\n    /** @internal */\n    _enterDetaching() {\n        ++this._detachingStack;\n    }\n    /** @internal */\n    _leaveDetaching() {\n        if (--this._detachingStack === 0) {\n            // Note: this controller is the initiator (detach is only ever called on the initiator)\n            /* istanbul ignore next */\n            if (this.debug) {\n                this.logger.trace(`detach()`);\n            }\n            this._enterUnbinding();\n            this.removeNodes();\n            let cur = this.$initiator.head;\n            let ret = void 0;\n            while (cur !== null) {\n                if (cur !== this) {\n                    /* istanbul ignore next */\n                    if (cur.debug) {\n                        cur.logger.trace(`detach()`);\n                    }\n                    cur.removeNodes();\n                }\n                if (cur._isBindingDone) {\n                    if (cur.vmKind !== vmkSynth && cur._lifecycleHooks.unbinding != null) {\n                        ret = onResolveAll(...cur._lifecycleHooks.unbinding.map(callUnbindingHook, cur));\n                    }\n                    if (cur._vmHooks._unbinding) {\n                        if (cur.debug) {\n                            cur.logger.trace('unbinding()');\n                        }\n                        ret = onResolveAll(ret, cur.viewModel.unbinding(cur.$initiator, cur.parent));\n                    }\n                }\n                if (isPromise(ret)) {\n                    this._ensurePromise();\n                    this._enterUnbinding();\n                    ret.then(() => {\n                        this._leaveUnbinding();\n                    }).catch((err) => {\n                        this._reject(err);\n                    });\n                }\n                ret = void 0;\n                cur = cur.next;\n            }\n            this._leaveUnbinding();\n        }\n    }\n    /** @internal */\n    _enterUnbinding() {\n        ++this._unbindingStack;\n    }\n    /** @internal */\n    _leaveUnbinding() {\n        if (--this._unbindingStack === 0) {\n            /* istanbul ignore next */\n            if (this.debug) {\n                this.logger.trace(`unbind()`);\n            }\n            let cur = this.$initiator.head;\n            let next = null;\n            while (cur !== null) {\n                if (cur !== this) {\n                    cur._isBindingDone = false;\n                    cur.isBound = false;\n                    cur.unbind();\n                }\n                next = cur.next;\n                cur.next = null;\n                cur = next;\n            }\n            this.head = this.tail = null;\n            this._isBindingDone = false;\n            this.isBound = false;\n            this.unbind();\n        }\n    }\n    addBinding(binding) {\n        if (this.bindings === null) {\n            this.bindings = [binding];\n        }\n        else {\n            this.bindings[this.bindings.length] = binding;\n        }\n    }\n    addChild(controller) {\n        if (this.children === null) {\n            this.children = [controller];\n        }\n        else {\n            this.children[this.children.length] = controller;\n        }\n    }\n    is(name) {\n        switch (this.vmKind) {\n            case vmkCa:\n            case vmkCe: {\n                return this.definition.name === name;\n            }\n            case vmkSynth:\n                return this.viewFactory.name === name;\n        }\n    }\n    lockScope(scope) {\n        this.scope = scope;\n        this.hasLockedScope = true;\n    }\n    setHost(host) {\n        if (this.vmKind === vmkCe) {\n            setRef(host, elementBaseName, this);\n            setRef(host, this.definition.key, this);\n        }\n        this.host = host;\n        this.mountTarget = targetHost;\n        return this;\n    }\n    setShadowRoot(shadowRoot) {\n        if (this.vmKind === vmkCe) {\n            setRef(shadowRoot, elementBaseName, this);\n            setRef(shadowRoot, this.definition.key, this);\n        }\n        this.shadowRoot = shadowRoot;\n        this.mountTarget = targetShadowRoot;\n        return this;\n    }\n    setLocation(location) {\n        if (this.vmKind === vmkCe) {\n            setRef(location, elementBaseName, this);\n            setRef(location, this.definition.key, this);\n        }\n        this.location = location;\n        this.mountTarget = targetLocation;\n        return this;\n    }\n    release() {\n        this.state |= released;\n    }\n    dispose() {\n        /* istanbul ignore next */\n        if (this.debug) {\n            this.logger.trace(`dispose()`);\n        }\n        if ((this.state & disposed) === disposed) {\n            return;\n        }\n        this.state |= disposed;\n        if (this._vmHooks._dispose) {\n            this._vm.dispose();\n        }\n        if (this.children !== null) {\n            this.children.forEach(callDispose);\n            this.children = null;\n        }\n        this.scope = null;\n        this.nodes = null;\n        this.location = null;\n        this.viewFactory = null;\n        if (this._vm !== null) {\n            controllerLookup.delete(this._vm);\n            this._vm = null;\n        }\n        this._vm = null;\n        this.host = null;\n        this.shadowRoot = null;\n        this.container.disposeResolvers();\n    }\n    accept(visitor) {\n        if (visitor(this) === true) {\n            return true;\n        }\n        if (this._vmHooks._accept && this._vm.accept(visitor) === true) {\n            return true;\n        }\n        if (this.children !== null) {\n            const { children } = this;\n            for (let i = 0, ii = children.length; i < ii; ++i) {\n                if (children[i].accept(visitor) === true) {\n                    return true;\n                }\n            }\n        }\n    }\n}\nconst controllerLookup = new WeakMap();\nconst targetNone = 0;\nconst targetHost = 1;\nconst targetShadowRoot = 2;\nconst targetLocation = 3;\n/**\n * Describes the type of the host node/location of a controller\n * - `none` / 1:       no host\n * - `host` / 2:       an HTML element is the host of a controller\n * - `shadowRoot` / 3: a shadow root is the host of a controller\n * - `location` / 4:   a render location is the location of a controller, this is often used for template controllers\n */\nconst MountTarget = objectFreeze({\n    none: targetNone,\n    host: targetHost,\n    shadowRoot: targetShadowRoot,\n    location: targetLocation,\n});\n// const optionalCeFind = { optional: true } as const;\nconst optionalCoercionConfigResolver = optionalResource(ICoercionConfiguration);\nfunction createObservers(controller, definition, instance) {\n    const bindables = definition.bindables;\n    const observableNames = getOwnPropertyNames(bindables);\n    const length = observableNames.length;\n    if (length === 0)\n        return;\n    const locator = controller.container.get(IObserverLocator);\n    const hasAggregatedCallbacks = 'propertiesChanged' in instance;\n    const coercion = controller.vmKind === vmkSynth\n        ? void 0\n        : controller.container.get(optionalCoercionConfigResolver);\n    const queueCallback = hasAggregatedCallbacks\n        ? (() => {\n            let changes = {};\n            let isQueued = false;\n            let changeCount = 0;\n            const callPropertiesChanged = () => {\n                if (!isQueued) {\n                    isQueued = true;\n                    queueTask(() => {\n                        isQueued = false;\n                        const $changes = changes;\n                        changes = {};\n                        changeCount = 0;\n                        if (controller.isBound) {\n                            instance.propertiesChanged?.($changes);\n                            if (changeCount > 0) {\n                                callPropertiesChanged();\n                            }\n                        }\n                    });\n                }\n            };\n            return (key, newValue, oldValue) => {\n                changes[key] = { newValue, oldValue };\n                changeCount++;\n                callPropertiesChanged();\n            };\n        })()\n        : noop;\n    for (let i = 0; i < length; ++i) {\n        const name = observableNames[i];\n        const bindable = bindables[name];\n        const handler = bindable.callback;\n        const obs = locator.getObserver(instance, name);\n        if (bindable.set !== noop) {\n            if (obs.useCoercer?.(bindable.set, coercion) !== true) {\n                throw createMappedError(507 /* ErrorNames.controller_property_not_coercible */, name);\n            }\n        }\n        if (instance[handler] != null\n            || instance.propertyChanged != null\n            || hasAggregatedCallbacks) {\n            const callback = (newValue, oldValue) => {\n                if (controller.isBound) {\n                    instance[handler]?.(newValue, oldValue);\n                    instance.propertyChanged?.(name, newValue, oldValue);\n                    queueCallback(name, newValue, oldValue);\n                }\n            };\n            if (obs.useCallback?.(callback) !== true) {\n                throw createMappedError(508 /* ErrorNames.controller_property_no_change_handler */, name);\n            }\n        }\n    }\n}\nconst AccessScopeAstMap = new Map();\nconst getAccessScopeAst = (key) => {\n    let ast = AccessScopeAstMap.get(key);\n    if (ast == null) {\n        ast = new AccessScopeExpression(key, 0);\n        AccessScopeAstMap.set(key, ast);\n    }\n    return ast;\n};\nfunction createWatchers(controller, context, definition, instance) {\n    const observerLocator = context.get(IObserverLocator);\n    const expressionParser = context.get(IExpressionParser);\n    const watches = definition.watches;\n    const scope = controller.vmKind === vmkCe\n        ? controller.scope\n        // custom attribute does not have own scope\n        : Scope.create(instance, null, true);\n    const ii = watches.length;\n    let expression;\n    let callback;\n    let ast;\n    let flush;\n    let i = 0;\n    for (; ii > i; ++i) {\n        ({ expression, callback, flush } = watches[i]);\n        callback = isFunction(callback)\n            ? callback\n            : Reflect.get(instance, callback);\n        if (!isFunction(callback)) {\n            throw createMappedError(506 /* ErrorNames.controller_watch_invalid_callback */, callback);\n        }\n        if (isFunction(expression)) {\n            controller.addBinding(new ComputedWatcher(instance, observerLocator, expression, callback, flush));\n        }\n        else {\n            ast = isString(expression)\n                ? expressionParser.parse(expression, etIsProperty)\n                : getAccessScopeAst(expression);\n            controller.addBinding(new ExpressionWatcher(scope, context, observerLocator, ast, callback, flush));\n        }\n    }\n}\nfunction isCustomElementController(value) {\n    return value instanceof Controller && value.vmKind === vmkCe;\n}\nfunction isCustomElementViewModel(value) {\n    return isElementType(value?.constructor);\n}\nclass HooksDefinition {\n    constructor(target) {\n        this._define = 'define' in target;\n        this._hydrating = 'hydrating' in target;\n        this._hydrated = 'hydrated' in target;\n        this._created = 'created' in target;\n        this._binding = 'binding' in target;\n        this._bound = 'bound' in target;\n        this._attaching = 'attaching' in target;\n        this._attached = 'attached' in target;\n        this._detaching = 'detaching' in target;\n        this._unbinding = 'unbinding' in target;\n        this._dispose = 'dispose' in target;\n        this._accept = 'accept' in target;\n    }\n}\nHooksDefinition.none = new HooksDefinition({});\nconst defaultShadowOptions = {\n    mode: 'open'\n};\n/** @internal */ const vmkCe = 'customElement';\n/** @internal */ const vmkCa = 'customAttribute';\nconst vmkSynth = 'synthetic';\n/** @internal */ const none = 0b00_00_00;\n/** @internal */ const activating = 0b00_00_01;\n/** @internal */ const activated = 0b00_00_10;\n/** @internal */ const deactivating = 0b00_01_00;\n/** @internal */ const deactivated = 0b00_10_00;\n/** @internal */ const released = 0b01_00_00;\n/** @internal */ const disposed = 0b10_00_00;\nconst State = /*@__PURE__*/ objectFreeze({\n    none,\n    activating,\n    activated,\n    deactivating,\n    deactivated,\n    released,\n    disposed,\n});\nfunction stringifyState(state) {\n    const names = [];\n    if ((state & activating) === activating) {\n        names.push('activating');\n    }\n    if ((state & activated) === activated) {\n        names.push('activated');\n    }\n    if ((state & deactivating) === deactivating) {\n        names.push('deactivating');\n    }\n    if ((state & deactivated) === deactivated) {\n        names.push('deactivated');\n    }\n    if ((state & released) === released) {\n        names.push('released');\n    }\n    if ((state & disposed) === disposed) {\n        names.push('disposed');\n    }\n    return names.length === 0 ? 'none' : names.join('|');\n}\nconst IController = /*@__PURE__*/ createInterface('IController');\nconst IHydrationContext = /*@__PURE__*/ createInterface('IHydrationContext');\n/** @internal */\nclass HydrationContext {\n    constructor(controller, instruction, parent) {\n        this.instruction = instruction;\n        this.parent = parent;\n        this.controller = controller;\n    }\n}\nfunction callDispose(disposable) {\n    disposable.dispose();\n}\nfunction callCreatedHook(l) {\n    l.instance.created(this._vm, this);\n}\nfunction callHydratingHook(l) {\n    l.instance.hydrating(this._vm, this);\n}\nfunction callHydratedHook(l) {\n    l.instance.hydrated(this._vm, this);\n}\nfunction callBindingHook(l) {\n    return l.instance.binding(this._vm, this['$initiator'], this.parent);\n}\nfunction callBoundHook(l) {\n    return l.instance.bound(this._vm, this['$initiator'], this.parent);\n}\nfunction callAttachingHook(l) {\n    return l.instance.attaching(this._vm, this['$initiator'], this.parent);\n}\nfunction callAttachedHook(l) {\n    return l.instance.attached(this._vm, this['$initiator']);\n}\nfunction callDetachingHook(l) {\n    return l.instance.detaching(this._vm, this['$initiator'], this.parent);\n}\nfunction callUnbindingHook(l) {\n    return l.instance.unbinding(this._vm, this['$initiator'], this.parent);\n}\n// some reuseable variables to avoid creating nested blocks inside hot paths of controllers\nlet _resolve;\nlet _reject;\nlet _retPromise;\nconst setRef = refs.set;\n\nconst IEventTarget = /*@__PURE__*/ createInterface('IEventTarget', x => x.cachedCallback(handler => {\n    if (handler.has(IAppRoot, true)) {\n        return handler.get(IAppRoot).host;\n    }\n    return handler.get(IPlatform).document;\n}));\n/**\n * An interface describing a marker.\n * Components can use this to anchor where their content should be rendered in place of a host element.\n */\nconst IRenderLocation = /*@__PURE__*/ createInterface('IRenderLocation');\n/** @internal */\nconst ICssClassMapping = /*@__PURE__*/ createInterface('ICssClassMapping');\n\nconst effectiveParentNodeOverrides = new WeakMap();\n/**\n * Returns the effective parentNode according to Aurelia's component hierarchy.\n *\n * Used by Aurelia to find the closest parent controller relative to a node.\n *\n * This method supports 3 additional scenarios that `node.parentNode` does not support:\n * - Containerless elements. The parentNode in this case is a comment precending the element under specific conditions, rather than a node wrapping the element.\n * - ShadowDOM. If a `ShadowRoot` is encountered, this method retrieves the associated controller via the metadata api to locate the original host.\n * - Portals. If the provided node was moved to a different location in the DOM by a `portal` attribute, then the original parent of the node will be returned.\n *\n * @param node - The node to get the parent for.\n * @returns Either the closest parent node, the closest `IRenderLocation` (comment node that is the containerless host), original portal host, or `null` if this is either the absolute document root or a disconnected node.\n */\nfunction getEffectiveParentNode(node) {\n    // TODO: this method needs more tests!\n    // First look for any overrides\n    if (effectiveParentNodeOverrides.has(node)) {\n        return effectiveParentNodeOverrides.get(node);\n    }\n    // Then try to get the nearest au-start render location, which would be the containerless parent,\n    // again looking for any overrides along the way.\n    // otherwise return the normal parent node\n    let containerlessOffset = 0;\n    let next = node.nextSibling;\n    while (next !== null) {\n        if (next.nodeType === 8 /* NodeType.Comment */) {\n            switch (next.textContent) {\n                case 'au-start':\n                    // If we see an au-start before we see au-end, it will precede the host of a sibling containerless element rather than a parent.\n                    // So we use the offset to ignore the next au-end\n                    ++containerlessOffset;\n                    break;\n                case 'au-end':\n                    if (containerlessOffset-- === 0) {\n                        return next;\n                    }\n            }\n        }\n        next = next.nextSibling;\n    }\n    if (node.parentNode === null && node.nodeType === 11 /* NodeType.DocumentFragment */) {\n        // Could be a shadow root; see if there's a controller and if so, get the original host via the projector\n        const controller = findElementControllerFor(node, { optional: true });\n        if (controller == null) {\n            // Not a shadow root (or at least, not one created by Aurelia)\n            // Nothing more we can try, just return null\n            return null;\n        }\n        if (controller.mountTarget === MountTarget.shadowRoot) {\n            return getEffectiveParentNode(controller.host);\n        }\n    }\n    return node.parentNode;\n}\nfunction setEffectiveParentNode(childNodeOrNodeSequence, parentNode) {\n    if (childNodeOrNodeSequence.platform !== void 0 && !(childNodeOrNodeSequence instanceof childNodeOrNodeSequence.platform.Node)) {\n        const nodes = childNodeOrNodeSequence.childNodes;\n        for (let i = 0, ii = nodes.length; i < ii; ++i) {\n            effectiveParentNodeOverrides.set(nodes[i], parentNode);\n        }\n    }\n    else {\n        effectiveParentNodeOverrides.set(childNodeOrNodeSequence, parentNode);\n    }\n}\nfunction convertToRenderLocation(node) {\n    if (isRenderLocation(node)) {\n        return node; // it's already a IRenderLocation (converted by FragmentNodeSequence)\n    }\n    const locationEnd = node.ownerDocument.createComment('au-end');\n    const locationStart = locationEnd.$start = node.ownerDocument.createComment('au-start');\n    const parentNode = node.parentNode;\n    if (parentNode !== null) {\n        parentNode.replaceChild(locationEnd, node);\n        parentNode.insertBefore(locationStart, locationEnd);\n    }\n    return locationEnd;\n}\nfunction isRenderLocation(node) {\n    return node.textContent === 'au-end';\n}\nclass FragmentNodeSequence {\n    get firstChild() {\n        return this._firstChild;\n    }\n    get lastChild() {\n        return this._lastChild;\n    }\n    constructor(platform, fragment) {\n        this.platform = platform;\n        this.next = void 0;\n        /** @internal */\n        this._isMounted = false;\n        /** @internal */\n        this._isLinked = false;\n        /** @internal */\n        this.ref = null;\n        const targetNodeList = (this.f = fragment).querySelectorAll('au-m');\n        let i = 0;\n        let ii = targetNodeList.length;\n        // eslint-disable-next-line\n        let targets = this.t = Array(ii);\n        let target;\n        let marker;\n        while (ii > i) {\n            marker = targetNodeList[i];\n            target = marker.nextSibling;\n            marker.remove();\n            if (target.nodeType === 8) {\n                marker = target;\n                (target = target.nextSibling).$start = marker;\n            }\n            targets[i] = target;\n            ++i;\n        }\n        const childNodeList = fragment.childNodes;\n        const childNodes = this.childNodes = Array(ii = childNodeList.length);\n        i = 0;\n        while (ii > i) {\n            childNodes[i] = childNodeList[i];\n            ++i;\n        }\n        this._firstChild = fragment.firstChild;\n        this._lastChild = fragment.lastChild;\n    }\n    findTargets() {\n        return this.t;\n    }\n    insertBefore(refNode) {\n        if (this._isLinked && !!this.ref) {\n            this.addToLinked();\n        }\n        else {\n            const parent = refNode.parentNode;\n            if (this._isMounted) {\n                let current = this._firstChild;\n                let next;\n                const end = this._lastChild;\n                while (current != null) {\n                    next = current.nextSibling;\n                    parent.insertBefore(current, refNode);\n                    if (current === end) {\n                        break;\n                    }\n                    current = next;\n                }\n            }\n            else {\n                this._isMounted = true;\n                refNode.parentNode.insertBefore(this.f, refNode);\n            }\n        }\n    }\n    appendTo(parent, enhance = false) {\n        if (this._isMounted) {\n            let current = this._firstChild;\n            let next;\n            const end = this._lastChild;\n            while (current != null) {\n                next = current.nextSibling;\n                parent.appendChild(current);\n                if (current === end) {\n                    break;\n                }\n                current = next;\n            }\n        }\n        else {\n            this._isMounted = true;\n            if (!enhance) {\n                parent.appendChild(this.f);\n            }\n        }\n    }\n    remove() {\n        if (this._isMounted) {\n            this._isMounted = false;\n            const fragment = this.f;\n            const end = this._lastChild;\n            let next;\n            let current = this._firstChild;\n            while (current !== null) {\n                next = current.nextSibling;\n                fragment.appendChild(current);\n                if (current === end) {\n                    break;\n                }\n                current = next;\n            }\n        }\n    }\n    addToLinked() {\n        const refNode = this.ref;\n        const parent = refNode.parentNode;\n        if (this._isMounted) {\n            let current = this._firstChild;\n            let next;\n            const end = this._lastChild;\n            while (current != null) {\n                next = current.nextSibling;\n                parent.insertBefore(current, refNode);\n                if (current === end) {\n                    break;\n                }\n                current = next;\n            }\n        }\n        else {\n            this._isMounted = true;\n            parent.insertBefore(this.f, refNode);\n        }\n    }\n    unlink() {\n        this._isLinked = false;\n        this.next = void 0;\n        this.ref = void 0;\n    }\n    link(next) {\n        this._isLinked = true;\n        if (isRenderLocation(next)) {\n            this.ref = next;\n        }\n        else {\n            this.next = next;\n            this._obtainRefNode();\n        }\n    }\n    /** @internal */\n    _obtainRefNode() {\n        if (this.next !== void 0) {\n            this.ref = this.next.firstChild;\n        }\n        else {\n            this.ref = void 0;\n        }\n    }\n}\nconst IWindow = /*@__PURE__*/ createInterface('IWindow', x => x.callback(handler => handler.get(IPlatform).window));\nconst ILocation = /*@__PURE__*/ createInterface('ILocation', x => x.callback(handler => handler.get(IWindow).location));\nconst IHistory = /*@__PURE__*/ createInterface('IHistory', x => x.callback(handler => handler.get(IWindow).history));\n/**\n * An utility to register a host node with the container with all the commonly used keys.\n */\nconst registerHostNode = (container, host, platform = container.get(IPlatform)) => {\n    registerResolver(container, platform.HTMLElement, registerResolver(container, platform.Element, registerResolver(container, INode, new InstanceProvider('ElementResolver', host))));\n    return container;\n};\n\nfunction customElement(nameOrDef) {\n    return function (target, context) {\n        context.addInitializer(function () {\n            defineElement(nameOrDef, this);\n        });\n        return target;\n    };\n}\nfunction useShadowDOM(targetOrOptions, context) {\n    if (targetOrOptions === void 0) {\n        return function ($target, context) {\n            context.addInitializer(function () {\n                annotateElementMetadata(this, 'shadowOptions', { mode: 'open' });\n            });\n        };\n    }\n    if (!isFunction(targetOrOptions)) {\n        return function ($target, context) {\n            context.addInitializer(function () {\n                annotateElementMetadata(this, 'shadowOptions', targetOrOptions);\n            });\n        };\n    }\n    context.addInitializer(function () {\n        annotateElementMetadata(this, 'shadowOptions', { mode: 'open' });\n    });\n}\nfunction containerless(target, context) {\n    if (target === void 0) {\n        return function ($target, $context) {\n            $context.addInitializer(function () {\n                markContainerless($target);\n            });\n        };\n    }\n    context.addInitializer(function () {\n        markContainerless(target);\n    });\n}\n/** Manipulates the `containerless` property of the custom element definition for the type, when present else it annotates the type. */\nfunction markContainerless(target) {\n    const def = getMetadata(elementBaseName, target);\n    if (def === void 0) {\n        annotateElementMetadata(target, 'containerless', true);\n        return;\n    }\n    def.containerless = true;\n}\nconst definitionLookup = new WeakMap();\nclass CustomElementDefinition {\n    get type() { return dtElement; }\n    constructor(Type, name, aliases, key, capture, template, instructions, dependencies, injectable, needsCompile, surrogates, bindables, containerless, shadowOptions, \n    /**\n     * Indicates whether the custom element has <slot/> in its template\n     */\n    hasSlots, enhance, watches, strict, processContent) {\n        this.Type = Type;\n        this.name = name;\n        this.aliases = aliases;\n        this.key = key;\n        this.capture = capture;\n        this.template = template;\n        this.instructions = instructions;\n        this.dependencies = dependencies;\n        this.injectable = injectable;\n        this.needsCompile = needsCompile;\n        this.surrogates = surrogates;\n        this.bindables = bindables;\n        this.containerless = containerless;\n        this.shadowOptions = shadowOptions;\n        this.hasSlots = hasSlots;\n        this.enhance = enhance;\n        this.watches = watches;\n        this.strict = strict;\n        this.processContent = processContent;\n    }\n    static create(nameOrDef, Type = null) {\n        if (Type === null) {\n            const def = nameOrDef;\n            if (isString(def)) {\n                throw createMappedError(761 /* ErrorNames.element_only_name */, nameOrDef);\n            }\n            const name = fromDefinitionOrDefault('name', def, generateElementName);\n            if (isFunction(def.Type)) {\n                // This needs to be a clone (it will usually be the compiler calling this signature)\n                // TODO: we need to make sure it's documented that passing in the type via the definition (while passing in null\n                // as the \"Type\" parameter) effectively skips type analysis, so it should only be used this way for cloning purposes.\n                Type = def.Type;\n            }\n            else {\n                Type = generateElementType(pascalCase(name));\n            }\n            for (const bindable of Object.values(Bindable.from(def.bindables))) {\n                Bindable._add(bindable, Type);\n            }\n            return new CustomElementDefinition(Type, name, mergeArrays(def.aliases), fromDefinitionOrDefault('key', def, () => getElementKeyFrom(name)), fromAnnotationOrDefinitionOrTypeOrDefault('capture', def, Type, returnFalse), fromAnnotationOrDefinitionOrTypeOrDefault('template', def, Type, returnNull), mergeArrays(def.instructions), mergeArrays(getElementAnnotation(Type, 'dependencies'), def.dependencies), fromDefinitionOrDefault('injectable', def, returnNull), fromDefinitionOrDefault('needsCompile', def, returnTrue), mergeArrays(def.surrogates), Bindable.from(getElementAnnotation(Type, 'bindables'), def.bindables), fromAnnotationOrDefinitionOrTypeOrDefault('containerless', def, Type, returnFalse), fromDefinitionOrDefault('shadowOptions', def, returnNull), fromDefinitionOrDefault('hasSlots', def, returnFalse), fromDefinitionOrDefault('enhance', def, returnFalse), fromDefinitionOrDefault('watches', def, returnEmptyArray), \n            // casting is incorrect, but it's good enough\n            fromDefinitionOrDefault('strict', def, returnUndefined), fromAnnotationOrTypeOrDefault('processContent', Type, returnNull));\n        }\n        // If a type is passed in, we ignore the Type property on the definition if it exists.\n        // TODO: document this behavior\n        if (isString(nameOrDef)) {\n            return new CustomElementDefinition(Type, nameOrDef, mergeArrays(getElementAnnotation(Type, 'aliases'), Type.aliases), getElementKeyFrom(nameOrDef), fromAnnotationOrTypeOrDefault('capture', Type, returnFalse), fromAnnotationOrTypeOrDefault('template', Type, returnNull), mergeArrays(getElementAnnotation(Type, 'instructions'), Type.instructions), mergeArrays(getElementAnnotation(Type, 'dependencies'), Type.dependencies), fromAnnotationOrTypeOrDefault('injectable', Type, returnNull), fromAnnotationOrTypeOrDefault('needsCompile', Type, returnTrue), mergeArrays(getElementAnnotation(Type, 'surrogates'), Type.surrogates), Bindable.from(...Bindable.getAll(Type), getElementAnnotation(Type, 'bindables'), Type.bindables), fromAnnotationOrTypeOrDefault('containerless', Type, returnFalse), fromAnnotationOrTypeOrDefault('shadowOptions', Type, returnNull), fromAnnotationOrTypeOrDefault('hasSlots', Type, returnFalse), fromAnnotationOrTypeOrDefault('enhance', Type, returnFalse), mergeArrays(Watch.getDefinitions(Type), Type.watches), fromAnnotationOrTypeOrDefault('strict', Type, returnUndefined), fromAnnotationOrTypeOrDefault('processContent', Type, returnNull));\n        }\n        // This is the typical default behavior, e.g. from regular CustomElement.define invocations or from @customElement deco\n        // The ViewValueConverter also uses this signature and passes in a definition where everything except for the 'hooks'\n        // property needs to be copied. So we have that exception for 'hooks', but we may need to revisit that default behavior\n        // if this turns out to be too opinionated.\n        const name = fromDefinitionOrDefault('name', nameOrDef, generateElementName);\n        for (const bindable of Object.values(Bindable.from(nameOrDef.bindables))) {\n            Bindable._add(bindable, Type);\n        }\n        return new CustomElementDefinition(Type, name, mergeArrays(getElementAnnotation(Type, 'aliases'), nameOrDef.aliases, Type.aliases), getElementKeyFrom(name), fromAnnotationOrDefinitionOrTypeOrDefault('capture', nameOrDef, Type, returnFalse), fromAnnotationOrDefinitionOrTypeOrDefault('template', nameOrDef, Type, returnNull), mergeArrays(getElementAnnotation(Type, 'instructions'), nameOrDef.instructions, Type.instructions), mergeArrays(getElementAnnotation(Type, 'dependencies'), nameOrDef.dependencies, Type.dependencies), fromAnnotationOrDefinitionOrTypeOrDefault('injectable', nameOrDef, Type, returnNull), fromAnnotationOrDefinitionOrTypeOrDefault('needsCompile', nameOrDef, Type, returnTrue), mergeArrays(getElementAnnotation(Type, 'surrogates'), nameOrDef.surrogates, Type.surrogates), Bindable.from(...Bindable.getAll(Type), getElementAnnotation(Type, 'bindables'), Type.bindables, nameOrDef.bindables), fromAnnotationOrDefinitionOrTypeOrDefault('containerless', nameOrDef, Type, returnFalse), fromAnnotationOrDefinitionOrTypeOrDefault('shadowOptions', nameOrDef, Type, returnNull), fromAnnotationOrDefinitionOrTypeOrDefault('hasSlots', nameOrDef, Type, returnFalse), fromAnnotationOrDefinitionOrTypeOrDefault('enhance', nameOrDef, Type, returnFalse), mergeArrays(nameOrDef.watches, Watch.getDefinitions(Type), Type.watches), fromAnnotationOrDefinitionOrTypeOrDefault('strict', nameOrDef, Type, returnUndefined), fromAnnotationOrDefinitionOrTypeOrDefault('processContent', nameOrDef, Type, returnNull));\n    }\n    static getOrCreate(partialDefinition) {\n        if (partialDefinition instanceof CustomElementDefinition) {\n            return partialDefinition;\n        }\n        if (definitionLookup.has(partialDefinition)) {\n            return definitionLookup.get(partialDefinition);\n        }\n        const definition = CustomElementDefinition.create(partialDefinition);\n        definitionLookup.set(partialDefinition, definition);\n        // Make sure the full definition can be retrieved from dynamically created classes as well\n        defineMetadata(definition, definition.Type, elementBaseName);\n        return definition;\n    }\n    register(container, aliasName) {\n        const $Type = this.Type;\n        const key = typeof aliasName === 'string' ? getElementKeyFrom(aliasName) : this.key;\n        const aliases = this.aliases;\n        /* istanbul ignore next */\n        if (container.has(key, false)) {\n            // eslint-disable-next-line no-console\n            console.warn(createMappedError(153 /* ErrorNames.element_existed */, this.name));\n            return;\n        }\n        container.register(container.has($Type, false) ? null : singletonRegistration($Type, $Type), aliasRegistration($Type, key), ...aliases.map(alias => aliasRegistration($Type, getElementKeyFrom(alias))));\n    }\n    toString() {\n        return `au:ce:${this.name}`;\n    }\n}\nconst defaultForOpts = {\n    name: undefined,\n    searchParents: false,\n    optional: false,\n};\nconst returnNull = () => null;\nconst returnUndefined = () => void 0;\nconst returnFalse = () => false;\nconst returnTrue = () => true;\nconst returnEmptyArray = () => emptyArray;\n/** @internal */ const elementTypeName = 'custom-element';\n/** @internal */ const elementBaseName = /*@__PURE__*/ getResourceKeyFor(elementTypeName);\n/** @internal */\nconst getElementKeyFrom = (name) => `${elementBaseName}:${name}`;\n/** @internal */\nconst generateElementName = /*@__PURE__*/ (id => () => `unnamed-${++id}`)(0);\nconst annotateElementMetadata = (Type, prop, value) => {\n    defineMetadata(value, Type, getAnnotationKeyFor(prop));\n};\n/** @internal */\nconst defineElement = (nameOrDef, Type) => {\n    const definition = CustomElementDefinition.create(nameOrDef, Type);\n    const $Type = definition.Type;\n    // this is the case, where the APi is invoked directly without a decorator\n    // registration of resource name is a requirement for the resource system in kernel (module-loader)\n    defineMetadata(definition, $Type, elementBaseName, resourceBaseName);\n    return $Type;\n};\n/** @internal */\nconst isElementType = (value) => {\n    return isFunction(value)\n        && (hasMetadata(elementBaseName, value)\n            || value.$au?.type === elementTypeName);\n};\n/** @internal */\nconst findElementControllerFor = (node, opts = defaultForOpts) => {\n    if (opts.name === void 0 && opts.searchParents !== true) {\n        const controller = refs.get(node, elementBaseName);\n        if (controller === null) {\n            if (opts.optional === true) {\n                return null;\n            }\n            throw createMappedError(762 /* ErrorNames.node_is_not_a_host */, node);\n        }\n        return controller;\n    }\n    if (opts.name !== void 0) {\n        if (opts.searchParents !== true) {\n            const controller = refs.get(node, elementBaseName);\n            if (controller === null) {\n                throw createMappedError(763 /* ErrorNames.node_is_not_a_host2 */, node);\n            }\n            if (controller.is(opts.name)) {\n                return controller;\n            }\n            return (void 0);\n        }\n        let cur = node;\n        let foundAController = false;\n        while (cur !== null) {\n            const controller = refs.get(cur, elementBaseName);\n            if (controller !== null) {\n                foundAController = true;\n                if (controller.is(opts.name)) {\n                    return controller;\n                }\n            }\n            cur = getEffectiveParentNode(cur);\n        }\n        if (foundAController) {\n            return (void 0);\n        }\n        throw createMappedError(764 /* ErrorNames.node_is_not_part_of_aurelia_app */, node);\n    }\n    let cur = node;\n    while (cur !== null) {\n        const controller = refs.get(cur, elementBaseName);\n        if (controller !== null) {\n            return controller;\n        }\n        cur = getEffectiveParentNode(cur);\n    }\n    throw createMappedError(765 /* ErrorNames.node_is_not_part_of_aurelia_app2 */, node);\n};\nconst getElementAnnotation = (Type, prop) => getMetadata(getAnnotationKeyFor(prop), Type);\n/** @internal */\n// eslint-disable-next-line @typescript-eslint/ban-types\nconst getElementDefinition = (Type) => {\n    const def = getMetadata(elementBaseName, Type)\n        ?? getDefinitionFromStaticAu(Type, elementTypeName, CustomElementDefinition.create);\n    if (def == null) {\n        throw createMappedError(760 /* ErrorNames.element_def_not_found */, Type);\n    }\n    return def;\n};\n/** @internal */\nconst createElementInjectable = () => {\n    const $injectable = {\n        // Old code is kept around. Needs to be refactored when TC39 supports argument decorator.\n        // function(target: Injectable | AbstractInjectable, property: string | symbol | undefined, index?: number): Injectable | AbstractInjectable {\n        //   const annotationParamtypes = DI.getOrCreateAnnotationParamTypes(target as Constructable);\n        //   annotationParamtypes[index!] = $injectable;\n        //   return target;\n        // },\n        $isInterface: false,\n        register() {\n            return {\n                $isResolver: true,\n                resolve(container, requestor) {\n                    if (requestor.has($injectable, true)) {\n                        return requestor.get($injectable);\n                    }\n                    else {\n                        return null;\n                    }\n                }\n            };\n        }\n    };\n    return $injectable;\n};\n/** @internal */\nconst generateElementType = /*@__PURE__*/ (function () {\n    const nameDescriptor = {\n        value: '',\n        writable: false,\n        enumerable: false,\n        configurable: true,\n    };\n    const defaultProto = {};\n    return function (name, proto = defaultProto) {\n        // Anonymous class ensures that minification cannot cause unintended side-effects, and keeps the class\n        // looking similarly from the outside (when inspected via debugger, etc).\n        const Type = class Anonymous {\n        };\n        // Define the name property so that Type.name can be used by end users / plugin authors if they really need to,\n        // even when minified.\n        nameDescriptor.value = name;\n        def(Type, 'name', nameDescriptor);\n        // Assign anything from the prototype that was passed in\n        if (proto !== defaultProto) {\n            objectAssign(Type.prototype, proto);\n        }\n        return Type;\n    };\n})();\nconst CustomElement = /*@__PURE__*/ objectFreeze({\n    name: elementBaseName,\n    keyFrom: getElementKeyFrom,\n    isType: isElementType,\n    for: findElementControllerFor,\n    define: defineElement,\n    getDefinition: getElementDefinition,\n    annotate: annotateElementMetadata,\n    getAnnotation: getElementAnnotation,\n    generateName: generateElementName,\n    createInjectable: createElementInjectable,\n    generateType: generateElementType,\n    find(c, name) {\n        const Type = c.find(elementTypeName, name);\n        return Type == null\n            ? null\n            : getMetadata(elementBaseName, Type) ?? getDefinitionFromStaticAu(Type, elementTypeName, CustomElementDefinition.create) ?? null;\n    }\n});\nconst pcHookMetadataProperty = /*@__PURE__*/ getAnnotationKeyFor('processContent');\nfunction processContent(hook) {\n    return hook === void 0\n        // eslint-disable-next-line @typescript-eslint/ban-types\n        ? function (target, context) {\n            if (!context.static || context.kind !== 'method')\n                throw createMappedError(766 /* ErrorNames.invalid_process_content_hook */, target);\n            // As the method is ensured to be static, the following initializer will be invoked in static fashion, before executing the initializers added via a class decorator.\n            // Refer: https://tinyurl.com/ts-static-method-deco\n            context.addInitializer(function () {\n                defineMetadata(target, this, pcHookMetadataProperty);\n            });\n        }\n        : function (target, context) {\n            context.addInitializer(function () {\n                if (isString(hook) || isSymbol(hook)) {\n                    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-explicit-any\n                    hook = this[hook];\n                }\n                if (!isFunction(hook))\n                    throw createMappedError(766 /* ErrorNames.invalid_process_content_hook */, hook);\n                const def = getMetadata(elementBaseName, this);\n                if (def !== void 0) {\n                    def.processContent = hook;\n                }\n                else {\n                    defineMetadata(hook, this, pcHookMetadataProperty);\n                }\n            });\n            return target;\n        };\n}\nfunction capture(targetOrFilter) {\n    return function ($target, context) {\n        const value = isFunction(targetOrFilter) ? targetOrFilter : true;\n        context.addInitializer(function () {\n            annotateElementMetadata(this, 'capture', value);\n            // also do this to make order of the decorator irrelevant\n            if (isElementType(this)) {\n                getElementDefinition(this).capture = value;\n            }\n        });\n    };\n}\n\nconst IAppRoot = /*@__PURE__*/ createInterface('IAppRoot');\nclass AppRoot {\n    get controller() {\n        return this._controller;\n    }\n    constructor(config, container, rootProvider, enhance = false) {\n        this.config = config;\n        this.container = container;\n        /** @internal */\n        this._hydratePromise = void 0;\n        this._useOwnAppTasks = enhance;\n        const host = this.host = config.host;\n        rootProvider.prepare(this);\n        registerResolver(container, IEventTarget, new InstanceProvider('IEventTarget', host));\n        registerHostNode(container, host, this.platform = this._createPlatform(container, host));\n        this._hydratePromise = onResolve(this._runAppTasks('creating'), () => {\n            if (!config.allowActionlessForm !== false) {\n                host.addEventListener('submit', (e) => {\n                    const target = e.target;\n                    const noAction = !target.getAttribute('action');\n                    if (target.tagName === 'FORM' && noAction) {\n                        e.preventDefault();\n                    }\n                }, false);\n            }\n            const childCtn = enhance ? container : container.createChild();\n            const component = config.component;\n            let instance;\n            if (isFunction(component)) {\n                instance = childCtn.invoke(component);\n                instanceRegistration(component, instance);\n            }\n            else {\n                instance = config.component;\n            }\n            const hydrationInst = { hydrate: false, projections: null };\n            const definition = enhance\n                ? CustomElementDefinition.create({ name: generateElementName(), template: this.host, enhance: true, strict: config.strictBinding })\n                // leave the work of figuring out the definition to the controller\n                // there's proper error messages in case of failure inside the $el() call\n                : void 0;\n            const controller = (this._controller = Controller.$el(childCtn, instance, host, hydrationInst, definition));\n            controller._hydrateCustomElement(hydrationInst);\n            return onResolve(this._runAppTasks('hydrating'), () => {\n                controller._hydrate();\n                return onResolve(this._runAppTasks('hydrated'), () => {\n                    controller._hydrateChildren();\n                    this._hydratePromise = void 0;\n                });\n            });\n        });\n    }\n    activate() {\n        return onResolve(this._hydratePromise, () => {\n            return onResolve(this._runAppTasks('activating'), () => {\n                return onResolve(this._controller.activate(this._controller, null, void 0), () => {\n                    return this._runAppTasks('activated');\n                });\n            });\n        });\n    }\n    deactivate() {\n        return onResolve(this._runAppTasks('deactivating'), () => {\n            return onResolve(this._controller.deactivate(this._controller, null), () => {\n                return this._runAppTasks('deactivated');\n            });\n        });\n    }\n    /** @internal */\n    _runAppTasks(slot) {\n        const container = this.container;\n        const appTasks = this._useOwnAppTasks && !container.has(IAppTask, false)\n            ? []\n            : container.getAll(IAppTask);\n        return onResolveAll(...appTasks.reduce((results, task) => {\n            if (task.slot === slot) {\n                results.push(task.run());\n            }\n            return results;\n        }, []));\n    }\n    /** @internal */\n    _createPlatform(container, host) {\n        let p;\n        if (!container.has(IPlatform, false)) {\n            if (host.ownerDocument.defaultView === null) {\n                throw createMappedError(769 /* ErrorNames.invalid_platform_impl */);\n            }\n            p = new BrowserPlatform(host.ownerDocument.defaultView);\n            container.register(instanceRegistration(IPlatform, p));\n        }\n        else {\n            p = container.get(IPlatform);\n        }\n        return p;\n    }\n    dispose() {\n        this._controller?.dispose();\n    }\n}\n\nconst IAurelia = /*@__PURE__*/ createInterface('IAurelia');\nclass Aurelia {\n    get isRunning() { return this._isRunning; }\n    get isStarting() { return this._isStarting; }\n    get isStopping() { return this._isStopping; }\n    get root() {\n        if (this._root == null) {\n            if (this.next == null) {\n                throw createMappedError(767 /* ErrorNames.root_not_found */);\n            }\n            return this.next;\n        }\n        return this._root;\n    }\n    constructor(container = DI.createContainer()) {\n        this.container = container;\n        /** @internal */\n        this._isRunning = false;\n        /** @internal */\n        this._isStarting = false;\n        /** @internal */\n        this._isStopping = false;\n        /** @internal */\n        this._root = void 0;\n        this.next = void 0;\n        /** @internal */\n        this._startPromise = void 0;\n        /** @internal */\n        this._stopPromise = void 0;\n        if (container.has(IAurelia, true) || container.has(Aurelia, true)) {\n            throw createMappedError(768 /* ErrorNames.aurelia_instance_existed_in_container */);\n        }\n        registerResolver(container, IAurelia, new InstanceProvider('IAurelia', this));\n        registerResolver(container, Aurelia, new InstanceProvider('Aurelia', this));\n        registerResolver(container, IAppRoot, this._rootProvider = new InstanceProvider('IAppRoot'));\n    }\n    register(...params) {\n        this.container.register(...params);\n        return this;\n    }\n    app(config) {\n        this.next = new AppRoot(config, this.container, this._rootProvider);\n        return this;\n    }\n    /**\n     * @param parentController - The owning controller of the view created by this enhance call\n     */\n    enhance(config) {\n        const container = (config.container ?? this.container.createChild());\n        const rootProvider = registerResolver(container, IAppRoot, new InstanceProvider('IAppRoot'));\n        const appRoot = new AppRoot({ host: config.host, component: config.component }, container, rootProvider, true);\n        return onResolve(appRoot.activate(), () => appRoot);\n    }\n    async waitForIdle() {\n        const platform = this.root.platform;\n        await platform.domQueue.yield();\n        await platform.taskQueue.yield();\n    }\n    start(root = this.next) {\n        if (root == null) {\n            throw createMappedError(770 /* ErrorNames.no_composition_root */);\n        }\n        if (isPromise(this._startPromise)) {\n            return this._startPromise;\n        }\n        return this._startPromise = onResolve(this.stop(), () => {\n            if (!refs.hideProp) {\n                Reflect.set(root.host, '$aurelia', this);\n            }\n            this._rootProvider.prepare(this._root = root);\n            this._isStarting = true;\n            return onResolve(root.activate(), () => {\n                this._isRunning = true;\n                this._isStarting = false;\n                this._startPromise = void 0;\n                this._dispatchEvent(root, 'au-started', root.host);\n            });\n        });\n    }\n    stop(dispose = false) {\n        if (isPromise(this._stopPromise)) {\n            return this._stopPromise;\n        }\n        if (this._isRunning === true) {\n            const root = this._root;\n            this._isRunning = false;\n            this._isStopping = true;\n            return this._stopPromise = onResolve(root.deactivate(), () => {\n                return onResolve(tasksSettled(), () => {\n                    Reflect.deleteProperty(root.host, '$aurelia');\n                    if (dispose) {\n                        root.dispose();\n                    }\n                    this._root = void 0;\n                    this._rootProvider.dispose();\n                    this._isStopping = false;\n                    this._stopPromise = void 0;\n                    this._dispatchEvent(root, 'au-stopped', root.host);\n                });\n            });\n        }\n    }\n    dispose() {\n        if (this._isRunning || this._isStopping) {\n            throw createMappedError(771 /* ErrorNames.invalid_dispose_call */);\n        }\n        this.container.dispose();\n    }\n    /** @internal */\n    _dispatchEvent(root, name, target) {\n        const ev = new root.platform.window.CustomEvent(name, { detail: this, bubbles: true, cancelable: true });\n        target.dispatchEvent(ev);\n    }\n}\n\nconst ISVGAnalyzer = /*@__PURE__*/ createInterface('ISVGAnalyzer', x => x.singleton(NoopSVGAnalyzer));\nconst o = (keys) => {\n    const lookup = createLookup();\n    keys = isString(keys) ? keys.split(' ') : keys;\n    let key;\n    for (key of keys) {\n        lookup[key] = true;\n    }\n    return lookup;\n};\nclass NoopSVGAnalyzer {\n    isStandardSvgAttribute(_node, _attributeName) {\n        return false;\n    }\n}\nclass SVGAnalyzer {\n    static register(container) {\n        container.register(singletonRegistration(this, this), aliasRegistration(this, ISVGAnalyzer));\n    }\n    constructor() {\n        /** @internal */\n        this._svgElements = objectAssign(createLookup(), {\n            'a': o('class externalResourcesRequired id onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup requiredExtensions requiredFeatures style systemLanguage target transform xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space'),\n            'altGlyph': o('class dx dy externalResourcesRequired format glyphRef id onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup requiredExtensions requiredFeatures rotate style systemLanguage x xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space y'),\n            'altglyph': createLookup(),\n            'altGlyphDef': o('id xml:base xml:lang xml:space'),\n            'altglyphdef': createLookup(),\n            'altGlyphItem': o('id xml:base xml:lang xml:space'),\n            'altglyphitem': createLookup(),\n            'animate': o('accumulate additive attributeName attributeType begin by calcMode dur end externalResourcesRequired fill from id keySplines keyTimes max min onbegin onend onload onrepeat repeatCount repeatDur requiredExtensions requiredFeatures restart systemLanguage to values xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space'),\n            'animateColor': o('accumulate additive attributeName attributeType begin by calcMode dur end externalResourcesRequired fill from id keySplines keyTimes max min onbegin onend onload onrepeat repeatCount repeatDur requiredExtensions requiredFeatures restart systemLanguage to values xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space'),\n            'animateMotion': o('accumulate additive begin by calcMode dur end externalResourcesRequired fill from id keyPoints keySplines keyTimes max min onbegin onend onload onrepeat origin path repeatCount repeatDur requiredExtensions requiredFeatures restart rotate systemLanguage to values xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space'),\n            'animateTransform': o('accumulate additive attributeName attributeType begin by calcMode dur end externalResourcesRequired fill from id keySplines keyTimes max min onbegin onend onload onrepeat repeatCount repeatDur requiredExtensions requiredFeatures restart systemLanguage to type values xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space'),\n            'circle': o('class cx cy externalResourcesRequired id onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup r requiredExtensions requiredFeatures style systemLanguage transform xml:base xml:lang xml:space'),\n            'clipPath': o('class clipPathUnits externalResourcesRequired id requiredExtensions requiredFeatures style systemLanguage transform xml:base xml:lang xml:space'),\n            'color-profile': o('id local name rendering-intent xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space'),\n            'cursor': o('externalResourcesRequired id requiredExtensions requiredFeatures systemLanguage x xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space y'),\n            'defs': o('class externalResourcesRequired id onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup requiredExtensions requiredFeatures style systemLanguage transform xml:base xml:lang xml:space'),\n            'desc': o('class id style xml:base xml:lang xml:space'),\n            'ellipse': o('class cx cy externalResourcesRequired id onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup requiredExtensions requiredFeatures rx ry style systemLanguage transform xml:base xml:lang xml:space'),\n            'feBlend': o('class height id in in2 mode result style width x xml:base xml:lang xml:space y'),\n            'feColorMatrix': o('class height id in result style type values width x xml:base xml:lang xml:space y'),\n            'feComponentTransfer': o('class height id in result style width x xml:base xml:lang xml:space y'),\n            'feComposite': o('class height id in in2 k1 k2 k3 k4 operator result style width x xml:base xml:lang xml:space y'),\n            'feConvolveMatrix': o('bias class divisor edgeMode height id in kernelMatrix kernelUnitLength order preserveAlpha result style targetX targetY width x xml:base xml:lang xml:space y'),\n            'feDiffuseLighting': o('class diffuseConstant height id in kernelUnitLength result style surfaceScale width x xml:base xml:lang xml:space y'),\n            'feDisplacementMap': o('class height id in in2 result scale style width x xChannelSelector xml:base xml:lang xml:space y yChannelSelector'),\n            'feDistantLight': o('azimuth elevation id xml:base xml:lang xml:space'),\n            'feFlood': o('class height id result style width x xml:base xml:lang xml:space y'),\n            'feFuncA': o('amplitude exponent id intercept offset slope tableValues type xml:base xml:lang xml:space'),\n            'feFuncB': o('amplitude exponent id intercept offset slope tableValues type xml:base xml:lang xml:space'),\n            'feFuncG': o('amplitude exponent id intercept offset slope tableValues type xml:base xml:lang xml:space'),\n            'feFuncR': o('amplitude exponent id intercept offset slope tableValues type xml:base xml:lang xml:space'),\n            'feGaussianBlur': o('class height id in result stdDeviation style width x xml:base xml:lang xml:space y'),\n            'feImage': o('class externalResourcesRequired height id preserveAspectRatio result style width x xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space y'),\n            'feMerge': o('class height id result style width x xml:base xml:lang xml:space y'),\n            'feMergeNode': o('id xml:base xml:lang xml:space'),\n            'feMorphology': o('class height id in operator radius result style width x xml:base xml:lang xml:space y'),\n            'feOffset': o('class dx dy height id in result style width x xml:base xml:lang xml:space y'),\n            'fePointLight': o('id x xml:base xml:lang xml:space y z'),\n            'feSpecularLighting': o('class height id in kernelUnitLength result specularConstant specularExponent style surfaceScale width x xml:base xml:lang xml:space y'),\n            'feSpotLight': o('id limitingConeAngle pointsAtX pointsAtY pointsAtZ specularExponent x xml:base xml:lang xml:space y z'),\n            'feTile': o('class height id in result style width x xml:base xml:lang xml:space y'),\n            'feTurbulence': o('baseFrequency class height id numOctaves result seed stitchTiles style type width x xml:base xml:lang xml:space y'),\n            'filter': o('class externalResourcesRequired filterRes filterUnits height id primitiveUnits style width x xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space y'),\n            'font': o('class externalResourcesRequired horiz-adv-x horiz-origin-x horiz-origin-y id style vert-adv-y vert-origin-x vert-origin-y xml:base xml:lang xml:space'),\n            'font-face': o('accent-height alphabetic ascent bbox cap-height descent font-family font-size font-stretch font-style font-variant font-weight hanging id ideographic mathematical overline-position overline-thickness panose-1 slope stemh stemv strikethrough-position strikethrough-thickness underline-position underline-thickness unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical widths x-height xml:base xml:lang xml:space'),\n            'font-face-format': o('id string xml:base xml:lang xml:space'),\n            'font-face-name': o('id name xml:base xml:lang xml:space'),\n            'font-face-src': o('id xml:base xml:lang xml:space'),\n            'font-face-uri': o('id xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space'),\n            'foreignObject': o('class externalResourcesRequired height id onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup requiredExtensions requiredFeatures style systemLanguage transform width x xml:base xml:lang xml:space y'),\n            'g': o('class externalResourcesRequired id onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup requiredExtensions requiredFeatures style systemLanguage transform xml:base xml:lang xml:space'),\n            'glyph': o('arabic-form class d glyph-name horiz-adv-x id lang orientation style unicode vert-adv-y vert-origin-x vert-origin-y xml:base xml:lang xml:space'),\n            'glyphRef': o('class dx dy format glyphRef id style x xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space y'),\n            'glyphref': createLookup(),\n            'hkern': o('g1 g2 id k u1 u2 xml:base xml:lang xml:space'),\n            'image': o('class externalResourcesRequired height id onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup preserveAspectRatio requiredExtensions requiredFeatures style systemLanguage transform width x xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space y'),\n            'line': o('class externalResourcesRequired id onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup requiredExtensions requiredFeatures style systemLanguage transform x1 x2 xml:base xml:lang xml:space y1 y2'),\n            'linearGradient': o('class externalResourcesRequired gradientTransform gradientUnits id spreadMethod style x1 x2 xlink:arcrole xlink:href xlink:role xlink:title xlink:type xml:base xml:lang xml:space y1 y2'),\n            'marker': o('class externalResourcesRequired id markerHeight markerUnits markerWidth orient preserveAspectRatio refX refY style viewBox xml:base xml:lang xml:space'),\n            'mask': o('class externalResourcesRequired height id maskContentUnits maskUnits requiredExtensions requiredFeatures style systemLanguage width x xml:base xml:lang xml:space y'),\n            'metadata': o('id xml:base xml:lang xml:space'),\n            'missing-glyph': o('class d horiz-adv-x id style vert-adv-y vert-origin-x vert-origin-y xml:base xml:lang xml:space'),\n            'mpath': o('externalResourcesRequired id xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space'),\n            'path': o('class d externalResourcesRequired id onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup pathLength requiredExtensions requiredFeatures style systemLanguage transform xml:base xml:lang xml:space'),\n            'pattern': o('class externalResourcesRequired height id patternContentUnits patternTransform patternUnits preserveAspectRatio requiredExtensions requiredFeatures style systemLanguage viewBox width x xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space y'),\n            'polygon': o('class externalResourcesRequired id onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup points requiredExtensions requiredFeatures style systemLanguage transform xml:base xml:lang xml:space'),\n            'polyline': o('class externalResourcesRequired id onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup points requiredExtensions requiredFeatures style systemLanguage transform xml:base xml:lang xml:space'),\n            'radialGradient': o('class cx cy externalResourcesRequired fx fy gradientTransform gradientUnits id r spreadMethod style xlink:arcrole xlink:href xlink:role xlink:title xlink:type xml:base xml:lang xml:space'),\n            'rect': o('class externalResourcesRequired height id onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup requiredExtensions requiredFeatures rx ry style systemLanguage transform width x xml:base xml:lang xml:space y'),\n            'script': o('externalResourcesRequired id type xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space'),\n            'set': o('attributeName attributeType begin dur end externalResourcesRequired fill id max min onbegin onend onload onrepeat repeatCount repeatDur requiredExtensions requiredFeatures restart systemLanguage to xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space'),\n            'stop': o('class id offset style xml:base xml:lang xml:space'),\n            'style': o('id media title type xml:base xml:lang xml:space'),\n            'svg': o('baseProfile class contentScriptType contentStyleType externalResourcesRequired height id onabort onactivate onclick onerror onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup onresize onscroll onunload onzoom preserveAspectRatio requiredExtensions requiredFeatures style systemLanguage version viewBox width x xml:base xml:lang xml:space y zoomAndPan'),\n            'switch': o('class externalResourcesRequired id onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup requiredExtensions requiredFeatures style systemLanguage transform xml:base xml:lang xml:space'),\n            'symbol': o('class externalResourcesRequired id onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup preserveAspectRatio style viewBox xml:base xml:lang xml:space'),\n            'text': o('class dx dy externalResourcesRequired id lengthAdjust onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup requiredExtensions requiredFeatures rotate style systemLanguage textLength transform x xml:base xml:lang xml:space y'),\n            'textPath': o('class externalResourcesRequired id lengthAdjust method onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup requiredExtensions requiredFeatures spacing startOffset style systemLanguage textLength xlink:arcrole xlink:href xlink:role xlink:title xlink:type xml:base xml:lang xml:space'),\n            'title': o('class id style xml:base xml:lang xml:space'),\n            'tref': o('class dx dy externalResourcesRequired id lengthAdjust onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup requiredExtensions requiredFeatures rotate style systemLanguage textLength x xlink:arcrole xlink:href xlink:role xlink:title xlink:type xml:base xml:lang xml:space y'),\n            'tspan': o('class dx dy externalResourcesRequired id lengthAdjust onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup requiredExtensions requiredFeatures rotate style systemLanguage textLength x xml:base xml:lang xml:space y'),\n            'use': o('class externalResourcesRequired height id onactivate onclick onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup requiredExtensions requiredFeatures style systemLanguage transform width x xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space y'),\n            'view': o('externalResourcesRequired id preserveAspectRatio viewBox viewTarget xml:base xml:lang xml:space zoomAndPan'),\n            'vkern': o('g1 g2 id k u1 u2 xml:base xml:lang xml:space'),\n        });\n        /** @internal */\n        this._svgPresentationElements = o('a altGlyph animate animateColor circle clipPath defs ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feFlood feGaussianBlur feImage feMerge feMorphology feOffset feSpecularLighting feTile feTurbulence filter font foreignObject g glyph glyphRef image line linearGradient marker mask missing-glyph path pattern polygon polyline radialGradient rect stop svg switch symbol text textPath tref tspan use');\n        /** @internal */\n        this._svgPresentationAttributes = o('alignment-baseline baseline-shift clip-path clip-rule clip color-interpolation-filters color-interpolation color-profile color-rendering color cursor direction display dominant-baseline enable-background fill-opacity fill-rule fill filter flood-color flood-opacity font-family font-size-adjust font-size font-stretch font-style font-variant font-weight glyph-orientation-horizontal glyph-orientation-vertical image-rendering kerning letter-spacing lighting-color marker-end marker-mid marker-start mask opacity overflow pointer-events shape-rendering stop-color stop-opacity stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width stroke text-anchor text-decoration text-rendering unicode-bidi visibility word-spacing writing-mode');\n        const platform = resolve(IPlatform);\n        this.SVGElement = platform.globalThis.SVGElement;\n        const div = platform.document.createElement('div');\n        div.innerHTML = '<svg><altGlyph /></svg>';\n        if (div.firstElementChild.nodeName === 'altglyph') {\n            // handle chrome casing inconsistencies.\n            const svg = this._svgElements;\n            let tmp = svg.altGlyph;\n            svg.altGlyph = svg.altglyph;\n            svg.altglyph = tmp;\n            tmp = svg.altGlyphDef;\n            svg.altGlyphDef = svg.altglyphdef;\n            svg.altglyphdef = tmp;\n            tmp = svg.altGlyphItem;\n            svg.altGlyphItem = svg.altglyphitem;\n            svg.altglyphitem = tmp;\n            tmp = svg.glyphRef;\n            svg.glyphRef = svg.glyphref;\n            svg.glyphref = tmp;\n        }\n    }\n    isStandardSvgAttribute(node, attributeName) {\n        if (!(node instanceof this.SVGElement)) {\n            return false;\n        }\n        return (this._svgPresentationElements[node.nodeName] === true && this._svgPresentationAttributes[attributeName] === true ||\n            this._svgElements[node.nodeName]?.[attributeName] === true);\n    }\n}\n\nclass AttrMapper {\n    constructor() {\n        /** @internal */ this.fns = [];\n        /** @internal */ this._tagAttrMap = createLookup();\n        /** @internal */ this._globalAttrMap = createLookup();\n        this.svg = resolve(ISVGAnalyzer);\n        this.useMapping({\n            LABEL: { for: 'htmlFor' },\n            IMG: { usemap: 'useMap' },\n            INPUT: {\n                maxlength: 'maxLength',\n                minlength: 'minLength',\n                formaction: 'formAction',\n                formenctype: 'formEncType',\n                formmethod: 'formMethod',\n                formnovalidate: 'formNoValidate',\n                formtarget: 'formTarget',\n                inputmode: 'inputMode',\n            },\n            TEXTAREA: { maxlength: 'maxLength' },\n            TD: { rowspan: 'rowSpan', colspan: 'colSpan' },\n            TH: { rowspan: 'rowSpan', colspan: 'colSpan' },\n        });\n        this.useGlobalMapping({\n            accesskey: 'accessKey',\n            contenteditable: 'contentEditable',\n            tabindex: 'tabIndex',\n            textcontent: 'textContent',\n            innerhtml: 'innerHTML',\n            scrolltop: 'scrollTop',\n            scrollleft: 'scrollLeft',\n            readonly: 'readOnly',\n        });\n    }\n    /**\n     * Allow application to teach Aurelia how to define how to map attributes to properties\n     * based on element tagName\n     */\n    useMapping(config) {\n        let newAttrMapping;\n        let targetAttrMapping;\n        let tagName;\n        let attr;\n        for (tagName in config) {\n            newAttrMapping = config[tagName];\n            targetAttrMapping = this._tagAttrMap[tagName] ??= createLookup();\n            for (attr in newAttrMapping) {\n                if (targetAttrMapping[attr] !== void 0) {\n                    throw createError(attr, tagName);\n                }\n                targetAttrMapping[attr] = newAttrMapping[attr];\n            }\n        }\n    }\n    /**\n     * Allow applications to teach Aurelia how to define how to map attributes to properties\n     * for all elements\n     */\n    useGlobalMapping(config) {\n        const mapper = this._globalAttrMap;\n        for (const attr in config) {\n            if (mapper[attr] !== void 0) {\n                throw createError(attr, '*');\n            }\n            mapper[attr] = config[attr];\n        }\n    }\n    /**\n     * Add a given function to a list of fns that will be used\n     * to check if `'bind'` command can be understood as `'two-way'` command.\n     */\n    useTwoWay(fn) {\n        this.fns.push(fn);\n    }\n    /**\n     * Returns true if an attribute should be two way bound based on an element\n     */\n    isTwoWay(node, attrName) {\n        return shouldDefaultToTwoWay(node, attrName)\n            || this.fns.length > 0 && this.fns.some(fn => fn(node, attrName));\n    }\n    /**\n     * Retrieves the mapping information this mapper have for an attribute on an element\n     */\n    map(node, attr) {\n        return this._tagAttrMap[node.nodeName]?.[attr]\n            ?? this._globalAttrMap[attr]\n            ?? (isDataAttribute(node, attr, this.svg)\n                ? attr\n                : null);\n    }\n}\nAttrMapper.register = createImplementationRegister(IAttrMapper);\nfunction shouldDefaultToTwoWay(element, attr) {\n    switch (element.nodeName) {\n        case 'INPUT':\n            switch (element.type) {\n                case 'checkbox':\n                case 'radio':\n                    return attr === 'checked';\n                // note:\n                // ideally, it should check for corresponding input type first\n                // as 'files' shouldn't be two way on a number input, for example\n                // but doing it this way is acceptable-ish, as the common user expectations,\n                // and the behavior of the control for these properties are the same,\n                // regardless the type of the <input>\n                default:\n                    return attr === 'value' || attr === 'files' || attr === 'value-as-number' || attr === 'value-as-date';\n            }\n        case 'TEXTAREA':\n        case 'SELECT':\n            return attr === 'value';\n        default:\n            switch (attr) {\n                case 'textcontent':\n                case 'innerhtml':\n                    return element.hasAttribute('contenteditable');\n                case 'scrolltop':\n                case 'scrollleft':\n                    return true;\n                default:\n                    return false;\n            }\n    }\n}\nfunction createError(attr, tagName) {\n    return createMappedError(719 /* ErrorNames.compiler_attr_mapper_duplicate_mapping */, attr, tagName);\n}\n\n/**\n * A group of registrations to connect the template compiler with the aurelia runtime implementation\n */\nconst RuntimeTemplateCompilerImplementation = {\n    register(container) {\n        container.register(TemplateCompiler, AttrMapper, ResourceResolver);\n    }\n};\nclass BindablesInfo {\n    constructor(attrs, bindables, primary) {\n        this.attrs = attrs;\n        this.bindables = bindables;\n        this.primary = primary;\n    }\n}\nclass ResourceResolver {\n    constructor() {\n        /** @internal */\n        this._resourceCache = new WeakMap();\n        /** @internal */\n        this._bindableCache = new WeakMap();\n    }\n    el(c, name) {\n        let record = this._resourceCache.get(c);\n        if (record == null) {\n            this._resourceCache.set(c, record = new RecordCache());\n        }\n        return name in record._element ? record._element[name] : (record._element[name] = CustomElement.find(c, name));\n    }\n    attr(c, name) {\n        let record = this._resourceCache.get(c);\n        if (record == null) {\n            this._resourceCache.set(c, record = new RecordCache());\n        }\n        return name in record._attr ? record._attr[name] : (record._attr[name] = CustomAttribute.find(c, name));\n    }\n    bindables(def) {\n        let info = this._bindableCache.get(def);\n        if (info == null) {\n            const bindables = def.bindables;\n            const attrs = createLookup();\n            let bindable;\n            let prop;\n            let hasPrimary = false;\n            let primary;\n            let attr;\n            // from all bindables, pick the first primary bindable\n            // if there is no primary, pick the first bindable\n            // if there's no bindables, create a new primary with property value\n            for (prop in bindables) {\n                bindable = bindables[prop];\n                attr = bindable.attribute;\n                if (bindable.primary === true) {\n                    if (hasPrimary) {\n                        throw createMappedError(714 /* ErrorNames.compiler_primary_already_existed */, def);\n                    }\n                    hasPrimary = true;\n                    primary = bindable;\n                }\n                else if (!hasPrimary && primary == null) {\n                    primary = bindable;\n                }\n                attrs[attr] = BindableDefinition.create(prop, bindable);\n            }\n            if (bindable == null && def.type === 'custom-attribute') {\n                // if no bindables are present, default to \"value\"\n                primary = attrs.value = BindableDefinition.create('value', { mode: def.defaultBindingMode ?? defaultMode });\n            }\n            this._bindableCache.set(def, info = new BindablesInfo(attrs, bindables, primary ?? null));\n        }\n        return info;\n    }\n}\nResourceResolver.register = createImplementationRegister(IResourceResolver);\nclass RecordCache {\n    constructor() {\n        this._element = createLookup();\n        this._attr = createLookup();\n    }\n}\n\nconst nsMap = createLookup();\n/**\n * Attribute accessor in a XML document/element that can be accessed via a namespace.\n * Wraps [`getAttributeNS`](https://developer.mozilla.org/en-US/docs/Web/API/Element/getAttributeNS).\n */\nclass AttributeNSAccessor {\n    static forNs(ns) {\n        return nsMap[ns] ??= new AttributeNSAccessor(ns);\n    }\n    constructor(\n    /**\n     * The namespace associated with this accessor\n     */\n    ns) {\n        this.ns = ns;\n        // ObserverType.Layout is not always true, it depends on the property\n        // but for simplicity, always treat as such\n        this.type = (atNode | atLayout);\n    }\n    getValue(obj, propertyKey) {\n        return obj.getAttributeNS(this.ns, propertyKey);\n    }\n    setValue(newValue, obj, key) {\n        if (newValue == null) {\n            obj.removeAttributeNS(this.ns, key);\n        }\n        else {\n            obj.setAttributeNS(this.ns, key, newValue);\n        }\n    }\n}\n(() => {\n    mixinNoopSubscribable(AttributeNSAccessor);\n})();\n\n/**\n * Attribute accessor for HTML elements.\n * Note that Aurelia works with properties, so in all case it will try to assign to property instead of attributes.\n * Unless the property falls into a special set, then it will use attribute for it.\n *\n * @see PropertyAccessor\n */\nclass DataAttributeAccessor {\n    constructor() {\n        // ObserverType.Layout is not always true, it depends on the property\n        // but for simplicity, always treat as such\n        this.type = (atNode | atLayout);\n    }\n    getValue(obj, key) {\n        return obj.getAttribute(key);\n    }\n    setValue(newValue, obj, key) {\n        if (newValue == null) {\n            obj.removeAttribute(key);\n        }\n        else {\n            obj.setAttribute(key, newValue);\n        }\n    }\n}\n(() => {\n    mixinNoopSubscribable(DataAttributeAccessor);\n})();\nconst attrAccessor = /*@__PURE__*/ new DataAttributeAccessor();\n\nclass SelectValueObserver {\n    /** @internal */\n    static _getSelectedOptions(options) {\n        const selection = [];\n        if (options.length === 0) {\n            return selection;\n        }\n        const ii = options.length;\n        let i = 0;\n        let option;\n        while (ii > i) {\n            option = options[i];\n            if (option.selected) {\n                selection[selection.length] = hasOwnProperty.call(option, 'model') ? option.model : option.value;\n            }\n            ++i;\n        }\n        return selection;\n    }\n    /** @internal */\n    static _defaultMatcher(a, b) {\n        return a === b;\n    }\n    constructor(obj, \n    // deepscan-disable-next-line\n    _key, config, observerLocator) {\n        // ObserverType.Layout is not always true\n        // but for simplicity, always treat as such\n        this.type = (atNode | atObserver | atLayout);\n        /** @internal */\n        this._value = void 0;\n        /** @internal */\n        this._oldValue = void 0;\n        /** @internal */\n        this._hasChanges = false;\n        /** @internal */\n        this._arrayObserver = void 0;\n        /** @internal */\n        this._nodeObserver = void 0;\n        /** @internal */\n        this._observing = false;\n        /**\n         * Used by mixing defined methods subscribe/unsubscribe\n         *\n         * @internal\n         */\n        this._listened = false;\n        this._el = obj;\n        this._observerLocator = observerLocator;\n        this._config = config;\n    }\n    getValue() {\n        // is it safe to assume the observer has the latest value?\n        // todo: ability to turn on/off cache based on type\n        return this._observing\n            ? this._value\n            : this._el.multiple\n                // todo: maybe avoid double iteration?\n                ? SelectValueObserver._getSelectedOptions(this._el.options)\n                : this._el.value;\n    }\n    setValue(newValue) {\n        this._oldValue = this._value;\n        this._value = newValue;\n        this._hasChanges = newValue !== this._oldValue;\n        this._observeArray(newValue instanceof Array ? newValue : null);\n        this._flushChanges();\n    }\n    /** @internal */\n    _flushChanges() {\n        if (this._hasChanges) {\n            this._hasChanges = false;\n            this.syncOptions();\n        }\n    }\n    handleCollectionChange() {\n        // always sync \"selected\" property of <options/>\n        // immediately whenever the array notifies its mutation\n        this.syncOptions();\n    }\n    syncOptions() {\n        const value = this._value;\n        const obj = this._el;\n        const $isArray = isArray(value);\n        const matcher = obj.matcher ?? SelectValueObserver._defaultMatcher;\n        const options = obj.options;\n        let i = options.length;\n        while (i-- > 0) {\n            const option = options[i];\n            const optionValue = hasOwnProperty.call(option, 'model') ? option.model : option.value;\n            if ($isArray) {\n                option.selected = value.findIndex(item => !!matcher(optionValue, item)) !== -1;\n                continue;\n            }\n            option.selected = !!matcher(optionValue, value);\n        }\n    }\n    syncValue() {\n        // Spec for synchronizing value from `<select/>`  to `SelectObserver`\n        // When synchronizing value to observed <select/> element, do the following steps:\n        // A. If `<select/>` is multiple\n        //    1. Check if current value, called `currentValue` is an array\n        //      a. If not an array, return true to signal value has changed\n        //      b. If is an array:\n        //        i. gather all current selected <option/>, in to array called `values`\n        //        ii. loop through the `currentValue` array and remove items that are nolonger selected based on matcher\n        //        iii. loop through the `values` array and add items that are selected based on matcher\n        //        iv. Return false to signal value hasn't changed\n        // B. If the select is single\n        //    1. Let `value` equal the first selected option, if no option selected, then `value` is `null`\n        //    2. assign `this.currentValue` to `this.oldValue`\n        //    3. assign `value` to `this.currentValue`\n        //    4. return `true` to signal value has changed\n        const obj = this._el;\n        const options = obj.options;\n        const len = options.length;\n        const currentValue = this._value;\n        let i = 0;\n        if (obj.multiple) {\n            // A.\n            if (!(currentValue instanceof Array)) {\n                // A.1.a\n                return true;\n            }\n            // A.1.b\n            // multi select\n            let option;\n            // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n            const matcher = obj.matcher || SelectValueObserver._defaultMatcher;\n            // A.1.b.i\n            const values = [];\n            while (i < len) {\n                option = options[i];\n                if (option.selected) {\n                    values.push(hasOwnProperty.call(option, 'model')\n                        ? option.model\n                        : option.value);\n                }\n                ++i;\n            }\n            let a;\n            // A.1.b.ii\n            i = 0;\n            while (i < currentValue.length) {\n                a = currentValue[i];\n                // Todo: remove arrow fn\n                if (values.findIndex(b => !!matcher(a, b)) === -1) {\n                    currentValue.splice(i, 1);\n                }\n                else {\n                    ++i;\n                }\n            }\n            // A.1.b.iii\n            i = 0;\n            while (i < values.length) {\n                a = values[i];\n                // Todo: remove arrow fn\n                if (currentValue.findIndex(b => !!matcher(a, b)) === -1) {\n                    currentValue.push(a);\n                }\n                ++i;\n            }\n            // A.1.b.iv\n            return false;\n        }\n        // B. single select\n        // B.1\n        let value = null;\n        let option;\n        while (i < len) {\n            option = options[i];\n            if (option.selected) {\n                value = hasOwnProperty.call(option, 'model')\n                    ? option.model\n                    : option.value;\n                break;\n            }\n            ++i;\n        }\n        // B.2\n        this._oldValue = this._value;\n        // B.3\n        this._value = value;\n        // B.4\n        return true;\n    }\n    /**\n     * Used by mixing defined methods subscribe\n     *\n     * @internal\n     */\n    _start() {\n        (this._nodeObserver = createMutationObserver(this._el, this._handleNodeChange.bind(this))).observe(this._el, {\n            childList: true,\n            subtree: true,\n            characterData: true\n        });\n        this._observeArray(this._value instanceof Array ? this._value : null);\n        this._observing = true;\n    }\n    /**\n     * Used by mixing defined method unsubscribe\n     *\n     * @internal\n     */\n    _stop() {\n        this._nodeObserver.disconnect();\n        this._arrayObserver?.unsubscribe(this);\n        this._nodeObserver\n            = this._arrayObserver\n                = void 0;\n        this._observing = false;\n    }\n    // todo: observe all kind of collection\n    /** @internal */\n    _observeArray(array) {\n        this._arrayObserver?.unsubscribe(this);\n        this._arrayObserver = void 0;\n        if (array != null) {\n            if (!this._el.multiple) {\n                throw createMappedError(654 /* ErrorNames.select_observer_array_on_non_multi_select */);\n            }\n            (this._arrayObserver = this._observerLocator.getArrayObserver(array)).subscribe(this);\n        }\n    }\n    handleEvent() {\n        const shouldNotify = this.syncValue();\n        if (shouldNotify) {\n            this._flush();\n        }\n    }\n    /** @internal */\n    _handleNodeChange(_records) {\n        // syncing options first means forcing the UI to take the existing state from the model\n        // example: if existing state has only 3 selected option\n        //          and it's adding a 4th <option/> with selected state\n        //          [selected] state will be disregarded as it's not present in the model\n        //          this force uni-direction flow: where UI update is only via user event, or model changes\n        //          Cons:\n        //          Sometimes, an <option selected /> maybe added to the UI, and causes confusion, as it's not selected anymore after the sync\n        //          Consider this before entering release candidate\n        this.syncOptions();\n        const shouldNotify = this.syncValue();\n        if (shouldNotify) {\n            this._flush();\n        }\n    }\n    /** @internal */\n    _flush() {\n        const oV = this._oldValue;\n        this._oldValue = this._value;\n        this.subs.notify(this._value, oV);\n    }\n}\n(() => {\n    mixinNodeObserverUseConfig(SelectValueObserver);\n    subscriberCollection(SelectValueObserver, null);\n})();\n\nconst customPropertyPrefix = '--';\nclass StyleAttributeAccessor {\n    constructor(obj) {\n        this.obj = obj;\n        this.type = (atNode | atLayout);\n        /** @internal */\n        this._value = '';\n        /** @internal */\n        this._oldValue = '';\n        this.styles = {};\n        this.version = 0;\n        /** @internal */\n        this._hasChanges = false;\n    }\n    getValue() {\n        return this.obj.style.cssText;\n    }\n    setValue(newValue) {\n        this._value = newValue;\n        this._hasChanges = newValue !== this._oldValue;\n        this._flushChanges();\n    }\n    /** @internal */\n    _getStyleTuplesFromString(currentValue) {\n        const styleTuples = [];\n        const urlRegexTester = /url\\([^)]+$/;\n        let offset = 0;\n        let currentChunk = '';\n        let nextSplit;\n        let indexOfColon;\n        let attribute;\n        let value;\n        while (offset < currentValue.length) {\n            nextSplit = currentValue.indexOf(';', offset);\n            if (nextSplit === -1) {\n                nextSplit = currentValue.length;\n            }\n            currentChunk += currentValue.substring(offset, nextSplit);\n            offset = nextSplit + 1;\n            // Make sure we never split a url so advance to next\n            if (urlRegexTester.test(currentChunk)) {\n                currentChunk += ';';\n                continue;\n            }\n            indexOfColon = currentChunk.indexOf(':');\n            attribute = currentChunk.substring(0, indexOfColon).trim();\n            value = currentChunk.substring(indexOfColon + 1).trim();\n            styleTuples.push([attribute, value]);\n            currentChunk = '';\n        }\n        return styleTuples;\n    }\n    /** @internal */\n    _getStyleTuplesFromObject(currentValue) {\n        let value;\n        let property;\n        const styles = [];\n        for (property in currentValue) {\n            value = currentValue[property];\n            if (value == null) {\n                continue;\n            }\n            if (isString(value)) {\n                // Custom properties should not be tampered with\n                if (property.startsWith(customPropertyPrefix)) {\n                    styles.push([property, value]);\n                    continue;\n                }\n                styles.push([kebabCase(property), value]);\n                continue;\n            }\n            styles.push(...this._getStyleTuples(value));\n        }\n        return styles;\n    }\n    /** @internal */\n    _getStyleTuplesFromArray(currentValue) {\n        const len = currentValue.length;\n        if (len > 0) {\n            const styles = [];\n            let i = 0;\n            for (; len > i; ++i) {\n                styles.push(...this._getStyleTuples(currentValue[i]));\n            }\n            return styles;\n        }\n        return emptyArray;\n    }\n    /** @internal */\n    _getStyleTuples(currentValue) {\n        if (isString(currentValue)) {\n            return this._getStyleTuplesFromString(currentValue);\n        }\n        if (currentValue instanceof Array) {\n            return this._getStyleTuplesFromArray(currentValue);\n        }\n        if (currentValue instanceof Object) {\n            return this._getStyleTuplesFromObject(currentValue);\n        }\n        return emptyArray;\n    }\n    /** @internal */\n    _flushChanges() {\n        if (this._hasChanges) {\n            this._hasChanges = false;\n            const currentValue = this._value;\n            const styles = this.styles;\n            const styleTuples = this._getStyleTuples(currentValue);\n            let style;\n            let version = this.version;\n            this._oldValue = currentValue;\n            let tuple;\n            let name;\n            let value;\n            let i = 0;\n            const len = styleTuples.length;\n            for (; i < len; ++i) {\n                tuple = styleTuples[i];\n                name = tuple[0];\n                value = tuple[1];\n                this.setProperty(name, value);\n                styles[name] = version;\n            }\n            this.styles = styles;\n            this.version += 1;\n            if (version === 0) {\n                return;\n            }\n            version -= 1;\n            for (style in styles) {\n                if (!hasOwnProperty.call(styles, style) || styles[style] !== version) {\n                    continue;\n                }\n                this.obj.style.removeProperty(style);\n            }\n        }\n    }\n    setProperty(style, value) {\n        let priority = '';\n        if (value != null && isFunction(value.indexOf) && value.includes('!important')) {\n            priority = 'important';\n            value = value.replace('!important', '');\n        }\n        this.obj.style.setProperty(style, value, priority);\n    }\n    bind() {\n        this._value = this._oldValue = this.obj.style.cssText;\n    }\n}\n(() => {\n    mixinNoopSubscribable(StyleAttributeAccessor);\n})();\n\n/**\n * Observer for non-radio, non-checkbox input.\n */\nclass ValueAttributeObserver {\n    constructor(obj, key, config) {\n        // ObserverType.Layout is not always true, it depends on the element & property combo\n        // but for simplicity, always treat as such\n        this.type = (atNode | atObserver | atLayout);\n        /** @internal */\n        this._value = '';\n        /** @internal */\n        this._oldValue = '';\n        /** @internal */\n        this._hasChanges = false;\n        /**\n         * Used by mixing defined methods subscribe/unsubscribe\n         *\n         * @internal\n         */\n        this._listened = false;\n        this._el = obj;\n        this._key = key;\n        this._config = config;\n    }\n    getValue() {\n        // is it safe to assume the observer has the latest value?\n        // todo: ability to turn on/off cache based on type\n        return this._value;\n    }\n    setValue(newValue) {\n        if (areEqual(newValue, this._value)) {\n            return;\n        }\n        this._oldValue = this._value;\n        this._value = newValue;\n        this._hasChanges = true;\n        if (!this._config.readonly) {\n            this._flushChanges();\n        }\n    }\n    /** @internal */\n    _flushChanges() {\n        if (this._hasChanges) {\n            this._hasChanges = false;\n            this._el[this._key] = this._value ?? this._config.default;\n            this._flush();\n        }\n    }\n    handleEvent() {\n        this._oldValue = this._value;\n        this._value = this._el[this._key];\n        if (this._oldValue !== this._value) {\n            this._hasChanges = false;\n            this._flush();\n        }\n    }\n    /**\n     * Used by mixing defined methods subscribe\n     *\n     * @internal\n     */\n    _start() {\n        this._value = this._oldValue = this._el[this._key];\n    }\n    /** @internal */\n    _flush() {\n        const oV = this._oldValue;\n        this._oldValue = this._value;\n        this.subs.notify(this._value, oV);\n    }\n}\n(() => {\n    mixinNodeObserverUseConfig(ValueAttributeObserver);\n    subscriberCollection(ValueAttributeObserver, null);\n})();\n\nconst nsAttributes = (() => {\n    // https://infra.spec.whatwg.org/#namespaces\n    // const htmlNS = 'http://www.w3.org/1999/xhtml';\n    // const mathmlNS = 'http://www.w3.org/1998/Math/MathML';\n    // const svgNS = 'http://www.w3.org/2000/svg';\n    const xlinkNS = 'http://www.w3.org/1999/xlink';\n    const xmlNS = 'http://www.w3.org/XML/1998/namespace';\n    const xmlnsNS = 'http://www.w3.org/2000/xmlns/';\n    // https://html.spec.whatwg.org/multipage/syntax.html#attributes-2\n    return objectAssign(createLookup(), {\n        'xlink:actuate': ['actuate', xlinkNS],\n        'xlink:arcrole': ['arcrole', xlinkNS],\n        'xlink:href': ['href', xlinkNS],\n        'xlink:role': ['role', xlinkNS],\n        'xlink:show': ['show', xlinkNS],\n        'xlink:title': ['title', xlinkNS],\n        'xlink:type': ['type', xlinkNS],\n        'xml:lang': ['lang', xmlNS],\n        'xml:space': ['space', xmlNS],\n        'xmlns': ['xmlns', xmlnsNS],\n        'xmlns:xlink': ['xlink', xmlnsNS],\n    });\n})();\nconst elementPropertyAccessor = new PropertyAccessor();\nelementPropertyAccessor.type = (atNode | atLayout);\nclass NodeObserverLocator {\n    constructor() {\n        /**\n         * Indicates whether the node observer will be allowed to use dirty checking for a property it doesn't know how to observe\n         */\n        this.allowDirtyCheck = true;\n        /** @internal */\n        this._events = createLookup();\n        /** @internal */\n        this._globalEvents = createLookup();\n        /** @internal */\n        this._overrides = createLookup();\n        /** @internal */\n        this._globalOverrides = createLookup();\n        /** @internal */\n        this._locator = resolve(IServiceLocator);\n        /** @internal */\n        this._platform = resolve(IPlatform);\n        /** @internal */\n        this._dirtyChecker = resolve(IDirtyChecker);\n        /** @internal */\n        this.svg = resolve(ISVGAnalyzer);\n        // todo: atm, platform is required to be resolved too eagerly for the `.handles()` check\n        // also a lot of tests assume default availability of observation\n        // those 2 assumptions make it not the right time to extract the following line into a\n        // default configuration for NodeObserverLocator yet\n        // but in the future, they should be, so apps that don't use check box/select, or implement a different\n        // observer don't have to pay the of the default implementation\n        const inputEvents = ['change', 'input'];\n        const inputEventsConfig = { events: inputEvents, default: '' };\n        this.useConfig({\n            INPUT: {\n                value: inputEventsConfig,\n                valueAsNumber: { events: inputEvents, default: 0 },\n                checked: { type: CheckedObserver, events: inputEvents },\n                files: { events: inputEvents, readonly: true },\n            },\n            SELECT: {\n                value: { type: SelectValueObserver, events: ['change'], default: '' },\n            },\n            TEXTAREA: {\n                value: inputEventsConfig,\n            },\n        });\n        const contentEventsConfig = { events: ['change', 'input', 'blur', 'keyup', 'paste'], default: '' };\n        const scrollEventsConfig = { events: ['scroll'], default: 0 };\n        this.useConfigGlobal({\n            scrollTop: scrollEventsConfig,\n            scrollLeft: scrollEventsConfig,\n            textContent: contentEventsConfig,\n            innerHTML: contentEventsConfig,\n        });\n        this.overrideAccessorGlobal('css', 'style', 'class');\n        this.overrideAccessor({\n            INPUT: ['value', 'checked', 'model'],\n            SELECT: ['value'],\n            TEXTAREA: ['value'],\n        });\n    }\n    // deepscan-disable-next-line\n    handles(obj, _key) {\n        return obj instanceof this._platform.Node;\n    }\n    useConfig(nodeNameOrConfig, key, eventsConfig) {\n        const lookup = this._events;\n        let existingMapping;\n        if (isString(nodeNameOrConfig)) {\n            existingMapping = lookup[nodeNameOrConfig] ??= createLookup();\n            if (existingMapping[key] == null) {\n                existingMapping[key] = eventsConfig;\n            }\n            else {\n                throwMappingExisted(nodeNameOrConfig, key);\n            }\n        }\n        else {\n            for (const nodeName in nodeNameOrConfig) {\n                existingMapping = lookup[nodeName] ??= createLookup();\n                const newMapping = nodeNameOrConfig[nodeName];\n                for (key in newMapping) {\n                    if (existingMapping[key] == null) {\n                        existingMapping[key] = newMapping[key];\n                    }\n                    else {\n                        throwMappingExisted(nodeName, key);\n                    }\n                }\n            }\n        }\n    }\n    useConfigGlobal(configOrKey, eventsConfig) {\n        const lookup = this._globalEvents;\n        if (typeof configOrKey === 'object') {\n            for (const key in configOrKey) {\n                if (lookup[key] == null) {\n                    lookup[key] = configOrKey[key];\n                }\n                else {\n                    throwMappingExisted('*', key);\n                }\n            }\n        }\n        else {\n            if (lookup[configOrKey] == null) {\n                lookup[configOrKey] = eventsConfig;\n            }\n            else {\n                throwMappingExisted('*', configOrKey);\n            }\n        }\n    }\n    // deepscan-disable-nextline\n    getAccessor(obj, key, requestor) {\n        if (key in this._globalOverrides || (key in (this._overrides[obj.tagName] ?? emptyObject))) {\n            return this.getObserver(obj, key, requestor);\n        }\n        switch (key) {\n            // class / style / css attribute will be observed using .getObserver() per overrides\n            //\n            // TODO: there are (many) more situation where we want to default to DataAttributeAccessor\n            case 'src':\n            case 'href':\n            case 'role':\n            case 'minLength':\n            case 'maxLength':\n            case 'placeholder':\n            case 'size':\n            case 'pattern':\n            case 'title':\n            case 'popovertarget':\n            case 'popovertargetaction':\n                /* istanbul-ignore-next */\n                {\n                    if ((key === 'popovertarget' || key === 'popovertargetaction') && obj.nodeName !== 'INPUT' && obj.nodeName !== 'BUTTON') {\n                        // eslint-disable-next-line no-console\n                        console.warn(`[aurelia] Popover API are only valid on <input> or <button>. Detected ${key} on <${obj.nodeName.toLowerCase()}>`);\n                    }\n                }\n                // assigning null/undefined to size on input is an error\n                // though it may be fine on other elements.\n                // todo: make an effort to distinguish properties based on element name\n                // https://html.spec.whatwg.org/multipage/dom.html#wai-aria\n                return attrAccessor;\n            default: {\n                const nsProps = nsAttributes[key];\n                if (nsProps !== undefined) {\n                    return AttributeNSAccessor.forNs(nsProps[1]);\n                }\n                if (isDataAttribute(obj, key, this.svg)) {\n                    return attrAccessor;\n                }\n                return elementPropertyAccessor;\n            }\n        }\n    }\n    overrideAccessor(tagNameOrOverrides, key) {\n        let existingTagOverride;\n        if (isString(tagNameOrOverrides)) {\n            existingTagOverride = this._overrides[tagNameOrOverrides] ??= createLookup();\n            existingTagOverride[key] = true;\n        }\n        else {\n            for (const tagName in tagNameOrOverrides) {\n                for (const key of tagNameOrOverrides[tagName]) {\n                    existingTagOverride = this._overrides[tagName] ??= createLookup();\n                    existingTagOverride[key] = true;\n                }\n            }\n        }\n    }\n    /**\n     * For all elements:\n     * compose a list of properties,\n     * to indicate that an overser should be returned instead of an accessor in `.getAccessor()`\n     */\n    overrideAccessorGlobal(...keys) {\n        for (const key of keys) {\n            this._globalOverrides[key] = true;\n        }\n    }\n    getNodeObserverConfig(el, key) {\n        return this._events[el.tagName]?.[key] ?? this._globalEvents[key];\n    }\n    getNodeObserver(el, key, requestor) {\n        const eventsConfig = this._events[el.tagName]?.[key] ?? this._globalEvents[key];\n        let observer;\n        if (eventsConfig != null) {\n            observer = new (eventsConfig.type ?? ValueAttributeObserver)(el, key, eventsConfig, requestor, this._locator);\n            if (!observer.doNotCache) {\n                getObserverLookup(el)[key] = observer;\n            }\n            return observer;\n        }\n        return null;\n    }\n    getObserver(el, key, requestor) {\n        switch (key) {\n            case 'class':\n                // todo: invalid accessor returned for a get observer call\n                //       for now it's a noop observer\n                return new ClassAttributeAccessor(el);\n            case 'css':\n            case 'style':\n                // todo: invalid accessor returned for a get observer call\n                //       for now it's a noop observer\n                return new StyleAttributeAccessor(el);\n        }\n        const nodeObserver = this.getNodeObserver(el, key, requestor);\n        if (nodeObserver != null) {\n            return nodeObserver;\n        }\n        const nsProps = nsAttributes[key];\n        if (nsProps !== undefined) {\n            // todo: invalid accessor returned for a get observer call\n            //       for now it's a noop observer\n            return AttributeNSAccessor.forNs(nsProps[1]);\n        }\n        if (isDataAttribute(el, key, this.svg)) {\n            // todo: invalid accessor returned for a get observer call\n            //       for now it's a noop observer\n            return attrAccessor;\n        }\n        if (key in el.constructor.prototype) {\n            if (this.allowDirtyCheck) {\n                return this._dirtyChecker.createProperty(el, key);\n            }\n            // consider:\n            // - maybe add a adapter API to handle unknown obj/key combo\n            throw createMappedError(652 /* ErrorNames.node_observer_strategy_not_found */, key);\n        }\n        else {\n            // todo: probably still needs to get the property descriptor via getOwnPropertyDescriptor\n            // but let's start with simplest scenario\n            return new SetterObserver(el, key);\n        }\n    }\n}\nNodeObserverLocator.register = createImplementationRegister(INodeObserverLocator);\nfunction getCollectionObserver(collection, observerLocator) {\n    if (collection instanceof Array) {\n        return observerLocator.getArrayObserver(collection);\n    }\n    if (collection instanceof Map) {\n        return observerLocator.getMapObserver(collection);\n    }\n    if (collection instanceof Set) {\n        return observerLocator.getSetObserver(collection);\n    }\n}\nfunction throwMappingExisted(nodeName, key) {\n    throw createMappedError(653 /* ErrorNames.node_observer_mapping_existed */, nodeName, key);\n}\n\nfunction defaultMatcher(a, b) {\n    return a === b;\n}\nclass CheckedObserver {\n    constructor(obj, \n    // deepscan-disable-next-line\n    _key, config, observerLocator) {\n        this.type = (atNode | atObserver | atLayout);\n        /** @internal */\n        this._value = void 0;\n        /** @internal */\n        this._oldValue = void 0;\n        /** @internal */\n        this._collectionObserver = void 0;\n        /**\n         * There' situation when a checked observers is used together with `model.bind` on the checkbox\n         *\n         * Then this checked box also needs to observe the changes of tht model so that it will be able to referesh the value accordingly\n         *\n         * @internal\n         */\n        this._valueObserver = void 0;\n        /**\n         * Used by mixing defined methods subscribe/unsubscribe\n         *\n         * @internal\n         */\n        this._listened = false;\n        this._el = obj;\n        this.oL = observerLocator;\n        this._config = config;\n    }\n    getValue() {\n        return this._value;\n    }\n    setValue(newValue) {\n        const currentValue = this._value;\n        if (newValue === currentValue) {\n            return;\n        }\n        this._value = newValue;\n        this._oldValue = currentValue;\n        this._observe();\n        this._synchronizeElement();\n        this._flush();\n    }\n    handleCollectionChange() {\n        this._synchronizeElement();\n    }\n    handleChange(_newValue, _previousValue) {\n        this._synchronizeElement();\n    }\n    /** @internal */\n    _synchronizeElement() {\n        const currentValue = this._value;\n        const obj = this._el;\n        const elementValue = hasOwnProperty.call(obj, 'model') ? obj.model : obj.value;\n        const isRadio = obj.type === 'radio';\n        const matcher = obj.matcher !== void 0 ? obj.matcher : defaultMatcher;\n        if (isRadio) {\n            obj.checked = !!matcher(currentValue, elementValue);\n        }\n        else if (currentValue === true) {\n            obj.checked = true;\n        }\n        else {\n            let hasMatch = false;\n            if (isArray(currentValue)) {\n                hasMatch = currentValue.findIndex(item => !!matcher(item, elementValue)) !== -1;\n            }\n            else if (currentValue instanceof Set) {\n                for (const v of currentValue) {\n                    if (matcher(v, elementValue)) {\n                        hasMatch = true;\n                        break;\n                    }\n                }\n            }\n            else if (currentValue instanceof Map) {\n                for (const pair of currentValue) {\n                    const existingItem = pair[0];\n                    const $isChecked = pair[1];\n                    // a potential complain, when only `true` is supported\n                    // but it's consistent with array\n                    if (matcher(existingItem, elementValue) && $isChecked === true) {\n                        hasMatch = true;\n                        break;\n                    }\n                }\n            }\n            obj.checked = hasMatch;\n        }\n    }\n    handleEvent() {\n        let currentValue = this._oldValue = this._value;\n        const obj = this._el;\n        const elementValue = hasOwnProperty.call(obj, 'model') ? obj.model : obj.value;\n        const isChecked = obj.checked;\n        const matcher = obj.matcher !== void 0 ? obj.matcher : defaultMatcher;\n        if (obj.type === 'checkbox') {\n            if (isArray(currentValue)) {\n                // Array binding steps on a change event:\n                // 1. find corresponding item INDEX in the Set based on current model/value and matcher\n                // 2. is the checkbox checked?\n                //    2.1. Yes: is the corresponding item in the Array (index === -1)?\n                //        2.1.1 No: push the current model/value to the Array\n                //    2.2. No: is the corresponding item in the Array (index !== -1)?\n                //        2.2.1: Yes: remove the corresponding item\n                // =================================================\n                const index = currentValue.findIndex(item => !!matcher(item, elementValue));\n                // if the checkbox is checkde, and there's no matching value in the existing array\n                // add the checkbox model/value to the array\n                if (isChecked && index === -1) {\n                    currentValue.push(elementValue);\n                }\n                else if (!isChecked && index !== -1) {\n                    // if the checkbox is not checked, and found a matching item in the array\n                    // based on the checkbox model/value\n                    // remove the existing item\n                    currentValue.splice(index, 1);\n                }\n                // when existing currentValue is an array,\n                // do not invoke callback as only the array obj has changed\n                return;\n            }\n            else if (currentValue instanceof Set) {\n                // Set binding steps on a change event:\n                // 1. find corresponding item in the Set based on current model/value and matcher\n                // 2. is the checkbox checked?\n                //    2.1. Yes: is the corresponding item in the Set?\n                //        2.1.1 No: add the current model/value to the Set\n                //    2.2. No: is the corresponding item in the Set?\n                //        2.2.1: Yes: remove the corresponding item\n                // =================================================\n                // 1. find corresponding item\n                const unset = {};\n                let existingItem = unset;\n                for (const value of currentValue) {\n                    if (matcher(value, elementValue) === true) {\n                        existingItem = value;\n                        break;\n                    }\n                }\n                // 2.1. Checkbox is checked, is the corresponding item in the Set?\n                //\n                // if checkbox is checked and there's no value in the existing Set\n                // add the checkbox model/value to the Set\n                if (isChecked && existingItem === unset) {\n                    // 2.1.1. add the current model/value to the Set\n                    currentValue.add(elementValue);\n                }\n                else if (!isChecked && existingItem !== unset) {\n                    // 2.2.1 Checkbox is unchecked, corresponding is in the Set\n                    //\n                    // if checkbox is not checked, and found a matching item in the Set\n                    // based on the checkbox model/value\n                    // remove the existing item\n                    currentValue.delete(existingItem);\n                }\n                // when existing value is a Set,\n                // do not invoke callback as only the Set has been mutated\n                return;\n            }\n            else if (currentValue instanceof Map) {\n                // Map binding steps on a change event\n                // 1. find corresponding item in the Map based on current model/value and matcher\n                // 2. Set the value of the corresponding item in the Map based on checked state of the checkbox\n                // =================================================\n                // 1. find the corresponding item\n                let existingItem;\n                for (const pair of currentValue) {\n                    const currItem = pair[0];\n                    if (matcher(currItem, elementValue) === true) {\n                        existingItem = currItem;\n                        break;\n                    }\n                }\n                // 2. set the value of the corresponding item in the map\n                // if checkbox is checked and there's no value in the existing Map\n                // add the checkbox model/value to the Map as key,\n                // and value will be checked state of the checkbox\n                currentValue.set(existingItem, isChecked);\n                // when existing value is a Map,\n                // do not invoke callback as only the Map has been mutated\n                return;\n            }\n            currentValue = isChecked;\n        }\n        else if (isChecked) {\n            currentValue = elementValue;\n        }\n        else {\n            // if it's a radio and it has been unchecked\n            // do nothing, as the radio that was checked will fire change event and it will be handle there\n            // a radio cannot be unchecked by user\n            return;\n        }\n        this._value = currentValue;\n        this._flush();\n    }\n    /**\n     * Used by mixing defined methods subscribe\n     *\n     * @internal\n     */\n    _start() {\n        this._observe();\n    }\n    /**\n     * Used by mixing defined methods unsubscribe\n     *\n     * @internal\n     */\n    _stop() {\n        this._value = this._oldValue = void 0;\n        this._collectionObserver?.unsubscribe(this);\n        this._valueObserver?.unsubscribe(this);\n        this._collectionObserver = this._valueObserver = void 0;\n    }\n    /** @internal */\n    _flush() {\n        oV = this._oldValue;\n        this._oldValue = this._value;\n        this.subs.notify(this._value, oV);\n        oV = void 0;\n    }\n    /** @internal */\n    _observe() {\n        const obj = this._el;\n        (this._valueObserver ??= obj.$observers?.model ?? obj.$observers?.value)?.subscribe(this);\n        this._collectionObserver?.unsubscribe(this);\n        this._collectionObserver = void 0;\n        if (obj.type === 'checkbox') {\n            (this._collectionObserver = getCollectionObserver(this._value, this.oL))?.subscribe(this);\n        }\n    }\n}\n(() => {\n    mixinNodeObserverUseConfig(CheckedObserver);\n    subscriberCollection(CheckedObserver, null);\n})();\n// a reusable variable for `.flush()` methods of observers\n// so that there doesn't need to create an env record for every call\nlet oV = void 0;\n\nclass AttrBindingBehavior {\n    bind(_scope, binding) {\n        if (!(binding instanceof PropertyBinding)) {\n            throw createMappedError(9994 /* ErrorNames.attr_behavior_invalid_binding */, binding);\n        }\n        binding.useTargetObserver(attrAccessor);\n    }\n}\nAttrBindingBehavior.$au = {\n    type: behaviorTypeName,\n    name: 'attr',\n};\n\nclass SelfBindingBehavior {\n    bind(_scope, binding) {\n        if (!('handleEvent' in binding)) {\n            throw createMappedError(801 /* ErrorNames.self_behavior_invalid_usage */);\n        }\n        binding.self = true;\n    }\n    unbind(_scope, binding) {\n        binding.self = false;\n    }\n}\nSelfBindingBehavior.$au = {\n    type: behaviorTypeName,\n    name: 'self',\n};\n\nclass UpdateTriggerBindingBehavior {\n    constructor() {\n        /** @internal */ this._observerLocator = resolve(IObserverLocator);\n        /** @internal */ this._nodeObserverLocator = resolve(INodeObserverLocator);\n    }\n    bind(_scope, binding, ...events) {\n        if (!(this._nodeObserverLocator instanceof NodeObserverLocator)) {\n            throw createMappedError(9993 /* ErrorNames.update_trigger_behavior_not_supported */);\n        }\n        if (events.length === 0) {\n            throw createMappedError(802 /* ErrorNames.update_trigger_behavior_no_triggers */);\n        }\n        if (!(binding instanceof PropertyBinding) || !(binding.mode & fromView)) {\n            throw createMappedError(803 /* ErrorNames.update_trigger_invalid_usage */);\n        }\n        // ensure the binding's target observer has been set.\n        const targetConfig = this._nodeObserverLocator.getNodeObserverConfig(binding.target, binding.targetProperty);\n        // todo(bigopon): potentially updateTrigger can be used to teach Aurelia adhoc listening capability\n        //                since event names are the only thing needed\n        if (targetConfig == null) {\n            throw createMappedError(9992 /* ErrorNames.update_trigger_behavior_node_property_not_observable */, binding);\n        }\n        const targetObserver = this._nodeObserverLocator.getNodeObserver(binding.target, binding.targetProperty, this._observerLocator); // the check on targetConfig ensures it's not null, save execessive check her\n        targetObserver.useConfig({ readonly: targetConfig.readonly, default: targetConfig.default, events });\n        binding.useTargetObserver(targetObserver);\n    }\n}\nUpdateTriggerBindingBehavior.$au = {\n    type: behaviorTypeName,\n    name: 'updateTrigger',\n};\n\n/* eslint-disable @typescript-eslint/strict-boolean-expressions */\nclass If {\n    constructor() {\n        this.elseFactory = void 0;\n        this.elseView = void 0;\n        this.ifView = void 0;\n        this.view = void 0;\n        this.value = false;\n        /**\n         * `false` to always dispose the existing `view` whenever the value of if changes to false\n         */\n        this.cache = true;\n        this.pending = void 0;\n        /** @internal */ this._wantsDeactivate = false;\n        /** @internal */ this._swapId = 0;\n        /** @internal */ this._ifFactory = resolve(IViewFactory);\n        /** @internal */ this._location = resolve(IRenderLocation);\n    }\n    attaching(_initiator, _parent) {\n        return this._swap(this.value);\n    }\n    detaching(initiator, _parent) {\n        this._wantsDeactivate = true;\n        return onResolve(this.pending, () => {\n            this._wantsDeactivate = false;\n            this.pending = void 0;\n            // Promise return values from user VM hooks are awaited by the initiator\n            void this.view?.deactivate(initiator, this.$controller);\n        });\n    }\n    valueChanged(newValue, oldValue) {\n        if (!this.$controller.isActive)\n            return;\n        newValue = !!newValue;\n        oldValue = !!oldValue;\n        if (newValue !== oldValue)\n            return this._swap(newValue);\n    }\n    /** @internal */\n    _swap(value) {\n        const currView = this.view;\n        const ctrl = this.$controller;\n        const swapId = this._swapId++;\n        /**\n         * returns true when\n         * 1. entering deactivation of the [if] itself\n         * 2. new swap has started since this change\n         */\n        const isCurrent = () => !this._wantsDeactivate && this._swapId === swapId + 1;\n        let view;\n        return onResolve(this.pending, () => this.pending = onResolve(currView?.deactivate(currView, ctrl), () => {\n            if (!isCurrent()) {\n                return;\n            }\n            // falsy -> truthy\n            if (value) {\n                view = (this.view = this.ifView = this.cache && this.ifView != null\n                    ? this.ifView\n                    : this._ifFactory.create());\n            }\n            else {\n                // truthy -> falsy\n                view = (this.view = this.elseView = this.cache && this.elseView != null\n                    ? this.elseView\n                    : this.elseFactory?.create());\n            }\n            // if the value is falsy\n            // and there's no [else], `view` will be null\n            if (view == null) {\n                return;\n            }\n            // todo: location should be based on either the [if]/[else] attribute\n            //       instead of always of the [if]\n            view.setLocation(this._location);\n            return onResolve(view.activate(view, ctrl, ctrl.scope), () => {\n                if (isCurrent()) {\n                    this.pending = void 0;\n                }\n            });\n        }));\n    }\n    dispose() {\n        this.ifView?.dispose();\n        this.elseView?.dispose();\n        this.ifView\n            = this.elseView\n                = this.view\n                    = void 0;\n    }\n    accept(visitor) {\n        if (this.view?.accept(visitor) === true) {\n            return true;\n        }\n    }\n}\nIf.$au = {\n    type: attrTypeName,\n    name: 'if',\n    isTemplateController: true,\n    bindables: {\n        value: true,\n        cache: {\n            set: (v) => v === '' || !!v && v !== 'false',\n        }\n    }\n};\nclass Else {\n    constructor() {\n        /** @internal */ this._factory = resolve(IViewFactory);\n    }\n    link(controller, _childController, _target, _instruction) {\n        const children = controller.children;\n        const ifBehavior = children[children.length - 1];\n        if (ifBehavior instanceof If) {\n            ifBehavior.elseFactory = this._factory;\n        }\n        else if (ifBehavior.viewModel instanceof If) {\n            ifBehavior.viewModel.elseFactory = this._factory;\n        }\n        else {\n            throw createMappedError(810 /* ErrorNames.else_without_if */);\n        }\n    }\n}\nElse.$au = {\n    type: 'custom-attribute',\n    name: 'else',\n    isTemplateController: true,\n};\n\nfunction dispose(disposable) {\n    disposable.dispose();\n}\nconst wrappedExprs = [\n    'BindingBehavior',\n    'ValueConverter',\n];\nclass Repeat {\n    constructor() {\n        this.views = [];\n        this.key = null;\n        /** @internal */ this._oldViews = [];\n        /** @internal */ this._scopes = [];\n        /** @internal */ this._oldScopes = [];\n        /** @internal */ this._scopeMap = new Map();\n        /** @internal */ this._observer = void 0;\n        /** @internal */ this._observingInnerItems = false;\n        /** @internal */ this._reevaluating = false;\n        /** @internal */ this._innerItemsExpression = null;\n        /** @internal */ this._normalizedItems = void 0;\n        /** @internal */ this._hasDestructuredLocal = false;\n        /** @internal */ this._location = resolve(IRenderLocation);\n        /** @internal */ this._parent = resolve(IController);\n        /** @internal */ this._factory = resolve(IViewFactory);\n        /** @internal */ this._resolver = resolve(IRepeatableHandlerResolver);\n        const instruction = resolve(IInstruction);\n        const keyProp = instruction.props[0].props[0];\n        if (keyProp !== void 0) {\n            const { to, value, command } = keyProp;\n            if (to === 'key') {\n                if (command === null) {\n                    this.key = value;\n                }\n                else if (command === 'bind') {\n                    this.key = resolve(IExpressionParser).parse(value, etIsProperty);\n                }\n                else {\n                    throw createMappedError(775 /* ErrorNames.repeat_invalid_key_binding_command */, command);\n                }\n            }\n            else {\n                throw createMappedError(776 /* ErrorNames.repeat_extraneous_binding */, to);\n            }\n        }\n    }\n    binding(_initiator, _parent) {\n        const bindings = this._parent.bindings;\n        const ii = bindings.length;\n        let binding = (void 0);\n        let forOf;\n        let i = 0;\n        for (; ii > i; ++i) {\n            binding = bindings[i];\n            if (binding.target === this && binding.targetProperty === 'items') {\n                forOf = this.forOf = binding.ast;\n                this._forOfBinding = binding;\n                let expression = forOf.iterable;\n                while (expression != null && wrappedExprs.includes(expression.$kind)) {\n                    expression = expression.expression;\n                    this._observingInnerItems = true;\n                }\n                this._innerItemsExpression = expression;\n                break;\n            }\n        }\n        this._refreshCollectionObserver();\n        const dec = forOf.declaration;\n        if (!(this._hasDestructuredLocal = dec.$kind === 'ArrayDestructuring' || dec.$kind === 'ObjectDestructuring')) {\n            this.local = astEvaluate(dec, this.$controller.scope, binding, null);\n        }\n    }\n    attaching(initiator, _parent) {\n        this._normalizeToArray();\n        this._createScopes(void 0);\n        return this._activateAllViews(initiator, this._normalizedItems ?? emptyArray);\n    }\n    detaching(initiator, _parent) {\n        this._refreshCollectionObserver();\n        return this._deactivateAllViews(initiator);\n    }\n    unbinding(_initiator, _parent) {\n        this._scopeMap.clear();\n    }\n    // called by SetterObserver\n    itemsChanged() {\n        if (!this.$controller.isActive) {\n            return;\n        }\n        this._refreshCollectionObserver();\n        this._normalizeToArray();\n        this._createScopes(void 0);\n        this._applyIndexMap(void 0);\n    }\n    handleCollectionChange(collection, indexMap) {\n        const $controller = this.$controller;\n        if (!$controller.isActive) {\n            return;\n        }\n        if (this._observingInnerItems) {\n            if (this._reevaluating) {\n                return;\n            }\n            this._reevaluating = true;\n            this.items = astEvaluate(this.forOf.iterable, $controller.scope, this._forOfBinding, null);\n            this._reevaluating = false;\n            return;\n        }\n        this._normalizeToArray();\n        this._createScopes(this.key === null ? indexMap : void 0);\n        this._applyIndexMap(indexMap);\n    }\n    /** @internal */\n    _applyIndexMap(indexMap) {\n        const oldViews = this.views;\n        this._oldViews = oldViews.slice();\n        const oldLen = oldViews.length;\n        const key = this.key;\n        const hasKey = key !== null;\n        const oldScopes = this._oldScopes;\n        const newScopes = this._scopes;\n        if (hasKey || indexMap === void 0) {\n            const local = this.local;\n            const newItems = this._normalizedItems;\n            const newLen = newItems.length;\n            const forOf = this.forOf;\n            const dec = forOf.declaration;\n            const binding = this._forOfBinding;\n            const hasDestructuredLocal = this._hasDestructuredLocal;\n            indexMap = createIndexMap(newLen);\n            let i = 0;\n            if (oldLen === 0) {\n                // Only add new views\n                for (; i < newLen; ++i) {\n                    indexMap[i] = -2;\n                }\n            }\n            else if (newLen === 0) {\n                // Only remove old views\n                for (i = 0; i < oldLen; ++i) {\n                    indexMap.deletedIndices.push(i);\n                    indexMap.deletedItems.push(getItem(hasDestructuredLocal, dec, oldScopes[i], binding, local));\n                }\n            }\n            else if (hasKey) {\n                const oldKeys = Array(oldLen);\n                for (i = 0; i < oldLen; ++i) {\n                    oldKeys[i] = getKeyValue(hasDestructuredLocal, key, dec, oldScopes[i], binding, local);\n                }\n                const newKeys = Array(oldLen);\n                for (i = 0; i < newLen; ++i) {\n                    newKeys[i] = getKeyValue(hasDestructuredLocal, key, dec, newScopes[i], binding, local);\n                }\n                for (i = 0; i < newLen; ++i) {\n                    if (oldKeys.includes(newKeys[i])) {\n                        indexMap[i] = oldKeys.indexOf(newKeys[i]);\n                    }\n                    else {\n                        indexMap[i] = -2;\n                    }\n                }\n                for (i = 0; i < oldLen; ++i) {\n                    if (!newKeys.includes(oldKeys[i])) {\n                        indexMap.deletedIndices.push(i);\n                        indexMap.deletedItems.push(getItem(hasDestructuredLocal, dec, oldScopes[i], binding, local));\n                    }\n                }\n            }\n            else {\n                for (i = 0; i < newLen; ++i) {\n                    if (oldScopes.includes(newScopes[i])) {\n                        indexMap[i] = oldScopes.indexOf(newScopes[i]);\n                    }\n                    else {\n                        indexMap[i] = -2;\n                    }\n                }\n                for (i = 0; i < oldLen; ++i) {\n                    if (!newScopes.includes(oldScopes[i])) {\n                        indexMap.deletedIndices.push(i);\n                        indexMap.deletedItems.push(getItem(hasDestructuredLocal, dec, oldScopes[i], binding, local));\n                    }\n                }\n            }\n        }\n        // first detach+unbind+(remove from array) the deleted view indices\n        if (indexMap.deletedIndices.length > 0) {\n            const ret = onResolve(this._deactivateAndRemoveViewsByKey(indexMap), () => {\n                // TODO(fkleuver): add logic to the controller that ensures correct handling of race conditions and add a variety of `if` integration tests\n                return this._createAndActivateAndSortViewsByKey(indexMap);\n            });\n            if (isPromise(ret)) {\n                ret.catch(rethrow);\n            }\n        }\n        else {\n            // TODO(fkleuver): add logic to the controller that ensures correct handling of race conditions and add integration tests\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this._createAndActivateAndSortViewsByKey(indexMap);\n        }\n    }\n    // todo: subscribe to collection from inner expression\n    /** @internal */\n    _refreshCollectionObserver() {\n        const scope = this.$controller.scope;\n        let innerItems = this._innerItems;\n        let observingInnerItems = this._observingInnerItems;\n        let newObserver;\n        if (observingInnerItems) {\n            innerItems = this._innerItems = astEvaluate(this._innerItemsExpression, scope, this._forOfBinding, null) ?? null;\n            observingInnerItems = this._observingInnerItems = !areEqual(this.items, innerItems);\n        }\n        const oldObserver = this._observer;\n        if (this.$controller.isActive) {\n            const items = observingInnerItems ? innerItems : this.items;\n            newObserver = this._observer = this._resolver.resolve(items).getObserver?.(items);\n            if (oldObserver !== newObserver) {\n                oldObserver?.unsubscribe(this);\n                newObserver?.subscribe(this);\n            }\n        }\n        else {\n            oldObserver?.unsubscribe(this);\n            this._observer = undefined;\n        }\n    }\n    /** @internal */\n    _createScopes(indexMap) {\n        const oldScopes = this._scopes;\n        this._oldScopes = oldScopes.slice();\n        const items = this._normalizedItems;\n        const len = items.length;\n        const scopes = this._scopes = Array(items.length);\n        const oldScopeMap = this._scopeMap;\n        const newScopeMap = new Map();\n        const parentScope = this.$controller.scope;\n        const binding = this._forOfBinding;\n        const forOf = this.forOf;\n        const local = this.local;\n        const hasDestructuredLocal = this._hasDestructuredLocal;\n        if (indexMap === void 0) {\n            const key = this.key;\n            const hasKey = key !== null;\n            if (hasKey) {\n                const keys = Array(len);\n                if (typeof key === 'string') {\n                    for (let i = 0; i < len; ++i) {\n                        keys[i] = items[i][key];\n                    }\n                }\n                else {\n                    for (let i = 0; i < len; ++i) {\n                        // This method of creating a throwaway scope just for key evaluation is inefficient but requires a lot less code this way.\n                        // It seems acceptable for what should be a niche use case and this way it's guaranteed to work correctly in all cases.\n                        // When performance matters, it is advised to use normal string-based keys instead of expressions:\n                        // `repeat.for=\"i of items; key.bind: i.key\" - inefficient\n                        // `repeat.for=\"i of items; key: key\" - efficient\n                        const scope = createScope(items[i], forOf, parentScope, binding, local, hasDestructuredLocal);\n                        setItem(hasDestructuredLocal, forOf.declaration, scope, binding, local, items[i]);\n                        keys[i] = astEvaluate(key, scope, binding, null);\n                    }\n                }\n                for (let i = 0; i < len; ++i) {\n                    scopes[i] = getScope(oldScopeMap, newScopeMap, keys[i], items[i], forOf, parentScope, binding, local, hasDestructuredLocal);\n                }\n            }\n            else {\n                for (let i = 0; i < len; ++i) {\n                    scopes[i] = getScope(oldScopeMap, newScopeMap, items[i], items[i], forOf, parentScope, binding, local, hasDestructuredLocal);\n                }\n            }\n        }\n        else {\n            const oldLen = oldScopes.length;\n            for (let i = 0; i < len; ++i) {\n                const src = indexMap[i];\n                if (src >= 0 && src < oldLen) {\n                    scopes[i] = oldScopes[src];\n                }\n                else {\n                    scopes[i] = createScope(items[i], forOf, parentScope, binding, local, hasDestructuredLocal);\n                }\n                setItem(hasDestructuredLocal, forOf.declaration, scopes[i], binding, local, items[i]);\n            }\n        }\n        oldScopeMap.clear();\n        this._scopeMap = newScopeMap;\n    }\n    /** @internal */\n    _normalizeToArray() {\n        const items = this.items;\n        if (isArray(items)) {\n            this._normalizedItems = items.slice(0);\n            return;\n        }\n        const normalizedItems = [];\n        this._resolver.resolve(items).iterate(items, (item, index) => {\n            normalizedItems[index] = item;\n        });\n        this._normalizedItems = normalizedItems;\n    }\n    /** @internal */\n    _activateAllViews(initiator, $items) {\n        let promises = void 0;\n        let ret;\n        let view;\n        let scope;\n        const { $controller, _factory, _location, _scopes } = this;\n        const newLen = $items.length;\n        const views = this.views = Array(newLen);\n        for (let i = 0; i < newLen; ++i) {\n            view = views[i] = _factory.create().setLocation(_location);\n            view.nodes.unlink();\n            scope = _scopes[i];\n            setContextualProperties(scope.overrideContext, i, newLen);\n            ret = view.activate(initiator ?? view, $controller, scope);\n            if (isPromise(ret)) {\n                (promises ??= []).push(ret);\n            }\n        }\n        if (promises !== void 0) {\n            return promises.length === 1\n                ? promises[0]\n                : Promise.all(promises);\n        }\n    }\n    /** @internal */\n    _deactivateAllViews(initiator) {\n        let promises = void 0;\n        let ret;\n        let view;\n        let i = 0;\n        const { views, $controller } = this;\n        const ii = views.length;\n        for (; ii > i; ++i) {\n            view = views[i];\n            view.release();\n            ret = view.deactivate(initiator ?? view, $controller);\n            if (isPromise(ret)) {\n                (promises ?? (promises = [])).push(ret);\n            }\n        }\n        if (promises !== void 0) {\n            return (promises.length === 1\n                ? promises[0]\n                : Promise.all(promises));\n        }\n    }\n    /** @internal */\n    _deactivateAndRemoveViewsByKey(indexMap) {\n        let promises = void 0;\n        let ret;\n        let view;\n        const { $controller, views } = this;\n        const deleted = indexMap.deletedIndices.slice().sort(compareNumber);\n        const deletedLen = deleted.length;\n        let i = 0;\n        for (; deletedLen > i; ++i) {\n            view = views[deleted[i]];\n            view.release();\n            ret = view.deactivate(view, $controller);\n            if (isPromise(ret)) {\n                (promises ?? (promises = [])).push(ret);\n            }\n        }\n        i = 0;\n        for (; deletedLen > i; ++i) {\n            views.splice(deleted[i] - i, 1);\n        }\n        if (promises !== void 0) {\n            return promises.length === 1\n                ? promises[0]\n                : Promise.all(promises);\n        }\n    }\n    /** @internal */\n    _createAndActivateAndSortViewsByKey(indexMap) {\n        let promises = void 0;\n        let ret;\n        let view;\n        let i = 0;\n        const { $controller, _factory, _location, views, _scopes, _oldViews } = this;\n        const newLen = indexMap.length;\n        for (; newLen > i; ++i) {\n            if (indexMap[i] === -2) {\n                view = _factory.create();\n                views.splice(i, 0, view);\n            }\n        }\n        if (views.length !== newLen) {\n            throw createMappedError(814 /* ErrorNames.repeat_mismatch_length */, [views.length, newLen]);\n        }\n        let source = 0;\n        i = 0;\n        for (; i < indexMap.length; ++i) {\n            if ((source = indexMap[i]) !== -2) {\n                views[i] = _oldViews[source];\n            }\n        }\n        // this algorithm retrieves the indices of the longest increasing subsequence of items in the repeater\n        // the items on those indices are not moved; this minimizes the number of DOM operations that need to be performed\n        const seq = longestIncreasingSubsequence(indexMap);\n        const seqLen = seq.length;\n        let next;\n        let j = seqLen - 1;\n        i = newLen - 1;\n        for (; i >= 0; --i) {\n            view = views[i];\n            next = views[i + 1];\n            if (indexMap[i] === -2) {\n                view.nodes.link(next?.nodes ?? _location);\n                view.setLocation(_location);\n                setContextualProperties(_scopes[i].overrideContext, i, newLen);\n                ret = view.activate(view, $controller, _scopes[i]);\n                if (isPromise(ret)) {\n                    (promises ?? (promises = [])).push(ret);\n                }\n            }\n            else if (j < 0 || i !== seq[j]) {\n                view.nodes.link(next?.nodes ?? _location);\n                setContextualProperties(view.scope.overrideContext, i, newLen);\n                view.nodes.insertBefore(view.location);\n            }\n            else {\n                setContextualProperties(view.scope.overrideContext, i, newLen);\n                --j;\n            }\n        }\n        if (promises !== void 0) {\n            return promises.length === 1\n                ? promises[0]\n                : Promise.all(promises);\n        }\n    }\n    dispose() {\n        this.views.forEach(dispose);\n        this.views = (void 0);\n    }\n    accept(visitor) {\n        const { views } = this;\n        if (views !== void 0) {\n            for (let i = 0, ii = views.length; i < ii; ++i) {\n                if (views[i].accept(visitor) === true) {\n                    return true;\n                }\n            }\n        }\n    }\n}\nRepeat.$au = {\n    type: attrTypeName,\n    name: 'repeat',\n    isTemplateController: true,\n    bindables: ['items'],\n};\nlet maxLen = 16;\nlet prevIndices = new Int32Array(maxLen);\nlet tailIndices = new Int32Array(maxLen);\n// Based on inferno's lis_algorithm @ https://github.com/infernojs/inferno/blob/master/packages/inferno/src/DOM/patching.ts#L732\n// with some tweaks to make it just a bit faster + account for IndexMap (and some names changes for readability)\n/** @internal */\nfunction longestIncreasingSubsequence(indexMap) {\n    const len = indexMap.length;\n    if (len > maxLen) {\n        maxLen = len;\n        prevIndices = new Int32Array(len);\n        tailIndices = new Int32Array(len);\n    }\n    let cursor = 0;\n    let cur = 0;\n    let prev = 0;\n    let i = 0;\n    let j = 0;\n    let low = 0;\n    let high = 0;\n    let mid = 0;\n    for (; i < len; i++) {\n        cur = indexMap[i];\n        if (cur !== -2) {\n            j = prevIndices[cursor];\n            prev = indexMap[j];\n            if (prev !== -2 && prev < cur) {\n                tailIndices[i] = j;\n                prevIndices[++cursor] = i;\n                continue;\n            }\n            low = 0;\n            high = cursor;\n            while (low < high) {\n                mid = (low + high) >> 1;\n                prev = indexMap[prevIndices[mid]];\n                if (prev !== -2 && prev < cur) {\n                    low = mid + 1;\n                }\n                else {\n                    high = mid;\n                }\n            }\n            prev = indexMap[prevIndices[low]];\n            if (cur < prev || prev === -2) {\n                if (low > 0) {\n                    tailIndices[i] = prevIndices[low - 1];\n                }\n                prevIndices[low] = i;\n            }\n        }\n    }\n    i = ++cursor;\n    const result = new Int32Array(i);\n    cur = prevIndices[cursor - 1];\n    while (cursor-- > 0) {\n        result[cursor] = cur;\n        cur = tailIndices[cur];\n    }\n    while (i-- > 0)\n        prevIndices[i] = 0;\n    return result;\n}\nclass RepeatOverrideContext {\n    get $odd() {\n        return !this.$even;\n    }\n    get $even() {\n        return this.$index % 2 === 0;\n    }\n    get $first() {\n        return this.$index === 0;\n    }\n    get $middle() {\n        return !this.$first && !this.$last;\n    }\n    get $last() {\n        return this.$index === this.$length - 1;\n    }\n    constructor($index = 0, $length = 1) {\n        this.$index = $index;\n        this.$length = $length;\n    }\n}\nconst setContextualProperties = (oc, index, length) => {\n    oc.$index = index;\n    oc.$length = length;\n};\nconst IRepeatableHandlerResolver = /*@__PURE__*/ createInterface('IRepeatableHandlerResolver', x => x.singleton(RepeatableHandlerResolver));\n/**\n * The default implementation of the IRepeatableHandlerResolver interface\n */\nclass RepeatableHandlerResolver {\n    constructor() {\n        /** @internal */\n        this._handlers = resolve(all(IRepeatableHandler));\n    }\n    resolve(value) {\n        if (_arrayHandler.handles(value)) {\n            return _arrayHandler;\n        }\n        if (_setHandler.handles(value)) {\n            return _setHandler;\n        }\n        if (_mapHandler.handles(value)) {\n            return _mapHandler;\n        }\n        if (_numberHandler.handles(value)) {\n            return _numberHandler;\n        }\n        if (_nullishHandler.handles(value)) {\n            return _nullishHandler;\n        }\n        const handler = this._handlers.find(x => x.handles(value));\n        if (handler !== void 0) {\n            return handler;\n        }\n        return _unknownHandler;\n    }\n}\n/**\n * A simple implementation for handling common array like values, such as:\n * - HTMLCollection\n * - NodeList\n * - FileList,\n * - etc...\n */\nclass ArrayLikeHandler {\n    static register(c) {\n        c.register(singletonRegistration(IRepeatableHandler, this));\n    }\n    handles(value) {\n        return 'length' in value && isNumber(value.length);\n    }\n    iterate(items, func) {\n        for (let i = 0, ii = items.length; i < ii; ++i) {\n            func(items[i], i, items);\n        }\n    }\n}\n/**\n * An interface describing a repeatable value handler\n */\nconst IRepeatableHandler = /*@__PURE__*/ createInterface('IRepeatableHandler');\nconst _arrayHandler = {\n    handles: isArray,\n    getObserver: getCollectionObserver$1,\n    /* istanbul ignore next */\n    iterate(value, func) {\n        const ii = value.length;\n        let i = 0;\n        for (; i < ii; ++i) {\n            func(value[i], i, value);\n        }\n    },\n    // getCount: items => items.length,\n};\nconst _setHandler = {\n    handles: isSet,\n    getObserver: getCollectionObserver$1,\n    iterate(value, func) {\n        let i = 0;\n        let key;\n        for (key of value.keys()) {\n            func(key, i++, value);\n        }\n    },\n    // getCount: s => s.size,\n};\nconst _mapHandler = {\n    handles: isMap,\n    getObserver: getCollectionObserver$1,\n    iterate(value, func) {\n        let i = 0;\n        let entry;\n        for (entry of value.entries()) {\n            func(entry, i++, value);\n        }\n    },\n    // getCount: s => s.size,\n};\nconst _numberHandler = {\n    handles: isNumber,\n    iterate(value, func) {\n        let i = 0;\n        for (; i < value; ++i) {\n            func(i, i, value);\n        }\n    },\n    // getCount: v => v,\n};\nconst _nullishHandler = {\n    handles: v => v == null,\n    iterate() { },\n    // getCount: () => 0,\n};\nconst _unknownHandler = {\n    handles(_value) {\n        // Should only return as an explicit last fallback\n        return false;\n    },\n    iterate(value, _func) {\n        throw createMappedError(777 /* ErrorNames.repeat_non_iterable */, value);\n    },\n    // getCount: () => 0,\n};\nconst setItem = (hasDestructuredLocal, dec, scope, binding, local, item) => {\n    if (hasDestructuredLocal) {\n        astAssign(dec, scope, binding, null, item);\n    }\n    else {\n        scope.bindingContext[local] = item;\n    }\n};\nconst getItem = (hasDestructuredLocal, dec, scope, binding, local) => {\n    return hasDestructuredLocal ? astEvaluate(dec, scope, binding, null) : scope.bindingContext[local];\n};\nconst getKeyValue = (hasDestructuredLocal, key, dec, scope, binding, local) => {\n    if (typeof key === 'string') {\n        const item = getItem(hasDestructuredLocal, dec, scope, binding, local);\n        return item[key];\n    }\n    return astEvaluate(key, scope, binding, null);\n};\nconst getScope = (oldScopeMap, newScopeMap, key, item, forOf, parentScope, binding, local, hasDestructuredLocal) => {\n    let scope = oldScopeMap.get(key);\n    if (scope === void 0) {\n        scope = createScope(item, forOf, parentScope, binding, local, hasDestructuredLocal);\n    }\n    else if (scope instanceof Scope) {\n        oldScopeMap.delete(key);\n    }\n    else if (scope.length === 1) {\n        scope = scope[0];\n        oldScopeMap.delete(key);\n    }\n    else {\n        scope = scope.shift();\n    }\n    if (newScopeMap.has(key)) {\n        const entry = newScopeMap.get(key);\n        if (entry instanceof Scope) {\n            newScopeMap.set(key, [entry, scope]);\n        }\n        else {\n            entry.push(scope);\n        }\n    }\n    else {\n        newScopeMap.set(key, scope);\n    }\n    setItem(hasDestructuredLocal, forOf.declaration, scope, binding, local, item);\n    return scope;\n};\nconst createScope = (item, forOf, parentScope, binding, local, hasDestructuredLocal) => {\n    if (hasDestructuredLocal) {\n        const scope = Scope.fromParent(parentScope, new BindingContext(), new RepeatOverrideContext());\n        astAssign(forOf.declaration, scope, binding, null, item);\n    }\n    return Scope.fromParent(parentScope, new BindingContext(local, item), new RepeatOverrideContext());\n};\nconst compareNumber = (a, b) => a - b;\n\nclass With {\n    constructor() {\n        this.view = resolve(IViewFactory).create().setLocation(resolve(IRenderLocation));\n    }\n    valueChanged(newValue, _oldValue) {\n        const $controller = this.$controller;\n        const bindings = this.view.bindings;\n        let scope;\n        let i = 0, ii = 0;\n        if ($controller.isActive && bindings != null) {\n            scope = Scope.fromParent($controller.scope, newValue === void 0 ? {} : newValue);\n            for (ii = bindings.length; ii > i; ++i) {\n                bindings[i].bind(scope);\n            }\n        }\n    }\n    attaching(initiator, _parent) {\n        const { $controller, value } = this;\n        const scope = Scope.fromParent($controller.scope, value === void 0 ? {} : value);\n        return this.view.activate(initiator, $controller, scope);\n    }\n    detaching(initiator, _parent) {\n        return this.view.deactivate(initiator, this.$controller);\n    }\n    dispose() {\n        this.view.dispose();\n        this.view = (void 0);\n    }\n    accept(visitor) {\n        if (this.view?.accept(visitor) === true) {\n            return true;\n        }\n    }\n}\nWith.$au = {\n    type: attrTypeName,\n    name: 'with',\n    isTemplateController: true,\n    bindables: ['value'],\n};\n\nclass Switch {\n    constructor() {\n        /** @internal */\n        this.cases = [];\n        this.activeCases = [];\n        /**\n         * This is kept around here so that changes can be awaited from the tests.\n         * This needs to be removed after the scheduler is ready to handle/queue the floating promises.\n         */\n        this.promise = void 0;\n        /** @internal */ this._factory = resolve(IViewFactory);\n        /** @internal */ this._location = resolve(IRenderLocation);\n    }\n    link(_controller, _childController, _target, _instruction) {\n        this.view = this._factory.create(this.$controller).setLocation(this._location);\n    }\n    attaching(initiator, _parent) {\n        const view = this.view;\n        const $controller = this.$controller;\n        this.queue(() => view.activate(initiator, $controller, $controller.scope));\n        this.queue(() => this.swap(initiator, this.value));\n        return this.promise;\n    }\n    detaching(initiator, _parent) {\n        this.queue(() => {\n            const view = this.view;\n            return view.deactivate(initiator, this.$controller);\n        });\n        return this.promise;\n    }\n    dispose() {\n        this.view?.dispose();\n        this.view = (void 0);\n    }\n    valueChanged(_newValue, _oldValue) {\n        if (!this.$controller.isActive) {\n            return;\n        }\n        this.queue(() => this.swap(null, this.value));\n    }\n    caseChanged($case) {\n        this.queue(() => this._handleCaseChange($case));\n    }\n    /** @internal */\n    _handleCaseChange($case) {\n        const isMatch = $case.isMatch(this.value);\n        const activeCases = this.activeCases;\n        const numActiveCases = activeCases.length;\n        // Early termination #1\n        if (!isMatch) {\n            /** The previous match started with this; thus clear. */\n            if (numActiveCases > 0 && activeCases[0].id === $case.id) {\n                return this._clearActiveCases(null);\n            }\n            /**\n             * There are 2 different scenarios here:\n             * 1. $case in activeCases: Indicates by-product of fallthrough. The starting case still satisfies. Return.\n             * 2. $case not in activeCases: It was previously not active, and currently also not a match. Return.\n             */\n            return;\n        }\n        // Early termination #2\n        if (numActiveCases > 0 && activeCases[0].id < $case.id) {\n            // Even if this case now a match, the previous case still wins by as that has lower ordinal.\n            return;\n        }\n        // compute the new active cases\n        const newActiveCases = [];\n        let fallThrough = $case.fallThrough;\n        if (!fallThrough) {\n            newActiveCases.push($case);\n        }\n        else {\n            const cases = this.cases;\n            const idx = cases.indexOf($case);\n            for (let i = idx, ii = cases.length; i < ii && fallThrough; i++) {\n                const c = cases[i];\n                newActiveCases.push(c);\n                fallThrough = c.fallThrough;\n            }\n        }\n        return onResolve(this._clearActiveCases(null, newActiveCases), () => {\n            this.activeCases = newActiveCases;\n            return this._activateCases(null);\n        });\n    }\n    swap(initiator, value) {\n        const newActiveCases = [];\n        let fallThrough = false;\n        for (const $case of this.cases) {\n            if (fallThrough || $case.isMatch(value)) {\n                newActiveCases.push($case);\n                fallThrough = $case.fallThrough;\n            }\n            if (newActiveCases.length > 0 && !fallThrough) {\n                break;\n            }\n        }\n        const defaultCase = this.defaultCase;\n        if (newActiveCases.length === 0 && defaultCase !== void 0) {\n            newActiveCases.push(defaultCase);\n        }\n        return onResolve(this.activeCases.length > 0\n            ? this._clearActiveCases(initiator, newActiveCases)\n            : void 0, () => {\n            this.activeCases = newActiveCases;\n            if (newActiveCases.length === 0) {\n                return;\n            }\n            return this._activateCases(initiator);\n        });\n    }\n    /** @internal */\n    _activateCases(initiator) {\n        const controller = this.$controller;\n        if (!controller.isActive) {\n            return;\n        }\n        const cases = this.activeCases;\n        const length = cases.length;\n        if (length === 0) {\n            return;\n        }\n        const scope = controller.scope;\n        // most common case\n        if (length === 1) {\n            return cases[0].activate(initiator, scope);\n        }\n        return onResolveAll(...cases.map(($case) => $case.activate(initiator, scope)));\n    }\n    /** @internal */\n    _clearActiveCases(initiator, newActiveCases = []) {\n        const cases = this.activeCases;\n        const numCases = cases.length;\n        if (numCases === 0) {\n            return;\n        }\n        if (numCases === 1) {\n            const firstCase = cases[0];\n            if (!newActiveCases.includes(firstCase)) {\n                cases.length = 0;\n                return firstCase.deactivate(initiator);\n            }\n            return;\n        }\n        return onResolve(onResolveAll(...cases.reduce((acc, $case) => {\n            if (!newActiveCases.includes($case)) {\n                acc.push($case.deactivate(initiator));\n            }\n            return acc;\n        }, [])), () => {\n            cases.length = 0;\n        });\n    }\n    queue(action) {\n        const previousPromise = this.promise;\n        let promise = void 0;\n        promise = this.promise = onResolve(onResolve(previousPromise, action), () => {\n            if (this.promise === promise) {\n                this.promise = void 0;\n            }\n        });\n    }\n    accept(visitor) {\n        if (this.$controller.accept(visitor) === true) {\n            return true;\n        }\n        if (this.activeCases.some(x => x.accept(visitor))) {\n            return true;\n        }\n    }\n}\nSwitch.$au = {\n    type: attrTypeName,\n    name: 'switch',\n    isTemplateController: true,\n    bindables: ['value'],\n};\nlet caseId = 0;\nconst bindables = [\n    'value',\n    {\n        name: 'fallThrough',\n        mode: oneTime,\n        set(v) {\n            switch (v) {\n                case 'true': return true;\n                case 'false': return false;\n                // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n                default: return !!v;\n            }\n        }\n    }\n];\nclass Case {\n    constructor() {\n        /** @internal */ this.id = ++caseId;\n        this.fallThrough = false;\n        this.view = void 0;\n        /** @internal */ this._factory = resolve(IViewFactory);\n        /** @internal */ this._locator = resolve(IObserverLocator);\n        /** @internal */ this._location = resolve(IRenderLocation);\n        /** @internal */ this._logger = resolve(ILogger).scopeTo(`Case-#${this.id}`);\n    }\n    link(controller, _childController, _target, _instruction) {\n        const switchController = controller.parent;\n        const $switch = switchController?.viewModel;\n        if ($switch instanceof Switch) {\n            this.$switch = $switch;\n            this.linkToSwitch($switch);\n        }\n        else {\n            throw createMappedError(815 /* ErrorNames.switch_invalid_usage */);\n        }\n    }\n    detaching(initiator, _parent) {\n        return this.deactivate(initiator);\n    }\n    isMatch(value) {\n        this._logger.debug('isMatch()');\n        const $value = this.value;\n        if (isArray($value)) {\n            if (this._observer === void 0) {\n                this._observer = this._observeCollection($value);\n            }\n            return $value.includes(value);\n        }\n        return $value === value;\n    }\n    valueChanged(newValue, _oldValue) {\n        if (isArray(newValue)) {\n            this._observer?.unsubscribe(this);\n            this._observer = this._observeCollection(newValue);\n        }\n        else if (this._observer !== void 0) {\n            this._observer.unsubscribe(this);\n        }\n        this.$switch.caseChanged(this);\n    }\n    handleCollectionChange() {\n        this.$switch.caseChanged(this);\n    }\n    activate(initiator, scope) {\n        let view = this.view;\n        if (view === void 0) {\n            view = this.view = this._factory.create().setLocation(this._location);\n        }\n        if (view.isActive) {\n            return;\n        }\n        return view.activate(initiator ?? view, this.$controller, scope);\n    }\n    deactivate(initiator) {\n        const view = this.view;\n        if (view === void 0 || !view.isActive) {\n            return;\n        }\n        return view.deactivate(initiator ?? view, this.$controller);\n    }\n    dispose() {\n        this._observer?.unsubscribe(this);\n        this.view?.dispose();\n        this.view = (void 0);\n    }\n    linkToSwitch(auSwitch) {\n        auSwitch.cases.push(this);\n    }\n    /** @internal */\n    _observeCollection($value) {\n        const observer = this._locator.getArrayObserver($value);\n        observer.subscribe(this);\n        return observer;\n    }\n    accept(visitor) {\n        if (this.$controller.accept(visitor) === true) {\n            return true;\n        }\n        return this.view?.accept(visitor);\n    }\n}\n(() => {\n    defineAttribute({ name: 'case', bindables, isTemplateController: true }, Case);\n})();\nclass DefaultCase extends Case {\n    linkToSwitch($switch) {\n        if ($switch.defaultCase !== void 0) {\n            throw createMappedError(816 /* ErrorNames.switch_no_multiple_default */);\n        }\n        $switch.defaultCase = this;\n    }\n}\n(() => {\n    defineAttribute({ name: 'default-case', bindables, isTemplateController: true }, DefaultCase);\n})();\n\nvar _a, _b, _c;\nclass PromiseTemplateController {\n    constructor() {\n        this.preSettledTask = null;\n        this.postSettledTask = null;\n        /** @internal */ this._factory = resolve(IViewFactory);\n        /** @internal */ this._location = resolve(IRenderLocation);\n        /** @internal */ this._platform = resolve(IPlatform);\n        /** @internal */ this.logger = resolve(ILogger).scopeTo('promise.resolve');\n    }\n    link(_controller, _childController, _target, _instruction) {\n        this.view = this._factory.create(this.$controller).setLocation(this._location);\n    }\n    attaching(initiator, _parent) {\n        const view = this.view;\n        const $controller = this.$controller;\n        return onResolve(view.activate(initiator, $controller, this.viewScope = Scope.fromParent($controller.scope, {})), () => this.swap(initiator));\n    }\n    valueChanged(_newValue, _oldValue) {\n        if (!this.$controller.isActive) {\n            return;\n        }\n        this.swap(null);\n    }\n    swap(initiator) {\n        const value = this.value;\n        if (!isPromise(value)) {\n            {\n                /* istanbul ignore next */\n                this.logger.warn(`The value '${safeString(value)}' is not a promise. No change will be done.`);\n            }\n            return;\n        }\n        const fulfilled = this.fulfilled;\n        const rejected = this.rejected;\n        const pending = this.pending;\n        const s = this.viewScope;\n        let preSettlePromise;\n        const $swap = () => {\n            // Note that the whole thing is not wrapped in a q.queueTask intentionally.\n            // Because that would block the app till the actual promise is resolved, which is not the goal anyway.\n            void onResolveAll(\n            // At first deactivate the fulfilled and rejected views, as well as activate the pending view.\n            // The order of these 3 should not necessarily be sequential (i.e. order-irrelevant).\n            preSettlePromise = (this.preSettledTask = queueAsyncTask(() => {\n                return onResolveAll(fulfilled?.deactivate(initiator), rejected?.deactivate(initiator), pending?.activate(initiator, s));\n            })).result.catch((err) => { throw err; }), value\n                .then((data) => {\n                if (this.value !== value) {\n                    return;\n                }\n                const fulfill = () => {\n                    // Deactivation of pending view and the activation of the fulfilled view should not necessarily be sequential.\n                    this.postSettlePromise = (this.postSettledTask = queueAsyncTask(() => onResolveAll(pending?.deactivate(initiator), rejected?.deactivate(initiator), fulfilled?.activate(initiator, s, data)))).result;\n                };\n                if (this.preSettledTask.status === tsRunning) {\n                    void preSettlePromise.then(fulfill);\n                }\n                else {\n                    this.preSettledTask.cancel();\n                    fulfill();\n                }\n            }, (err) => {\n                if (this.value !== value) {\n                    return;\n                }\n                const reject = () => {\n                    // Deactivation of pending view and the activation of the rejected view should also not necessarily be sequential.\n                    this.postSettlePromise = (this.postSettledTask = queueAsyncTask(() => onResolveAll(pending?.deactivate(initiator), fulfilled?.deactivate(initiator), rejected?.activate(initiator, s, err)))).result;\n                };\n                if (this.preSettledTask.status === tsRunning) {\n                    void preSettlePromise.then(reject);\n                }\n                else {\n                    this.preSettledTask.cancel();\n                    reject();\n                }\n            }));\n        };\n        if (this.postSettledTask?.status === tsRunning) {\n            void this.postSettlePromise.then($swap);\n        }\n        else {\n            this.postSettledTask?.cancel();\n            $swap();\n        }\n    }\n    detaching(initiator, _parent) {\n        this.preSettledTask?.cancel();\n        this.postSettledTask?.cancel();\n        this.preSettledTask = this.postSettledTask = null;\n        return this.view.deactivate(initiator, this.$controller);\n    }\n    dispose() {\n        this.view?.dispose();\n        this.view = (void 0);\n    }\n}\nPromiseTemplateController.$au = {\n    type: attrTypeName,\n    name: 'promise',\n    isTemplateController: true,\n    bindables: ['value'],\n};\nclass PendingTemplateController {\n    constructor() {\n        this.view = void 0;\n        /** @internal */ this._factory = resolve(IViewFactory);\n        /** @internal */ this._location = resolve(IRenderLocation);\n    }\n    link(controller, _childController, _target, _instruction) {\n        getPromiseController(controller).pending = this;\n    }\n    activate(initiator, scope) {\n        let view = this.view;\n        if (view === void 0) {\n            view = this.view = this._factory.create().setLocation(this._location);\n        }\n        if (view.isActive) {\n            return;\n        }\n        return view.activate(view, this.$controller, scope);\n    }\n    deactivate(_initiator) {\n        const view = this.view;\n        if (view === void 0 || !view.isActive) {\n            return;\n        }\n        return view.deactivate(view, this.$controller);\n    }\n    detaching(initiator) {\n        return this.deactivate(initiator);\n    }\n    dispose() {\n        this.view?.dispose();\n        this.view = (void 0);\n    }\n}\nPendingTemplateController.$au = {\n    type: attrTypeName,\n    name: 'pending',\n    isTemplateController: true,\n    bindables: {\n        value: { mode: toView }\n    }\n};\nclass FulfilledTemplateController {\n    constructor() {\n        this.view = void 0;\n        /** @internal */ this._factory = resolve(IViewFactory);\n        /** @internal */ this._location = resolve(IRenderLocation);\n    }\n    link(controller, _childController, _target, _instruction) {\n        getPromiseController(controller).fulfilled = this;\n    }\n    activate(initiator, scope, resolvedValue) {\n        this.value = resolvedValue;\n        let view = this.view;\n        if (view === void 0) {\n            view = this.view = this._factory.create().setLocation(this._location);\n        }\n        if (view.isActive) {\n            return;\n        }\n        return view.activate(view, this.$controller, scope);\n    }\n    deactivate(_initiator) {\n        const view = this.view;\n        if (view === void 0 || !view.isActive) {\n            return;\n        }\n        return view.deactivate(view, this.$controller);\n    }\n    detaching(initiator, _parent) {\n        return this.deactivate(initiator);\n    }\n    dispose() {\n        this.view?.dispose();\n        this.view = (void 0);\n    }\n}\nFulfilledTemplateController.$au = {\n    type: attrTypeName,\n    name: 'then',\n    isTemplateController: true,\n    bindables: {\n        value: { mode: fromView }\n    }\n};\nclass RejectedTemplateController {\n    constructor() {\n        this.view = void 0;\n        /** @internal */ this._factory = resolve(IViewFactory);\n        /** @internal */ this._location = resolve(IRenderLocation);\n    }\n    link(controller, _childController, _target, _instruction) {\n        getPromiseController(controller).rejected = this;\n    }\n    activate(initiator, scope, error) {\n        this.value = error;\n        let view = this.view;\n        if (view === void 0) {\n            view = this.view = this._factory.create().setLocation(this._location);\n        }\n        if (view.isActive) {\n            return;\n        }\n        return view.activate(view, this.$controller, scope);\n    }\n    deactivate(_initiator) {\n        const view = this.view;\n        if (view === void 0 || !view.isActive) {\n            return;\n        }\n        return view.deactivate(view, this.$controller);\n    }\n    detaching(initiator, _parent) {\n        return this.deactivate(initiator);\n    }\n    dispose() {\n        this.view?.dispose();\n        this.view = (void 0);\n    }\n}\nRejectedTemplateController.$au = {\n    type: attrTypeName,\n    name: 'catch',\n    isTemplateController: true,\n    bindables: {\n        value: { mode: fromView }\n    }\n};\nfunction getPromiseController(controller) {\n    const promiseController = controller.parent;\n    const $promise = promiseController?.viewModel;\n    if ($promise instanceof PromiseTemplateController) {\n        return $promise;\n    }\n    throw createMappedError(813 /* ErrorNames.promise_invalid_usage */);\n}\nclass PromiseAttributePattern {\n    'promise.resolve'(name, value) {\n        return new AttrSyntax(name, value, 'promise', 'bind');\n    }\n}\n_a = Symbol.metadata;\nPromiseAttributePattern[_a] = {\n    [registrableMetadataKey]: AttributePattern.create([{ pattern: 'promise.resolve', symbols: '' }], PromiseAttributePattern)\n};\nclass FulfilledAttributePattern {\n    'then'(name, value) {\n        return new AttrSyntax(name, value, 'then', 'from-view');\n    }\n}\n_b = Symbol.metadata;\nFulfilledAttributePattern[_b] = {\n    [registrableMetadataKey]: AttributePattern.create([{ pattern: 'then', symbols: '' }], FulfilledAttributePattern)\n};\nclass RejectedAttributePattern {\n    'catch'(name, value) {\n        return new AttrSyntax(name, value, 'catch', 'from-view');\n    }\n}\n_c = Symbol.metadata;\nRejectedAttributePattern[_c] = {\n    [registrableMetadataKey]: AttributePattern.create([{ pattern: 'catch', symbols: '' }], RejectedAttributePattern)\n};\n\n/**\n * Focus attribute for element focus binding\n */\nclass Focus {\n    constructor() {\n        /**\n         * Indicates whether `apply` should be called when `attached` callback is invoked\n         *\n         * @internal\n         */\n        this._needsApply = false;\n        /** @internal */\n        this._element = resolve(INode);\n        /** @internal */\n        this._platform = resolve(IPlatform);\n    }\n    binding() {\n        this.valueChanged();\n    }\n    /**\n     * Invoked everytime the bound value changes.\n     *\n     * @param newValue - The new value.\n     */\n    valueChanged() {\n        // In theory, we could/should react immediately\n        // but focus state of an element cannot be achieved\n        // while it's disconnected from the document\n        // thus, there neesd to be a check if it's currently connected or not\n        // before applying the value to the element\n        if (this.$controller.isActive) {\n            this._apply();\n        }\n        else {\n            // If the element is not currently connect\n            // toggle the flag to add pending work for later\n            // in attached lifecycle\n            this._needsApply = true;\n        }\n    }\n    /**\n     * Invoked when the attribute is attached to the DOM.\n     */\n    attached() {\n        if (this._needsApply) {\n            this._needsApply = false;\n            this._apply();\n        }\n        this._element.addEventListener('focus', this);\n        this._element.addEventListener('blur', this);\n    }\n    /**\n     * Invoked when the attribute is afterDetachChildren from the DOM.\n     */\n    detaching() {\n        const el = this._element;\n        el.removeEventListener('focus', this);\n        el.removeEventListener('blur', this);\n    }\n    /**\n     * EventTarget interface handler for better memory usage\n     */\n    handleEvent(e) {\n        // there are only two event listened to\n        // if the even is focus, it menans the element is focused\n        // only need to switch the value to true\n        if (e.type === 'focus') {\n            this.value = true;\n        }\n        else if (!this._isElFocused) {\n            // else, it's blur event\n            // when a blur event happens, there are two situations\n            // 1. the element itself lost the focus\n            // 2. window lost the focus\n            // To handle both (1) and (2), only need to check if\n            // current active element is still the same element of this focus custom attribute\n            // If it's not, it's a blur event happened on Window because the browser tab lost focus\n            this.value = false;\n        }\n    }\n    /**\n     * Focus/blur based on current value\n     *\n     * @internal\n     */\n    _apply() {\n        const el = this._element;\n        const isFocused = this._isElFocused;\n        const shouldFocus = this.value;\n        // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n        if (shouldFocus && !isFocused) {\n            el.focus();\n            // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n        }\n        else if (!shouldFocus && isFocused) {\n            el.blur();\n        }\n    }\n    /** @internal */\n    get _isElFocused() {\n        return this._element === this._platform.document.activeElement;\n    }\n}\nFocus.$au = {\n    type: attrTypeName,\n    name: 'focus',\n    bindables: {\n        value: { mode: twoWay },\n    }\n};\n\nclass Portal {\n    constructor() {\n        this.position = 'beforeend';\n        this.strict = false;\n        const factory = resolve(IViewFactory);\n        const originalLoc = resolve(IRenderLocation);\n        const p = resolve(IPlatform);\n        this._platform = p;\n        // to make the shape of this object consistent.\n        // todo: is this necessary\n        this._resolvedTarget = p.document.createElement('div');\n        (this.view = factory.create()).setLocation(this._targetLocation = createLocation(p));\n        setEffectiveParentNode(this.view.nodes, originalLoc);\n    }\n    attaching(initiator) {\n        if (this.callbackContext == null) {\n            this.callbackContext = this.$controller.scope.bindingContext;\n        }\n        const newTarget = this._resolvedTarget = this._getTarget();\n        this._moveLocation(newTarget, this.position);\n        return this._activating(initiator, newTarget);\n    }\n    detaching(initiator) {\n        return this._deactivating(initiator, this._resolvedTarget);\n    }\n    targetChanged() {\n        const { $controller } = this;\n        if (!$controller.isActive) {\n            return;\n        }\n        const newTarget = this._getTarget();\n        if (this._resolvedTarget === newTarget) {\n            return;\n        }\n        this._resolvedTarget = newTarget;\n        // TODO(fkleuver): fix and test possible race condition\n        const ret = onResolve(this._deactivating(null, newTarget), () => {\n            this._moveLocation(newTarget, this.position);\n            return this._activating(null, newTarget);\n        });\n        if (isPromise(ret)) {\n            ret.catch(rethrow);\n        }\n    }\n    positionChanged() {\n        const { $controller, _resolvedTarget } = this;\n        if (!$controller.isActive) {\n            return;\n        }\n        // TODO(fkleuver): fix and test possible race condition\n        const ret = onResolve(this._deactivating(null, _resolvedTarget), () => {\n            this._moveLocation(_resolvedTarget, this.position);\n            return this._activating(null, _resolvedTarget);\n        });\n        if (isPromise(ret)) {\n            ret.catch(rethrow);\n        }\n    }\n    /** @internal */\n    _activating(initiator, target) {\n        const { activating, callbackContext, view } = this;\n        // view.setHost(target);\n        return onResolve(activating?.call(callbackContext, target, view), () => {\n            return this._activate(initiator, target);\n        });\n    }\n    /** @internal */\n    _activate(initiator, target) {\n        const { $controller, view } = this;\n        if (initiator === null) {\n            view.nodes.insertBefore(this._targetLocation);\n        }\n        else {\n            // TODO(fkleuver): fix and test possible race condition\n            return onResolve(view.activate(initiator ?? view, $controller, $controller.scope), () => {\n                return this._activated(target);\n            });\n        }\n        return this._activated(target);\n    }\n    /** @internal */\n    _activated(target) {\n        const { activated, callbackContext, view } = this;\n        return activated?.call(callbackContext, target, view);\n    }\n    /** @internal */\n    _deactivating(initiator, target) {\n        const { deactivating, callbackContext, view } = this;\n        return onResolve(deactivating?.call(callbackContext, target, view), () => {\n            return this._deactivate(initiator, target);\n        });\n    }\n    /** @internal */\n    _deactivate(initiator, target) {\n        const { $controller, view } = this;\n        if (initiator === null) {\n            view.nodes.remove();\n        }\n        else {\n            return onResolve(view.deactivate(initiator, $controller), () => {\n                return this._deactivated(target);\n            });\n        }\n        return this._deactivated(target);\n    }\n    /** @internal */\n    _deactivated(target) {\n        const { deactivated, callbackContext, view } = this;\n        return onResolve(deactivated?.call(callbackContext, target, view), () => this._removeLocation());\n    }\n    /** @internal */\n    _getTarget() {\n        const p = this._platform;\n        // with a $ in front to make it less confusing/error prone\n        const $document = p.document;\n        let target = this.target;\n        let context = this.renderContext;\n        if (target === '') {\n            if (this.strict) {\n                throw createMappedError(811 /* ErrorNames.portal_query_empty */);\n            }\n            return $document.body;\n        }\n        if (isString(target)) {\n            let queryContext = $document;\n            if (isString(context)) {\n                context = $document.querySelector(context);\n            }\n            if (context instanceof p.Node) {\n                queryContext = context;\n            }\n            target = queryContext.querySelector(target);\n        }\n        if (target instanceof p.Node) {\n            return target;\n        }\n        if (target == null) {\n            if (this.strict) {\n                throw createMappedError(812 /* ErrorNames.portal_no_target */);\n            }\n            return $document.body;\n        }\n        return target;\n    }\n    /** @internal */\n    _removeLocation() {\n        this._targetLocation.remove();\n        this._targetLocation.$start.remove();\n    }\n    /** @internal */\n    _moveLocation(target, position) {\n        const end = this._targetLocation;\n        const start = end.$start;\n        const parent = target.parentNode;\n        const nodes = [start, end];\n        switch (position) {\n            case 'beforeend':\n                insertManyBefore(target, null, nodes);\n                break;\n            case 'afterbegin':\n                insertManyBefore(target, target.firstChild, nodes);\n                break;\n            case 'beforebegin':\n                insertManyBefore(parent, target, nodes);\n                break;\n            case 'afterend':\n                insertManyBefore(parent, target.nextSibling, nodes);\n                break;\n            /* istanbul ignore next */\n            default:\n                throw createMappedError(779 /* ErrorNames.portal_invalid_insert_position */, position);\n        }\n    }\n    dispose() {\n        this.view.dispose();\n        this.view = (void 0);\n        this.callbackContext = null;\n    }\n    accept(visitor) {\n        if (this.view?.accept(visitor) === true) {\n            return true;\n        }\n    }\n}\nPortal.$au = {\n    type: attrTypeName,\n    name: 'portal',\n    isTemplateController: true,\n    bindables: [\n        { name: 'target', primary: true },\n        'position',\n        'activated',\n        'activating',\n        'callbackContext',\n        { name: 'renderContext', callback: 'targetChanged' },\n        'strict',\n        'deactivated',\n        'deactivating'\n    ],\n    // bindables: {\n    //   target: { primary: true },\n    //   position: true,\n    //   renderContext: { callback: 'targetChanged' },\n    //   activated: true,\n    //   activating: true,\n    //   callbackContext: true,\n    //   deactivated: true,\n    //   deactivating: true,\n    //   strict: true\n    // }\n};\n\nlet emptyTemplate;\nclass AuSlot {\n    constructor() {\n        /** @internal */ this._parentScope = null;\n        /** @internal */ this._outerScope = null;\n        /** @internal */ this._attached = false;\n        /**\n         * The binding context that will be exposed to slotted content\n         */\n        this.expose = null;\n        /**\n         * A callback that will be called when the content of this slot changed\n         */\n        this.slotchange = null;\n        /** @internal */\n        this._subs = new Set();\n        /** @internal */\n        this._observer = null;\n        const hdrContext = resolve(IHydrationContext);\n        const location = resolve(IRenderLocation);\n        const instruction = resolve(IInstruction);\n        const rendering = resolve(IRendering);\n        const slotName = this.name = instruction.data.name;\n        // when <au-slot> is empty, there's not even projections\n        // hence ?. operator is used\n        // for fallback, there's only default slot used\n        const fallback = instruction.projections?.[defaultSlotName];\n        const projection = hdrContext.instruction?.projections?.[slotName];\n        const contextContainer = hdrContext.controller.container;\n        let factory;\n        let container;\n        if (projection == null) {\n            container = contextContainer.createChild({ inheritParentResources: true });\n            factory = rendering.getViewFactory(fallback ?? (emptyTemplate ??= CustomElementDefinition.create({\n                name: 'au-slot-empty-template',\n                template: '',\n                needsCompile: false,\n            })), container);\n            this._hasProjection = false;\n        }\n        else {\n            // projection could happen within a projection, example:\n            // --my-app--\n            // <s-1>\n            //   ---projection 1---\n            //   <s-2>\n            //     ---projection 2---\n            //     <s-3>\n            // for the template above, if <s-3> is injecting <S1>,\n            // we won't find the information in the hydration context hierarchy <MyApp>/<S3>\n            // as it's a flat wysiwyg structure based on the template html\n            //\n            // since we are constructing the projection (2) view based on the\n            // container of <my-app>, we need to pre-register all information stored\n            // in projection (1) into the container created for the projection (2) view\n            // =============================\n            // my-app template:\n            // my-app  --- hydration context\n            // <el>     --- owning element (this has this <au-slot> that uses ---projection)\n            //   <s-1>  --- projection\n            //\n            container = contextContainer.createChild();\n            // registering resources from the parent hydration context is necessary\n            // as that's where the projection is declared in the template\n            //\n            // if neccessary, we can do the same gymnastic of registering information related to\n            // a custom element registration like in renderer.ts from line 1088 to 1098\n            // so we don't accidentally get information related to owning element (host, controller, instruction etc...)\n            // although it may be more desirable to have owning element information available here\n            container.useResources(hdrContext.parent.controller.container);\n            // doing this to shadow the owning element hydration context\n            // since we created a container out of the owning element container\n            // instead of the hydration context container\n            registerResolver(container, IHydrationContext, new InstanceProvider(void 0, hdrContext.parent));\n            factory = rendering.getViewFactory(projection, container);\n            this._hasProjection = true;\n            this._slotwatchers = contextContainer.getAll(IAuSlotWatcher, false)?.filter(w => w.slotName === '*' || w.slotName === slotName) ?? emptyArray;\n        }\n        this._hasSlotWatcher = (this._slotwatchers ??= emptyArray).length > 0;\n        this._hdrContext = hdrContext;\n        this.view = factory.create().setLocation(this._location = location);\n    }\n    get nodes() {\n        const nodes = [];\n        const location = this._location;\n        let curr = location.$start.nextSibling;\n        while (curr != null && curr !== location) {\n            if (curr.nodeType !== /* comment */ 8) {\n                nodes.push(curr);\n            }\n            curr = curr.nextSibling;\n        }\n        return nodes;\n    }\n    subscribe(subscriber) {\n        this._subs.add(subscriber);\n    }\n    unsubscribe(subscriber) {\n        this._subs.delete(subscriber);\n    }\n    binding(_initiator, parent) {\n        this._parentScope = parent.scope;\n        // The following block finds the real host scope for the content of this <au-slot>\n        //\n        // if this <au-slot> was created by another au slot, the controller hierarchy will be like this:\n        // C(au-slot)#1 --> C(synthetic)#1 --> C(au-slot)#2 --> C(synthetic)#2\n        //\n        // C(synthetic)#2 is what will provide the content for C(au-slot)#1\n        // but C(au-slot)#1 is what will provide the $host value for the content of C(au-slot)#2\n        //\n        // example:\n        // <template as-custom-element=\"parent\">\n        //   <child>\n        //    <au-slot> #2\n        //   </child>\n        // ...\n        // <template as-custom-element=\"child\">\n        //  <au-slot> #1\n        //\n        // because of this structure, walk 2 level of controller at once to find the right parent scope for $host value\n        while (parent.vmKind === 'synthetic' && parent.parent?.viewModel instanceof AuSlot) {\n            parent = parent.parent.parent;\n        }\n        const host = parent.scope.bindingContext;\n        let outerScope;\n        if (this._hasProjection) {\n            // if there is a projection,\n            // then the au-slot should connect the outer scope with the inner scope binding context\n            // via overlaying the outerscope with another scope that has\n            // - binding context & override context pointing to the outer scope binding & override context respectively\n            // - override context has the $host pointing to inner scope binding context\n            outerScope = this._hdrContext.controller.scope.parent;\n            (this._outerScope = Scope.fromParent(outerScope, outerScope.bindingContext))\n                .overrideContext.$host = this.expose ?? host;\n        }\n    }\n    attaching(initiator, _parent) {\n        return onResolve(this.view.activate(initiator, this.$controller, this._hasProjection ? this._outerScope : this._parentScope), () => {\n            if (this._hasSlotWatcher || isFunction(this.slotchange)) {\n                this._slotwatchers.forEach(w => w.watch(this));\n                this._observe();\n                this._notifySlotChange();\n                this._attached = true;\n            }\n        });\n    }\n    detaching(initiator, _parent) {\n        this._attached = false;\n        this._unobserve();\n        this._slotwatchers.forEach(w => w.unwatch(this));\n        return this.view.deactivate(initiator, this.$controller);\n    }\n    exposeChanged(v) {\n        if (this._hasProjection && this._outerScope != null) {\n            this._outerScope.overrideContext.$host = v;\n        }\n    }\n    dispose() {\n        this.view.dispose();\n        this.view = (void 0);\n    }\n    accept(visitor) {\n        if (this.view?.accept(visitor) === true) {\n            return true;\n        }\n    }\n    /** @internal */\n    _observe() {\n        if (this._observer != null) {\n            return;\n        }\n        const location = this._location;\n        const parent = location.parentElement;\n        if (parent == null) {\n            return;\n        }\n        (this._observer = createMutationObserver(parent, records => {\n            if (isMutationWithinLocation(location, records)) {\n                this._notifySlotChange();\n            }\n        })).observe(parent, { childList: true });\n    }\n    /** @internal */\n    _unobserve() {\n        this._observer?.disconnect();\n        this._observer = null;\n    }\n    /** @internal */\n    _notifySlotChange() {\n        const nodes = this.nodes;\n        const subs = new Set(this._subs);\n        let sub;\n        if (this._attached) {\n            this.slotchange?.call(void 0, this.name, nodes);\n        }\n        for (sub of subs) {\n            sub.handleSlotChange(this, nodes);\n        }\n    }\n}\nAuSlot.$au = {\n    type: elementTypeName,\n    name: 'au-slot',\n    template: null,\n    containerless: true,\n    processContent(el, p, data) {\n        data.name = el.getAttribute('name') ?? defaultSlotName;\n        let node = el.firstChild;\n        let next = null;\n        while (node !== null) {\n            next = node.nextSibling;\n            if (isElement(node) && node.hasAttribute(auslotAttr)) {\n                {\n                    // eslint-disable-next-line no-console\n                    console.warn(`[DEV:aurelia] detected [au-slot] attribute on a child node`, `of an <au-slot> element: \"<${node.nodeName} au-slot>\".`, `This element will be ignored and removed`);\n                }\n                el.removeChild(node);\n            }\n            node = next;\n        }\n    },\n    bindables: ['expose', 'slotchange'],\n};\nconst comparePosition = (a, b) => a.compareDocumentPosition(b);\nconst isMutationWithinLocation = (location, records) => {\n    for (const { addedNodes, removedNodes, nextSibling } of records) {\n        let i = 0;\n        // eslint-disable-next-line prefer-const\n        let ii = addedNodes.length;\n        let node;\n        for (; i < ii; ++i) {\n            node = addedNodes[i];\n            if (comparePosition(location.$start, node) === /* DOCUMENT_POSITION_FOLLOWING */ 4\n                && comparePosition(location, node) === /* DOCUMENT_POSITION_PRECEDING */ 2) {\n                return true;\n            }\n        }\n        if (removedNodes.length > 0) {\n            if (nextSibling != null && comparePosition(location.$start, nextSibling) === /* DOCUMENT_POSITION_FOLLOWING */ 4\n                && comparePosition(location, nextSibling) === /* DOCUMENT_POSITION_PRECEDING */ 2) {\n                return true;\n            }\n        }\n    }\n};\n\n// Desired usage:\n// <au-component template.bind=\"Promise<string>\" component.bind=\"\" model.bind=\"\" />\n// <au-component template.bind=\"<string>\" model.bind=\"\" />\nclass AuCompose {\n    constructor() {\n        /**\n         * Control scoping behavior of the view created by the au-compose.\n         * This only affects template-only composition. Does not have effects on custom element composition.\n         *\n         * auto = inherit parent scope\n         * scoped = do not inherit parent scope\n         */\n        this.scopeBehavior = 'auto';\n        /** @internal */\n        this._composition = void 0;\n        /**\n         * The tag name of the element to be created for non custom element composition.\n         *\n         * `null`/`undefined` means containerless\n         */\n        this.tag = null;\n        /** @internal */ this._container = resolve(IContainer);\n        /** @internal */ this.parent = resolve(IController);\n        /** @internal */ this._host = resolve(INode);\n        /** @internal */ this._location = resolve(IRenderLocation);\n        /** @internal */ this._platform = resolve(IPlatform);\n        /** @internal */ this._rendering = resolve(IRendering);\n        /** @internal */ this._instruction = resolve(IInstruction);\n        /** @internal */ this._contextFactory = resolve(transient(CompositionContextFactory, null));\n        /** @internal */ this._compiler = resolve(ITemplateCompiler);\n        /** @internal */ this._hydrationContext = resolve(IHydrationContext);\n        /** @internal */ this._exprParser = resolve(IExpressionParser);\n        /** @internal */ this._observerLocator = resolve(IObserverLocator);\n        /** @internal */ this._attached = false;\n    }\n    get composing() {\n        return this._composing;\n    }\n    get composition() {\n        return this._composition;\n    }\n    attaching(initiator, _parent) {\n        this._attached = true;\n        return this._composing = onResolve(this.queue(new ChangeInfo(this.template, this.component, this.model, void 0), initiator), (context) => {\n            if (this._contextFactory._isCurrent(context)) {\n                this._composing = void 0;\n            }\n        });\n    }\n    detaching(initiator) {\n        this._attached = false;\n        const cmpstn = this._composition;\n        const pending = this._composing;\n        this._contextFactory.invalidate();\n        this._composition = this._composing = void 0;\n        return onResolve(pending, () => cmpstn?.deactivate(initiator));\n    }\n    /** @internal */\n    propertyChanged(name) {\n        if (!this._attached)\n            return;\n        if (name === 'composing' || name === 'composition')\n            return;\n        if (name === 'model' && this._composition != null) {\n            this._composition.update(this.model);\n            return;\n        }\n        // tag change does not affect existing custom element composition\n        if (name === 'tag' && this._composition?.controller.vmKind === vmkCe) {\n            {\n                console.warn('[DEV:aurelia] Changing tag name of a custom element composition is ignored.'); // eslint-disable-line\n            }\n            return;\n        }\n        this._composing = onResolve(this._composing, () => onResolve(this.queue(new ChangeInfo(this.template, this.component, this.model, name), void 0), (context) => {\n            if (this._contextFactory._isCurrent(context)) {\n                this._composing = void 0;\n            }\n        }));\n    }\n    /** @internal */\n    queue(change, initiator) {\n        const factory = this._contextFactory;\n        const prevCompositionCtrl = this._composition;\n        // todo: handle consequitive changes that create multiple queues\n        return onResolve(factory.create(change), context => {\n            // Don't compose [stale] template/component\n            // by always ensuring that the composition context is the latest one\n            if (factory._isCurrent(context)) {\n                return onResolve(this.compose(context), (result) => {\n                    // Don't activate [stale] controller\n                    // by always ensuring that the composition context is the latest one\n                    if (factory._isCurrent(context)) {\n                        return onResolve(result.activate(initiator), () => {\n                            // Don't conclude the [stale] composition\n                            // by always ensuring that the composition context is the latest one\n                            if (factory._isCurrent(context)) {\n                                // after activation, if the composition context is still the most recent one\n                                // then the job is done\n                                this._composition = result;\n                                return onResolve(prevCompositionCtrl?.deactivate(initiator), () => context);\n                            }\n                            else {\n                                // the stale controller should be deactivated\n                                return onResolve(result.controller.deactivate(result.controller, this.$controller), \n                                // todo: do we need to deactivate?\n                                () => {\n                                    result.controller.dispose();\n                                    return context;\n                                });\n                            }\n                        });\n                    }\n                    result.controller.dispose();\n                    return context;\n                });\n            }\n            return context;\n        });\n    }\n    /** @internal */\n    compose(context) {\n        // todo: when both component and template are empty\n        //       should it throw or try it best to proceed?\n        //       current: proceed\n        const { _template: template, _component: component, _model: model } = context.change;\n        const { _container: container, $controller, _location: loc, _instruction } = this;\n        const vmDef = this._getDefinition(this._hydrationContext.controller.container, component);\n        const childCtn = container.createChild();\n        const compositionHost = this._platform.document.createElement(vmDef == null ? this.tag ?? 'div' : vmDef.name);\n        loc.parentNode.insertBefore(compositionHost, loc);\n        let compositionLocation;\n        if (vmDef == null) {\n            compositionLocation = this.tag == null ? convertToRenderLocation(compositionHost) : null;\n        }\n        else {\n            compositionLocation = vmDef.containerless ? convertToRenderLocation(compositionHost) : null;\n        }\n        const removeCompositionHost = () => {\n            compositionHost.remove();\n            if (compositionLocation != null) {\n                let curr = compositionLocation.$start.nextSibling;\n                let next = null;\n                while (curr !== null && curr !== compositionLocation) {\n                    next = curr.nextSibling;\n                    curr.remove();\n                    curr = next;\n                }\n                compositionLocation.$start?.remove();\n                compositionLocation.remove();\n            }\n        };\n        const comp = this._createComponentInstance(childCtn, typeof component === 'string' ? vmDef.Type : component, compositionHost, compositionLocation);\n        const compose = () => {\n            const aucomposeCapturedAttrs = _instruction.captures ?? emptyArray;\n            // custom element based composition\n            if (vmDef !== null) {\n                const capture = vmDef.capture;\n                const [capturedBindingAttrs, transferedToHostBindingAttrs] = aucomposeCapturedAttrs\n                    .reduce((attrGroups, attr) => {\n                    const shouldCapture = !(attr.target in vmDef.bindables)\n                        && (capture === true\n                            || isFunction(capture) && !!capture(attr.target));\n                    attrGroups[shouldCapture ? 0 : 1].push(attr);\n                    return attrGroups;\n                }, [[], []]);\n                const controller = Controller.$el(childCtn, comp, compositionHost, {\n                    projections: _instruction.projections,\n                    captures: capturedBindingAttrs\n                }, vmDef, compositionLocation);\n                // Theoretically these bindings aren't bindings of the composed custom element\n                // Though they are meant to be activated (bound)/ deactivated (unbound) together\n                // with the custom element controller, so it's practically ok to let the composed\n                // custom element manage these bindings\n                this._createSpreadBindings(compositionHost, vmDef, transferedToHostBindingAttrs).forEach(b => controller.addBinding(b));\n                return new CompositionController(controller, (attachInitiator) => controller.activate(attachInitiator ?? controller, $controller, $controller.scope.parent), \n                // todo: call deactivate on the component component\n                (deactachInitiator) => onResolve(controller.deactivate(deactachInitiator ?? controller, $controller), removeCompositionHost), \n                // casting is technically incorrect\n                // but it's ignored in the caller anyway\n                (model) => comp.activate?.(model), context);\n            }\n            else {\n                const targetDef = CustomElementDefinition.create({\n                    name: CustomElement.generateName(),\n                    template: template,\n                });\n                const viewFactory = this._rendering.getViewFactory(targetDef, childCtn);\n                const controller = Controller.$view(viewFactory, $controller);\n                const scope = this.scopeBehavior === 'auto'\n                    ? Scope.fromParent(this.parent.scope, comp)\n                    : Scope.create(comp);\n                controller.setHost(compositionHost);\n                if (compositionLocation == null) {\n                    // only spread the bindings if there is an actual host\n                    // otherwise we may accidentally do unnecessary work\n                    this._createSpreadBindings(compositionHost, targetDef, aucomposeCapturedAttrs).forEach(b => controller.addBinding(b));\n                }\n                else {\n                    controller.setLocation(compositionLocation);\n                }\n                return new CompositionController(controller, (attachInitiator) => controller.activate(attachInitiator ?? controller, $controller, scope), \n                // todo: call deactivate on the component\n                // a difference with composing custom element is that we leave render location/host alone\n                // as they all share the same host/render location\n                (detachInitiator) => onResolve(controller.deactivate(detachInitiator ?? controller, $controller), removeCompositionHost), \n                // casting is technically incorrect\n                // but it's ignored in the caller anyway\n                (model) => comp.activate?.(model), context);\n            }\n        };\n        if ('activate' in comp) {\n            // todo: try catch\n            // req:  ensure synchronosity of compositions that dont employ promise\n            return onResolve(comp.activate(model), () => compose());\n        }\n        else {\n            return compose();\n        }\n    }\n    /** @internal */\n    _createComponentInstance(container, comp, host, location) {\n        if (comp == null) {\n            return new EmptyComponent();\n        }\n        if (typeof comp === 'object') {\n            return comp;\n        }\n        const p = this._platform;\n        registerHostNode(container, host, p);\n        registerResolver(container, IRenderLocation, new InstanceProvider('IRenderLocation', location));\n        const instance = container.invoke(comp);\n        registerResolver(container, comp, new InstanceProvider('au-compose.component', instance));\n        return instance;\n    }\n    /** @internal */\n    _getDefinition(container, component) {\n        if (typeof component === 'string') {\n            const def = CustomElement.find(container, component);\n            if (def == null) {\n                throw createMappedError(806 /* ErrorNames.au_compose_component_name_not_found */, component);\n            }\n            return def;\n        }\n        const Ctor = (isFunction(component)\n            ? component\n            : component?.constructor);\n        return CustomElement.isType(Ctor, void 0)\n            ? CustomElement.getDefinition(Ctor, null)\n            : null;\n    }\n    /** @internal */\n    _createSpreadBindings(host, def, capturedAttrs) {\n        const transferHydrationContext = new HydrationContext(this.$controller, { projections: null, captures: capturedAttrs }, this._hydrationContext.parent);\n        return SpreadBinding.create(transferHydrationContext, host, def, this._rendering, this._compiler, this._platform, this._exprParser, this._observerLocator);\n    }\n}\n/** @internal */\nAuCompose.$au = {\n    type: elementTypeName,\n    name: 'au-compose',\n    capture: true,\n    containerless: true,\n    bindables: [\n        'template',\n        'component',\n        'model',\n        { name: 'scopeBehavior', set: v => {\n                if (v === 'scoped' || v === 'auto') {\n                    return v;\n                }\n                throw createMappedError(805 /* ErrorNames.au_compose_invalid_scope_behavior */, v);\n            } },\n        { name: 'composing', mode: fromView },\n        { name: 'composition', mode: fromView },\n        'tag'\n    ]\n};\nclass EmptyComponent {\n}\nclass CompositionContextFactory {\n    constructor() {\n        this.id = 0;\n    }\n    _isCurrent(context) {\n        return context.id === this.id;\n    }\n    create(changes) {\n        return onResolve(changes.load(), (loaded) => new CompositionContext(++this.id, loaded));\n    }\n    // simplify increasing the id will invalidate all previously created context\n    invalidate() {\n        this.id++;\n    }\n}\nclass ChangeInfo {\n    constructor(_template, _component, _model, _src) {\n        this._template = _template;\n        this._component = _component;\n        this._model = _model;\n        this._src = _src;\n    }\n    load() {\n        if (isPromise(this._template) || isPromise(this._component)) {\n            return Promise\n                .all([this._template, this._component])\n                .then(([template, component]) => {\n                return new LoadedChangeInfo(template, component, this._model, this._src);\n            });\n        }\n        else {\n            return new LoadedChangeInfo(this._template, this._component, this._model, this._src);\n        }\n    }\n}\nclass LoadedChangeInfo {\n    constructor(_template, _component, _model, _src) {\n        this._template = _template;\n        this._component = _component;\n        this._model = _model;\n        this._src = _src;\n    }\n}\nclass CompositionContext {\n    constructor(id, change) {\n        this.id = id;\n        this.change = change;\n    }\n}\nclass CompositionController {\n    constructor(controller, start, stop, update, context) {\n        this.controller = controller;\n        this.start = start;\n        this.stop = stop;\n        this.update = update;\n        this.context = context;\n        this.state = 0;\n    }\n    activate(initiator) {\n        if (this.state !== 0) {\n            throw createMappedError(807 /* ErrorNames.au_compose_invalid_run */, this);\n        }\n        this.state = 1;\n        return this.start(initiator);\n    }\n    deactivate(detachInitator) {\n        switch (this.state) {\n            case 1:\n                this.state = -1;\n                return this.stop(detachInitator);\n            case -1:\n                throw createMappedError(808 /* ErrorNames.au_compose_duplicate_deactivate */);\n            default:\n                this.state = -1;\n        }\n    }\n}\n\nconst ISanitizer = /*@__PURE__*/ createInterface('ISanitizer', x => x.singleton(class {\n    sanitize() {\n        throw createMappedError(99 /* ErrorNames.method_not_implemented */, 'sanitize');\n    }\n}));\n/**\n * Simple html sanitization converter to preserve whitelisted elements and attributes on a bound property containing html.\n */\nclass SanitizeValueConverter {\n    constructor() {\n        /** @internal */ this._sanitizer = resolve(ISanitizer);\n    }\n    /**\n     * Process the provided markup that flows to the view.\n     *\n     * @param untrustedMarkup - The untrusted markup to be sanitized.\n     */\n    toView(untrustedMarkup) {\n        if (untrustedMarkup == null) {\n            return null;\n        }\n        return this._sanitizer.sanitize(untrustedMarkup);\n    }\n}\nSanitizeValueConverter.$au = {\n    type: converterTypeName,\n    name: 'sanitize',\n};\n\nclass Show {\n    constructor() {\n        this.el = resolve(INode);\n        this.p = resolve(IPlatform);\n        /** @internal */ this._isActive = false;\n        /** @internal */ this._isQueued = false;\n        this.$val = '';\n        this.$prio = '';\n        this.update = () => {\n            this._isQueued = false;\n            // Only compare at the synchronous moment when we're about to update, because the value might have changed since the update was queued.\n            if (Boolean(this.value) !== this._isToggled) {\n                if (this._isToggled === this._base) {\n                    this._isToggled = !this._base;\n                    // Note: in v1 we used the 'au-hide' class, but in v2 it's so trivial to conditionally apply classes (e.g. 'hide.class=\"someCondition\"'),\n                    // that it's probably better to avoid the CSS inject infra involvement and keep this CA as simple as possible.\n                    // Instead, just store and restore the property values (with each mutation, to account for in-between updates), to cover the common cases, until there is convincing feedback to do otherwise.\n                    this.$val = this.el.style.getPropertyValue('display');\n                    this.$prio = this.el.style.getPropertyPriority('display');\n                    this.el.style.setProperty('display', 'none', 'important');\n                }\n                else {\n                    this._isToggled = this._base;\n                    this.el.style.setProperty('display', this.$val, this.$prio);\n                    // If the style attribute is now empty, remove it.\n                    if (this.el.getAttribute('style') === '') {\n                        this.el.removeAttribute('style');\n                    }\n                }\n            }\n        };\n        const instr = resolve(IInstruction);\n        // if this is declared as a 'hide' attribute, then this.base will be false, inverting everything.\n        this._isToggled = this._base = instr.alias !== 'hide';\n    }\n    binding() {\n        this._isActive = true;\n        this.update();\n    }\n    detaching() {\n        this._isActive = false;\n        this._isQueued = false;\n    }\n    valueChanged() {\n        if (this._isActive && !this._isQueued) {\n            this._isQueued = true;\n            queueTask(this.update);\n        }\n    }\n}\nShow.$au = {\n    type: attrTypeName,\n    name: 'show',\n    bindables: ['value'],\n    aliases: ['hide']\n};\n\n/**\n * Default HTML-specific (but environment-agnostic) implementations for the following interfaces:\n * - `ITemplateCompiler`\n * - `ITargetAccessorLocator`\n * - `ITargetObserverLocator`\n */\nconst DefaultComponents = [\n    RuntimeTemplateCompilerImplementation,\n    DirtyChecker,\n    NodeObserverLocator,\n];\n/**\n * Default binding syntax for the following attribute name patterns:\n * - `ref`\n * - `target.command` (dot-separated)\n */\nconst DefaultBindingSyntax = [\n    RefAttributePattern,\n    DotSeparatedAttributePattern,\n    EventAttributePattern,\n    EventModifierRegistration,\n];\n/**\n * Binding syntax for short-hand attribute name patterns:\n * - `@target` (short-hand for `target.trigger`)\n * - `:target` (short-hand for `target.bind`)\n */\nconst ShortHandBindingSyntax = [\n    AtPrefixedTriggerAttributePattern,\n    ColonPrefixedBindAttributePattern,\n];\n/**\n * Default HTML-specific (but environment-agnostic) binding commands:\n * - Property observation: `.bind`, `.one-time`, `.from-view`, `.to-view`, `.two-way\n * - Collection observation: `.for`\n * - Event listeners: `.trigger`, `.capture`\n */\nconst DefaultBindingLanguage = [\n    DefaultBindingCommand,\n    OneTimeBindingCommand,\n    FromViewBindingCommand,\n    ToViewBindingCommand,\n    TwoWayBindingCommand,\n    ForBindingCommand,\n    RefBindingCommand,\n    TriggerBindingCommand,\n    CaptureBindingCommand,\n    ClassBindingCommand,\n    StyleBindingCommand,\n    AttrBindingCommand,\n    SpreadValueBindingCommand,\n];\n/**\n * Default HTML-specific (but environment-agnostic) resources:\n * - Binding Behaviors: `oneTime`, `toView`, `fromView`, `twoWay`, `signal`, `debounce`, `throttle`, `attr`, `self`, `updateTrigger`\n * - Custom Elements: `au-compose`, `au-slot`\n * - Custom Attributes: `blur`, `focus`, `portal`\n * - Template controllers: `if`/`else`, `repeat`, `with`\n * - Value Converters: `sanitize`\n */\nconst DefaultResources = [\n    DebounceBindingBehavior,\n    OneTimeBindingBehavior,\n    ToViewBindingBehavior,\n    FromViewBindingBehavior,\n    SignalBindingBehavior,\n    ThrottleBindingBehavior,\n    TwoWayBindingBehavior,\n    SanitizeValueConverter,\n    If,\n    Else,\n    Repeat,\n    With,\n    Switch,\n    Case,\n    DefaultCase,\n    PromiseTemplateController,\n    PendingTemplateController,\n    FulfilledTemplateController,\n    RejectedTemplateController,\n    PromiseAttributePattern,\n    FulfilledAttributePattern,\n    RejectedAttributePattern,\n    AttrBindingBehavior,\n    SelfBindingBehavior,\n    UpdateTriggerBindingBehavior,\n    AuCompose,\n    Portal,\n    Focus,\n    Show,\n    AuSlot,\n];\n/**\n * Default renderers for:\n * - PropertyBinding: `bind`, `one-time`, `to-view`, `from-view`, `two-way`\n * - IteratorBinding: `for`\n * - CallBinding: `call`\n * - RefBinding: `ref`\n * - InterpolationBinding: `${}`\n * - SetProperty\n * - `customElement` hydration\n * - `customAttribute` hydration\n * - `templateController` hydration\n * - `let` element hydration\n * - Listener Bindings: `trigger`, `capture`, `delegate`\n * - SetAttribute\n * - StyleProperty: `style`, `css`\n * - TextBinding: `${}`\n */\nconst DefaultRenderers = [\n    PropertyBindingRenderer,\n    IteratorBindingRenderer,\n    RefBindingRenderer,\n    InterpolationBindingRenderer,\n    SetPropertyRenderer,\n    CustomElementRenderer,\n    CustomAttributeRenderer,\n    TemplateControllerRenderer,\n    LetElementRenderer,\n    ListenerBindingRenderer,\n    AttributeBindingRenderer,\n    SetAttributeRenderer,\n    SetClassAttributeRenderer,\n    SetStyleAttributeRenderer,\n    StylePropertyBindingRenderer,\n    TextBindingRenderer,\n    SpreadRenderer,\n    SpreadValueRenderer,\n];\nconst StandardConfiguration = /*@__PURE__*/ createConfiguration(noop);\nfunction createConfiguration(optionsProvider) {\n    return {\n        optionsProvider,\n        /**\n         * Apply this configuration to the provided container.\n         */\n        register(container) {\n            const runtimeConfigurationOptions = {\n                coercingOptions: {\n                    enableCoercion: false,\n                    coerceNullish: false\n                }\n            };\n            optionsProvider(runtimeConfigurationOptions);\n            /**\n             * Standard DI configuration containing html-specific (but environment-agnostic) registrations:\n             * - `RuntimeConfiguration` from `@aurelia/runtime`\n             * - `DefaultComponents`\n             * - `DefaultResources`\n             * - `DefaultRenderers`\n             */\n            return container.register(instanceRegistration(ICoercionConfiguration, runtimeConfigurationOptions.coercingOptions), ExpressionParser, ...DefaultComponents, ...DefaultResources, ...DefaultBindingSyntax, ...DefaultBindingLanguage, ...DefaultRenderers);\n        },\n        customize(cb) {\n            return createConfiguration(cb ?? optionsProvider);\n        },\n    };\n}\n\nfunction children(configOrTarget, context) {\n    if (!children.mixed) {\n        children.mixed = true;\n        subscriberCollection(ChildrenBinding, null);\n        lifecycleHooks()(ChildrenLifecycleHooks, null);\n    }\n    let config;\n    const dependenciesKey = getAnnotationKeyFor('dependencies');\n    function decorator(_target, context) {\n        switch (context.kind) {\n            case 'field':\n                config.name = context.name;\n                break;\n        }\n        const dependencies = (context.metadata[dependenciesKey] ??= []);\n        dependencies.push(new ChildrenLifecycleHooks(config ?? {}));\n    }\n    if (arguments.length > 1) {\n        // Non invocation:\n        // - @children\n        config = {};\n        decorator(configOrTarget, context);\n        return;\n    }\n    else if (isString(configOrTarget)) {\n        // Direct call:\n        // - @children('div')(Foo)\n        config = {\n            query: configOrTarget,\n            // filter: (node: Node) => isElement(node) && node.matches(configOrTarget),\n            // map: el => el\n        };\n        return decorator;\n    }\n    // Invocation with or w/o opts:\n    // - @children()\n    // - @children({...opts})\n    config = configOrTarget === void 0 ? {} : configOrTarget;\n    return decorator;\n}\nchildren.mixed = false;\n/**\n * A binding for observing & notifying the children of a custom element.\n */\nclass ChildrenBinding {\n    constructor(host, obj, callback, query, filter, map) {\n        /** @internal */\n        this._children = (void 0);\n        this.isBound = false;\n        this.obj = obj;\n        this._callback = callback;\n        this._query = query;\n        this._filter = filter;\n        this._map = map;\n        this._observer = createMutationObserver(this._host = host, () => {\n            this._onChildrenChanged();\n        });\n    }\n    getValue() {\n        return this.isBound ? this._children : this._getNodes();\n    }\n    setValue(_value) { }\n    bind() {\n        if (this.isBound) {\n            return;\n        }\n        this.isBound = true;\n        this._observer.observe(this._host, { childList: true });\n        this._children = this._getNodes();\n    }\n    unbind() {\n        if (!this.isBound) {\n            return;\n        }\n        this.isBound = false;\n        // prevent memory leaks\n        this._observer.takeRecords();\n        this._observer.disconnect();\n        this._children = emptyArray;\n    }\n    /** @internal */\n    _onChildrenChanged() {\n        this._children = this._getNodes();\n        this._callback?.call(this.obj);\n        this.subs.notify(this._children, undefined);\n    }\n    get() {\n        throw createMappedError(99 /* ErrorNames.method_not_implemented */, 'get');\n    }\n    /** @internal */\n    // freshly retrieve the children everytime\n    // in case this observer is not observing\n    _getNodes() {\n        const query = this._query;\n        const filter = this._filter;\n        const map = this._map;\n        const nodes = query === '$all' ? this._host.childNodes : this._host.querySelectorAll(`:scope > ${query}`);\n        const ii = nodes.length;\n        const results = [];\n        const findControllerOptions = { optional: true };\n        let $controller;\n        let viewModel;\n        let i = 0;\n        let node;\n        while (ii > i) {\n            node = nodes[i];\n            $controller = findElementControllerFor(node, findControllerOptions);\n            viewModel = $controller?.viewModel ?? null;\n            if (filter == null ? true : filter(node, viewModel)) {\n                results.push(map == null ? viewModel ?? node : map(node, viewModel));\n            }\n            ++i;\n        }\n        return results;\n    }\n}\nclass ChildrenLifecycleHooks {\n    constructor(_def) {\n        this._def = _def;\n    }\n    register(c) {\n        instanceRegistration(ILifecycleHooks, this).register(c);\n    }\n    hydrating(vm, controller) {\n        const $def = this._def;\n        const query = $def.query ?? '*';\n        const childrenObserver = new ChildrenBinding(controller.host, vm, vm[$def.callback ?? `${safeString($def.name)}Changed`], query, $def.filter, $def.map);\n        if (/[\\s>]/.test(query)) {\n            throw createMappedError(9989 /* ErrorNames.children_invalid_query */, query);\n        }\n        def(vm, $def.name, {\n            enumerable: true,\n            configurable: true,\n            get: objectAssign(( /* ChildrenBinding */) => childrenObserver.getValue(), { getObserver: () => childrenObserver }),\n            set: ( /* ChildrenBinding */) => {\n                {\n                    // eslint-disable-next-line no-console\n                    console.warn(`[DEV:aurelia] property ${safeString($def.name)} decorated with @children is readonly`);\n                }\n            },\n        });\n        controller.addBinding(childrenObserver);\n    }\n}\n\nexport { AdoptedStyleSheetsStyles, AppRoot, AppTask, ArrayLikeHandler, AttrBindingBehavior, AttrMapper, AttributeBinding, AttributeBindingRenderer, AttributeNSAccessor, AuCompose, AuSlot, AuSlotsInfo, Aurelia, Bindable, BindableDefinition, BindingBehavior, BindingBehaviorDefinition, BindingModeBehavior, BindingTargetSubscriber, CSSModulesProcessorRegistry, Case, CheckedObserver, ChildrenBinding, ClassAttributeAccessor, ComputedWatcher, ContentBinding, Controller, CustomAttribute, CustomAttributeDefinition, CustomAttributeRenderer, CustomElement, CustomElementDefinition, CustomElementRenderer, DataAttributeAccessor, DebounceBindingBehavior, DefaultBindingLanguage, DefaultBindingSyntax, DefaultCase, DefaultComponents, DefaultRenderers, DefaultResources, Else, EventModifier, EventModifierRegistration, ExpressionWatcher, FlushQueue, Focus, FragmentNodeSequence, FromViewBindingBehavior, FulfilledTemplateController, IAppRoot, IAppTask, IAuSlotWatcher, IAuSlotsInfo, IAurelia, IController, IEventModifier, IEventTarget, IFlushQueue, IHistory, IHydrationContext, IKeyMapping, ILifecycleHooks, IListenerBindingOptions, ILocation, IModifiedEventHandlerCreator, INode, IPlatform, IRenderLocation, IRenderer, IRendering, IRepeatableHandler, IRepeatableHandlerResolver, ISVGAnalyzer, ISanitizer, IShadowDOMGlobalStyles, IShadowDOMStyleFactory, IShadowDOMStyles, ISignaler, IViewFactory, IWindow, If, InterpolationBinding, InterpolationBindingRenderer, InterpolationPartBinding, IteratorBindingRenderer, LetBinding, LetElementRenderer, LifecycleHooks, LifecycleHooksDefinition, LifecycleHooksEntry, ListenerBinding, ListenerBindingOptions, ListenerBindingRenderer, MountTarget, NodeObserverLocator, NoopSVGAnalyzer, OneTimeBindingBehavior, PendingTemplateController, Portal, PromiseTemplateController, PropertyBinding, PropertyBindingRenderer, RefBinding, RefBindingRenderer, RejectedTemplateController, Rendering, Repeat, RuntimeTemplateCompilerImplementation, SVGAnalyzer, SanitizeValueConverter, SelectValueObserver, SelfBindingBehavior, SetAttributeRenderer, SetClassAttributeRenderer, SetPropertyRenderer, SetStyleAttributeRenderer, ShadowDOMRegistry, ShortHandBindingSyntax, SignalBindingBehavior, SpreadRenderer, StandardConfiguration, State, StyleAttributeAccessor, StyleConfiguration, StyleElementStyles, StylePropertyBindingRenderer, Switch, TemplateControllerRenderer, TextBindingRenderer, ThrottleBindingBehavior, ToViewBindingBehavior, TwoWayBindingBehavior, UpdateTriggerBindingBehavior, ValueAttributeObserver, ValueConverter, ValueConverterDefinition, ViewFactory, Watch, With, alias, bindable, bindingBehavior, capture, children, coercer, containerless, convertToRenderLocation, cssModules, customAttribute, customElement, getEffectiveParentNode, isCustomElementController, isCustomElementViewModel, isRenderLocation, lifecycleHooks, mixinAstEvaluator, mixinUseScope, mixingBindingLimited, processContent, refs, registerAliases, registerHostNode, renderer, setEffectiveParentNode, shadowCSS, slotted, templateController, useShadowDOM, valueConverter, watch };\n//# sourceMappingURL=index.dev.mjs.map\n","import { DI, Registration } from '@aurelia/kernel';\nexport { ConsoleSink, DI, EventAggregator, IContainer, IEventAggregator, ILogger, IServiceLocator, InstanceProvider, LogLevel, LoggerConfiguration, Registration, all, allResources, bound, camelCase, emptyArray, emptyObject, factory, ignore, inject, isArrayIndex, kebabCase, lazy, newInstanceForScope, newInstanceOf, noop, optional, pascalCase, resolve, resource, singleton, toArray, transient } from '@aurelia/kernel';\nimport { Aurelia as Aurelia$1, CustomElement, IPlatform, StandardConfiguration } from '@aurelia/runtime-html';\nexport { AppTask, ArrayLikeHandler, AuSlotsInfo, Bindable, BindingBehavior, BindingMode, ChildrenBinding, Controller, CustomAttribute, CustomElement, FlushQueue, IAppRoot, IAuSlotWatcher, IAuSlotsInfo, IAurelia, IController, IEventModifier, IEventTarget, IFlushQueue, IHistory, IKeyMapping, ILifecycleHooks, IModifiedEventHandlerCreator, INode, IPlatform, IRenderLocation, IRepeatableHandler, IRepeatableHandlerResolver, ISignaler, IViewFactory, IWindow, LifecycleHooks, NodeObserverLocator, RuntimeTemplateCompilerImplementation, ShortHandBindingSyntax, StyleConfiguration, ValueConverter, ViewFactory, alias, bindable, bindingBehavior, capture, children, coercer, containerless, cssModules, customAttribute, customElement, lifecycleHooks, processContent, refs, registerAliases, renderer, shadowCSS, slotted, templateController, useShadowDOM, valueConverter, watch } from '@aurelia/runtime-html';\nimport { BrowserPlatform } from '@aurelia/platform-browser';\nexport { Platform, Task, TaskAbortError, TaskQueue } from '@aurelia/platform';\nexport { CustomExpression, IExpressionParser } from '@aurelia/expression-parser';\nexport { ComputedObserver, IObservation, IObserverLocator, Scope, batch, observable, subscriberCollection } from '@aurelia/runtime';\nexport { AttributePattern, BindingCommand, IAttrMapper, IAttributeParser, IAttributePattern, ITemplateCompiler, ITemplateCompilerHooks, ITemplateElementFactory, TemplateCompilerHooks, attributePattern, bindingCommand, templateCompilerHooks } from '@aurelia/template-compiler';\n\nconst PLATFORM = BrowserPlatform.getOrCreate(globalThis);\nfunction createContainer() {\n    return DI.createContainer()\n        .register(Registration.instance(IPlatform, PLATFORM), StandardConfiguration);\n}\nclass Aurelia extends Aurelia$1 {\n    constructor(container = createContainer()) {\n        super(container);\n    }\n    static app(config) {\n        return new Aurelia().app(config);\n    }\n    static enhance(config) {\n        return new Aurelia().enhance(config);\n    }\n    static register(...params) {\n        return new Aurelia().register(...params);\n    }\n    app(config) {\n        if (CustomElement.isType(config)) {\n            // Default to custom element element name\n            const definition = CustomElement.getDefinition(config);\n            let host = document.querySelector(definition.name);\n            if (host === null) {\n                // When no target is found, default to body.\n                // For example, when user forgot to write <my-app></my-app> in html.\n                host = document.body;\n            }\n            return super.app({\n                host: host,\n                component: config\n            });\n        }\n        return super.app(config);\n    }\n}\n\nexport { Aurelia, PLATFORM, Aurelia as default };\n//# sourceMappingURL=index.dev.mjs.map\n","export default \"<template>\\n  <section class=\\\"data-extractor\\\" ref=\\\"rootEl\\\">\\n    <header class=\\\"hero\\\">\\n      <p class=\\\"eyebrow\\\">Data-extractor</p>\\n      <h1>Registraties filteren & exporteren</h1>\\n      <p class=\\\"lead\\\">\\n        Upload een shapefile (.shp + .dbf) of GeoJSON, filter de registraties op datum, tekst of cordinaten\\n        en exporteer het resultaat als CSV of GeoJSON.\\n      </p>\\n    </header>\\n\\n    <section class=\\\"panel\\\">\\n      <div class=\\\"panel-head\\\">\\n        <div>\\n          <p class=\\\"panel-eyebrow\\\">Invoer</p>\\n          <h2>Data inladen</h2>\\n        </div>\\n        <button type=\\\"button\\\" class=\\\"ghost\\\" disabled.bind=\\\"isBusy\\\" click.trigger=\\\"resetData()\\\">Leeg invoer</button>\\n      </div>\\n\\n      <div class=\\\"input-grid\\\">\\n        <div>\\n          <label class=\\\"field\\\">\\n            <span>Registraties (shapefile .shp)</span>\\n            <input type=\\\"file\\\" accept=\\\".shp\\\" change.trigger=\\\"shpFileChanged($event.target.files[0])\\\">\\n          </label>\\n          <label class=\\\"field\\\">\\n            <span>Attribuuttabel (.dbf, optioneel)</span>\\n            <input type=\\\"file\\\" accept=\\\".dbf\\\" change.trigger=\\\"dbfFileChanged($event.target.files[0])\\\">\\n          </label>\\n          <p class=\\\"hint\\\">We koppelen records uit de DBF automatisch aan de shapefile op volgorde.</p>\\n        </div>\\n        <div class=\\\"divider\\\">\\n          <span>of</span>\\n        </div>\\n        <div>\\n          <label class=\\\"field\\\">\\n            <span>GeoJSON met registraties</span>\\n            <input type=\\\"file\\\" accept=\\\".json,.geojson\\\" change.trigger=\\\"geoJsonFileChanged($event.target.files[0])\\\">\\n          </label>\\n          <p class=\\\"hint\\\">Alle eigenschappen uit GeoJSON komen beschikbaar als kolom in het overzicht.</p>\\n        </div>\\n      </div>\\n\\n      <p class=\\\"status\\\" if.bind=\\\"infoMessage\\\">${infoMessage}</p>\\n      <p class=\\\"status error\\\" if.bind=\\\"loadError\\\">${loadError}</p>\\n    </section>\\n\\n    <section class=\\\"panel\\\">\\n      <div class=\\\"panel-head\\\">\\n        <div>\\n          <p class=\\\"panel-eyebrow\\\">Filters</p>\\n          <h2>Verfijn resultaten</h2>\\n        </div>\\n        <button type=\\\"button\\\" class=\\\"ghost\\\" disabled.bind=\\\"!hasData\\\" click.trigger=\\\"resetFilters()\\\">Reset filters</button>\\n      </div>\\n\\n      <div class=\\\"filters\\\">\\n        <label class=\\\"field\\\">\\n          <span>Zoek in waarden</span>\\n          <input\\n            type=\\\"search\\\"\\n            placeholder=\\\"Adres, code, ... \\\"\\n            value.bind=\\\"filters.text\\\"\\n            input.trigger=\\\"onFilterChange()\\\">\\n        </label>\\n\\n        <div class=\\\"row\\\">\\n          <label class=\\\"field compact\\\">\\n            <span>Van (YYYY-MM-DD)</span>\\n            <input type=\\\"date\\\" value.bind=\\\"filters.from\\\" change.trigger=\\\"onFilterChange()\\\">\\n          </label>\\n          <label class=\\\"field compact\\\">\\n            <span>Tot en met</span>\\n            <input type=\\\"date\\\" value.bind=\\\"filters.to\\\" change.trigger=\\\"onFilterChange()\\\">\\n          </label>\\n          <label class=\\\"checkbox\\\">\\n            <input type=\\\"checkbox\\\" checked.bind=\\\"filters.onlyWithDate\\\" change.trigger=\\\"onFilterChange()\\\">\\n            <span>Alleen registraties met datum</span>\\n          </label>\\n          <label class=\\\"field compact\\\">\\n            <span>Sorteer op datum</span>\\n            <select value.bind=\\\"filters.sortDate\\\" change.trigger=\\\"onFilterChange()\\\">\\n              <option value=\\\"none\\\">Geen sortering</option>\\n              <option value=\\\"asc\\\">Oplopend</option>\\n              <option value=\\\"desc\\\">Aflopend</option>\\n            </select>\\n          </label>\\n        </div>\\n\\n        <div class=\\\"row bounds-row\\\">\\n          <label class=\\\"checkbox\\\">\\n            <input type=\\\"checkbox\\\" checked.bind=\\\"filters.boundsEnabled\\\" change.trigger=\\\"onFilterChange()\\\">\\n            <span>Filter op cordinatenbereik</span>\\n          </label>\\n          <div class=\\\"bounds-grid\\\" if.bind=\\\"filters.boundsEnabled\\\">\\n            <label class=\\\"field compact\\\">\\n              <span>minX (west)</span>\\n              <input type=\\\"number\\\" step=\\\"any\\\" value.bind=\\\"boundsInput.minX\\\" change.trigger=\\\"onFilterChange()\\\">\\n            </label>\\n            <label class=\\\"field compact\\\">\\n              <span>minY (zuid)</span>\\n              <input type=\\\"number\\\" step=\\\"any\\\" value.bind=\\\"boundsInput.minY\\\" change.trigger=\\\"onFilterChange()\\\">\\n            </label>\\n            <label class=\\\"field compact\\\">\\n              <span>maxX (oost)</span>\\n              <input type=\\\"number\\\" step=\\\"any\\\" value.bind=\\\"boundsInput.maxX\\\" change.trigger=\\\"onFilterChange()\\\">\\n            </label>\\n            <label class=\\\"field compact\\\">\\n              <span>maxY (noord)</span>\\n              <input type=\\\"number\\\" step=\\\"any\\\" value.bind=\\\"boundsInput.maxY\\\" change.trigger=\\\"onFilterChange()\\\">\\n            </label>\\n          </div>\\n        </div>\\n      </div>\\n    </section>\\n\\n    <section class=\\\"panel results\\\" if.bind=\\\"hasData\\\">\\n      <div class=\\\"results-head\\\">\\n        <div>\\n          <p class=\\\"panel-eyebrow\\\">Resultaten</p>\\n          <h2>Overzicht</h2>\\n          <p class=\\\"hint\\\">${resultSummary}</p>\\n          <p class=\\\"hint\\\">Excel-export genereert een .xlsx-bestand; CSV/GeoJSON blijven beschikbaar voor andere tools.</p>\\n        </div>\\n        <div class=\\\"actions\\\">\\n          <label class=\\\"field inline\\\">\\n            <span>Per pagina</span>\\n            <select value.two-way=\\\"pageSize\\\" change.trigger=\\\"onPageSizeChange($event.target.valueAsNumber || $event.target.value)\\\">\\n              <option repeat.for=\\\"opt of pageSizeOptions\\\" model.bind=\\\"opt\\\">${opt}</option>\\n            </select>\\n          </label>\\n          <button type=\\\"button\\\" disabled.bind=\\\"!filteredRows.length\\\" click.trigger=\\\"exportCsv()\\\">Exporteer CSV</button>\\n          <button type=\\\"button\\\" disabled.bind=\\\"!filteredRows.length\\\" click.trigger=\\\"exportExcel()\\\">Exporteer Excel</button>\\n          <button type=\\\"button\\\" disabled.bind=\\\"!filteredRows.length\\\" click.trigger=\\\"exportGeoJson()\\\">Exporteer GeoJSON</button>\\n        </div>\\n      </div>\\n\\n      <div class=\\\"table-wrap\\\" if.bind=\\\"filteredRows.length\\\">\\n        <table>\\n          <thead>\\n            <tr>\\n              <th>#</th>\\n              <th>Locatie</th>\\n              <th>X</th>\\n              <th>Y</th>\\n              <th>Datum</th>\\n              <th repeat.for=\\\"col of attributeColumns\\\">${col}</th>\\n            </tr>\\n          </thead>\\n          <tbody>\\n            <tr repeat.for=\\\"row of pageRows\\\">\\n              <td>${(currentPage - 1) * pageSize + $index + 1}</td>\\n              <td>\\n                <a class=\\\"map-link\\\" href.bind=\\\"googleMapsUrl(row)\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">\\n                  \\n                </a>\\n              </td>\\n              <td>${row.x}</td>\\n              <td>${row.y}</td>\\n              <td>${row.date || '-'}</td>\\n              <td repeat.for=\\\"col of attributeColumns\\\">\\n                <span if.bind=\\\"col !== 'obs_uri'\\\">${formatValue(row.attributes[col])}</span>\\n                <a\\n                  if.bind=\\\"col === 'obs_uri'\\\"\\n                  class=\\\"map-link\\\"\\n                  href.bind=\\\"obsUrl(row.attributes[col])\\\"\\n                  target=\\\"_blank\\\"\\n                  rel=\\\"noopener\\\">\\n                  ${obsLabel(row.attributes[col])}\\n                </a>\\n              </td>\\n            </tr>\\n          </tbody>\\n        </table>\\n      </div>\\n      <p class=\\\"hint\\\" if.bind=\\\"!filteredRows.length\\\">Geen registraties binnen de huidige filter.</p>\\n\\n      <div class=\\\"pagination\\\" if.bind=\\\"pageCount > 1\\\">\\n        <button type=\\\"button\\\" class=\\\"ghost\\\" disabled.bind=\\\"currentPage === 1\\\" click.trigger=\\\"goToPage(1)\\\">Eerste</button>\\n        <button type=\\\"button\\\" class=\\\"ghost\\\" disabled.bind=\\\"currentPage === 1\\\" click.trigger=\\\"changePage(-1)\\\">Vorige</button>\\n        <span>Pagina ${currentPage} van ${pageCount}</span>\\n        <button type=\\\"button\\\" class=\\\"ghost\\\" disabled.bind=\\\"currentPage === pageCount\\\" click.trigger=\\\"changePage(1)\\\">Volgende</button>\\n        <button type=\\\"button\\\" class=\\\"ghost\\\" disabled.bind=\\\"currentPage === pageCount\\\" click.trigger=\\\"goToPage(pageCount)\\\">Laatste</button>\\n      </div>\\n    </section>\\n\\n    <section class=\\\"panel muted\\\" if.bind=\\\"!hasData\\\">\\n      <h3>Geen data geladen</h3>\\n      <p class=\\\"hint\\\">Start met een shapefile of GeoJSON upload om de filters en export te gebruiken.</p>\\n    </section>\\n  </section>\\n</template>\\n\"","// src/nest-analysis/shapefile.ts\n// Minimal shapefile parser for point/multipoint/polyline/polygon geometries.\n// Focused on extracting registration coordinates client-side without external libs.\n\nexport interface MapBounds {\n  minX: number;\n  minY: number;\n  maxX: number;\n  maxY: number;\n}\n\nexport interface ObservationPoint {\n  x: number;\n  y: number;\n  dateStart?: string; // YYYYMMDD\n  dateStop?: string;  // YYYYMMDD\n  recordIndex?: number;\n  attributes?: Record<string, unknown>;\n}\n\nexport interface ParsedShapefile {\n  points: ObservationPoint[];\n  bounds: MapBounds;\n  shapeType: number;\n}\n\ninterface PolygonCentroid {\n  centroid: ObservationPoint;\n  area: number;\n}\n\nfunction parseHeader(view: DataView): { shapeType: number; bounds: MapBounds } {\n  if (view.byteLength < 100) {\n    throw new Error(\"SHP file too small to contain a valid header.\");\n  }\n\n  const fileCode = view.getInt32(0, false);\n  if (fileCode !== 9994) {\n    throw new Error(`Unexpected SHP file code: ${fileCode}`);\n  }\n\n  const shapeType = view.getInt32(32, true);\n  const minX = view.getFloat64(36, true);\n  const minY = view.getFloat64(44, true);\n  const maxX = view.getFloat64(52, true);\n  const maxY = view.getFloat64(60, true);\n\n  return {\n    shapeType,\n    bounds: { minX, minY, maxX, maxY }\n  };\n}\n\nfunction polygonCentroid(points: ObservationPoint[]): PolygonCentroid | null {\n  if (points.length < 3) {\n    return null;\n  }\n\n  let area = 0;\n  let cx = 0;\n  let cy = 0;\n\n  for (let i = 0; i < points.length; i++) {\n    const { x: x0, y: y0 } = points[i];\n    const { x: x1, y: y1 } = points[(i + 1) % points.length];\n    const cross = x0 * y1 - x1 * y0;\n    area += cross;\n    cx += (x0 + x1) * cross;\n    cy += (y0 + y1) * cross;\n  }\n\n  area *= 0.5;\n  if (Math.abs(area) < 1e-9) {\n    return null;\n  }\n\n  const factor = 1 / (6 * area);\n  return {\n    centroid: { x: cx * factor, y: cy * factor },\n    area: Math.abs(area)\n  };\n}\n\nfunction averagePoint(points: ObservationPoint[]): ObservationPoint {\n  if (!points.length) {\n    return { x: 0, y: 0 };\n  }\n\n  let sumX = 0;\n  let sumY = 0;\n  for (const p of points) {\n    sumX += p.x;\n    sumY += p.y;\n  }\n  return { x: sumX / points.length, y: sumY / points.length };\n}\n\nfunction readPolyRecord(\n  view: DataView,\n  offset: number\n): { centroid: ObservationPoint | null; next: number } {\n  // Record layout (little endian):\n  // int32 shapeType\n  // double[4] box\n  // int32 numParts\n  // int32 numPoints\n  // int32[numParts] parts\n  // Point[numPoints] points\n  const shapeType = view.getInt32(offset, true);\n  if (shapeType === 0) {\n    return { centroid: null, next: offset };\n  }\n\n  const numParts = view.getInt32(offset + 36, true);\n  const numPoints = view.getInt32(offset + 40, true);\n  const partOffset = offset + 44;\n  const pointsOffset = partOffset + numParts * 4;\n\n  const partStarts: number[] = [];\n  for (let i = 0; i < numParts; i++) {\n    partStarts.push(view.getInt32(partOffset + i * 4, true));\n  }\n  partStarts.push(numPoints); // sentinel for easy slicing\n\n  const points: ObservationPoint[] = [];\n  for (let i = 0; i < numPoints; i++) {\n    const base = pointsOffset + i * 16;\n    points.push({\n      x: view.getFloat64(base, true),\n      y: view.getFloat64(base + 8, true)\n    });\n  }\n\n  let weightedCx = 0;\n  let weightedCy = 0;\n  let totalArea = 0;\n\n  for (let p = 0; p < numParts; p++) {\n    const start = partStarts[p];\n    const end = partStarts[p + 1];\n    const slice = points.slice(start, end);\n    const centroid = polygonCentroid(slice);\n    if (centroid) {\n      weightedCx += centroid.centroid.x * centroid.area;\n      weightedCy += centroid.centroid.y * centroid.area;\n      totalArea += centroid.area;\n    }\n  }\n\n  if (totalArea > 0) {\n    return {\n      centroid: { x: weightedCx / totalArea, y: weightedCy / totalArea },\n      next: pointsOffset + numPoints * 16\n    };\n  }\n\n  return {\n    centroid: averagePoint(points),\n    next: pointsOffset + numPoints * 16\n  };\n}\n\nfunction readMultiPointRecord(\n  view: DataView,\n  offset: number\n): { points: ObservationPoint[]; next: number } {\n  const numPoints = view.getInt32(offset + 36, true);\n  const points: ObservationPoint[] = [];\n  const start = offset + 40;\n\n  for (let i = 0; i < numPoints; i++) {\n    const base = start + i * 16;\n    points.push({\n      x: view.getFloat64(base, true),\n      y: view.getFloat64(base + 8, true)\n    });\n  }\n\n  return { points, next: start + numPoints * 16 };\n}\n\n/**\n * Parse a .shp file ArrayBuffer and return observation points + bounds.\n * Supports Point (1), MultiPoint (8), PolyLine (3), Polygon (5).\n */\nexport function parseShapefile(buffer: ArrayBuffer): ParsedShapefile {\n  const view = new DataView(buffer);\n  const header = parseHeader(view);\n  const points: ObservationPoint[] = [];\n  let recordIndex = 0;\n\n  let offset = 100; // after header\n  while (offset + 12 <= view.byteLength) {\n    // Record header (big endian)\n    const contentLengthWords = view.getInt32(offset + 4, false);\n    const contentBytes = contentLengthWords * 2;\n    offset += 8;\n    const recordStart = offset;\n    const recordEnd = recordStart + contentBytes;\n    if (recordEnd > view.byteLength) {\n      break;\n    }\n\n    const shapeType = view.getInt32(recordStart, true);\n    if (shapeType === 0) {\n      offset = recordEnd;\n      continue; // Null shape\n    }\n\n    switch (shapeType) {\n      case 1: { // Point\n        const x = view.getFloat64(recordStart + 4, true);\n        const y = view.getFloat64(recordStart + 12, true);\n        points.push({ x, y, recordIndex });\n        break;\n      }\n      case 8: { // MultiPoint\n        const { points: pts, next } = readMultiPointRecord(view, recordStart);\n        points.push(...pts.map(p => ({ ...p, recordIndex })));\n        if (recordStart + contentBytes !== next) {\n          // align to record end if our parser didn't consume everything\n        }\n        break;\n      }\n      case 3: // PolyLine\n      case 5: { // Polygon\n        const { centroid } = readPolyRecord(view, recordStart);\n        if (centroid) {\n          points.push({ ...centroid, recordIndex });\n        }\n        break;\n      }\n      default:\n        // Unsupported shape type, skip\n        break;\n    }\n\n    recordIndex++;\n    offset = recordEnd;\n  }\n\n  return {\n    points,\n    bounds: header.bounds,\n    shapeType: header.shapeType\n  };\n}\n","// src/nest-analysis/dbf.ts\n// Minimal DBF reader that can expose all fields and help extract date columns.\n\nexport interface RecordDates {\n  start?: string; // YYYYMMDD\n  stop?: string;  // YYYYMMDD\n}\n\nexport interface DbfField {\n  name: string;\n  type: string;\n  size: number;\n  decimals: number;\n  offset: number;\n}\n\nexport interface ParsedDbf {\n  records: Record<string, string | number | boolean | null>[];\n  fields: DbfField[];\n}\n\nfunction parseHeader(view: DataView) {\n  const recordCount = view.getUint32(4, true);\n  const headerLength = view.getUint16(8, true);\n  const recordLength = view.getUint16(10, true);\n  return { recordCount, headerLength, recordLength };\n}\n\nfunction parseFields(view: DataView, headerLength: number): DbfField[] {\n  const fields: DbfField[] = [];\n  let offset = 32;\n  let recordOffset = 1; // first byte is deletion flag\n\n  while (offset + 32 <= headerLength - 1) {\n    const nameBytes = new Uint8Array(view.buffer, offset, 11);\n    const zeroIdx = nameBytes.indexOf(0);\n    const name = new TextDecoder(\"ascii\").decode(\n      zeroIdx >= 0 ? nameBytes.slice(0, zeroIdx) : nameBytes\n    ).trim();\n    const type = String.fromCharCode(view.getUint8(offset + 11));\n    const size = view.getUint8(offset + 16);\n    const decimals = view.getUint8(offset + 17);\n\n    if (!name) break;\n\n    fields.push({\n      name,\n      type,\n      size,\n      decimals,\n      offset: recordOffset\n    });\n\n    recordOffset += size;\n    offset += 32;\n  }\n\n  return fields;\n}\n\nfunction readString(\n  view: DataView,\n  base: number,\n  size: number\n): string {\n  const bytes = new Uint8Array(view.buffer, base, size);\n  return new TextDecoder(\"latin1\").decode(bytes).replace(/\\u0000/g, \"\").trim();\n}\n\nfunction normalizeDateString(value: string): string | null {\n  const trimmed = value.trim();\n  if (!trimmed) return null;\n  if (trimmed.length === 8 && /^\\d{8}$/.test(trimmed)) {\n    return `${trimmed.slice(0, 4)}-${trimmed.slice(4, 6)}-${trimmed.slice(6, 8)}`;\n  }\n  const d = new Date(trimmed);\n  if (isNaN(d.getTime())) return null;\n  return d.toISOString().slice(0, 10);\n}\n\nfunction parseValue(\n  view: DataView,\n  field: DbfField,\n  recordOffset: number\n): string | number | boolean | null {\n  const raw = readString(view, recordOffset + field.offset, field.size);\n  if (!raw) return null;\n\n  switch (field.type) {\n    case \"N\":\n    case \"F\": {\n      const num = Number(raw);\n      return Number.isFinite(num) ? num : raw;\n    }\n    case \"D\":\n      return normalizeDateString(raw);\n    case \"L\":\n      return [\"y\", \"t\", \"1\"].includes(raw.toLowerCase());\n    default:\n      return raw;\n  }\n}\n\nexport function parseDbf(buffer: ArrayBuffer): ParsedDbf {\n  const view = new DataView(buffer);\n  const { recordCount, headerLength, recordLength } = parseHeader(view);\n  const fields = parseFields(view, headerLength);\n\n  const records: Record<string, string | number | boolean | null>[] = [];\n  let offset = headerLength;\n\n  for (let i = 0; i < recordCount; i++) {\n    if (offset + recordLength > view.byteLength) break;\n    const deletedFlag = view.getUint8(offset);\n    const rec: Record<string, string | number | boolean | null> = {};\n\n    if (deletedFlag !== 0x2A) {\n      for (const field of fields) {\n        const value = parseValue(view, field, offset);\n        rec[field.name] = value;\n      }\n    }\n\n    records.push(rec);\n    offset += recordLength;\n  }\n\n  return { records, fields };\n}\n\n/**\n * Extract date strings (YYYY-MM-DD) for start/stop fields if present.\n */\nexport function parseDbfDates(\n  buffer: ArrayBuffer,\n  startField = \"datm_start\",\n  stopField = \"datm_stop\"\n): RecordDates[] {\n  const { records } = parseDbf(buffer);\n  return records.map(rec => {\n    const start = rec[startField];\n    const stop = rec[stopField];\n    return {\n      start: typeof start === \"string\" ? start.replace(/-/g, \"\") : start ? String(start) : undefined,\n      stop: typeof stop === \"string\" ? stop.replace(/-/g, \"\") : stop ? String(stop) : undefined\n    };\n  });\n}\n","// src/nest-analysis/geojson.ts\nimport { MapBounds, ObservationPoint } from \"./shapefile\";\n\nexport interface ParsedGeoJson {\n  points: ObservationPoint[];\n  bounds: MapBounds;\n}\n\nfunction updateBounds(b: MapBounds | null, x: number, y: number): MapBounds {\n  if (!b) return { minX: x, minY: y, maxX: x, maxY: y };\n  return {\n    minX: Math.min(b.minX, x),\n    minY: Math.min(b.minY, y),\n    maxX: Math.max(b.maxX, x),\n    maxY: Math.max(b.maxY, y),\n  };\n}\n\n/**\n * Minimal GeoJSON FeatureCollection parser for Point features (lon/lat).\n */\nexport function parseGeoJsonPoints(text: string): ParsedGeoJson {\n  const json = JSON.parse(text);\n  if (!json || json.type !== \"FeatureCollection\" || !Array.isArray(json.features)) {\n    throw new Error(\"GeoJSON moet een FeatureCollection zijn.\");\n  }\n\n  const points: ObservationPoint[] = [];\n  let bounds: MapBounds | null = null;\n\n  for (const feat of json.features) {\n    if (!feat || feat.type !== \"Feature\" || !feat.geometry) continue;\n    const geom = feat.geometry;\n    if (geom.type !== \"Point\" || !Array.isArray(geom.coordinates) || geom.coordinates.length < 2) continue;\n    const [lon, lat] = geom.coordinates;\n    if (!Number.isFinite(lon) || !Number.isFinite(lat)) continue;\n\n    const attrs = feat.properties && typeof feat.properties === \"object\"\n      ? { ...feat.properties }\n      : {};\n    const dateStart = attrs?.datm_start || attrs?.dateStart;\n    const dateStop = attrs?.datm_stop || attrs?.dateStop;\n\n    points.push({\n      x: lon,\n      y: lat,\n      dateStart,\n      dateStop,\n      attributes: attrs,\n      recordIndex: points.length\n    });\n    bounds = updateBounds(bounds, lon, lat);\n  }\n\n  if (!bounds) {\n    bounds = { minX: 0, minY: 0, maxX: 0, maxY: 0 };\n  }\n\n  return { points, bounds };\n}\n","// Precomputed CRC32 table for ZIP building.\nexport const CRC_TABLE = (() => {\n  const table = new Uint32Array(256);\n  for (let i = 0; i < 256; i++) {\n    let c = i;\n    for (let j = 0; j < 8; j++) {\n      c = ((c & 1) ? (0xEDB88320 ^ (c >>> 1)) : (c >>> 1)) >>> 0;\n    }\n    table[i] = c;\n  }\n  return table;\n})();\n","import { bindable, customElement, INode } from 'aurelia';\nimport template from './data-extractor-view.html?raw';\nimport './data-extractor.css';\nimport { MapBounds, ObservationPoint, parseShapefile } from '../nest-analysis/shapefile';\nimport { DbfField, parseDbf } from '../nest-analysis/dbf';\nimport { parseGeoJsonPoints } from '../nest-analysis/geojson';\nimport { CRC_TABLE } from './crc-table';\n\ntype SourceType = 'shp' | 'geojson';\n\ninterface DataRow {\n  id: number;\n  x: number;\n  y: number;\n  recordIndex?: number;\n  source: SourceType;\n  date: string | null;\n  attributes: Record<string, string | number | boolean | null>;\n}\n\n@customElement({\n  name: 'data-extractor-view',\n  template\n})\nexport class DataExtractorView {\n  @bindable shpFile: File | null = null;\n  @bindable dbfFile: File | null = null;\n  @bindable geoJsonFile: File | null = null;\n\n  sourceType: SourceType | null = null;\n  infoMessage: string | null = null;\n  loadError: string | null = null;\n  isBusy = false;\n\n  dataRows: DataRow[] = [];\n  filteredRows: DataRow[] = [];\n  pageRows: DataRow[] = [];\n  attributeColumns: string[] = [];\n  fieldsFromDbf: DbfField[] = [];\n\n  boundsFromData: MapBounds | null = null;\n  boundsInput: MapBounds = { minX: 0, minY: 0, maxX: 0, maxY: 0 };\n\n  filters = {\n    text: '',\n    from: '',\n    to: '',\n    onlyWithDate: false,\n    boundsEnabled: false,\n    sortDate: 'none' as 'none' | 'asc' | 'desc'\n  };\n\n  pageSizeOptions = [10, 25, 50];\n  pageSize = 10;\n  currentPage = 1;\n\n  private host: HTMLElement | null = null;\n\n  created(owningView: INode) {\n    this.host = owningView as HTMLElement;\n  }\n\n  get pageCount(): number {\n    return Math.max(1, Math.ceil(this.filteredRows.length / this.pageSize));\n  }\n\n  get hasData(): boolean {\n    return this.dataRows.length > 0;\n  }\n\n  get resultSummary(): string {\n    if (!this.hasData) return 'Nog geen data geladen.';\n    if (!this.filteredRows.length) return 'Geen resultaten na filteren.';\n    const start = (this.currentPage - 1) * this.pageSize + 1;\n    const end = Math.min(this.filteredRows.length, start + this.pageSize - 1);\n    return `${start}${end} van ${this.filteredRows.length} gefilterde registraties (${this.dataRows.length} totaal).`;\n  }\n\n  shpFileChanged(file: File | null) {\n    this.sourceType = 'shp';\n    this.shpFile = file;\n    this.loadData();\n  }\n\n  dbfFileChanged(file: File | null) {\n    this.dbfFile = file;\n    if (this.sourceType === 'shp') {\n      this.loadData();\n    }\n  }\n\n  geoJsonFileChanged(file: File | null) {\n    this.sourceType = 'geojson';\n    this.geoJsonFile = file;\n    this.loadData();\n  }\n\n  onFilterChange() {\n    this.applyFilters();\n  }\n\n  onPageSizeChange(value: string | number) {\n    const parsed = typeof value === 'number' ? value : Number(value);\n    if (!Number.isFinite(parsed)) return;\n    if (!this.pageSizeOptions.includes(parsed)) return;\n    this.pageSize = parsed;\n    this.currentPage = 1;\n    this.updatePageRows();\n  }\n\n  goToPage(page: number) {\n    const safePage = Math.min(Math.max(page, 1), this.pageCount);\n    if (safePage !== this.currentPage) {\n      this.currentPage = safePage;\n      this.updatePageRows();\n    }\n  }\n\n  changePage(delta: number) {\n    this.goToPage(this.currentPage + delta);\n  }\n\n  resetFilters() {\n    this.filters = { text: '', from: '', to: '', onlyWithDate: false, boundsEnabled: false };\n    if (this.boundsFromData) {\n      this.boundsInput = { ...this.boundsFromData };\n    }\n    this.applyFilters();\n  }\n\n  async exportCsv() {\n    if (!this.filteredRows.length) return;\n    const header = ['x', 'y', 'date', ...this.attributeColumns];\n    const lines = [header.join(',')];\n\n    for (const row of this.filteredRows) {\n      const vals = header.map(col => this.csvEscape(this.getValue(row, col)));\n      lines.push(vals.join(','));\n    }\n\n    const blob = new Blob([lines.join('\\n')], { type: 'text/csv' });\n    this.downloadBlob(blob, 'registraties.csv');\n  }\n\n  async exportExcel() {\n    if (!this.filteredRows.length) return;\n    const headers = ['#', 'x', 'y', 'date', ...this.attributeColumns];\n    const rows = this.filteredRows.map((row, idx) => ([\n      (idx + 1).toString(),\n      row.x,\n      row.y,\n      row.date ?? '',\n      ...this.attributeColumns.map(col => this.formatValue(row.attributes[col]))\n    ]));\n\n    const xlsxBytes = this.buildXlsx([headers, ...rows], 'Registraties');\n    const blob = new Blob([xlsxBytes], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\n    this.downloadBlob(blob, 'registraties.xlsx');\n  }\n\n  async exportGeoJson() {\n    if (!this.filteredRows.length) return;\n    const features = this.filteredRows.map(row => ({\n      type: 'Feature',\n      geometry: { type: 'Point', coordinates: [row.x, row.y] },\n      properties: {\n        ...row.attributes,\n        date: row.date,\n        source: row.source\n      }\n    }));\n\n    const collection = { type: 'FeatureCollection', features };\n    const blob = new Blob([JSON.stringify(collection, null, 2)], { type: 'application/json' });\n    this.downloadBlob(blob, 'registraties.geojson');\n  }\n\n  googleMapsUrl(row: DataRow): string {\n    const { lon, lat } = this.toWgs(row);\n    if (!Number.isFinite(lat) || !Number.isFinite(lon)) return '#';\n    const latStr = lat.toFixed(6);\n    const lonStr = lon.toFixed(6);\n    return `https://www.google.com/maps?q=${latStr},${lonStr}`;\n  }\n\n  obsUrl(value: unknown): string {\n    const raw = this.formatValue(value).trim();\n    if (!raw) return '#';\n    let url = raw;\n    if (url.startsWith('//')) {\n      url = `https:${url}`;\n    } else if (!/^https?:\\/\\//i.test(url)) {\n      url = `https://${url.replace(/^https?:\\/\\//i, '')}`;\n    } else if (/^http:\\/\\//i.test(url)) {\n      url = url.replace(/^http:\\/\\//i, 'https://');\n    }\n    return url;\n  }\n\n  obsLabel(value: unknown): string {\n    const raw = this.formatValue(value).trim();\n    if (!raw) return '-';\n    try {\n      const url = new URL(this.obsUrl(raw));\n      return url.hostname;\n    } catch {\n      return raw;\n    }\n  }\n\n  private async loadData() {\n    if (!this.shpFile && !this.geoJsonFile) {\n      this.resetData();\n      return;\n    }\n\n    this.setBusy(true);\n    this.loadError = null;\n\n    try {\n      if (this.sourceType === 'geojson' && this.geoJsonFile) {\n        await this.loadGeoJson();\n      } else if (this.shpFile) {\n        await this.loadShapefile();\n      }\n      this.applyFilters();\n    } catch (err) {\n      console.error('Kon data niet laden', err);\n      this.loadError = 'Kon data niet laden. Controleer het bestand en probeer opnieuw.';\n      this.resetData();\n    } finally {\n      this.setBusy(false);\n    }\n  }\n\n  private async loadShapefile() {\n    if (!this.shpFile) return;\n    const shpBuffer = await this.shpFile.arrayBuffer();\n    const parsed = parseShapefile(shpBuffer);\n\n    let dbfData: { records: Record<string, string | number | boolean | null>[]; fields: DbfField[] } | null = null;\n    if (this.dbfFile) {\n      try {\n        const dbfBuffer = await this.dbfFile.arrayBuffer();\n        dbfData = parseDbf(dbfBuffer);\n        this.fieldsFromDbf = dbfData.fields;\n      } catch (err) {\n        console.warn('DBF kon niet gelezen worden; attributen worden overgeslagen.', err);\n        this.fieldsFromDbf = [];\n      }\n    } else {\n      this.fieldsFromDbf = [];\n    }\n\n    const rows: DataRow[] = parsed.points.map((point, idx) => {\n      const recordIdx = point.recordIndex ?? idx;\n      const attributes = (dbfData?.records[recordIdx] ?? {}) as Record<string, string | number | boolean | null>;\n      const date = this.pickDate(point, attributes);\n      return {\n        id: idx + 1,\n        x: point.x,\n        y: point.y,\n        recordIndex: recordIdx,\n        source: 'shp',\n        date,\n        attributes\n      };\n    });\n\n    this.dataRows = rows;\n    this.boundsFromData = parsed.bounds;\n    this.boundsInput = { ...parsed.bounds };\n    this.attributeColumns = this.deriveAttributeColumns(rows, this.fieldsFromDbf);\n    this.infoMessage = `${rows.length} registraties ingelezen uit shapefile`;\n  }\n\n  private async loadGeoJson() {\n    if (!this.geoJsonFile) return;\n    const text = await this.geoJsonFile.text();\n    const parsed = parseGeoJsonPoints(text);\n\n    const rows: DataRow[] = parsed.points.map((point, idx) => {\n      const attributes = (point.attributes ?? {}) as Record<string, string | number | boolean | null>;\n      const date = this.pickDate(point, attributes);\n      return {\n        id: idx + 1,\n        x: point.x,\n        y: point.y,\n        recordIndex: point.recordIndex,\n        source: 'geojson',\n        date,\n        attributes\n      };\n    });\n\n    this.dataRows = rows;\n    this.boundsFromData = parsed.bounds;\n    this.boundsInput = { ...parsed.bounds };\n    this.attributeColumns = this.deriveAttributeColumns(rows);\n    this.infoMessage = `${rows.length} registraties ingelezen uit GeoJSON`;\n  }\n\n  private applyFilters() {\n    const { text, from, to, onlyWithDate, boundsEnabled } = this.filters;\n    const search = text.trim().toLowerCase();\n    const hasBounds = boundsEnabled && this.isValidBounds(this.boundsInput);\n\n    const filtered = this.dataRows.filter(row => {\n      const rowDate = this.normalizeDate(\n        row.date ||\n        row.attributes?.datm_start ||\n        row.attributes?.dateStart ||\n        row.attributes?.date\n      );\n      if (onlyWithDate && !rowDate) return false;\n      if (from && rowDate && rowDate < from) return false;\n      if (to && rowDate && rowDate > to) return false;\n\n      if (hasBounds) {\n        const { minX, minY, maxX, maxY } = this.boundsInput;\n        if (row.x < minX || row.x > maxX || row.y < minY || row.y > maxY) {\n          return false;\n        }\n      }\n\n      if (search) {\n        const haystack = this.buildSearchHaystack(row);\n        if (!haystack.includes(search)) return false;\n      }\n\n      return true;\n    });\n\n    const sorted = this.sortByDate(filtered, this.filters.sortDate);\n\n    this.filteredRows = sorted;\n    this.currentPage = 1;\n    this.updatePageRows();\n  }\n\n  private updatePageRows() {\n    const start = (this.currentPage - 1) * this.pageSize;\n    this.pageRows = this.filteredRows.slice(start, start + this.pageSize);\n  }\n\n  private sortByDate(rows: DataRow[], direction: 'none' | 'asc' | 'desc'): DataRow[] {\n    if (direction === 'none') return [...rows];\n    return [...rows].sort((a, b) => {\n      const da = this.normalizeDate(a.date) ?? '';\n      const db = this.normalizeDate(b.date) ?? '';\n      if (da === db) return 0;\n      return direction === 'asc' ? (da < db ? -1 : 1) : (da > db ? -1 : 1);\n    });\n  }\n\n  private toWgs(row: DataRow): { lon: number; lat: number } {\n    if (row.source === 'geojson') {\n      return { lon: row.x, lat: row.y };\n    }\n    const rd = { x: row.x, y: row.y };\n    const wgs = this.rdToWgs(rd);\n    return { lon: wgs.x, lat: wgs.y };\n  }\n\n  // RD New to WGS84 approximation (matches earlier implementation).\n  private rdToWgs(point: { x: number; y: number }): { x: number; y: number } {\n    const X0 = 155000.0;\n    const Y0 = 463000.0;\n    const phi0 = 52.15517440;\n    const lam0 = 5.38720621;\n    const K = [\n      [0, 1, 3235.65389], [2, 0, -32.58297], [0, 2, -0.2475],\n      [2, 1, -0.84978], [0, 3, -0.0655], [2, 2, -0.01709],\n      [1, 0, -0.00738], [4, 0, 0.0053], [2, 3, -0.00039],\n      [4, 1, 0.00033], [1, 1, -0.00012],\n    ];\n    const L = [\n      [1, 0, 5260.52916], [1, 1, 105.94684], [1, 2, 2.45656],\n      [3, 0, -0.81885], [1, 3, 0.05594], [3, 1, -0.05607],\n      [0, 1, 0.01199], [3, 2, -0.00256], [1, 4, 0.00128],\n      [0, 2, 0.00022], [2, 0, -0.00022], [5, 0, 0.00026],\n    ];\n\n    const dx = (point.x - X0) / 100000.0;\n    const dy = (point.y - Y0) / 100000.0;\n\n    let phi = phi0;\n    let lam = lam0;\n    for (const [p, q, c] of K) {\n      phi += (c * Math.pow(dx, p) * Math.pow(dy, q)) / 3600.0;\n    }\n    for (const [p, q, c] of L) {\n      lam += (c * Math.pow(dx, p) * Math.pow(dy, q)) / 3600.0;\n    }\n    return { x: lam, y: phi };\n  }\n\n  private buildSearchHaystack(row: DataRow): string {\n    const parts: string[] = [\n      row.x.toString(),\n      row.y.toString(),\n      row.date ?? ''\n    ];\n    for (const key of Object.keys(row.attributes)) {\n      const val = row.attributes[key];\n      parts.push(key, this.formatValue(val));\n    }\n    return parts.join(' ').toLowerCase();\n  }\n\n  private deriveAttributeColumns(rows: DataRow[], orderedFields: DbfField[] = []): string[] {\n    const exclude = new Set(['datm_start', 'datm_stop', 'dateStart', 'dateStop', 'date']);\n    const cols: string[] = [];\n    for (const f of orderedFields) {\n      if (!exclude.has(f.name) && !cols.includes(f.name)) {\n        cols.push(f.name);\n      }\n    }\n    for (const row of rows) {\n      Object.keys(row.attributes).forEach(key => {\n        if (!exclude.has(key) && !cols.includes(key)) {\n          cols.push(key);\n        }\n      });\n    }\n    return cols;\n  }\n\n  private pickDate(point: ObservationPoint, attributes: Record<string, string | number | boolean | null>): string | null {\n    const start = this.normalizeDate(point.dateStart || attributes?.datm_start || attributes?.dateStart || attributes?.start);\n    const stop = this.normalizeDate(point.dateStop || attributes?.datm_stop || attributes?.dateStop || attributes?.stop);\n    return start || stop;\n  }\n\n  private normalizeDate(input: unknown): string | null {\n    if (input === undefined || input === null) return null;\n    if (input instanceof Date) {\n      return isNaN(input.getTime()) ? null : input.toISOString().slice(0, 10);\n    }\n    const str = String(input).trim();\n    if (!str) return null;\n    const digits = str.replace(/\\D/g, '');\n    if (digits.length === 8) {\n      const iso = `${digits.slice(0, 4)}-${digits.slice(4, 6)}-${digits.slice(6, 8)}`;\n      const d = new Date(iso);\n      return isNaN(d.getTime()) ? null : iso;\n    }\n    const parsed = new Date(str);\n    return isNaN(parsed.getTime()) ? null : parsed.toISOString().slice(0, 10);\n  }\n\n  private isValidBounds(bounds: MapBounds): boolean {\n    const width = bounds.maxX - bounds.minX;\n    const height = bounds.maxY - bounds.minY;\n    return Number.isFinite(width) && Number.isFinite(height) && width > 0 && height > 0;\n  }\n\n  private getValue(row: DataRow, key: string): string | number | boolean | null {\n    switch (key) {\n      case 'x':\n        return row.x;\n      case 'y':\n        return row.y;\n      case 'date':\n        return row.date;\n      default:\n        return row.attributes[key] ?? null;\n    }\n  }\n\n  private csvEscape(value: unknown): string {\n    if (value === null || value === undefined) return '';\n    const str = String(value);\n    if (/[\",\\n]/.test(str)) {\n      return `\"${str.replace(/\"/g, '\"\"')}\"`;\n    }\n    return str;\n  }\n\n  formatValue(value: unknown): string {\n    if (value === null || value === undefined) return '';\n    if (typeof value === 'boolean') return value ? 'true' : 'false';\n    if (typeof value === 'number') return Number.isFinite(value) ? value.toString() : '';\n    return String(value);\n  }\n\n  private buildXlsx(rows: (string | number)[][], sheetName: string): Uint8Array {\n    const sheetXml = this.buildSheetXml(rows);\n    const workbookXml = this.buildWorkbookXml(sheetName);\n    const workbookRels = this.buildWorkbookRels();\n    const contentTypes = this.buildContentTypes();\n    const rels = this.buildRootRels();\n\n    const files = [\n      { path: '[Content_Types].xml', data: this.utf8(contentTypes) },\n      { path: '_rels/.rels', data: this.utf8(rels) },\n      { path: 'xl/workbook.xml', data: this.utf8(workbookXml) },\n      { path: 'xl/_rels/workbook.xml.rels', data: this.utf8(workbookRels) },\n      { path: 'xl/worksheets/sheet1.xml', data: this.utf8(sheetXml) },\n    ];\n\n    return this.buildZip(files);\n  }\n\n  private buildSheetXml(rows: (string | number)[][]): string {\n    const cells = (row: (string | number)[], rIdx: number) => row.map((value, cIdx) => {\n      const col = this.columnName(cIdx + 1);\n      const addr = `${col}${rIdx}`;\n      if (typeof value === 'number' && Number.isFinite(value)) {\n        return `<c r=\"${addr}\"><v>${value}</v></c>`;\n      }\n      const text = this.xmlEscape(String(value ?? ''));\n      return `<c r=\"${addr}\" t=\"inlineStr\"><is><t>${text}</t></is></c>`;\n    }).join('');\n\n    const rowsXml = rows.map((row, idx) => `<row r=\"${idx + 1}\">${cells(row, idx + 1)}</row>`).join('');\n    return `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<worksheet xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\">\n  <sheetData>\n    ${rowsXml}\n  </sheetData>\n</worksheet>`;\n  }\n\n  private buildWorkbookXml(sheetName: string): string {\n    const safeName = this.xmlEscape(sheetName || 'Sheet1');\n    return `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<workbook xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\" xmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\">\n  <sheets>\n    <sheet name=\"${safeName}\" sheetId=\"1\" r:id=\"rId1\"/>\n  </sheets>\n</workbook>`;\n  }\n\n  private buildWorkbookRels(): string {\n    return `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">\n  <Relationship Id=\"rId1\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet\" Target=\"worksheets/sheet1.xml\"/>\n</Relationships>`;\n  }\n\n  private buildContentTypes(): string {\n    return `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Types xmlns=\"http://schemas.openxmlformats.org/package/2006/content-types\">\n  <Default Extension=\"rels\" ContentType=\"application/vnd.openxmlformats-package.relationships+xml\"/>\n  <Default Extension=\"xml\" ContentType=\"application/xml\"/>\n  <Override PartName=\"/xl/workbook.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml\"/>\n  <Override PartName=\"/xl/worksheets/sheet1.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml\"/>\n</Types>`;\n  }\n\n  private buildRootRels(): string {\n    return `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">\n  <Relationship Id=\"rId1\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument\" Target=\"xl/workbook.xml\"/>\n</Relationships>`;\n  }\n\n  private columnName(index: number): string {\n    let n = index;\n    let name = '';\n    while (n > 0) {\n      const rem = (n - 1) % 26;\n      name = String.fromCharCode(65 + rem) + name;\n      n = Math.floor((n - 1) / 26);\n    }\n    return name;\n  }\n\n  private buildZip(files: { path: string; data: Uint8Array }[]): Uint8Array {\n    const encoder = new TextEncoder();\n    let offset = 0;\n    const localParts: Uint8Array[] = [];\n    const centralParts: Uint8Array[] = [];\n\n    for (const file of files) {\n      const nameBytes = encoder.encode(file.path);\n      const crc = this.crc32(file.data);\n      const size = file.data.length;\n\n      const localHeader = new DataView(new ArrayBuffer(30));\n      localHeader.setUint32(0, 0x04034b50, true);\n      localHeader.setUint16(4, 20, true);\n      localHeader.setUint16(6, 0, true);\n      localHeader.setUint16(8, 0, true);\n      localHeader.setUint16(10, 0, true);\n      localHeader.setUint16(12, 0, true);\n      localHeader.setUint32(14, crc, true);\n      localHeader.setUint32(18, size, true);\n      localHeader.setUint32(22, size, true);\n      localHeader.setUint16(26, nameBytes.length, true);\n      localHeader.setUint16(28, 0, true);\n\n      const localBuf = this.concatBuffers([new Uint8Array(localHeader.buffer), nameBytes, file.data]);\n      localParts.push(localBuf);\n\n      const centralHeader = new DataView(new ArrayBuffer(46));\n      centralHeader.setUint32(0, 0x02014b50, true);\n      centralHeader.setUint16(4, 20, true);\n      centralHeader.setUint16(6, 20, true);\n      centralHeader.setUint16(8, 0, true);\n      centralHeader.setUint16(10, 0, true);\n      centralHeader.setUint16(12, 0, true);\n      centralHeader.setUint16(14, 0, true);\n      centralHeader.setUint32(16, crc, true);\n      centralHeader.setUint32(20, size, true);\n      centralHeader.setUint32(24, size, true);\n      centralHeader.setUint16(28, nameBytes.length, true);\n      centralHeader.setUint16(30, 0, true);\n      centralHeader.setUint16(32, 0, true);\n      centralHeader.setUint16(34, 0, true);\n      centralHeader.setUint16(36, 0, true);\n      centralHeader.setUint32(38, 0, true);\n      centralHeader.setUint32(42, offset, true);\n\n      const centralBuf = this.concatBuffers([new Uint8Array(centralHeader.buffer), nameBytes]);\n      centralParts.push(centralBuf);\n\n      offset += localBuf.length;\n    }\n\n    const centralSize = centralParts.reduce((sum, part) => sum + part.length, 0);\n    const centralOffset = offset;\n    const endHeader = new DataView(new ArrayBuffer(22));\n    endHeader.setUint32(0, 0x06054b50, true);\n    endHeader.setUint16(4, 0, true);\n    endHeader.setUint16(6, 0, true);\n    endHeader.setUint16(8, files.length, true);\n    endHeader.setUint16(10, files.length, true);\n    endHeader.setUint32(12, centralSize, true);\n    endHeader.setUint32(16, centralOffset, true);\n    endHeader.setUint16(20, 0, true);\n\n    const output = this.concatBuffers([\n      ...localParts,\n      ...centralParts,\n      new Uint8Array(endHeader.buffer)\n    ]);\n    return output;\n  }\n\n  private concatBuffers(chunks: Uint8Array[]): Uint8Array {\n    const total = chunks.reduce((sum, c) => sum + c.length, 0);\n    const out = new Uint8Array(total);\n    let offset = 0;\n    for (const chunk of chunks) {\n      out.set(chunk, offset);\n      offset += chunk.length;\n    }\n    return out;\n  }\n\n  private utf8(input: string): Uint8Array {\n    return new TextEncoder().encode(input);\n  }\n\n  private crc32(data: Uint8Array): number {\n    let crc = 0 ^ (-1);\n    for (let i = 0; i < data.length; i++) {\n      crc = (crc >>> 8) ^ CRC_TABLE[(crc ^ data[i]) & 0xff];\n    }\n    return (crc ^ (-1)) >>> 0;\n  }\n\n  private xmlEscape(value: string): string {\n    return value\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\\\"/g, '&quot;')\n      .replace(/'/g, '&apos;');\n  }\n\n  private downloadBlob(blob: Blob, filename: string) {\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = filename;\n    a.click();\n    URL.revokeObjectURL(url);\n  }\n\n  resetData() {\n    this.dataRows = [];\n    this.filteredRows = [];\n    this.pageRows = [];\n    this.attributeColumns = [];\n    this.boundsFromData = null;\n    this.boundsInput = { minX: 0, minY: 0, maxX: 0, maxY: 0 };\n    this.fieldsFromDbf = [];\n    this.infoMessage = null;\n    this.loadError = null;\n  }\n\n  private setBusy(state: boolean) {\n    this.isBusy = state;\n    this.host?.classList?.toggle('is-busy', state);\n    if (typeof document !== 'undefined' && document.body) {\n      document.body.style.cursor = state ? 'progress' : 'default';\n    }\n  }\n}\n","// src/main.ts\nimport Aurelia from 'aurelia';\nimport { DataExtractorView } from './components/data-extractor-view';\nimport './styles.css';\n\n// Simpele startup volgens de Aurelia 2 docs:\n// Aurelia.app(MyRootComponent).start();\nAurelia\n  .app(DataExtractorView)\n  .start();\n"],"names":["initializeTC39Metadata","Metadata","key","type","value","keys","metadata","length","i","objectFreeze","objectAssign","safeString","getMetadata","defineMetadata","isPromise","v","isArray","isSet","isMap","isObject","isObjectOrFunction","isFunction","isString","isSymbol","isNumber","createLookup","areEqual","createMappedError","code","details","paddedCode","message","getMessageByCode","link","errorsMap","name","cooked","logError","args","isArrayIndex","isNumericLookup","result","ch","baseCase","isDigit","charToKind","char","input","cb","len","sep","output","prevKind","curChar","curKind","nextChar","nextKind","camelCase","cache","callback","pascalCase","kebabCase","toArray","arr","bound","originalMethod","context","methodName","mergeArrays","arrays","k","arraysLen","arrayLen","array","j","firstDefined","values","getPrototypeChain","functionPrototype","getPrototypeOf","proto","chain","Type","toLookup","objs","isNativeFunction","lookup","isNative","sourceText","fn","onResolve","maybePromise","resolveCallback","onResolveAll","maybePromises","firstPromise","promises","ii","instanceRegistration","Resolver","singletonRegistration","transientRegistation","callbackRegistration","cachedCallbackRegistration","cacheCallbackResult","aliasToRegistration","originalKey","aliasKey","deferRegistration","params","ParameterizedRegistry","containerLookup","fun","handler","requestor","resolver","resolverLookup","t","Registration","createImplementationRegister","container","annoBaseName","getAnnotationKeyFor","appendAnnotation","target","annotation","prop","resourceBaseName","getResourceKeyFor","Protocol","hasOwn","fromAnnotationOrDefinitionOrTypeOrDefault","def","getDefault","fromAnnotationOrTypeOrDefault","fromDefinitionOrDefault","registrableMetadataKey","DefaultResolver","ContainerConfiguration","inheritParentResources","defaultResolver","config","createContainer","Container","InstrinsicTypeNames","containerId","currentContainer","parent","IContainer","containerResolver","current","jj","isRegistry","isClass","registrable","$au","aliases","emptyArray","isDisposable","validateKey","resolvers","isResourceKey","transformer","factory","autoRegister","previousContainer","isRegisterInRequester","searchAncestors","resolutions","buildAllResponse","dynamicDependencies","resolvedDeps","dep","getDependencies","_","ex","containerGetKey","Factory","disposableResolvers","disposable","res","keyOrKind","keyAsValue","$isRegistry","registrationResolver","newResolver","dependencies","instance","transformInstance","inst","transform","d","resolve","state","results","obj","isSelfRegistry","ResolverBuilder","_container","_key","destinationKey","strategy","cloneArrayWithPossibleProps","source","clone","diParamTypesKeys","getAnnotationParamtypes","getDesignParamtypes","getOrCreateAnnotationParamTypes","inject","designParamtypes","annotationParamtypes","Proto","auAnnotationParamtype","createInterface","configureOrName","configuror","configure","friendlyName","Interface","decorated","DI","options","defaultSingletonOptions","IServiceLocator","transientDecorator","transient","InstanceProvider","x","emptyObject","noop","IPlatform","createResolver","getter","all","optional","own","resource","optionalResource","allResources","__esDecorate","ctor","descriptorIn","decorators","contextIn","initializers","extraInitializers","accept","f","kind","descriptor","done","__runInitializers","thisArg","useValue","trace","debug","info","warn","error","fatal","none","LogLevel","ILogConfig","LogConfig","ISink","ILogEventFactory","DefaultLogEventFactory","ILogger","DefaultLogger","ILogScopes","LoggerSink","definition","format","str","colorOptions","level","getLogLevelString","logLevelString","getScopeString","scope","getIsoString","timestamp","DefaultLogEvent","severity","optionalParams","forConsole","messageOrError","scopeInfo","msg","offset","logger","_a","_instanceExtraInitializers","_trace_decorators","_debug_decorators","_info_decorators","_warn_decorators","_error_decorators","_fatal_decorators","sinks","traceSinks","debugSinks","infoSinks","warnSinks","errorSinks","fatalSinks","$sink","handles","messageOrGetMessage","scopedLoggers","scopedLogger","msgOrGetMsg","event","_metadata","ekAccessThis","ekAccessBoundary","ekAccessGlobal","ekAccessScope","ekArrayLiteral","ekObjectLiteral","ekPrimitiveLiteral","ekNew","ekTemplate","ekUnary","ekCallScope","ekCallMember","ekCallFunction","ekCallGlobal","ekAccessMember","ekAccessKeyed","ekTaggedTemplate","ekBinary","ekConditional","ekAssign","ekArrowFunction","ekValueConverter","ekBindingBehavior","ekArrayBindingPattern","ekObjectBindingPattern","ekBindingIdentifier","ekForOfStatement","ekInterpolation","ekArrayDestructuring","ekObjectDestructuring","ekDestructuringAssignmentLeaf","ekCustom","CustomExpression","_visitor","BindingBehaviorExpression","expression","ValueConverterExpression","AssignExpression","op","ConditionalExpression","condition","yes","no","AccessGlobalExpression","AccessThisExpression","ancestor","AccessBoundaryExpression","AccessScopeExpression","isAccessGlobal","ast","AccessMemberExpression","object","AccessKeyedExpression","NewExpression","func","CallScopeExpression","CallMemberExpression","optionalMember","optionalCall","CallFunctionExpression","CallGlobalExpression","BinaryExpression","operation","left","right","UnaryExpression","pos","PrimitiveLiteralExpression","ArrayLiteralExpression","elements","ObjectLiteralExpression","TemplateExpression","expressions","TaggedTemplateExpression","raw","ArrayBindingPattern","ObjectBindingPattern","BindingIdentifier","ForOfStatement","declaration","iterable","semiIdx","Interpolation","parts","DestructuringAssignmentExpression","$kind","list","initializer","DestructuringAssignmentSingleExpression","ArrowFunction","body","rest","regex","matches","method","IExpressionParser","ExpressionParser","expressionType","found","etIsCustom","etInterpolation","etIsIterator","etIsFunction","etIsProperty","invalidEmptyExpression","$input","$index","$length","$scopeDepth","$startIndex","$currentToken","$tokenValue","$currentChar","$charCodeAt","$assignable","$optional","$accessGlobal","$semicolonIndex","parse","unescapeCode","$false","$true","$null","$undefined","$this","$parent","boundary","etNone","etIsChainable","stringFromCharCode","index","$tokenRaw","globalNames","minPrecedence","parseInterpolation","nextToken","invalidStartOfExpression","optionalThisTail","TokenValues","primary","expectedIdentifier","invalidMemberExpression","id","unexpectedImportKeyword","consumeOpt","functionBodyInArrowFn","_optional","_scopeDepth","unexpectedDoubleDot","invalidSpreadOp","parseCoverParenthesizedExpressionAndArrowParameterList","parseArrayDestructuring","parseArrayLiteralExpression","parseObjectLiteralExpression","parseTemplate","callee","parseArguments","unexpectedEndOfExpression","unconsumedToken","parseForOfStatement","unexpectedTokenInOptionalChain","parseKeyedExpression","invalidTaggedTemplateOnOptionalChain","createTemplateTail","parseOptionalChainLHS","parseMemberExpressionLHS","opToken","consume","lhsNotAssignable","expectedValueConverterIdentifier","expectedBindingBehaviorIdentifier","unexpectedOfKeyword","items","dae","$continue","addItem","unexpectedTokenInDestructuring","lhs","rhs","indexSave","startIndexSave","currentTokenSave","currentCharSave","tokenValueSave","assignableSave","optionalSave","arrowParams","paramsState","isParamList","loop","restParamsMustBeLastParam","invalidArrowParameterList","missingExpectedToken","defaultParamsInArrowFn","destructuringParamsInArrowFn","expr","allowedForExprKinds","invalidLHSBindingIdentifierInForOf","statement","currentChar","currentToken","invalidPropDefInObjLiteral","tagged","scanTemplateTail","strings","CharScanners","scanIdentifier","IdParts","token","KeywordLookup","scanNumber","isFloat","scanString","quote","unescaped","buffer","marker","unterminatedStringLiteral","last","scanTemplate","tail","unterminatedTemplateLiteral","unexpectedCharacter","codes","decompress","$set","compressed","rangeCount","start","end","returnToken","peek","tcCreateInterface","tcObjectFreeze","aliasRegistration","definitionTypeElement","BindingMode","ITemplateCompiler","IAttrMapper","getBindingCommandHelp","_b","_c","_d","_e","CharSpec","chars","repeat","isInverted","other","_char","Interpretation","pattern","currentRecord","partsRecord","AttrParsingState","charSpec","patterns","nextStates","child","interpretation","childLen","StaticSegment","text","specs","DynamicSegment","symbols","SymbolSegment","SegmentTypes","ISyntaxInterpreter","SyntaxInterpreter","defs","d1","d2","currentState","types","segments","charSpecCb","states","isEndpoint","sortEndpoint","c","a","b","aTypes","bTypes","AttrSyntax","rawName","rawValue","command","IAttributePattern","IAttributeParser","AttributeParser","$patterns","AttributePattern","patternDefs","DotSeparatedAttributePattern","RefAttributePattern","_parts","EventAttributePattern","ColonPrefixedBindAttributePattern","AtPrefixedTriggerAttributePattern","hydrateElement","hydrateAttribute","hydrateTemplateController","hydrateLetElement","setProperty","interpolation","propertyBinding","letBinding","refBinding","iteratorBinding","multiAttr","textBinding","listenerBinding","attributeBinding","stylePropertyBinding","setAttribute","setClassAttribute","setStyleAttribute","spreadTransferedBinding","spreadElementProp","spreadValueBinding","InstructionType","IInstruction","InterpolationInstruction","from","to","PropertyBindingInstruction","mode","IteratorBindingInstruction","forOf","props","RefBindingInstruction","SetPropertyInstruction","MultiAttrInstruction","HydrateElementInstruction","projections","containerless","captures","data","HydrateAttributeInstruction","alias","HydrateTemplateController","HydrateLetElementInstruction","instructions","toBindingContext","LetBindingInstruction","TextBindingInstruction","ListenerBindingInstruction","capture","modifier","SetAttributeInstruction","SetClassAttributeInstruction","SetStyleAttributeInstruction","AttributeBindingInstruction","attr","SpreadTransferedBindingInstruction","SpreadElementPropBindingInstruction","instruction","SpreadValueBindingInstruction","BindingCommandDefinition","nameOrDef","getCommandAnnotation","getCommandKeyFrom","aliasName","$Type","bindingCommandTypeName","cmdBaseName","BindingCommand","staticResourceDefinitionMetadataKey","getDefinitionFromStaticAu","typeName","createDef","OneTimeBindingCommand","exprParser","attrMapper","ToViewBindingCommand","FromViewBindingCommand","TwoWayBindingCommand","DefaultBindingCommand","bindable","defDefaultMode","ForBindingCommand","attrName","attrValue","attrSyntax","TriggerBindingCommand","CaptureBindingCommand","AttrBindingCommand","StyleBindingCommand","ClassBindingCommand","classes","RefBindingCommand","SpreadValueBindingCommand","ITemplateElementFactory","TemplateElementFactory","markupCache","template","node","needsWrapping","prevSibling","nextSibling","auLocationStart","auLocationEnd","insertBefore","newChildNode","insertManyBefore","newChildNodes","appendToTemplate","appendManyToTemplate","children","isElement","isTextNode","auslotAttr","defaultSlotName","generateElementName","TemplateCompiler","CompilationContext","isTemplateElement","TEMPLATE_NODE_NAME","content","hooks","TemplateCompilerHooks","localTemplateIdentifier","attrSyntaxs","targetDef","elDef","isCustomElement","attrDef","attrInstructions","attrBindableInstructions","bindablesInfo","primaryBindable","bindingCommand","isMultiBindings","attrTarget","commandBuildInfo","hasInlineBindings","resetCommandBuildInfo","el","attrs","bindableInfo","realAttrTarget","realAttrValue","invalidSurrogateAttribute","letInstructions","elName","isShadowDom","hasCaptureFilter","removeAttr","plainAttrInstructions","elBindableInstructions","tcInstructions","tcInstruction","elementInstruction","processContentResult","hasContainerless","canCapture","needsMarker","elementMetadata","spreadIndex","voidDefinition","shouldCompileContent","isMarker","mostInnerTemplate","childContext","childEl","targetSlot","hasAuSlot","slotTemplateRecord","slotTemplates","slotTemplate","projectionCompilationContext","isEmptyTextNode","next","part","attrRawValue","bindableAttrsInfo","valueLength","root","localTemplates","numLocalTemplates","localTemplateNames","localElementTypes","localTemplate","processTemplateName","bindableEls","properties","attributes","bindables","allBindables","bindableEl","property","attribute","ignoredAttributes","allowedLocalTemplateBindableAttributes","LocalDepType","compilationDeps","localElementType","nodeName","orderSensitiveInputType","_instructions","modelOrValueOrMatcherIndex","checkedIndex","valueIndex","multipleIndex","hasParent","IResourceResolver","IBindingCommandResolver","syntax","DefaultBindingCommandResolver","record","owningElementName","ITemplateCompilerHooks","hasOwnProp","rtDef","rtDefineHiddenProp","ensureProto","defaultValue","rtObjectAssign","rtObjectFreeze","rtSafeString","rtCreateInterface","rtGetMetadata","rtDefineMetadata","Scope","bindingContext","overrideContext","isBoundary","currentScope","bc","oc","OverrideContext","ps","BindingContext","astAssign","astEvaluate","astBind","astUnbind","getContext","s","e","evaluatedValue","ret","autoObserveArrayMethods","lastIdx","map","param","functionScope","$right","val","item","indexOrProperties","restValue","acc","mixinNoopAstEvaluator","tsPending","tsRunning","tsCompleted","tsCanceled","resolvedPromise","runScheduled","isAutoRun","queue","pendingAsyncCount","settlePromise","taskErrors","settlePromiseResolve","settlePromiseReject","requestRun","runTasks","signalSettled","hasPerformedWork","errors","isManualRun","reject","extraTaskCount","isEmpty","task","err","tasksSettled","queueTask","queueAsyncTask","Task","Task$1","delay","abortErr","TaskAbortError","idx","queueRecurringTask","opts","RecurringTask","_callback","_interval","ICoercionConfiguration","atNone","atObserver","atNode","atLayout","AccessorType","createIndexMap","batching","subscriberCollection","subscriberCollectionDeco","getSubscriberRecord","SubscriberRecord","addSubscriber","subscriber","removeSubscriber","decoratedTarget","oldVal","sub","collection","indexMap","_subs","dirtySub","CollectionLengthObserver","owner","newValue","_arr","oldValue","implementLengthObserver","CollectionSizeObserver","_collection","klass","subscribe","unsubscribe","getArrayObserver","lookupMetadataKey","observerLookup","sortCompare","y","preSortCompare","insertionSort","compareFn","velement","ielement","vtmp","itmp","order","quickSort","thirdIndex","v0","v1","v2","i0","i1","i2","c01","c02","c12","vpivot","ipivot","lowEnd","highStart","vtopElement","partition","methods","observe","overrideArrayPrototypes","$push","$unshift","$pop","$shift","$splice","$reverse","$sort","o","argCount","inserts","element","deleteCount","relativeStart","actualStart","actualDeleteCount","itemCount","deleted","middle","lower","upper","lowerValue","lowerIndex","upperValue","upperIndex","shouldNotify","enableArrayObservationCalled","observationEnabledKey","enableArrayObservation","ArrayObserverImpl","subs","ArrayIndexObserverImpl","arrayObserver","prevValue","currValue","observer","getSetObserver","$add","$clear","$delete","oldSize","entry","deleteResult","enableSetObservation","set","SetObserverImpl","observedSet","size","getMapObserver","enableMapObservation","MapObserverImpl","connectableDecorator","BindingObserverRecord","unsubscribeStale","unsubscribeAll","version","subscribable","getObserverRecord","observeCollection","subscribeTo","noopHandleChange","noopHandleCollectionChange","connectable","_connectable","connectables","connecting","pauseConnecting","resumeConnecting","currentConnectable","enterConnectable","exitConnectable","ConnectableSwitcher","R$get","toStringTag","proxyMap","nowrapClassKey","nowrapPropKey","canWrap","rawKey","wrap","getProxy","createProxy","getRaw","unwrap","doNotCollect","arrayHandler","collectionHandler","objectHandler","proxiedObj","receiver","p","wrappedArrayMap","wrappedArrayIncludes","wrappedArrayIndexOf","wrappedArrayLastIndexOf","wrappedArrayEvery","wrappedArrayFilter","wrappedArrayFind","wrappedArrayFindIndex","wrappedArrayFlat","wrappedArrayFlatMap","wrappedArrayJoin","wrappedArrayPush","wrappedArrayPop","wrappedReduce","wrappedReduceRight","wrappedArrayReverse","wrappedArrayShift","wrappedArrayUnshift","wrappedArraySlice","wrappedArraySplice","wrappedArraySome","wrappedArraySort","wrappedKeys","wrappedValues","wrappedEntries","separator","_args","initValue","curr","wrappedClear","wrappedDelete","wrappedForEach","wrappedAdd","wrappedGet","wrappedSet","wrappedHas","iterator","ProxyObservable","ComputedObserver","get","observerLocator","flush","coercer","coercionConfig","computedPropInfo","normalizeKey","IDirtyChecker","DirtyCheckSettings","DirtyChecker","tracked","DirtyCheckProperty","dirtyChecker","_v","PrimitiveObserver","PropertyAccessor","SetterObserver","propertyAccessor","IObserverLocator","ObserverLocator","INodeObserverLocator","DefaultNodeObserverLocator","IComputedObserverLocator","pd","adapter","getObserverLookup","cached","observedArray","observedMap","getOwnPropDesc","getProto","obs","getCollectionObserver","RunEffect","oL","ExpressionObserver","notImplemented","createError","Platform","g","overrides","TaskQueue","platform","isPersistent","$request","$cancel","Tracer","now","cur","createExposedPromise","preempt","persistent","suspend","defaultQueueTaskOptions","preemptDelayComboError","preemptyPersistentComboError","time","promise","tracer","taskQueue","createdTime","queueTime","$ret","console","prefix","processing","pending","delayed","flushReq","susTask","created","status","$resolve","$reject","executor","BrowserPlatform","domRequested","domHandle","requestDomFlush","flushDomQueue","cancelDomFlush","domQueue","defaultMode","oneTime","toView","fromView","twoWay","hasMetadata","O","baseObjectPrototype","hasOwnProperty","getOwnPropertyNames","objectKeys","IsDataAttribute","isDataAttribute","svgAnalyzer","rethrow","defineHiddenProp","addSignalListener","signaler","signal","listener","removeSignalListener","configOrPropOrTarget","configOrProp","decorator","_target","$prop","baseName","BindableDefinition","Bindable","bindableLists","addName","addDescription","addList","maybeList","prototypeChain","iProto","Class","bindableMetadata","getInterceptor","Coercer","$coercer","createCoercer","nullable","coercionConfiguration","registerResolver","ctn","dtElement","dtAttribute","metadataKey","BindingBehaviorDefinition","getBehaviorAnnotation","BindingBehavior","getBindingBehaviorKeyFrom","behaviorTypeName","bbBaseName","originalModesMap","createConfig","BindingModeBehavior","binding","OneTimeBindingBehavior","ToViewBindingBehavior","FromViewBindingBehavior","TwoWayBindingBehavior","bindingHandlerMap$1","defaultDelay$1","DebounceBindingBehavior","IPlatform$1","signals","ISignaler","Signaler","listeners","SignalBindingBehavior","names","bindingHandlerMap","defaultDelay","ThrottleBindingBehavior","IAppTask","Refs","refs","refsMap","hideProp","controller","ref","INode","Watch","watches","CustomAttributeDefinition","defaultBindingMode","isTemplateController","noMultiBindings","containerStrategy","getAttributeAnnotation","getAttributeKeyFrom","attrTypeName","attributeBaseName","isAttributeType","findAttributeControllerFor","defineAttribute","getAttributeDefinition","findClosestControllerByName","attrNameOrType","getEffectiveParentNode","CustomAttribute","ILifecycleHooks","LifecycleHooksEntry","LifecycleHooksDefinition","propertyNames","LifecycleHooks","definitionMap","ctx","LifecycleHooksLookupImpl","instances","entries","ValueConverterDefinition","getConverterAnnotation","ValueConverter","getValueConverterKeyFrom","converterTypeName","vcBaseName","BindingTargetSubscriber","flushQueue","mixinUseScope","useScope","mixinAstEvaluator","ResourceLookup","converterResourceLookupCache","behaviorResourceLookupCache","appliedBehaviors","evaluatorGet","evaluatorGetBehavior","resourceLookup","evaluatorBindBehavior","behavior","applied","evaluatorUnbindBehavior","evaluatorGetConverter","evaluatorBindConverter","vc","evaluatorUnbindConverter","evaluatorUseConverter","withContext","callerContext","IHydrationContext","IFlushQueue","FlushQueue","flushable","flushItem","mixingBindingLimited","withLimitationBindings","debounced","callOriginal","limiterTask","latestValue","isPending","callOriginalCallback","dispose","throttled","elapsed","getMethodName","originalFn","limitedFn","signalListener","createPrototypeMixer","mixed","mixer","AttributeBinding","locator","targetAttribute","targetProperty","strict","force","cls","priority","InterpolationBinding","partBindings","InterpolationPartBinding","activating","staticParts","accessor","ContentBinding","LetBinding","_scope","PropertyBinding","$mode","targetObserver","shouldConnect","propBinding","RefBinding","ListenerBindingOptions","prevent","onError","ListenerBinding","targetEvent","modifiedEventHandler","IModifiedEventHandlerCreator","IKeyMapping","ModifiedMouseEventHandler","modifiers","stop","m","ModifiedKeyboardEventHandler","mod","ModifiedEventHandler","IEventModifier","EventModifier","EventModifierRegistration","IViewFactory","ViewFactory","doNotOverrideIfAlreadySet","_controller","parentController","Controller","createLocation","createComment","locationEnd","createMutationObserver","IAuSlotsInfo","AuSlotsInfo","projectedSlots","IAuSlotWatcher","SpreadBinding","hydrationContext","rendering","compiler","bindings","renderers","getHydrationContext","currentLevel","currentContext","renderSpreadInstruction","spreadBinding","findElementControllerFor","innerScope","vmkCa","SpreadValueBinding","targetKeys","ol","l","unbind","addListener","removeListener","mixinNodeObserverUseConfig","prototype","mixinNoopSubscribable","ClassAttributeAccessor","mapping","nameIndex","classList","classesToAdd","getClassesToAdd","splitClassString","classString","fromHydrationContext","IRenderer","renderer","ensureExpression","parser","srcOrExpr","getTarget","potentialTarget","getRefTarget","refHost","refTargetName","caController","ceController","SetPropertyRenderer","renderingCtrl","CustomElementRenderer","IRendering","component","childCtrl","ctxContainer","CustomElement","location","convertToRenderLocation","createElementContainer","propInst","CustomAttributeRenderer","invokeAttribute","childController","TemplateControllerRenderer","viewFactory","renderLocation","LetElementRenderer","childInstructions","childInstruction","RefBindingRenderer","InterpolationBindingRenderer","cssMapping","ICssClassMapping","PropertyBindingRenderer","IteratorBindingRenderer","TextBindingRenderer","IListenerBindingOptions","errorEvent","ListenerBindingRenderer","SetAttributeRenderer","SetClassAttributeRenderer","addClasses","SetStyleAttributeRenderer","ambiguousStyles","StylePropertyBindingRenderer","DevStylePropertyBinding","AttributeBindingRenderer","classMapping","SpreadRenderer","SpreadValueRenderer","instructionTarget","className","controllerProviderName","instructionProviderName","locationProviderName","slotInfoProviderName","host","auSlotsInfo","registerHostNode","IController","IRenderLocation","noLocationProvider","RenderLocationProvider","noViewFactoryProvider","noAuSlotProvider","ViewFactoryProvider","$renderingCtrl","_location","Rendering","r","FragmentNodeSequence","compiledMap","compiled","CustomElementDefinition","fragment","needsImportNode","doc","tpl","targets","rows","row","walker","currentNode","IShadowDOMStyles","IShadowDOMGlobalStyles","enter","exit","ComputedWatcher","$get","ExpressionWatcher","activated","deactivating","vmkCe","vmkSynth","HooksDefinition","vmKind","viewModel","targetNone","controllerLookup","$el","hydrationInst","getElementDefinition","HydrationContext","createWatchers","createObservers","callHydratingHook","compiledDef","shadowOptions","hasSlots","setRef","elementBaseName","defaultShadowOptions","targetShadowRoot","targetLocation","targetHost","callHydratedHook","callCreatedHook","initiator","deactivated","disposed","stringifyState","callBindingHook","callBoundHook","nodes","callAttachingHook","_parent","prevActivation","released","callDetachingHook","_resolve","_reject","_retPromise","callAttachedHook","callUnbindingHook","shadowRoot","callDispose","visitor","MountTarget","optionalCoercionConfigResolver","observableNames","hasAggregatedCallbacks","coercion","queueCallback","changes","isQueued","changeCount","callPropertiesChanged","$changes","AccessScopeAstMap","getAccessScopeAst","expressionParser","IEventTarget","IAppRoot","effectiveParentNodeOverrides","containerlessOffset","setEffectiveParentNode","childNodeOrNodeSequence","parentNode","isRenderLocation","locationStart","targetNodeList","childNodeList","childNodes","refNode","enhance","customElement","defineElement","definitionLookup","injectable","needsCompile","surrogates","processContent","generateElementType","getElementKeyFrom","returnFalse","returnNull","getElementAnnotation","returnTrue","returnEmptyArray","returnUndefined","partialDefinition","defaultForOpts","elementTypeName","annotateElementMetadata","isElementType","foundAController","createElementInjectable","$injectable","nameDescriptor","defaultProto","AppRoot","rootProvider","noAction","childCtn","slot","appTasks","IAurelia","Aurelia$1","Aurelia","appRoot","ev","ISVGAnalyzer","NoopSVGAnalyzer","_node","_attributeName","AttrMapper","newAttrMapping","targetAttrMapping","tagName","mapper","shouldDefaultToTwoWay","RuntimeTemplateCompilerImplementation","ResourceResolver","BindablesInfo","RecordCache","hasPrimary","nsMap","AttributeNSAccessor","ns","propertyKey","DataAttributeAccessor","attrAccessor","SelectValueObserver","selection","option","$isArray","matcher","optionValue","currentValue","_records","oV","customPropertyPrefix","StyleAttributeAccessor","styleTuples","urlRegexTester","currentChunk","nextSplit","indexOfColon","styles","style","tuple","ValueAttributeObserver","nsAttributes","xlinkNS","xmlNS","xmlnsNS","elementPropertyAccessor","NodeObserverLocator","inputEvents","inputEventsConfig","CheckedObserver","contentEventsConfig","scrollEventsConfig","nodeNameOrConfig","eventsConfig","existingMapping","throwMappingExisted","newMapping","configOrKey","nsProps","tagNameOrOverrides","existingTagOverride","nodeObserver","defaultMatcher","_newValue","_previousValue","elementValue","isRadio","hasMatch","pair","existingItem","$isChecked","isChecked","unset","currItem","AttrBindingBehavior","SelfBindingBehavior","UpdateTriggerBindingBehavior","events","targetConfig","If","_initiator","currView","ctrl","swapId","isCurrent","view","Else","_childController","_instruction","ifBehavior","wrappedExprs","Repeat","IRepeatableHandlerResolver","keyProp","dec","$controller","oldViews","oldLen","hasKey","oldScopes","newScopes","local","newLen","hasDestructuredLocal","getItem","oldKeys","getKeyValue","newKeys","innerItems","observingInnerItems","newObserver","oldObserver","scopes","oldScopeMap","newScopeMap","parentScope","createScope","setItem","getScope","src","normalizedItems","$items","_factory","_scopes","views","setContextualProperties","compareNumber","deletedLen","_oldViews","seq","longestIncreasingSubsequence","seqLen","maxLen","prevIndices","tailIndices","cursor","prev","low","high","mid","RepeatOverrideContext","RepeatableHandlerResolver","IRepeatableHandler","_arrayHandler","_setHandler","_mapHandler","_numberHandler","_nullishHandler","_unknownHandler","getCollectionObserver$1","_value","_func","With","_oldValue","Switch","$case","isMatch","activeCases","numActiveCases","newActiveCases","fallThrough","cases","defaultCase","numCases","firstCase","action","previousPromise","caseId","Case","$switch","$value","auSwitch","DefaultCase","PromiseTemplateController","fulfilled","rejected","preSettlePromise","$swap","fulfill","PendingTemplateController","getPromiseController","FulfilledTemplateController","resolvedValue","RejectedTemplateController","$promise","PromiseAttributePattern","FulfilledAttributePattern","RejectedAttributePattern","Focus","isFocused","shouldFocus","Portal","originalLoc","newTarget","_resolvedTarget","callbackContext","$document","queryContext","position","emptyTemplate","AuSlot","hdrContext","slotName","fallback","projection","contextContainer","w","outerScope","records","isMutationWithinLocation","comparePosition","addedNodes","removedNodes","AuCompose","CompositionContextFactory","ChangeInfo","cmpstn","change","prevCompositionCtrl","model","loc","vmDef","compositionHost","compositionLocation","removeCompositionHost","comp","compose","aucomposeCapturedAttrs","capturedBindingAttrs","transferedToHostBindingAttrs","attrGroups","shouldCapture","CompositionController","attachInitiator","deactachInitiator","detachInitiator","EmptyComponent","Ctor","capturedAttrs","transferHydrationContext","loaded","CompositionContext","_template","_component","_model","_src","LoadedChangeInfo","update","detachInitator","ISanitizer","SanitizeValueConverter","untrustedMarkup","Show","instr","DefaultComponents","DefaultBindingSyntax","DefaultBindingLanguage","DefaultResources","DefaultRenderers","StandardConfiguration","createConfiguration","optionsProvider","runtimeConfigurationOptions","PLATFORM","parseHeader","fileCode","shapeType","minX","minY","maxX","maxY","polygonCentroid","points","area","cx","cy","x0","y0","x1","y1","cross","factor","averagePoint","sumX","sumY","readPolyRecord","numParts","numPoints","partOffset","pointsOffset","partStarts","base","weightedCx","weightedCy","totalArea","slice","centroid","readMultiPointRecord","parseShapefile","header","recordIndex","contentBytes","recordStart","recordEnd","pts","recordCount","headerLength","recordLength","parseFields","fields","recordOffset","nameBytes","zeroIdx","decimals","readString","bytes","normalizeDateString","trimmed","parseValue","field","num","parseDbf","deletedFlag","rec","updateBounds","parseGeoJsonPoints","json","bounds","feat","geom","lon","lat","dateStart","dateStop","CRC_TABLE","table","_geoJsonFile_dec","_dbfFile_dec","_shpFile_dec","_DataExtractorView_decorators","_init","DataExtractorView","owningView","file","parsed","page","safePage","delta","lines","vals","col","blob","headers","xlsxBytes","latStr","lonStr","url","shpBuffer","dbfData","dbfBuffer","point","recordIdx","date","onlyWithDate","boundsEnabled","search","hasBounds","filtered","rowDate","sorted","direction","da","db","rd","wgs","phi0","lam0","K","L","dx","dy","phi","lam","q","orderedFields","exclude","cols","digits","iso","width","height","sheetName","sheetXml","workbookXml","workbookRels","contentTypes","rels","files","cells","rIdx","cIdx","addr","n","rem","encoder","localParts","centralParts","crc","localHeader","localBuf","centralHeader","centralBuf","centralSize","sum","centralOffset","endHeader","chunks","total","out","chunk","filename","__decoratorStart","__decorateElement"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8]}